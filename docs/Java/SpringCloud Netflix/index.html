<!doctype html>
<html lang="cn" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Java/SpringCloud Netflix" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">springcloud2020 | 小冷の代码世界</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-site.example.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-site.example.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-site.example.com/docs/Java/SpringCloud Netflix"><meta data-rh="true" property="og:locale" content="cn"><meta data-rh="true" name="docusaurus_locale" content="cn"><meta data-rh="true" name="docsearch:language" content="cn"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="springcloud2020 | 小冷の代码世界"><meta data-rh="true" name="description" content="整理知识"><meta data-rh="true" property="og:description" content="整理知识"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-site.example.com/docs/Java/SpringCloud Netflix"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/docs/Java/SpringCloud Netflix" hreflang="cn"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/docs/Java/SpringCloud Netflix" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.15cbc4ab.css">
<script src="/assets/js/runtime~main.41489e3b.js" defer="defer"></script>
<script src="/assets/js/main.53b12e53.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="小冷の代码世界" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="小冷の代码世界" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">小冷の代码世界</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/Java/Docker 快速入门">Java知识库</a><a class="navbar__item navbar__link" href="/docs/Web/JavaScript 高级">前端知识库</a><a class="navbar__item navbar__link" sidebarid="GodotSidebar" href="/docs/Godot">Godot游戏开发</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Doomwatcher2004" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Docker 快速入门">Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Java 8 更新的新特性 （函数式接口 lambda stream option）">Java8 新特性</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Java后端进阶之路： JavaWeb">javaweb</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Mybatis">Mybatis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Netty+springboot实现IM即时通讯服务端">Netty+springboot实现IM即时通讯服务端</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Netty_HTTP文件列表服务器">Netty_HTTP文件列表服务器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Netty_模拟Redis的客户端">Netty_模拟Redis的客户端</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Netty网络框架">Netty 网络框架</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Nginx">Nginx</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Redis 数据结构操作入门">Redis 数据结构操作入门</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Spring Aop 底层责任链思路实现">Spring Aop 底层责任链思路实现</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Spring5 Webflux 响应式编程">Spring5 Webflux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/SpringBoot 解决企业级复杂性简化开发的神奇">微服务阶段</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/SpringCloud Alibaba">springCloudAlibaba</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/Java/SpringCloud Netflix">springcloud2020</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Spring内置MVC框架：SpringMVC">SpringMVC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/mybatis plus">mybatis plus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/redis问题的常见解决方案">redis问题的常见解决方案</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/使用Netty+zookeeper开发一款高性能LRpc">RPC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/六道入门树题目带你走入树结构的世界">六道入门树题目带你走入树结构的世界</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/分布式项目中锁的应用（本地锁-redis【setnx】-redisson-springcache）">分布式项目中锁的应用（本地锁-redis【setnx】-redisson-springcache）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/多线程进阶 JUC并发编程">多线程进阶 JUC 并发编程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/大前端进阶（ES6）">ES6</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/快速入门RabbitMQ并且加入项目实战">快速入门RabbitMQ并且加入项目实战</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/快速入门分布式系统与Dubbo+zookeeper">分布式系统简述：</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/掌握极简服务器开发的优秀框架 ：Spring">Spring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/搜索引擎 _ Elasticsearch">Elasticsearch</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/数据结构与算法">数据结构与算法</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/理解IOC 手写springIOC">Spring 手撕 IOC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/线程池详解与异步任务编排使用案例">线程池详解与异步任务编排使用案例</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/通透百万数据秒级排序  快速排序">通透百万数据秒级排序  快速排序</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/阿里淘系单点登录中心">阿里淘系单点登录中心</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/高并发秒杀系统">高并发秒杀系统</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">springcloud2020</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>springcloud2020</h1></header>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="整理知识">整理知识<a href="#整理知识" class="hash-link" aria-label="Direct link to 整理知识" title="Direct link to 整理知识">​</a></h3>
<p>串一下自己之前的东西</p>
<p>这个阶段该如何学</p>
<p>在学习新知识的同时不忘回顾自己以及拥有的知识</p>
<p><strong>我自己的东西</strong></p>
<ul>
<li>javaSE</li>
<li>数据库</li>
<li>前端知识</li>
<li>Servlet</li>
<li>springboot</li>
<li>Mybatis</li>
<li>spring</li>
<li>Maven</li>
<li>Ajax</li>
<li>dubbo+zookeeper</li>
</ul>
<p>我差了的东西</p>
<ul>
<li>Http</li>
</ul>
<blockquote>
<p>标准的变化</p>
</blockquote>
<p>我们在之前以学过了 ssm</p>
<p>我们的开发核心在哪里</p>
<blockquote>
<p>javaEE 标准</p>
</blockquote>
<p><strong>spring</strong> javaEE 开发标准</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">spring几乎连接着我们开发中的一切，他就像一个中央集成一样</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>但是慢慢的我们发现，他真的轻量吗？</p>
<ul>
<li>随着开发量不断增多的配合内容</li>
</ul>
<p>让他变得不再轻量，于是乎新的解决方案诞生了</p>
<blockquote>
<p>javaEE 新标准</p>
</blockquote>
<p>springboot javaEE 开发新的标准</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">	他简化了繁琐的配置，自动化的帮助我们干了很多的配置上需要重复干的事情，</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">	给了我们一套默认的解决方案，我们可以把boot理解成一个 spring的plus版，他集成了很多的启动器，从而让springboot逐渐取代了 ssm，springboot慢慢的变成了javaEE最好的解决方案，让无数企业喜爱</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>不管是新标准还是旧标准，他的特点是统一的：约定大于配置</p>
<blockquote>
<p>最开始</p>
</blockquote>
<p>我们现在开发的程序 all in one 的形式，所有的模块全在一个 jar 或者 war 包下</p>
<blockquote>
<p>演进</p>
</blockquote>
<p>那么随着架构的演进我们逐渐把功能拆分出来，代码并没有什么变化</p>
<p>但是一旦并发量高起来，这样的架构，我们的机器无法让业务正常实行了</p>
<blockquote>
<p>现在</p>
</blockquote>
<p>解决方法应运而生，微服务架构</p>
<p>把功能拆分多个设备上去，来解决性能上导致业务无法正常运行的问题</p>
<p>微服务四大核心问题：</p>
<ol>
<li>服务很多，用户如何访问，注册中心</li>
<li>服务中如何通信 ： rpc</li>
<li>这么多服务，服务治理？</li>
<li>服务挂了怎么办？</li>
</ol>
<p>对于这些问题，spring cloud 是个生态</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/19395dea3a3bd1584a0fbf73f78ba524.png" alt="" class="img_ev3q"></p>
<p>用来解决这四个问题的</p>
<ol>
<li>
<p>Spring cloud netfix 一站式解决方案</p>
<p>api 网关，zuul 组件</p>
<p>Feign --HttpClinet ----Http 通信方式</p>
<p>服务注册发现：Eureka</p>
<p>熔断机制： Hystrix</p>
<p>。。。。</p>
</li>
<li>
<p>Apache Dubbo zookeeper 半自动，需要整合别人的</p>
<p>API 没有，找第三方组件，或者自己实现</p>
<p>Dubbo 通信，高性能 rpc 框架</p>
<p>服务注册发现：zookeeper</p>
<p>熔断机制并没有：借助 Hystrix</p>
</li>
<li>
<p>Spring Cloud Alibaba 最新的一站式解决方案！</p>
</li>
</ol>
<p>新概念：服务网格！server mesh</p>
<p><strong>概念都是一样的：</strong></p>
<ol>
<li>API</li>
<li>http rpc</li>
<li>注册与发现</li>
<li>熔断机制</li>
</ol>
<p>为什么会出现这个情况，因为：网络不可靠!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="微服务">微服务<a href="#微服务" class="hash-link" aria-label="Direct link to 微服务" title="Direct link to 微服务">​</a></h2>
<ul>
<li>就目前而言微服务，业界没有统一标准的定义</li>
<li>微服务架构是一种架构模式，或者是一种架构风格他提倡单一应用程序划分一组小服务，每个服务运行在自己独立的进程内，服务之间，互相协调，互相配置，为用户提倡最终的价值，体现最终价值，服务之间采用轻量级的通信机制互相沟通，每个服务围绕具体的业务构建，并且能够被独立的部署在生产环境中，另外，尽量避免统一的，集中式管理的服务管理机制，对具体的一个服务而言，根据上下文，选择合适的语言，工具，对齐构建，可以有一个非常轻量的集中式管理来协调业务，可以使用不同的语言编写，也可以用不同的数据储存</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="我们从技术维度理解一下">我们从技术维度理解一下<a href="#我们从技术维度理解一下" class="hash-link" aria-label="Direct link to 我们从技术维度理解一下" title="Direct link to 我们从技术维度理解一下">​</a></h3>
<p>就是微服务的作用就是将传统的一个项目解决业务（一站式应用）根据业务拆分成一个一个的服务，去彻底的去耦合，每个微服务提供单个业务的功能服务，一个服务做一个事情，从技术角度来说就是一个小而独立的处理过程，类的进程的概念，能够自行单独启动或销毁，拥有自己独立的数据库</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="微服务与微服务架构">微服务与微服务架构<a href="#微服务与微服务架构" class="hash-link" aria-label="Direct link to 微服务与微服务架构" title="Direct link to 微服务与微服务架构">​</a></h3>
<p><strong>微服务</strong></p>
<p>强调的是服务的大小 ，他关注的是一个点，是具体解决某一个问题提供落地对服务的应用，就是 idea 中一个个微服务的工程或者 moudel</p>
<p>idea 工具里面使用 maven 建立的一个个独立的小 moudle，他具体是使用 springboot 开发的一个个小模块，专业的事情交给专业的模版来做，一个模块做着一件事情</p>
<p>强调的是一个个的个体，每个个体完成一个具体的任务或者功能！</p>
<p><strong>微服务架构</strong></p>
<p>一钟新的架构形式，Martin Fowler</p>
<p>2014 推出</p>
<ul>
<li>微服务架构是一种架构模式，或者是一种架构风格他提倡单一应用程序划分一组小服务，每个服务运行在自己独立的进程内，服务之间，互相协调，互相配置，为用户提倡最终的价值，体现最终价值，服务之间采用轻量级的通信机制互相沟通，每个服务围绕具体的业务构建，并且能够被独立的部署在生产环境中，另外，尽量避免统一的，集中式管理的服务管理机制，对具体的一个服务而言，根据上下文，选择合适的语言，工具，对齐构建，可以有一个非常轻量的集中式管理来协调业务，可以使用不同的语言编写，也可以用不同的数据储存</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="微服务的有缺点">微服务的有缺点<a href="#微服务的有缺点" class="hash-link" aria-label="Direct link to 微服务的有缺点" title="Direct link to 微服务的有缺点">​</a></h3>
<p>优点</p>
<ul>
<li>单一职责原则</li>
<li>每个服务足够内聚，足够小，代码容易理解，这个能聚焦一个指定的业务功能和业务需求</li>
<li>开发简单，开发效率提高，一个服务可能就是转义的只干一件事情</li>
<li>微服务能够被小团队单独开发，这个小团队是 2~5 的开发人员组成</li>
<li>微服务是松耦合的，是具有功能意义的服务，无论是在开发阶段或者部署阶段都是独立的</li>
<li>微服务能使用不同的预言开发</li>
<li>易于是第三方集成，微服务允许容易且灵活的方式集成自动部署，通过持续集成工具，如 jenkins，hudson，bamboo</li>
<li>微服务易于被一个开发人员理解，修改和维护，这样小团队能够更加关注自己的工作成果。无需通过合作才能体现价值</li>
<li>微服务允许你利用融合最新技术</li>
<li>微服务只是业务逻辑的代码，不会喝 html，css 或其他的界面混合</li>
<li>每个微服务都有自己的储存能力，可以有自己的数据库，也可以有统一数据库</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>开发人员要处理分布式系统的复杂性</li>
<li>多服务运维难度，随着服务的增加，运维压力也在增大</li>
<li>系统部署依赖</li>
<li>服务间通信成本</li>
<li>数据一致性</li>
<li>系统集成测试</li>
<li>性能监控</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="微服务技术栈">微服务技术栈<a href="#微服务技术栈" class="hash-link" aria-label="Direct link to 微服务技术栈" title="Direct link to 微服务技术栈">​</a></h3>





































































<table><thead><tr><th>微服务技术条目</th><th>落地技术</th></tr></thead><tbody><tr><td>服务开发</td><td>SpringBoot，Spring，SpringMVC</td></tr><tr><td>服务配置与管理</td><td>netflix 公司的 archaius 和阿里的 diamond 等</td></tr><tr><td>服务注册与发现</td><td>eureka，consul，zookeeper</td></tr><tr><td>服务调用</td><td>rest，rpc，grpc</td></tr><tr><td>服务熔断器</td><td>Hystrix，Envoy 等</td></tr><tr><td>负载均衡</td><td>RIbbon，nginx 等</td></tr><tr><td>服务接口调用（服务端调用服务的简化工具）</td><td>Feign 等</td></tr><tr><td>消息队列</td><td>kafka，rabbitMQ,ActiveMQ</td></tr><tr><td>服务配置中心管理</td><td>SpringCloudconfig，chef 等</td></tr><tr><td>服务路由</td><td>Zuul 等</td></tr><tr><td>服务监控</td><td>zabbix，Nagios，M ertrics，Specatator</td></tr><tr><td>全链路追踪</td><td>Zipkin，Brave，Dapper</td></tr><tr><td>服务部署</td><td>DOCKER，openStack，kubernetes</td></tr><tr><td>数据操作开发包</td><td>Springcloud Stream（封装与 rides，rabbit，kafka 等发送接收消息）</td></tr><tr><td>事件消息总线</td><td>springcloud Bus</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="为什么我们要选择-springcloud-作为微服务架构呢">为什么我们要选择 SpringCloud 作为微服务架构呢<a href="#为什么我们要选择-springcloud-作为微服务架构呢" class="hash-link" aria-label="Direct link to 为什么我们要选择 SpringCloud 作为微服务架构呢" title="Direct link to 为什么我们要选择 SpringCloud 作为微服务架构呢">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1选型依据">1、选型依据<a href="#1选型依据" class="hash-link" aria-label="Direct link to 1、选型依据" title="Direct link to 1、选型依据">​</a></h4>
<ul>
<li>整体解决方案和框架成熟度</li>
<li>社区热度</li>
<li>可维护性</li>
<li>学习曲线</li>
</ul>
<p>2、当前各大公司微服务架构是那些</p>
<ul>
<li>阿里：dubbo+hfs</li>
<li>京东：jsf</li>
<li>新浪：Motan</li>
<li>当当： bubbox</li>
</ul>





















































































































<table><thead><tr><th>功能和服务框架</th><th>Netflix/springCloud</th><th>Motan</th><th>grpc</th><th>thrift</th><th>Dubbo/dubbox</th></tr></thead><tbody><tr><td>功能定位</td><td>完整的微服务框架</td><td>rpc 框架但是整合了 zk 或者 consul 可以实现集群环境和基本的服务注册发现</td><td>rpc 框架</td><td>rpc 框架</td><td>服务框架</td></tr><tr><td>支持 rest</td><td>支持，ribbon 支持多种可插拔序列化选择</td><td>否</td><td>否</td><td>否</td><td>否</td></tr><tr><td>支持 rpc</td><td>否（但是可以和 dubbo 兼容）</td><td>是</td><td>是</td><td>是</td><td>是</td></tr><tr><td>支持多语言</td><td>支持（rest 形式）</td><td>否</td><td>是</td><td>是</td><td>否</td></tr><tr><td>负载均衡</td><td>支持（服务端 zuul+客户端 ribbon），zuul 服务，动态路由，云端负载均衡，eureka 针对中间层服务器</td><td>支持（客户端）</td><td>否</td><td>否</td><td>是（客户端）</td></tr><tr><td>配置服务</td><td>netfix archaius spring cloud config Server 集中配置</td><td>是（zookeeper 提供）</td><td>否</td><td>否</td><td>否</td></tr><tr><td>服务调用链监</td><td>支持，zuul，zuul 提供边缘服务，api 网关</td><td>否</td><td>否</td><td>否</td><td>否</td></tr><tr><td>高可用/容错</td><td>支持，服务端 hystrix+ribbon</td><td>支持（客户端）</td><td>否</td><td>否</td><td>支持（客户端）</td></tr><tr><td>典型应用案例</td><td>Netflix</td><td>sina</td><td>google</td><td>facebook</td><td></td></tr><tr><td>社区活跃度</td><td>高</td><td>一般</td><td>高</td><td>一般</td><td>2017 才开始重新维护，之前中断了五年</td></tr><tr><td>学习难度</td><td>中</td><td>低</td><td>高</td><td>高</td><td>低</td></tr><tr><td>文档丰富程度</td><td>高</td><td>一般</td><td>一般</td><td>一般</td><td>高</td></tr><tr><td>其他</td><td>SpringCloud bus 为我们的应用带来更多的管理端点</td><td>支持降级</td><td>netflix 内部在开发集成 grpc</td><td>idl 定义</td><td>实践的公司比较多</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="springcloud-入门概述">springcloud 入门概述<a href="#springcloud-入门概述" class="hash-link" aria-label="Direct link to springcloud 入门概述" title="Direct link to springcloud 入门概述">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="springcloud-是什么"><strong>springcloud 是什么？</strong><a href="#springcloud-是什么" class="hash-link" aria-label="Direct link to springcloud-是什么" title="Direct link to springcloud-是什么">​</a></h3>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/c0feb47e435fc4b97dc2dd6566e5c6dc.png" alt="" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/3c7d6ec17f42a67a541078ce3f2d745c.png" alt="" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/fd7475b223cd5ab1e94068b3fe1e34ee.png" alt="" class="img_ev3q"></p>
<p>springcloud 基于 springboot 提供了一套微服务解决方案，包括服务注册，发现，配置中心，全链路监控</p>
<p>服务网管，负载均衡，熔断器等组件，除了基于 netflix 的开源组件做高度抽象封装之外，还有一些选型中立得 1 开源组件。</p>
<p>springcloud 利用 springboot 的开发便利性，巧妙的简化了分布式系统基础设施额开发，springcloud 为开发人员提供了快速构建分布式系统的一些工具，包括配置管理，服务发现，断路器，路由，微代理，事件总线，全局锁，决策竞选，分布式会话等等，他们都可以用 springboot 的开发风格做到一键启动部署</p>
<p>springboot 并没有重复造轮子，他只是将目前各家公司开发的比较成熟经得起实际考研的 服务框架组合起来，通过 springboot 风格进行封装，屏蔽掉了复杂的配置，和实现原理，最终给开发者留出一套简单易懂，易部署，和易维护的分布式系统开发工具包</p>
<p>springcloud 是分布式微服务架构下的一站式解决方案，是各个微服务架构落地技术的集合体，俗称微服务全家桶</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="springboot-和-springcloud-的关系">springboot 和 springcloud 的关系<a href="#springboot-和-springcloud-的关系" class="hash-link" aria-label="Direct link to springboot 和 springcloud 的关系" title="Direct link to springboot 和 springcloud 的关系">​</a></h3>
<ul>
<li>springboot 专注于快速方便的开发单个个体微服务</li>
<li>springcloud 是关注全局微服务协调治框架，他将 springboot 开发的一个个单体微服务，整合并管理起来，为各个微服务之间提供了配置管理，服务发现，断路器，路由，事件总线全局锁，决策竞选，分布式会话等等集成服务</li>
<li>springboot 可以离开 springcloud 独立使用，开发项目，但是 springcloud 离不开 springboot，属于依赖关系</li>
<li><strong>springboot 专注于快速方便的开发单个个体微服务，springcloud 关注全局的服务治理框架</strong></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="dubbo-和-springcloud-技术选型">Dubbo 和 springcloud 技术选型<a href="#dubbo-和-springcloud-技术选型" class="hash-link" aria-label="Direct link to Dubbo 和 springcloud 技术选型" title="Direct link to Dubbo 和 springcloud 技术选型">​</a></h3>
<p>分布式+服务治理 Dubbo</p>
<p>目前成熟的互联网架构：应用服务化拆分+消息中间件</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/7d63a7ecc9a56284b2cd29c66c1cdd19.png" alt="" class="img_ev3q"></p>
<p>Dubbo 和 springcloud 对比</p>
<blockquote>
<p>dubbo 应为停更了之后，社区并不活跃，垂死状态，未来未知</p>
</blockquote>
<blockquote>
<p>springcloud 的社区十分活跃，正值壮年，</p>
</blockquote>
<p>对比图：</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/c4f9c93e9edc8adaa6cf089f092ccdf7.png" alt="" class="img_ev3q"></p>
<p><strong>最大区别：springcloud 抛弃了 Dubbo 的 rpc 通信，采用基于 http 的 rest 方式</strong></p>
<p>严格来说，两种方式各有优劣，从一定程度上，后者牺牲了服务调用的性能，但是也比避免了原生 rpc 带来的问题，rest 相比 rpc 更加的灵活，服务提供方和调用方的依赖只靠一个七月，不存在在吗级别的强依赖，这就是强调快速烟花的微服务环境下，显得更加合适</p>
<p><strong>品牌机和组装机的区别</strong></p>
<p>springcloud（品牌机）：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">很明显的一点就是，springcloud的功能比dubbo强大的太多，覆盖面更广，而且作为spring的明星项目，他也能够和其他的spring项目完美融合。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>dubbo（组装机）：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">使用dubbo构建微服务架构就像组装电脑，各环节，我们的选择自由度非常高，但是最终结果可能是就是一个内存条不点亮了，总是不让人那么放心，但是如果是一个高手，那这些都不是问题，</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">springcloud就像品牌机，在spring source的整合下，做了大量的兼容性测试，保证了机器拥有更高的稳定性，但是如果要在使用非原装组件外的东西，就需要对其基础足够了解，</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>社区支持和更新力度</strong></p>
<p>最重要的是，dubbo 停止了 5 年狗熊，虽然 17 年重启了，对于技术发展的需求，更需要爱发展着自行拓展升级，比如 dubbox，对于这很多想要采纳微服务的中小软件组织，显然是不太合适的，中小公司没有那么强大的技术去修改 dubbo 的源码+周边的一整套解决方案。并不是每个公司都有阿里的大牛+真实线上生产环境测试过</p>
<p><strong>总结</strong></p>
<p>曾风靡国内的 rpc 框架 Dubbo 在重启维护后，让很多用户为之雀跃，但是同时也要有质疑的声音，发展迅速的时代，dubbo 能否跟上?dubbo 和 springcloud 的差异 ？是否会有相关的举措保证 dubbo 的后续更新频率</p>
<p>dubbo 是一个专注 rpc 框架，springcloud 的目标是微服务架构下的一站式解决方案</p>
<p>设计模式+微服务拆分思想：不一定善于表达的技术人才，你可以领导他，软实力是职场关键的一点，你可能技术没有人才好，但是你的设计思维，架构理解和表达能力让你可以成为只会技术人才的团队 leader，</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="springcloud-下载">springcloud 下载<a href="#springcloud-下载" class="hash-link" aria-label="Direct link to springcloud 下载" title="Direct link to springcloud 下载">​</a></h3>
<p>springcloud 的不同版本</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/774f9adad48385485be7532a9228d7c4.png" alt="" class="img_ev3q"></p>
<p>以伦敦地铁站和字符开头来命名</p>
<p>接下来是需要知道的几个文档</p>
<p>springcloud 的中文文档：<a href="https://www.springcloud.cc/spring-cloud-dalston.html" target="_blank" rel="noopener noreferrer">https://www.springcloud.cc/spring-cloud-dalston.html</a></p>
<p>社区官网：<a href="http://docs.springcloud.cn/" target="_blank" rel="noopener noreferrer">http://docs.springcloud.cn/</a></p>
<p>以上的理论内容是和代码挂钩的，很多面试中淡资也是很重要的东西</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="上手实战咯">上手实战咯<a href="#上手实战咯" class="hash-link" aria-label="Direct link to 上手实战咯" title="Direct link to 上手实战咯">​</a></h2>
<ul>
<li>我们使用一个支付模块做一个微服务通用案例，用 rest 风格</li>
<li>回忆 ssm 所学的知识</li>
<li>maven 分包分模块的架构复习
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rvb213YXRjaGVy,size_16,color_FFFFFF,t_70.png" alt="在这里插入图片描述" class="img_ev3q"></li>
</ul>
<p>一个父工程带着多个子模块</p>
<p>动手！</p>
<p>springcloud 的大版本说明</p>













































<table><thead><tr><th>springboot</th><th>springcloud</th><th>关系</th></tr></thead><tbody><tr><td>1.2.x</td><td>天使版 angel</td><td>兼容 boot1.2.x</td></tr><tr><td>1.3.x</td><td>brixton 版本</td><td>兼容 spring1.3，也兼容 1.4</td></tr><tr><td>1.4.x</td><td>camden 版本</td><td>兼容 spring1.4，也兼容 1.5</td></tr><tr><td>1.5.x</td><td>dalston 版本</td><td>兼容 spring1.5，不兼容 2.0.x</td></tr><tr><td>1.5.x</td><td>edgware</td><td>兼容 spring1.5，不兼容 2.0</td></tr><tr><td>2.0.x</td><td>finchley</td><td>兼容 spring2.0，不兼容 1.5</td></tr><tr><td>2.1.x</td><td>greenwich</td><td></td></tr></tbody></table>
<p>到了 2020 我们发现技术一代一代的换，有的技术慢慢的停止更新维护，又会有新的更全面的解决方案跟上，时代快速发展
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rvb213YXRjaGVy,size_16,color_FFFFFF,t_70-16808671922131472.png" alt="在这里插入图片描述" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cloud-项目搭建">cloud 项目搭建<a href="#cloud-项目搭建" class="hash-link" aria-label="Direct link to cloud 项目搭建" title="Direct link to cloud 项目搭建">​</a></h3>
<p>我们采用的是用 maven 聚合项目作为父项目
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rvb213YXRjaGVy,size_16,color_FFFFFF,t_70-16808671922131473.png" alt="在这里插入图片描述" class="img_ev3q"></p>
<p>在里面编写子模块，主要是可以解决一个问题
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rvb213YXRjaGVy,size_16,color_FFFFFF,t_70-16808671922131474.png" alt="在这里插入图片描述" class="img_ev3q"></p>
<p>就是子模块依赖版本的统一管理
这里呢我们就要用到 dependencyManagement+properties 来控制版本
下图就是关于 dependencyManagement 的一些知识复习
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rvb213YXRjaGVy,size_16,color_FFFFFF,t_70-16808671922131475.png" alt="在这里插入图片描述" class="img_ev3q"><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rvb213YXRjaGVy,size_16,color_FFFFFF,t_70-16808671922131476.png" alt="在这里插入图片描述" class="img_ev3q"></p>
<p>父项目 pom</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token prolog" style="color:#000080">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">project</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">xmlns</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">http://maven.apache.org/POM/4.0.0</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name namespace" style="color:#0c4a6e">xmlns:</span><span class="token tag attr-name" style="color:#0c4a6e">xsi</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">http://www.w3.org/2001/XMLSchema-instance</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token tag" style="color:#0ea5e9">         </span><span class="token tag attr-name namespace" style="color:#0c4a6e">xsi:</span><span class="token tag attr-name" style="color:#0c4a6e">schemaLocation</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">modelVersion</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">4.0.0</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">modelVersion</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">com.hyc.springcloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">cloud2020</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">1.0-SNAPSHOT</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">modules</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">module</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">cloud-provider-payment8001</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">module</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">modules</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">packaging</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">packaging</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token comment" style="color:#6A9955">&lt;!-- 统一管理jar包版本 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">properties</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">project.build.sourceEncoding</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">UTF-8</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">project.build.sourceEncoding</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">maven.compiler.source</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">1.8</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">maven.compiler.source</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">maven.compiler.target</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">1.8</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">maven.compiler.target</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">junit.version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">4.12</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">junit.version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">log4j.version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">1.2.17</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">log4j.version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">lombok.version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">1.16.18</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">lombok.version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">mysql.version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">8.0.11</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">mysql.version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">druid.version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">1.1.16</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">druid.version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">mybatis.spring.boot.version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">1.3.0</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">mybatis.spring.boot.version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">properties</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token comment" style="color:#6A9955">&lt;!-- 子模块继承之后，提供作用：锁定版本+子modlue不用写groupId和version  --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependencyManagement</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token comment" style="color:#6A9955">&lt;!--spring boot 2.2.2--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-dependencies</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">2.2.2.RELEASE</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">type</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">type</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">import</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token comment" style="color:#6A9955">&lt;!--spring cloud Hoxton.SR1--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-dependencies</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">Hoxton.SR1</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">type</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">type</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">import</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token comment" style="color:#6A9955">&lt;!--spring cloud alibaba 2.1.0.RELEASE--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">com.alibaba.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-alibaba-dependencies</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">2.1.0.RELEASE</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">type</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">type</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">import</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">mysql</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">mysql-connector-java</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">${mysql.version}</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">com.alibaba</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">druid</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">${druid.version}</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.mybatis.spring.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">mybatis-spring-boot-starter</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">${mybatis.spring.boot.version}</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">junit</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">junit</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">${junit.version}</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">log4j</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">log4j</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">${log4j.version}</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.projectlombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">lombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">${lombok.version}</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependencyManagement</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">build</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">plugins</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">plugin</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-maven-plugin</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">configuration</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">          </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">fork</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">fork</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">          </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">addResources</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">addResources</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">configuration</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">plugin</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">plugins</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">build</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">project</span><span class="token tag punctuation" style="color:#475569">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>搞定这边之后，我们就可以去编写子模块了</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="支付模块服务提供者">支付模块，服务提供者<a href="#支付模块服务提供者" class="hash-link" aria-label="Direct link to 支付模块，服务提供者" title="Direct link to 支付模块，服务提供者">​</a></h4>
<p>建 cloud-provider-payment8001
在 springboot 的学习中我们发现一个模块的构建也是有迹可循的</p>
<ul>
<li>创建 moudle</li>
<li>编写 pom，导入依赖</li>
<li>编写 boot 配置文件 yml</li>
<li>主启动类</li>
<li>编写业务类</li>
<li>测试
<code>一般来说都是这个几个步骤</code>
那我们跟着来
首先是创建模块
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/94e5964efca8484bb142d08224e1283e.png" alt="在这里插入图片描述" class="img_ev3q">
之后引入需要的依赖</li>
</ul>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token prolog" style="color:#000080">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">project</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">xmlns</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">http://maven.apache.org/POM/4.0.0</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token tag" style="color:#0ea5e9">         </span><span class="token tag attr-name namespace" style="color:#0c4a6e">xmlns:</span><span class="token tag attr-name" style="color:#0c4a6e">xsi</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">http://www.w3.org/2001/XMLSchema-instance</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token tag" style="color:#0ea5e9">         </span><span class="token tag attr-name namespace" style="color:#0c4a6e">xsi:</span><span class="token tag attr-name" style="color:#0c4a6e">schemaLocation</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">parent</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">cloud2020</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">com.atguigu.springcloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">1.0-SNAPSHOT</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">parent</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">modelVersion</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">4.0.0</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">modelVersion</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">cloud-provider-payment8001</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-actuator</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.mybatis.spring.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">mybatis-spring-boot-starter</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/druid --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">com.alibaba</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">druid-spring-boot-starter</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">1.1.10</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">mysql</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">mysql-connector-java</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-jdbc --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-jdbc</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-devtools</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">           </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">runtime</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.projectlombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">lombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-test</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">test</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">project</span><span class="token tag punctuation" style="color:#475569">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>之后编写相关的配置文件 application.Yml</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">server</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">8001</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">spring</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">application</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> cloud</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">payment</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">datasource</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> com.alibaba.druid.pool.DruidDataSource</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">driver-class-name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> org.gjt.mm.mysql.Driver</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">url</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> jdbc</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">mysql</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">3306/db2019</span><span class="token punctuation" style="color:#475569">?</span><span class="token plain">useUnicode=true</span><span class="token important">&amp;characterEncoding=utf-8&amp;useSSL=false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">username</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">password</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">123456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">mybatis</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">mapperLocations</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> classpath</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">mapper/</span><span class="token important">*.xml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">type-aliases-package</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> com.atguigu.springcloud.entities</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>编写业务类</p>
<blockquote>
<p>实体类</p>
</blockquote>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">package com.atguigu.springcloud.entities;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import lombok.AllArgsConstructor;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import lombok.Data;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import lombok.NoArgsConstructor;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import java.io.Serializable;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@Data</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@AllArgsConstructor</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@NoArgsConstructor</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class Payment implements Serializable {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    private Long id;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    private String serial;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Json 封装体 CommonResult</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">package com.atguigu.springcloud.entities;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import lombok.AllArgsConstructor;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import lombok.Data;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import lombok.NoArgsConstructor;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@Data</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@AllArgsConstructor</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@NoArgsConstructor</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class CommonResult &lt;T&gt;{</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    private Integer code;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    private String message;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    private T data;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public CommonResult(Integer code,String message){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        this(code,message,null);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>mapper 与映射文件</p>
</blockquote>
<p>mapper 接口</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">package com.hyc.cloud.mapper;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import com.hyc.cloud.pojo.payment;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.apache.ibatis.annotations.Mapper;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.apache.ibatis.annotations.Param;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@Mapper</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public interface PaymentMapper {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public int create(payment payment);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public payment getPaymentByid(@Param(&quot;id&quot;) long id);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>对应的映射文件</p>
</blockquote>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token prolog" style="color:#000080">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token doctype punctuation" style="color:#475569">&lt;!</span><span class="token doctype doctype-tag">DOCTYPE</span><span class="token doctype"> </span><span class="token doctype name">mapper</span><span class="token doctype"> </span><span class="token doctype name">PUBLIC</span><span class="token doctype"> </span><span class="token doctype string" style="color:#64748b">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><span class="token doctype"> </span><span class="token doctype string" style="color:#64748b">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span><span class="token doctype punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">mapper</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">namespace</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">com.hyc.cloud.mapper.PaymentMapper</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">insert</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">create</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">parameterType</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">com.hyc.cloud.pojo.payment</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">useGeneratedKeys</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">true</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">keyProperty</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">id</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        insert into db01.paymemt (serial) values (#{name});</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">insert</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">select</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">getPaymentByid</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">resultType</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">com.hyc.cloud.pojo.payment</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">parameterType</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">long</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">resultMap</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">BaseResultMap</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        select *</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        from paymemt where id = #{id};</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">select</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">resultMap</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">BaseResultMap</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">com.hyc.cloud.pojo.payment</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">id</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">column</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">id</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">property</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">id</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">jdbcType</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">BIGINT</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag punctuation" style="color:#475569">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">id</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">column</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">serial</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">property</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">serial</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">jdbcType</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">VARCHAR</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag punctuation" style="color:#475569">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">resultMap</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">mapper</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>服务层</p>
</blockquote>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">package com.atguigu.springcloud.service;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import com.atguigu.springcloud.entities.Payment;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.apache.ibatis.annotations.Param;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public interface PaymentService {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public int create(Payment payment); //写</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public Payment getPaymentById(@Param(&quot;id&quot;) Long id);  //读取</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>实现类</p>
</blockquote>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">package com.atguigu.springcloud.service.impl;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import com.atguigu.springcloud.dao.PaymentDao;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import com.atguigu.springcloud.entities.Payment;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import com.atguigu.springcloud.service.PaymentService;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.apache.ibatis.annotations.Param;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.stereotype.Service;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import javax.annotation.Resource;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@Service</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class PaymentServiceImpl implements PaymentService {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Resource</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    private PaymentDao paymentDao;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public int create(Payment payment){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return paymentDao.create(payment);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public Payment getPaymentById( Long id){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return paymentDao.getPaymentById(id);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>最后就是 controller</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">package com.hyc.cloud.controller;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import com.hyc.cloud.pojo.CommonResult;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import com.hyc.cloud.pojo.payment;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import com.hyc.cloud.service.PaymentService;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import lombok.extern.slf4j.Slf4j;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.stereotype.Controller;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.web.bind.annotation.GetMapping;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.web.bind.annotation.PathVariable;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.web.bind.annotation.PostMapping;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.web.bind.annotation.RestController;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import javax.annotation.Resource;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@RestController</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class PaymentController {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Resource</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    private PaymentService paymentService;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @PostMapping(&quot;payment/create&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public CommonResult create(payment payment){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        int result = paymentService.create(payment);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        log.info(&quot;****新增结果：&quot;+result);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        if (result&gt;0){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            return new CommonResult(200,&quot;插入数据库成功&quot;,result);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        }else {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            return  new CommonResult(444,&quot;插入数据库失败&quot;,null);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @GetMapping(&quot;payment/get/{id}&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public CommonResult getPaymentByid(@PathVariable(&quot;id&quot;) long id){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        payment payment = paymentService.getPaymentByid(id);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        log.info(&quot;****新增结果：&quot;+payment);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        if (payment!=null){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            return new CommonResult(200,&quot;查询成功&quot;,payment);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        }else {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            return  new CommonResult(444,&quot;没有对应的记录，失败，查询id&quot;+id,null);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>编写主启动类</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">package com.hyc.cloud;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.boot.SpringApplication;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class paymentMain8001 {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        SpringApplication.run(paymentMain8001.class,args);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>测试即可
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/1246ef63f44f43f2a3c1135bf08758a0.png" alt="在这里插入图片描述" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="支付模块消费者者">支付模块，消费者者<a href="#支付模块消费者者" class="hash-link" aria-label="Direct link to 支付模块，消费者者" title="Direct link to 支付模块，消费者者">​</a></h4>
<p>走过一遍流程，那我们就加快速度
新建消费者子模块
cloud-consumer-order80
修改 pom 文件</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token prolog" style="color:#000080">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">project</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">xmlns</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">http://maven.apache.org/POM/4.0.0</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token tag" style="color:#0ea5e9">         </span><span class="token tag attr-name namespace" style="color:#0c4a6e">xmlns:</span><span class="token tag attr-name" style="color:#0c4a6e">xsi</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">http://www.w3.org/2001/XMLSchema-instance</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token tag" style="color:#0ea5e9">         </span><span class="token tag attr-name namespace" style="color:#0c4a6e">xsi:</span><span class="token tag attr-name" style="color:#0c4a6e">schemaLocation</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">parent</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">cloud2020</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">com.hyc.springcloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">1.0-SNAPSHOT</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">parent</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">modelVersion</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">4.0.0</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">modelVersion</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">cloud-consumer-order80</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web  --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-actuator</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-devtools</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">runtime</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.projectlombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">lombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-test</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">test</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">project</span><span class="token tag punctuation" style="color:#475569">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>配置文件消费者十分的简单，就是配置一下端口号
<code>server:   port: 80 </code>
之后复制实体类到消费者项目里
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/3a96cf02692c4c48a73f1e03eefd9ee7.png" alt="在这里插入图片描述" class="img_ev3q"></p>
<blockquote>
<p>那么思考一个问题
我们现在不再是单一的项目而是两个项目，那么如果调动到接口呢？？？
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rvb213YXRjaGVy,size_16,color_FFFFFF,t_70-16808671922141477.png" alt="在这里插入图片描述" class="img_ev3q"></p>
</blockquote>
<p>springboot 中有很多的 template 供我们使用
这里我们要用到的就是其中的<code>resttemplate</code>
他和网络编程中的 httpclient 有异曲同工之妙
这里我们需要编写一个 config 类，springboot 需要什么我们就 new 什么</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class orderConfig {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public RestTemplate restTemplate(){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return new RestTemplate();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>有了这个我们就可以在消费者里面调用<code>resttemplate</code>了
因为是消费者所以我们只需要知道怎么使用服务就可以了
这里我们编写 controller</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">package com.hyc.cloud.controller;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import com.hyc.cloud.pojo.CommonResult;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import com.hyc.cloud.pojo.payment;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import io.micrometer.core.instrument.Meter;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.web.bind.annotation.GetMapping;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.web.bind.annotation.PathVariable;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.web.bind.annotation.RestController;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.web.client.RestTemplate;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import javax.annotation.Resource;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@RestController</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class orderContorller {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Resource</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    private RestTemplate restTemplate;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public final static String PAYMENT_URL = &quot;http://localhost:8001&quot;;//服务提供者的地址（后面做负载均衡的时候会替换成application.name）</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @GetMapping(&quot;/consumer/payment/create&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public CommonResult create(payment payment){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return restTemplate.postForObject(PAYMENT_URL+&quot;/payment/create&quot;,payment,CommonResult.class);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @GetMapping(&quot;/consumer/payment/get/{id}&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public CommonResult getPament(@PathVariable(&quot;id&quot;) long id){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return restTemplate.getForObject(PAYMENT_URL+&quot;/payment/get/&quot;+ id,CommonResult.class);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>到这里启动测试
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/624bd0045d8f4957869284298e11de20.png" alt="在这里插入图片描述" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="是不是以为这样就结束了">是不是以为这样就结束了？<a href="#是不是以为这样就结束了" class="hash-link" aria-label="Direct link to 是不是以为这样就结束了？" title="Direct link to 是不是以为这样就结束了？">​</a></h3>
<p>当然不是
这里是的插入数据是存在问题的
会出现只有自增的主键没有内容
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/a7884a87120d43b89dcebbdf882274fd.png" alt="在这里插入图片描述" class="img_ev3q">
这个时候我们要回到服务提供者
在新增的对象参数前加上注解<code>@requestbody</code>这个主机再次测试就解决了</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">    @PostMapping(&quot;payment/create&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public CommonResult create(@RequestBody payment payment){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        int result = paymentService.create(payment);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        log.info(&quot;****新增结果：&quot;+result);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        if (result&gt;0){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            return new CommonResult(200,&quot;插入数据库成功&quot;,result);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        }else {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            return  new CommonResult(444,&quot;插入数据库失败&quot;,null);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/f422fbe6dfb543889693ad89a9d04d78.png" alt="在这里插入图片描述" class="img_ev3q">
此时的数据库也新增成功了
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/10b4222301e9449fae6c1815839d26bd.png" alt="在这里插入图片描述" class="img_ev3q">
到这里呢支付模块为例 体验 demo 就结束了</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="eureka-服务注册与发现">Eureka 服务注册与发现<a href="#eureka-服务注册与发现" class="hash-link" aria-label="Direct link to Eureka 服务注册与发现" title="Direct link to Eureka 服务注册与发现">​</a></h2>
<blockquote>
<p>什么是服务治理</p>
<p>springcloud 封装了 netflix 的 Eureka 模块实现服务治理
在传统的 rpc 远程调用框架中，管理每个服务与服务之间依赖关系比较复杂，管理比较复杂所以需要有一个东西去治理他，管理服务与服务之间的依赖关系，负载均衡，容错等 实现服务发现与注册</p>
</blockquote>
<p><strong>这个是有人要问了：什么时服务的注册与发现呢？？？</strong>
问得好，</p>
<blockquote>
<p>答案:
Eureka 采用了 CS 也就是服务器和客户端的架构模式，Eureka Server 作为服务注册中心，来管理微服务，也可以理解成用 springboot 来开发的一个个微服务，他们在 Eureka 的位置就是 Eureka client，他们用心跳来告诉服务端自己是可以用的
我们可以用 Eureka server 就可以监控各个微服务的状态，同时也有一系列的保证机制，比如心跳检测，
我们的服务提供者和消费者的例子就是这样的，
<strong>服务提供者</strong>：在启动后将把自己当前的信息，通讯地址等以别名的方式注册到注册中心也就是 Eureka server 中
<strong>消费者</strong>：用别名的的形式，去获取服务的信息和通讯地址，之后实现本地调用 RPC 调用框架的设计思想
注册中心负责管理服务之间的依赖关系（服务治理），在任何的远程 RPC 中都会有一个注册中心，通过注册中心来获取服务的信息和接口地址</p>
</blockquote>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/e5edd5822b6be1cc659c8aa2e78aac14.png" alt="在这里插入图片描述" class="img_ev3q">
下图是脑图中对于 Eureka 两大组件的作用和功能介绍</p>
<ul>
<li>Eureka server</li>
<li>Eureka client</li>
</ul>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rvb213YXRjaGVy,size_16,color_FFFFFF,t_70-16808671922141478.png" alt="在这里插入图片描述" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="单项目-eurekademo">单项目 Eurekademo<a href="#单项目-eurekademo" class="hash-link" aria-label="Direct link to 单项目 Eurekademo" title="Direct link to 单项目 Eurekademo">​</a></h3>
<p><strong>老步骤：</strong></p>
<ul>
<li>建模块</li>
<li>添加依赖 pom</li>
<li>yml 配置文件</li>
<li>主启动类</li>
<li>业务编码</li>
</ul>
<blockquote>
<p>创建 cloud-eureka-server7001 模块</p>
</blockquote>
<p>之后导入我们要用到的依赖</p>
<div class="language-XML language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-eureka-server --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-netflix-eureka-server</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">com.atguigu.springcloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">cloud-api-commons</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">${project.version}</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web  --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-actuator</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-devtools</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">runtime</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.projectlombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">lombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-test</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">test</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">junit</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">junit</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这里 Eureka 的服务端新老版本也有变化</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/7246c2b588d18e7b5b65295a3e525fb4.png" alt="image-20210819225527988" class="img_ev3q"></p>
<p>之后就是配置了 yml</p>
<div class="language-YML language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">server</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">7001</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">instance</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">hostname</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> localhost  </span><span class="token comment" style="color:#6A9955">#eureka服务端的实例名字</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">client</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">register-with-eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain">    </span><span class="token comment" style="color:#6A9955">#表识不向注册中心注册自己</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">fetch-registry</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain">   </span><span class="token comment" style="color:#6A9955">#表示自己就是注册中心，职责是维护服务实例，并不需要去检索服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">     </span><span class="token key atrule">service-url</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">defaultZone</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//$</span><span class="token punctuation" style="color:#475569">{</span><span class="token plain">eureka.instance.hostname</span><span class="token punctuation" style="color:#475569">}</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">$</span><span class="token punctuation" style="color:#475569">{</span><span class="token plain">server.port</span><span class="token punctuation" style="color:#475569">}</span><span class="token plain">/eureka/    </span><span class="token comment" style="color:#6A9955">#设置与eureka server交互的地址查询服务和注册服务都需要依赖这个地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>之后的主启动类的编写</p>
<div class="language-JAVA language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">package com.atguigu.springcloud;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.boot.SpringApplication;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@EnableEurekaServer</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class EurekaMain7001 {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        SpringApplication.run(EurekaMain7001.class,args);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>@EnableEurekaServer</code>加上个注解就是 Eureka 的服务端了，我们并不需要写什么业务员，启动之后访问</p>
<p>7001 端口就可以看道 Eureka 的注册中心啦</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/ac13c1063f43e2a68c04279038a2c0eb.png" alt="image-20210819225943551" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="服务的注册">服务的注册<a href="#服务的注册" class="hash-link" aria-label="Direct link to 服务的注册" title="Direct link to 服务的注册">​</a></h3>
<p><strong>cloud-provider-payment8001</strong>我们的目光回到服务提供者</p>
<blockquote>
<p>Eurekashi1 C/S 架构</p>
<p>所以我们想要将服务提供者注册道服务中心，还需要导入一个依赖，就是 Eureka client 的依赖抱</p>
</blockquote>
<div class="language-XML language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain"> </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-eureka-server --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-netflix-eureka-client</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-kBh2RWke-1648908821908)(<a href="https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210819230600170.png" target="_blank" rel="noopener noreferrer">https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210819230600170.png</a>)]</p>
<p>之后就是配置文件了</p>
<div class="language-JAVA language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">eureka:</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  client:</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    register-with-eureka: true</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    fetchRegistry: true</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    service-url:</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      defaultZone: http://localhost:7001/eureka</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>配置解读：</p>
<ol>
<li><code>register-with-eureka:true</code> 表示自己会被注册到服务中心</li>
<li><code>fetchRegistry：true</code>表示自己不是服务中心，需要检索服务</li>
<li><code>defaultZone</code>要注册的服务中心的地址</li>
</ol>
<blockquote>
<p>主启动类</p>
</blockquote>
<div class="language-JAVA language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">package com.atguigu.springcloud;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.boot.SpringApplication;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@EnableEurekaClient</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class PaymentMain8001 {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        SpringApplication.run(PaymentMain8001.class,args);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>@EnableEurekaClient</code>表示自己的客户端，</p>
<p>之后就是测试了</p>
<ol>
<li>先启动注册中心</li>
<li>之后启动需要注册的注册中心</li>
<li>访问注册中心即可</li>
</ol>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/21066d897161a59b22f81e2f035d0959.png" alt="image-20210819232956305" class="img_ev3q"></p>
<p>微服务名称配置</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/865e732e2f81aa18aed5e5f390254ec5.png" alt="image-20210819233006085" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="eureka-的自我保护机制">Eureka 的自我保护机制<a href="#eureka-的自我保护机制" class="hash-link" aria-label="Direct link to Eureka 的自我保护机制" title="Direct link to Eureka 的自我保护机制">​</a></h3>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/6f08620aeca75835edf07c478344670c.png" alt="image-20210819233134638" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/fdfb7e6432cf890544631efa8f91a98d.png" alt="image-20210819233036533" class="img_ev3q"></p>
<p>当 Eureka 一定时间内没有检测到服务的心跳或者短时间内丢失了多个服务，那么服务端就会认为是网络故障或者是一系列 i 意外的发生</p>
<p>此时不应该注销任何的服务。同时新的服务也可以继续进来，</p>
<blockquote>
<p>设计哲学</p>
<p>好死不如赖活着</p>
<p>Eureka 宁可保护错误的服务信息，也不会去轻易的注销服务</p>
</blockquote>
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-KVWJjlqP-1648908821910)(<a href="https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210819233339779.png" target="_blank" rel="noopener noreferrer">https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210819233339779.png</a>)]</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="eureka-集群原理">Eureka 集群原理<a href="#eureka-集群原理" class="hash-link" aria-label="Direct link to Eureka 集群原理" title="Direct link to Eureka 集群原理">​</a></h3>
<p>Eureka 集群原理说明：</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/4f32a04eb5ab8bfb7458a806364c1ceb.png" alt="image-20210819233515492" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="搭建注册中心集群">搭建注册中心集群<a href="#搭建注册中心集群" class="hash-link" aria-label="Direct link to 搭建注册中心集群" title="Direct link to 搭建注册中心集群">​</a></h4>
<p>参考我们的注册中心 7001，搭建一个一模一样的注册中心</p>
<p>在搭建之前请去修改一下映射文件，</p>
<p>找到 C:\Windows\System32\drivers\etc 路径下的 hosts 文件，修改</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/b110b969cf99e4d9d6b71fdc72445edb.png" alt="image-20210819233652511" class="img_ev3q"></p>
<p>因为我们之前使用都是一个单机的项目，我们要集群那么不能使用 localhost，他会被识别成一样的路径</p>
<p>我们修改一些映射</p>
<p>如：</p>
<ol>
<li>127.0.0.1 eureka7001.com</li>
<li>127.0.0.1 eureka7002.com</li>
</ol>
<p>本质还是 localhost 但是却是两个不一样的映射</p>
<p>导入和 7001<strong>相同的依赖</strong></p>
<p>之后分别修改</p>
<p>7001 配置文件</p>
<div class="language-YML language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">server</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">7001</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">instance</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">hostname</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> eureka7001.com    </span><span class="token comment" style="color:#6A9955">#eureka服务端的实例名字</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">client</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">register-with-eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain">    </span><span class="token comment" style="color:#6A9955">#表识不向注册中心注册自己</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">fetch-registry</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain">   </span><span class="token comment" style="color:#6A9955">#表示自己就是注册中心，职责是维护服务实例，并不需要去检索服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">service-url</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">defaultZone</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//eureka7002.com</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">7002/eureka/    </span><span class="token comment" style="color:#6A9955">#设置与eureka server交互的地址查询服务和注册服务都需要依赖这个地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>7002</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">server</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">7002</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">instance</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">hostname</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> eureka7002.com </span><span class="token comment" style="color:#6A9955">#eureka服务端的实例名字</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">client</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">register-with-eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955">#表识不向注册中心注册自己</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">fetch-registry</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955">#表示自己就是注册中心，职责是维护服务实例，并不需要去检索服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">service-url</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">defaultZone</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//eureka7001.com</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">7001/eureka/ </span><span class="token comment" style="color:#6A9955">#设置与eureka server交互的地址查询服务和注册服务都需要依赖这个地址</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>集群其实就是一句话：相互守望，</p>
<p>之后我们还要修改一下 服务提供者 8001 的注册地址，他现在同时需要注册到两个注册中心去</p>
<div class="language-YML language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">service-url</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">defaultZone</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//eureka7001.com</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">7001/eureka</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain">http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//eureka7002.com</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">7002/eureka  </span><span class="token comment" style="color:#6A9955">#集群版</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>测试：</p>
<ol>
<li>先要启动 EurekaServer，7001/7002 服务</li>
<li>再要启动服务提供者 provider，8001 服务</li>
<li>再要启动消费者，80</li>
<li><a href="http://localhost/consumer/payment/get/1" target="_blank" rel="noopener noreferrer">http://localhost/consumer/payment/get/1</a></li>
</ol>
<p>查看结果即可</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="支付服务提供者-8001-集群环境构建">支付服务提供者 8001 集群环境构建<a href="#支付服务提供者-8001-集群环境构建" class="hash-link" aria-label="Direct link to 支付服务提供者 8001 集群环境构建" title="Direct link to 支付服务提供者 8001 集群环境构建">​</a></h4>
<p>同上搭建一个除了端口号和 8001 一抹一样的模块</p>
<p>cloud-provider-payment8002</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ribbon-负载均衡">Ribbon 负载均衡<a href="#ribbon-负载均衡" class="hash-link" aria-label="Direct link to Ribbon 负载均衡" title="Direct link to Ribbon 负载均衡">​</a></h2>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/a1312622ac0bde7aec4bd1b08b1f0676.png" alt="image-20210831155425465" class="img_ev3q"></p>
<p>现在的 RIbbon 已经进入维护模式了</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/f9bb8da2d261834d62a754e007dc41e5.png" alt="image-20210831155523817" class="img_ev3q"></p>
<p>现有他的代替解决方案是</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/82f7afaa9345f476e81b5804232a46ce.png" alt="image-20210831155539759" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lb负载均衡">LB（负载均衡）<a href="#lb负载均衡" class="hash-link" aria-label="Direct link to LB（负载均衡）" title="Direct link to LB（负载均衡）">​</a></h3>
<p>负载均衡分类</p>
<blockquote>
<p>集中式 LB</p>
</blockquote>
<p>即在服务的消费方和提供方之间使用独立的 LB 设施,(可以是硬件,如 f5,也可以是软件,如 nginx),由该设施负责把访问请求通过某种请求策略转发至服务的提供方;</p>
<blockquote>
<p>进程内 LB</p>
</blockquote>
<p>将 L B 逻辑集成在消费方,消费方从服务注册中心获取那些地址可用,让后自己再从这些地址选择出一个合适的服务器.</p>
<p>Ribbon 就是属于进程内 LB,他只是一个类库,集成于消费房的进程,消费房通过他来获取到服务器的提供方地址</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ribbon-能够做些什么">Ribbon 能够做些什么<a href="#ribbon-能够做些什么" class="hash-link" aria-label="Direct link to Ribbon 能够做些什么" title="Direct link to Ribbon 能够做些什么">​</a></h3>
<p>就是在消费者中对服务提供者进行负载均衡操作,</p>
<p>默认是轮询的方式,</p>
<p>1 2 3 再来一遍 1 2 3</p>
<blockquote>
<p>负载均衡+RestTemplate 调用架构说明</p>
</blockquote>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/1baebed2af8d7870cb1685a9e0c5f4d8.png" alt="image-20210831160415484" class="img_ev3q"></p>
<blockquote>
<p>总结:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">	Ribbon其实就是一个软负载均衡的客户端组件，他可以和其他所需请求的客户端结合使用，和eureka结合只是其中的一个实例。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</blockquote>
<p>我们之前导入的 Netflix-Eureka 的 jar 包中包含了 ribbon 新版本不包含,</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/712352d777e516960add915f684961f7.png" alt="image-20210831160604160" class="img_ev3q"></p>
<p>现在的最新版本 h12 Ribbon 以被上图提到的 lb 给代替了(之前全部最新版的时候踩到的坑)</p>
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-s1Y5cCOF-1648908821913)(<a href="https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210831160552808.png" target="_blank" rel="noopener noreferrer">https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210831160552808.png</a>)]</p>
<p>再次复习 RestTemplate 的使用</p>
<p>官网连接:<a href="https://docs.spring.io/spring-framework/docs/5.2.2.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html" target="_blank" rel="noopener noreferrer">https://docs.spring.io/spring-framework/docs/5.2.2.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html</a></p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/7325acc2a9c9b29b77e0888a4169c7a3.png" alt="image-20210831160653268" class="img_ev3q"></p>
<blockquote>
<p>getForObject 方法/getForEntity 方法</p>
</blockquote>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/833f17f4f7dca1c71077836a63dba3ee.png" alt="image-20210831160739588" class="img_ev3q"></p>
<blockquote>
<p>postForObject/postForEntity</p>
</blockquote>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/ab7960b1e94ac2b773535242ca3d2326.png" alt="image-20210831160804564" class="img_ev3q"></p>
<blockquote>
<p>开启负载均衡</p>
</blockquote>
<p>默认的开启负载均衡操作就一个注解</p>
<p>在你的消费者 config 中的 restTemoplate 上添加一个注解</p>
<div class="language-JAVA language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class orderConfig {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @LoadBalanced</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public RestTemplate restTemplate(){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return new RestTemplate();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这样就开启的 Ribbon 的默认轮询的负载均衡</p>
<blockquote>
<p>IRule:根据特定算法从服务列表中选取一个要访问的服务,用哪一种方式做负载均衡</p>
</blockquote>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/b62b038c4a62d00771ee62667b50a013.png" alt="image-20210831160935110" class="img_ev3q"></p>
<blockquote>
<p>我们首先要强调一下配置细节</p>
</blockquote>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/94646295c1c4b055564d2aded55410cf.png" alt="image-20210831161010919" class="img_ev3q"></p>
<p>如果我们想改变默认的负载均衡算法我们需要在 这样建立一个新包</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/f4af066d613368a5d54f251c438c4951.png" alt="image-20210831161128681" class="img_ev3q"></p>
<p>主启动类在 cloud 的中,所以他会扫描 cloud 下所有的子包</p>
<p>接下来是自定义负载均衡的规则编写(使用起来越方便的,他的底层就越精妙)</p>
<div class="language-JAVA language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@EnableEurekaClient</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@RibbonClient(value = &quot;CLOUD-PAYMENT-SERVICE&quot;,configuration = Myselgrule.class )</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class orderMain {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        SpringApplication.run(orderMain.class,args);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>添加了这个之后我们要使用自己设置的规则我们需要使用到注解<code>@RibbonClient</code></p>
<p>在主启动类上添加这个注解 ,并且设置两个参数</p>
<p>value：需要负载均衡的服务名</p>
<p>configuration : 要使用的规则类 <code>Myselgrule.class</code></p>
<p>即可</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ribbon-负载均衡算法这里由于算法实在不是咱的擅长就跳过了手写算法那个一节课">Ribbon 负载均衡算法(这里由于算法实在不是咱的擅长就跳过了手写算法那个一节课)<a href="#ribbon-负载均衡算法这里由于算法实在不是咱的擅长就跳过了手写算法那个一节课" class="hash-link" aria-label="Direct link to Ribbon 负载均衡算法(这里由于算法实在不是咱的擅长就跳过了手写算法那个一节课)" title="Direct link to Ribbon 负载均衡算法(这里由于算法实在不是咱的擅长就跳过了手写算法那个一节课)">​</a></h3>
<blockquote>
<p>轮询算法原理</p>
</blockquote>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/e710c1c21d99db4d22336f2ab493877e.png" alt="image-20210831161946018" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="openfeign">openFeign<a href="#openfeign" class="hash-link" aria-label="Direct link to openFeign" title="Direct link to openFeign">​</a></h2>
<p>链接:<a href="https://github.com/spring-cloud/spring-cloud-openfeign" target="_blank" rel="noopener noreferrer">https://github.com/spring-cloud/spring-cloud-openfeign</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="feign-是什么">Feign 是什么?<a href="#feign-是什么" class="hash-link" aria-label="Direct link to Feign 是什么?" title="Direct link to Feign 是什么?">​</a></h3>
<p>​ Feign 是一个声明式的 web 服务客户端，让编写 web 服务客户端变得非常容易，只需创建一个接口并在接口上添加注解即可.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="feign-能干什么">Feign 能干什么?<a href="#feign-能干什么" class="hash-link" aria-label="Direct link to Feign 能干什么?" title="Direct link to Feign 能干什么?">​</a></h3>
<p>使用 Feign 可以让我们在编写 java HTTP 客户端的时候变得更加的容易</p>
<p>我们在之前的项目中使用的是 Ribbon + Resttemplate 的时候,利用 Resttemplate 对请求的封装处理,形成了一套模版话的调用方法,但是实际开发中,由于对服务的依赖调用可能不止一处**,往往一个接口要被多处调用,所以通常都会针对每个微服务自行封装一些客户端类来包装**.**这个依赖服务的调用.**所以,Feign 在此基础上,做了进一步的封装,由他来帮助我们定义和实现依赖服务接口的定义.在 Feign 的实现下,**我们只需要创建一个接口并使用注解的方式来配置他(以前是 dao 接口上面标注 mapper 注解,现在是一个微服务接口上面标注一个 Feign 注解即可),**即可完成对服务提供方的接口绑定,简化了使用 spring cloud ribbon 时候,自动封装服务调用客户端的开发量</p>
<blockquote>
<p>同时 Feign 集成了 Ribbon</p>
</blockquote>
<p>利用 Ribbon 维护了 Payment 的服务列表信息,并且通过轮询实现了客户端的负载均衡.而与 Ribbon 不同的是.通过 feign 只需要定义服务绑定的接口且以声明式的方法,简单的实现了服务的调用</p>
<blockquote>
<p>这个时候有人要提问了</p>
<p>我们学习 openFeign 和 Feign 有什么区别嘛,</p>
<p>区别如下</p>
</blockquote>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/b1faf4ddaa4fe09d7fae1b25dd7e9253.png" alt="image-20210905145616103" class="img_ev3q"></p>
<p>也就是说,我们要使用 openFeign 需要使用</p>
<p>接口+注解的方式来开发:微服务调用接口+@FeignClient</p>
<p>使用之前强调一点,也是官方文档说的,fegin 在消费端使用</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/a2ee95117482da593e7a5b23a37220fc.png" alt="image-20210905145806447" class="img_ev3q"></p>
<p>前置知识强调完之后我们开始编码吧!</p>
<p>老规矩,新建一个模块: <code>cloud-consumer-feign-order80</code></p>
<p>导入相关的依赖</p>
<div class="language-XML language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token comment" style="color:#6A9955">&lt;!--openfeign--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-openfeign</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-netflix-eureka-client</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">com.atguigu.springcloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">cloud-api-commons</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">${project.version}</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-actuator</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-devtools</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">runtime</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.projectlombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">lombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-test</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">test</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>底下的依赖是平常的使用的,主要是第一个依赖</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-openfeign</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>之后编写配置文件:编写端口和 Eureka 的相关配置</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">server</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">client</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">register-with-eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">service-url</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">defaultZone</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//eureka7001.com</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">7001/eureka</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//eureka7002.com</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">7002/eureka</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们可以学习的时候就发现,我们每次接触到新的组件,主启动类就会多一个新的注解<code>@EnableFeignClients</code></p>
<div class="language-JAVA language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@EnableFeignClients</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class feignOrder80Main {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        SpringApplication.run(feignOrder80Main.class,args);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>之后就编写业务类就可以了</p>
<blockquote>
<p>业务逻辑接口+@FeignClient 配置调用 provider 服务</p>
</blockquote>
<p>新建服务层接口</p>
<div class="language-JAVA language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@FeignClient(value = &quot;CLOUD-PAYMENT-SERVICE&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public interface PaymentFeignService {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @GetMapping(&quot;/payment/get/{id}&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public CommonResult getPaymentByid(@PathVariable(&quot;id&quot;) long id);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @GetMapping(value = &quot;/payment/feign/timeout&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public String paymentFeignTimeout();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>@FeignClient(value = &quot;CLOUD-PAYMENT-SERVICE&quot;)</code>这里是我们需要使用 fegin 来调用的服务提供者的,服务名称</p>
<p>编写控制层之后测试</p>
<div class="language-JAVA language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@RestController</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class openFeginController {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Resource</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    private PaymentFeignService paymentFeignService;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @GetMapping(&quot;/consumer/payment/get/{id}&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public CommonResult getPaymentByid(@PathVariable(&quot;id&quot;) long id){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        System.out.println(id);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return paymentFeignService.getPaymentByid(id);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @GetMapping(value = &quot;/consumer/payment/feign/timeout&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public String paymentFeignTimeout(){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return paymentFeignService.paymentFeignTimeout();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>测试</p>
</blockquote>
<ul>
<li>先启动 2 个 eureka 集群 7001/7002</li>
<li>再启动 2 个微服务 8001/8002</li>
<li>启动 OpenFeign 启动</li>
<li><a href="http://localhost/consumer/payment/get/1" target="_blank" rel="noopener noreferrer">http://localhost/consumer/payment/get/1</a></li>
<li>Feign 自带负载均衡配置项</li>
</ul>
<p>这里是调用的服务名称的对应和服务调用的地址</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/20fc2f777ca00f0c23fa4c6e72d64985.png" alt="image-20210905153344028" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="openfeign-超时控制">OpenFeign 超时控制<a href="#openfeign-超时控制" class="hash-link" aria-label="Direct link to OpenFeign 超时控制" title="Direct link to OpenFeign 超时控制">​</a></h3>
<p>场景演示</p>
<p>超时设置，<strong>故意设置超时演示出错情况</strong></p>
<p>服务提供方 8001 故意写暂停程序</p>
<div class="language-JAVA language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@GetMapping(value = &quot;/payment/feign/timeout&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public String paymentFeignTimeout(){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    try { TimeUnit.SECONDS.sleep(3); }catch (Exception e) {e.printStackTrace();}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    return serverPort;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>服务消费方 80 添加超时方法 PaymentFeignService</p>
<div class="language-JAVA language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@GetMapping(value = &quot;/payment/feign/timeout&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public String paymentFeignTimeout();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>服务消费方 80 添加超时方法 OrderFeignController</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@GetMapping(value = &quot;/consumer/payment/feign/timeout&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public String paymentFeignTimeout(){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">   return paymentFeignService.paymentFeignTimeout();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>测试方法</p>
<p>访问延时方法:<a href="http://localhost/consumer/payment/feign/timeout" target="_blank" rel="noopener noreferrer">http://localhost/consumer/payment/feign/timeout</a></p>
<p>错误页面:</p>
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-7cjtDIAK-1648908821916)(<a href="https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210905153649722.png" target="_blank" rel="noopener noreferrer">https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210905153649722.png</a>)]</p>
<p>OpenFeign 默认等待一秒钟，超过后报错,因为集成了 ribbon,默认超过一秒钟就会超时</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/712f62404acd94fe29775669716eadfc.png" alt="image-20210905153751258" class="img_ev3q"></p>
<p>怎么配置呢 ? :我们在 yml 中配置 ribbon 的超时即可</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">ribbon</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">ReadTimeout</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">5000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">ConnectTimeout</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">5000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="openfeign-日志打印功能">OpenFeign 日志打印功能<a href="#openfeign-日志打印功能" class="hash-link" aria-label="Direct link to OpenFeign 日志打印功能" title="Direct link to OpenFeign 日志打印功能">​</a></h3>
<blockquote>
<p>feign 支持日志打印功能</p>
</blockquote>
<p>我们可以通过日志来获取到 feign 的 http 请求中的细节</p>
<p>对使用了 feign 的接口调用情况监控和输出</p>
<p>opnefeign 的日志级别</p>
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-Jm7bL43A-1648908821917)(<a href="https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210905154015536.png" target="_blank" rel="noopener noreferrer">https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210905154015536.png</a>)]</p>
<p>要使用 opnefeign 的日志</p>
<p>我们需要去配置 config</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">package com.atguigu.springcloud.config;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import feign.Logger;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.context.annotation.Bean;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.context.annotation.Configuration;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class FeignConfig {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    Logger.Level feignLoggerLevel(){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return Logger.Level.FULL;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>之后在 yml 配置日志的级别</p>
<div class="language-YML language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">logging</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">level</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">com.hyc.springcloud.service.PaymentFeignService</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> debug</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>之后查看日志内容</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/b99c42083fa354ede0493706181b0c5e.png" alt="image-20210905154433224" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="hystrix-断路器">Hystrix 断路器<a href="#hystrix-断路器" class="hash-link" aria-label="Direct link to Hystrix 断路器" title="Direct link to Hystrix 断路器">​</a></h2>
<p>我们在使用分布式系统的时候总会面临着一个问题</p>
<p>数十个的依赖关系,有时候会不可避免的出错,</p>
<p>而多个接口调用一个服务有一个挂了,就会导致整个调用的接口无法使用</p>
<p>我们称这个为:服务雪崩</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/91ff5ccdc020652ecf19242c69f20bc1.png" alt="image-20210905154720000" class="img_ev3q"></p>
<blockquote>
<p>服务雪崩</p>
</blockquote>
<p>​ 多个微服务之间调用的时候，假设微服务 A 调用微服务 B 和微服务 C，微服务 B 和微服务 C 又调用其它的微服务，这就是所谓的“扇出”。如果扇出的链路上某个微服务的调用响应时间过长或者不可用，对微服务 A 的调用就会占用越来越多的系统资源，进而引起系统崩溃，所谓的“雪崩效应”.
对于高流量的应用来说，单一的后端依赖可能会导致所有服务器上的所有资源都在几秒钟内饱和。比失败更糟糕的是，这些应用程序还可能导致服务之间的延迟增加，备份队列，线程和其他系统资源紧张，导致整个系统发生更多的级联故障。这些都表示需要对故障和延迟进行隔离和管理，以便单个依赖关系的失败，不能取消整个应用程序或系统。
​ 所以，通常当你发现一个模块下的某个实例失败后，这时候这个模块依然还会接收流量，然后这个有问题的模块还调用了其他的模块，这样就会发生级联故障，或者叫雪崩。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="有需求那就有人出手解决于是乎-出现了">有需求那就有人出手解决于是乎:Hystrix 出现了<a href="#有需求那就有人出手解决于是乎-出现了" class="hash-link" aria-label="Direct link to 有需求那就有人出手解决于是乎:Hystrix 出现了" title="Direct link to 有需求那就有人出手解决于是乎:Hystrix 出现了">​</a></h3>
<p>​ Hystrix 是一个用于处理分布式系统的延迟和容错的开源库，在分布式系统里，许多依赖不可避免的会调用失败，比如超时、异常等，Hystrix 能够保证在一个依赖出问题的情况下，不会导致整体服务失败，避免级联故障，以提高分布式系统的弹性。
​ &quot;断路器”本身是一种开关装置，当某个服务单元发生故障之后，通过断路器的故障监控（类似熔断保险丝)，向调用方返回一个符合预期的、可处理的备选响应（FallBack)，而不是长时间的等待或者抛出调用方无法处理的异常，这样就保证了服务调用方的线程不会被长时间、不必要地占用，从而避免了故障在分布式系统中的蔓延，乃至雪崩。</p>
<blockquote>
<p>讲了这么多他能解决什么呢?</p>
</blockquote>
<ul>
<li>服务降级</li>
<li>服务熔断</li>
<li>接近实时的监控</li>
</ul>
<p>官网连接:<a href="https://github.com/Netflix/Hystrix/wiki/How-To-Use" target="_blank" rel="noopener noreferrer">https://github.com/Netflix/Hystrix/wiki/How-To-Use</a></p>
<p>然而这么好的东西 : Hystrix 官宣，停更进维</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/cb5158330cb57e005a1e72d846cef628.png" alt="image-20210905155233076" class="img_ev3q"></p>
<p>为了后面新的学习,我们需要理解思想,主要学习思想</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="hystrix-重要概念">Hystrix 重要概念<a href="#hystrix-重要概念" class="hash-link" aria-label="Direct link to Hystrix 重要概念" title="Direct link to Hystrix 重要概念">​</a></h3>
<blockquote>
<p>服务降级 fallback</p>
</blockquote>
<p>服务器忙，请稍候再试，不让客户端等待并立刻返回一个友好提示，fallback 方法</p>
<p>要是让客户端看到这个</p>
<p>哪些情况会触发降级:</p>
<ol>
<li>程序运行异常</li>
<li>超时</li>
<li>服务熔断触发服务降级</li>
<li>线程池/信号量打满也会导致服务降级</li>
</ol>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/349743d7fa642ec41fa68005ab3dca13.png" alt="image-20210905153649722" class="img_ev3q"></p>
<p>不太好</p>
<p>我们可以在服务器出问题的时候编写兜底方法,如果服务出问题,有一个兜底,调用友好提示</p>
<blockquote>
<p>服务熔断机制</p>
</blockquote>
<p>类比保险丝达到最大服务访问后，直接拒绝访问，拉闸限电，然后调用服务降级的方法并返回友好提示</p>
<p>服务的降级-&gt;进而熔断-&gt;恢复调用链路</p>
<p>最核心的是可以重启服务</p>
<p>他就是类似一个机制,如果服务器出现触发机制的问题,停止服务,调用服务降级,尝试恢复服务</p>
<blockquote>
<p>服务限流 flowlimit(这里我暂时没有实践,等到 Alibaba 的版本的时候在使用)</p>
</blockquote>
<p>秒杀高并发等操作，严禁一窝蜂的过来拥挤，大家排队，一秒钟 N 个，有序进行</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="服务降级-实例模块编写">服务降级: 实例模块编写<a href="#服务降级-实例模块编写" class="hash-link" aria-label="Direct link to 服务降级: 实例模块编写" title="Direct link to 服务降级: 实例模块编写">​</a></h3>
<p>新建项目<code>cloud-provider-hystrix-payment8001</code></p>
<p>导入核心依赖</p>
<div class="language-XML language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!--新增hystrix--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-netflix-hystrix</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-netflix-eureka-client</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">com.atguigu.springcloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">cloud-api-commons</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">${project.version}</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-actuator</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-devtools</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">runtime</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.projectlombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">lombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-test</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">test</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>yml 配置</p>
<div class="language-YML language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">server</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">8001</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">client</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">register-with-eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain">    </span><span class="token comment" style="color:#6A9955">#表识不向注册中心注册自己</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">fetch-registry</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain">   </span><span class="token comment" style="color:#6A9955">#表示自己就是注册中心，职责是维护服务实例，并不需要去检索服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">service-url</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token comment" style="color:#6A9955"># defaultZone: http://eureka7002.com:7002/eureka/    #设置与eureka server交互的地址查询服务和注册服务都需要依赖这个地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">defaultZone</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//eureka7001.com</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">7001/eureka/</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token comment" style="color:#6A9955">#  server:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token comment" style="color:#6A9955">#    enable-self-preservation: false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">spring</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">application</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> cloud</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">provider</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">hystrix</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">payment</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token comment" style="color:#6A9955">#    eviction-interval-timer-in-ms: 2000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>编写主启动类</p>
<div class="language-JAVA language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@EnableEurekaClient</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class PaymentHystrixMain8001 {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        SpringApplication.run(PaymentHystrixMain8001.class,args);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>之后编写服务(这里我们直接使用实现类)</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@Service</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class PaymentService {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    //成功</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public String paymentInfo_OK(Integer id){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return &quot;线程池：&quot;+Thread.currentThread().getName()+&quot;   paymentInfo_OK,id：  &quot;+id+&quot;\t&quot;+&quot;哈哈哈&quot;  ;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    //失败</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public String paymentInfo_TimeOut(Integer id){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        int timeNumber = 3;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        try { TimeUnit.SECONDS.sleep(timeNumber); }catch (Exception e) {e.printStackTrace();}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return &quot;线程池：&quot;+Thread.currentThread().getName()+&quot;   paymentInfo_TimeOut,id：  &quot;+id+&quot;\t&quot;+&quot;呜呜呜&quot;+&quot; 耗时(秒)&quot;+timeNumber;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>编写控制层</p>
<div class="language-JAVA language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@RestController</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class PaymentController {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Resource</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    private PaymentService paymentService;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Value(&quot;${server.port}&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    private String serverPort;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @GetMapping(&quot;/payment/hystrix/ok/{id}&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public String paymentInfo_OK(@PathVariable(&quot;id&quot;) Integer id){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        String result = paymentService.paymentInfo_OK(id);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        log.info(&quot;*******result:&quot;+result);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return result;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @GetMapping(&quot;/payment/hystrix/timeout/{id}&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public String paymentInfo_TimeOut(@PathVariable(&quot;id&quot;) Integer id){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        String result = paymentService.paymentInfo_TimeOut(id);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        log.info(&quot;*******result:&quot;+result);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return result;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>之后启动测试方法</p>
<p>两个方法都 OK</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="业务场景">业务场景<a href="#业务场景" class="hash-link" aria-label="Direct link to 业务场景" title="Direct link to 业务场景">​</a></h4>
<p>带入场景</p>
<p>开启 Jmeter，来 20000 个并发压死 8001，20000 个请求都去访问 paymentInfo_TimeOut 服务</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/6c9adc23b560ae3a76e6eae08f5d82a7.png" alt="image-20210905175524136" class="img_ev3q"></p>
<p>这个时候我们再次访问的时候哪怕是第一个方法也会出现转圈加载的情况</p>
<blockquote>
<p>为什么会被卡死?</p>
</blockquote>
<p>因为 tomcat 的默认的工作线程数被打满了，没有多余的线程来分解压力和处理。</p>
<p>上面还是服务提供者 8001 自己测试，</p>
<p>假如此时外部的消费者 80 也来访问，那消费者只能干等，最终导致消费端 80 不满意，服务端 8001 直接被拖死</p>
<p>以上还只是服务提供者的自测,这个时候我们就需要使用 hystrix 的时候</p>
<p>我们一般使用在服务端,客户端也可以做两重保险</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="客户端">客户端<a href="#客户端" class="hash-link" aria-label="Direct link to 客户端" title="Direct link to 客户端">​</a></h4>
<p>看热闹不嫌事情大,这个时候我们加入客户端,来更接近真实业务</p>
<p>新建模块<code>cloud-consumer-feign-hystrix-order80</code></p>
<p>导入依赖</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain"> </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!--新增hystrix--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-netflix-hystrix</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-openfeign</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-netflix-eureka-client</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">com.atguigu.springcloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">cloud-api-commons</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">${project.version}</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-actuator</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-devtools</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">runtime</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.projectlombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">lombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-test</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">test</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>配置 yml</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">server</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">client</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">register-with-eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain">    </span><span class="token comment" style="color:#6A9955">#表识不向注册中心注册自己</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">fetch-registry</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain">   </span><span class="token comment" style="color:#6A9955">#表示自己就是注册中心，职责是维护服务实例，并不需要去检索服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">service-url</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">             </span><span class="token key atrule">defaultZone</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//eureka7001.com</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">7001/eureka/</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">spring</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">application</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> cloud</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">provider</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">hystrix</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">order</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>主启动类</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@EnableEurekaClient</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class PaymentHystrixMain8001 {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        SpringApplication.run(PaymentHystrixMain8001.class,args);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">package com.atguigu.springcloud;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.boot.SpringApplication;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.cloud.openfeign.EnableFeignClients;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@EnableFeignClients</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class OrderHystrixMain80 {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        SpringApplication.run(OrderHystrixMain80.class,args);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>服务接口</p>
<div class="language-JAVA language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">package com.atguigu.springcloud.service;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.cloud.openfeign.FeignClient;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.stereotype.Component;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.web.bind.annotation.GetMapping;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.web.bind.annotation.PathVariable;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@FeignClient(value = &quot;CLOUD-PROVIDER-HYSTRIX-PAYMENT&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public interface PaymentHystrixService {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @GetMapping(&quot;/payment/hystrix/ok/{id}&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public String paymentInfo_OK(@PathVariable(&quot;id&quot;) Integer id);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @GetMapping(&quot;/payment/hystrix/timeout/{id}&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public String paymentInfo_TimeOut(@PathVariable(&quot;id&quot;) Integer id);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>controller 接口</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@RestController</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class OrderHystrixController {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Resource</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    private PaymentHystrixService paymentHystrixService;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Value(&quot;${server.port}&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    private String serverPort;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @GetMapping(&quot;/consumer/payment/hystrix/ok/{id}&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public String paymentInfo_OK(@PathVariable(&quot;id&quot;) Integer id){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        String result = paymentHystrixService.paymentInfo_OK(id);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        log.info(&quot;*******result:&quot;+result);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return result;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @GetMapping(&quot;/consumer/payment/hystrix/timeout/{id}&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public String paymentInfo_TimeOut(@PathVariable(&quot;id&quot;) Integer id){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        String result = paymentHystrixService.paymentInfo_TimeOut(id);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        log.info(&quot;*******result:&quot;+result);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return result;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>之后测试</p>
<p>再高并发场景下会出现什么情况</p>
<ul>
<li>2W 个线程压 8001</li>
<li>消费端 80 微服务再去访问正常的 OK 微服务 8001 地址</li>
</ul>
<p>此时的 80 访问有两种情况</p>
<ol>
<li>要么转圈圈等待</li>
<li>要么超时</li>
</ol>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/2ce9e5800e2c29ebcaa37337e2c8931b.png" alt="image-20210905180340825" class="img_ev3q"></p>
<p>为什么会出现上述情况呢?</p>
<ol>
<li>8001 同一层次的其他接口服务被困死，因为 tomcat 线程里面的工作线程已经被挤占完毕</li>
<li>80 此时调用 8001，客户端访问响应缓慢，转圈圈</li>
</ol>
<p><strong>正因为有上述故障或不佳表现，才有我们的降级/容错/限流等技术诞生</strong></p>
<blockquote>
<p>如何解决？解决的要求</p>
</blockquote>
<p>这个时候我们的问题有了解决方案</p>
<ol>
<li>超时导致服务器变慢（转圈）---------&gt;超时不再等待,超过一定时间调用 fallback 方法</li>
<li>出错（宕机或程序运行出错）----------&gt;出错要有兜底有方法兜底</li>
</ol>
<p>解决:</p>
<ul>
<li>对方服务（8001）超时了，调用者（80）不能一直卡死等待，必须有服务降级</li>
<li>对方服务（8001）down 机了，调用者（80）不能一直卡死等待，必须有服务降级</li>
<li>对方服务（8001）OK，调用者（80）自己出故障或有自我要求（自己的等待时间小于服务提供者），自己处理降级</li>
</ul>
<p>有了方案呢我们可以去执行</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="8001fallback">8001fallback<a href="#8001fallback" class="hash-link" aria-label="Direct link to 8001fallback" title="Direct link to 8001fallback">​</a></h4>
<p>设置自身调用超时时间的峰值，峰值内可以正常运行，超过了需要有兜底的方法处理，作服务降级 fallback</p>
<p>业务类启用 我们需要使用到 Hystrix 的注解</p>
<p><code>@HystrixCommand报异常后如何处理</code>: 一旦调用服务方法失败并抛出了错误信息后，会自动调用@HystrixCommand 标注好的 fallbackMethod 调用类中的指定方法</p>
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-ruDUmb2p-1648908821920)(<a href="https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210905180818599.png" target="_blank" rel="noopener noreferrer">https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210905180818599.png</a>)]</p>
<p>老规矩用了新的组件</p>
<p>主启动类就要激活</p>
<p>添加新注解<code>@EnableCircuitBreaker</code></p>
<p>此时的主启动类</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@EnableEurekaClient</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@EnableCircuitBreaker</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class paymentHystrix8001 {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        SpringApplication.run(paymentHystrix8001.class,args);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="80fallback">80fallback<a href="#80fallback" class="hash-link" aria-label="Direct link to 80fallback" title="Direct link to 80fallback">​</a></h4>
<p>80 订单微服务，也可以更好的保护自己，自己也依样画葫芦进行客户端降级保护</p>
<p>配置 yml</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">feign</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">hystrix</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955">#如果处理自身的容错就开启。开启方式与生产端不一样。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>主启动</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@EnableFeignClients</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@EnableHystrix</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class feignHystrixMain80 {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        SpringApplication.run(feignHystrixMain80.class,args);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>业务类</p>
<div class="language-JAVA language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@GetMapping(&quot;/consumer/payment/hystrix/timeout/{id}&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@HystrixCommand(fallbackMethod = &quot;paymentTimeOutFallbackMethod&quot;,commandProperties = {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;,value = &quot;1500&quot;)  //3秒钟以内就是正常的业务逻辑</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">})</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public String paymentInfo_TimeOut(@PathVariable(&quot;id&quot;) Integer id){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    String result = paymentHystrixService.paymentInfo_TimeOut(id);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    return result;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">//兜底方法</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public String paymentTimeOutFallbackMethod(@PathVariable(&quot;id&quot;) Integer id){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    return &quot;我是消费者80，对付支付系统繁忙请10秒钟后再试或者自己运行出错请检查自己,(┬＿┬)&quot;;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="代码膨胀">代码膨胀<a href="#代码膨胀" class="hash-link" aria-label="Direct link to 代码膨胀" title="Direct link to 代码膨胀">​</a></h4>
<p>解决了服务兜底的问题,我们这个时候审视场景,会发现,如果每个方法都有一个兜底那是不是太膨胀了</p>
<p>于是乎我们需要一套公用的兜底方案,个别案例再去用一对一兜底</p>
<p>新注解:<code>@DefaultProperties(defaultFallback = &quot;&quot;)</code></p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/6ce6f42ace3bd637415b5c74e8d44881.png" alt="image-20210905181325246" class="img_ev3q"></p>
<p>接下来就是 80Controller 的改变</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/4fffef7c147b7cae8c157dff0b055b2e.png" alt="image-20210905181613140" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="业务逻辑混乱">业务逻辑混乱<a href="#业务逻辑混乱" class="hash-link" aria-label="Direct link to 业务逻辑混乱" title="Direct link to 业务逻辑混乱">​</a></h4>
<p>我们在思考一下,还能不能再优化?</p>
<p>本次案例服务降级处理是在客户端 80 实现完成的，与服务端 8001 没有关系，只需要为 Feign 客户端定义的接口添加一个服务降级处理的实现类即可实现解耦</p>
<p>我们只需要将统一的兜底方法抽象出来,和业务代码分离,就可以解决客户端,混乱的问题,
业务就只关心业务,兜底就专门负责兜底.</p>
<p>接下来</p>
<p>根据 cloud-consumer-feign-hystrix-order80 已经有的 PaymentHystrixService 接口，重新新建一个类（PaymentFallbackService）实现该接口，统一为接口里面的方法进行异常处理</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">package com.atguigu.springcloud.service;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.stereotype.Component;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class PaymentFallbackService implements PaymentHystrixService {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public String paymentInfo_OK(Integer id) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return &quot;-----PaymentFallbackService fall back-paymentInfo_OK , (┬＿┬)&quot;;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public String paymentInfo_TimeOut(Integer id) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return &quot;-----PaymentFallbackService fall back-paymentInfo_TimeOut , (┬＿┬)&quot;;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>使用 fegin 的好处就来了</p>
<p>fegin 里集成了 fegin 于是乎我们可以这样来改建我们的 80 服务接口
<code>fallback = PaymentFallbackService.class</code>设置参数指向我们的兜底类</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@FeignClient(value = &quot;CLOUD-PROVIDER-HYSTRIX-PAYMENT&quot;,fallback = PaymentFallbackService.class)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public interface PaymentHystrixService {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @GetMapping(&quot;/payment/hystrix/ok/{id}&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public String paymentInfo_OK(@PathVariable(&quot;id&quot;) Integer id);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @GetMapping(&quot;/payment/hystrix/timeout/{id}&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public String paymentInfo_TimeOut(@PathVariable(&quot;id&quot;) Integer id);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>测试:</p>
<ul>
<li>单个 eureka 先启动 7001</li>
<li>PaymentHystrixMain8001 启动</li>
<li>正常访问测试</li>
<li>故意关闭微服务 8001</li>
<li>客户端自己调用提升: 此时服务端 provider 已经 down 了，但是我们做了服务降级处理，让客户端在服务端不可用时也会获得提示信息而不会挂起耗死服务器</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="小总结">小总结:<a href="#小总结" class="hash-link" aria-label="Direct link to 小总结:" title="Direct link to 小总结:">​</a></h4>
<p>​ 到这里我们就解决了有关客户端和服务端两方面的服务降级解决方案</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="服务熔断--实力模块编写">服务熔断 : 实力模块编写<a href="#服务熔断--实力模块编写" class="hash-link" aria-label="Direct link to 服务熔断 : 实力模块编写" title="Direct link to 服务熔断 : 实力模块编写">​</a></h3>
<p>其实,服务熔断就是一种调用机制,</p>
<p>他来判断什么时候触发服务熔断,达到触发雕件,就暂停服务的使用,调用服务降级,和并且在一定时间或者是其他条件的完成尝试重启服务</p>
<p>马丁福勒提出的理论:<strong><a href="https://martinfowler.com/bliki/CircuitBreaker.html" target="_blank" rel="noopener noreferrer">https://martinfowler.com/bliki/CircuitBreaker.html</a></strong></p>
<p>修改业务类<code>cloud-provider-hystrix-payment8001</code></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">//服务熔断</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@HystrixCommand(fallbackMethod = &quot;paymentCircuitBreaker_fallback&quot;,commandProperties = {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        @HystrixProperty(name = &quot;circuitBreaker.enabled&quot;,value = &quot;true&quot;),  //是否开启断路器</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        @HystrixProperty(name = &quot;circuitBreaker.requestVolumeThreshold&quot;,value = &quot;10&quot;),   //请求次数</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        @HystrixProperty(name = &quot;circuitBreaker.sleepWindowInMilliseconds&quot;,value = &quot;10000&quot;),  //时间范围</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        @HystrixProperty(name = &quot;circuitBreaker.errorThresholdPercentage&quot;,value = &quot;60&quot;), //失败率达到多少后跳闸</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">})</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public String paymentCircuitBreaker(@PathVariable(&quot;id&quot;) Integer id){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    if (id &lt; 0){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        throw new RuntimeException(&quot;*****id 不能负数&quot;);//抛出异常</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    String serialNumber = IdUtil.simpleUUID();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    return Thread.currentThread().getName()+&quot;\t&quot;+&quot;调用成功,流水号：&quot;+serialNumber;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public String paymentCircuitBreaker_fallback(@PathVariable(&quot;id&quot;) Integer id){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    return &quot;id 不能负数，请稍候再试,(┬＿┬)/~~     id: &quot; +id;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>CONTROLLER 编写</p>
<div class="language-JAVA language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">//===服务熔断</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@GetMapping(&quot;/payment/circuit/{id}&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public String paymentCircuitBreaker(@PathVariable(&quot;id&quot;) Integer id){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    String result = paymentService.paymentCircuitBreaker(id);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    log.info(&quot;*******result:&quot;+result);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    return result;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>之后我们测试</p>
<p>一直用参数为-1 的错误请求访问</p>
<p>之后访问正确的请求(参数为正数)会发现</p>
<p>服务暂时调用不了正确的业务代码</p>
<p>多次错误,然后慢慢正确，发现刚开始不满足条件，就算是正确的访问地址也不能进行访问，等待片刻之后就可以访问到了</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="原理小总结">原理（小总结）<a href="#原理小总结" class="hash-link" aria-label="Direct link to 原理（小总结）" title="Direct link to 原理（小总结）">​</a></h4>
<blockquote>
<p>熔断类型</p>
<p>熔断打开:</p>
<p>​ 请求不再进行调用当前服务，内部设置时钟一般为 MTTR(平均故障处理时间)，当打开时长达到所设时钟则进入熔断状态</p>
<p>熔断关闭:</p>
<p>​ 熔断关闭不会对服务进行熔断,而是暂时关闭服务,等待片刻就会进入半开状态</p>
<p>熔断半开:</p>
<p>​ 部分请求根据规则调用当前服务，如果请求成功且符合规则则认为当前服务恢复正常，关闭熔断</p>
</blockquote>
<p>官网的流程步骤:</p>
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-jl4s7lNJ-1648908821921)(<a href="https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210905204203408.png" target="_blank" rel="noopener noreferrer">https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210905204203408.png</a>)]</p>
<blockquote>
<p>什么时候会触发熔断呢?</p>
</blockquote>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/6d2e0d31691e16e8f73151d2e68de1cd.png" alt="image-20210905204230488" class="img_ev3q"></p>
<p>涉及到断路器的三个重要参数:快照时间窗、请求总数阀值、错误百分比阀值。</p>
<ul>
<li>快照时间窗:断路器确定是否打开需要统计一些请求和错误数据，而统计的时间范围就是快照时间窗，默认为最近的 10 秒。</li>
<li>请求总数阀值:在快照时间窗内，必须满足请求总数阀值才有资格熔断。默认为 20，意味着在 10 秒内，如果该 hystrix 命令的调用次数不足 20 次，即使所有的请求都超时或其他原因失败，断路器都不会打开。</li>
<li>错误百分比阀值:当请求总数在快照时间窗内超过了阀值，比如发生了 30 次调用，如果在这 30 次调用中，有 15 次发生了超时异常，也就是超过 50%的错误百分比，在默认设定 50%阀值情况下，这时候就会将断路器打开。</li>
</ul>
<blockquote>
<p>断路器开启或者关闭的条件</p>
</blockquote>
<ol>
<li>当满足一定阀值的时候（默认 10 秒内超过 20 个请求次数）</li>
<li>当失败率达到一定的时候（默认 10 秒内超过 50%请求失败）</li>
<li>到达以上阀值，断路器将会开启</li>
<li>当开启的时候，所有请求都不会进行转发</li>
<li>一段时间之后（默认是 5 秒），这个时候断路器是半开状态，会让其中一个请求进行转发。如果成功，断路器会关闭，若失败，继续开启。重复 4 和 5</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="gateway-新一代网关">Gateway 新一代网关<a href="#gateway-新一代网关" class="hash-link" aria-label="Direct link to Gateway 新一代网关" title="Direct link to Gateway 新一代网关">​</a></h2>
<p>gateway 官网:<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/" target="_blank" rel="noopener noreferrer">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/</a></p>
<blockquote>
<p>他是什么?</p>
</blockquote>
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-1vTkY1mr-1648908821921)(<a href="https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911002632034.png" target="_blank" rel="noopener noreferrer">https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911002632034.png</a>)]</p>
<p>​ Gateway 是在 Spring 生态系统之上构建的 API 网关服务，基于 Spring 5，Spring Boot 2 和 Project Reactor 等技术。
Gateway 旨在提供一种简单而有效的方式来对 API 进行路由，以及提供一些强大的过滤器功能，例如:熔断、限流、重试等</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/3159f85d46a4dc3562d17cf160225e2e.png" alt="image-20210911002642902" class="img_ev3q"></p>
<p>​ SpringCloud Gateway 是 Spring Cloud 的一个全新项目，基于 Spring 5.0+Spring Boot 2.0 和 Project Reactor 等技术开发的网关，它旨在为微服务架构提供—种简单有效的统一的 API 路由管理方式。
​ SpringCloud Gateway 作为 Spring Cloud 生态系统中的网关，目标是替代 Zuul，在 Spring Cloud 2.0 以上版本中，没有对新版本的 Zuul .0 以上最新高性能版本进行集成，仍然还是使用的 Zuul 1.x 非 Reactor 模式的老版本。而为了提升网关的性能
​ SpringCloud Gateway 是基于 WebFlux 框架实现的，而 WebFlux 框架底层则使用了高性能的 Reactor 模式通信框架 Netty。
​ Spring Cloud Gateway 的目标提供统一的路由方式且基于 Filter 链的方式提供了网关基本的功能，例如:安全，监控/指标，和限流。</p>
<p>一句话概括就是:<strong>Spring Cloud Gateway 使用的 Webflux 中的 reactor-netty 响应式编程组件，底层使用了 Netty 通讯框架.</strong></p>
<p>架构:</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/c17fad73049ad88dc3543bd1bf11911e.png" alt="image-20210911002757348" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="技术背景">技术背景<a href="#技术背景" class="hash-link" aria-label="Direct link to 技术背景" title="Direct link to 技术背景">​</a></h3>
<blockquote>
<p><strong>有了 Zuul 了怎么又出来了 gateway??</strong></p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="我们为什么选择-gatway">我们为什么选择 Gatway?:<a href="#我们为什么选择-gatway" class="hash-link" aria-label="Direct link to 我们为什么选择 Gatway?:" title="Direct link to 我们为什么选择 Gatway?:">​</a></h4>
<p>neflix 不太靠谱，zuul2.0 一直跳票,迟迟不发布</p>
<p>​ 一方面因为 Zuul1.0 已经进入了维护阶段，而且 Gateway 是 SpringCloud 团队研发的，是亲儿子产品，值得信赖。而且很多功能 Zuul 都没有用起来也非常的简单便捷。
​ Gateway 是基于异步非阻塞模型上进行开发的，性能方面不需要担心。虽然 Netflix 早就发布了最新的 Zuul 2.x,但 Spring Cloud 貌似没有整合计划。而且 Netflix 相关组件都宣布进入维护期;不知前景如何 ? 多方面综合考虑 Gateway 是很理想的网关选择。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="springcloud-gateway-具有如下特性">SpringCloud Gateway 具有如下特性<a href="#springcloud-gateway-具有如下特性" class="hash-link" aria-label="Direct link to SpringCloud Gateway 具有如下特性" title="Direct link to SpringCloud Gateway 具有如下特性">​</a></h4>
<ul>
<li>基于 Spring Framework 5, Project Reactor 和 Spring Boot 2.0 进行构建;动态路由:能够匹配任何请求属性;</li>
<li>可以对路由指定 Predicate(断言）和 Filter (过滤器）;集成 Hystrix 的断路器功能;</li>
<li>集成 Spring Cloud 服务发现功能;</li>
<li>易于编写的 Predicate(断言）和 Filter (过滤器);请求限流功能;</li>
<li>支持路径重写。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="技术对比">技术对比<a href="#技术对比" class="hash-link" aria-label="Direct link to 技术对比" title="Direct link to 技术对比">​</a></h4>
<blockquote>
<p>Zuul</p>
</blockquote>
<p>Springcloud 中所集成的 Zuul 版本，采用的是 Tomcat 容器，使用的是传统的 Servlet lO 处理模型。
学过尚硅谷 web 中期课程都知道一个题目，Servlet 的生命周期?servlet 由 servlet container 进行生命周
期管理。
container 启动时构造 servlet 对象并调用 servlet init)进行初始化;
container 运行时接受请求，并为每个请求分配一个线程（一般从线程池中获取空闲线程）然后调用 service()。container 关闭时调用 servlet destory0 销毁 servlet;</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/5ff870db02596d3dd3143b336aa656be.png" alt="image-20210911003206886" class="img_ev3q"></p>
<p>上述模式的缺点:</p>
<p>​ servlet 是一个简单的网络 IO 模型，当请求进入 servlet container 时，servlet container 就会为其绑定一个线程，在并发不高的场景下这种模型是适用的。但是一旦高并发(此比如抽风用 jemeter)，线程数量就会上涨，而线程资源代价是昂贵的（上线文切换，内存消耗大)严重影响请求的处理时间。</p>
<p>在一些简单业务场景下，不希望为每个 request 分配一个线程，只需要 1 个或几个线程就能应对极大并发的请求，这种业务场景下 servlet 模型没有优势</p>
<p>所以 Zuul 1.X 是基于 servlet 之上的一个姐塞式处理模型，即 spring 实现了处理所有 request 请求的一个 servlet (DispatcherServiet)并由该 servletse 塞式处理处理。所以 Springcloud Zuul 无法摆脱 servlet 模型的弊端</p>
<blockquote>
<p>gateway(webflux + netty)</p>
</blockquote>
<p>​ 传统的 Web 框架，比如说: struts2,springmvc 等都是基于 Servlet API 与 Servlet 容器基础之上运行的。
但是
​ 在 Servlet3.1 之后有了异步非阻塞的支持。而 WebFlux 是一个典型非阻塞异步的框架，它的核心是基于 Reactor 的相关 API 实现的。相对于传统的 web 框架来说，它可以运行在诸如 Netty, Undertow 及支持 Servlet3.1 的容器上。非阻塞式+函数式编程(Spring5 必须让你使用 java8)</p>
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-VA68uSuE-1648908821923)(<a href="https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911003521718.png" target="_blank" rel="noopener noreferrer">https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911003521718.png</a>)]</p>
<p>​ Spring WebFlux 是 Spring 5.0 引入的新的响应式框架，区别于 Spring MVC，它不需要依赖 Servlet API，它是完全异步非阻塞的，并且基于 Reactor 来实现响应式流规范。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="gateway-三大核心概念">Gateway 三大核心概念<a href="#gateway-三大核心概念" class="hash-link" aria-label="Direct link to Gateway 三大核心概念" title="Direct link to Gateway 三大核心概念">​</a></h3>
<p><strong>Route(路由)</strong>：</p>
<p>​ 路由是构建网关的基本模块，它由 ID，目标 URI，一系列的断言和过滤器组成，如果断言为 true 则匹配该路由</p>
<p><strong>Predicate（断言）：</strong></p>
<p>​ 参考的是 java8 的 java.util.function.Predicate 开发人员可以匹配 HTTP 请求中的所有内容（例如请求头或请求参数），如果请求与断言相匹配则进行路由</p>
<p><strong>Filter(过滤)</strong>：</p>
<p>​ 指的是 Spring 框架中 GatewayFilter 的实例，使用过滤器，可以在请求被路由前或者之后对请求进行修改。</p>
<p>总体:</p>
<ul>
<li>web 请求，通过一些匹配条件，定位到真正的服务节点。并在这个转发过程的前后，进行一些精细化控制。</li>
<li>predicate 就是我们的匹配条件;</li>
<li>flter，就可以理解为一个无所不能的拦截器。有了这两个元素，再加上目标 uri，就可以实现一个具体的路由了</li>
</ul>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/3b83431058325029514620c8d99cf516.png" alt="image-20210911003737963" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="gateway-工作流程">Gateway 工作流程<a href="#gateway-工作流程" class="hash-link" aria-label="Direct link to Gateway 工作流程" title="Direct link to Gateway 工作流程">​</a></h3>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/3c8a3336c2957d0af1d220c484c93564.png" alt="image-20210911003852702" class="img_ev3q"></p>
<p>核心逻辑: <code>路由转发+执行过滤器链</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="demo-实战">demo 实战<a href="#demo-实战" class="hash-link" aria-label="Direct link to demo 实战" title="Direct link to demo 实战">​</a></h3>
<p>新建模块: <code>cloud-gateway-gateway9527</code></p>
<p>导入依赖</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!--新增gateway--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-gateway</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">com.atguigu.springcloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">cloud-api-commons</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">1.0-SNAPSHOT</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-netflix-hystrix</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-netflix-eureka-client</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-devtools</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">runtime</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.projectlombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">lombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-test</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">test</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>配置对应的 yml</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">server</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">9527</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">spring</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">application</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> cloud</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">gateway</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">cloud</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">gateway</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">routes</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token punctuation" style="color:#475569">-</span><span class="token plain"> </span><span class="token key atrule">id</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> payment_routh </span><span class="token comment" style="color:#6A9955">#路由的ID，没有固定规则但要求唯一，建议配合服务名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">          </span><span class="token key atrule">uri</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#475569">:</span><span class="token number" style="color:#B5CEA8">8001</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955">#匹配后提供服务的路由地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">          </span><span class="token key atrule">predicates</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token punctuation" style="color:#475569">-</span><span class="token plain"> Path=/payment/get/</span><span class="token important">**</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955">#断言,路径相匹配的进行路由</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token punctuation" style="color:#475569">-</span><span class="token plain"> </span><span class="token key atrule">id</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> payment_routh2</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">          </span><span class="token key atrule">uri</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#475569">:</span><span class="token number" style="color:#B5CEA8">8001</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">          </span><span class="token key atrule">predicates</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token punctuation" style="color:#475569">-</span><span class="token plain"> Path=/payment/lb/</span><span class="token important">**</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955">#断言,路径相匹配的进行路由</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">instance</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">hostname</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> cloud</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">gateway</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">client</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">service-url</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">register-with-eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">fetch-registry</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">defaultZone</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//eureka7001.com</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">7001/eureka</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>编写主启动类:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@EnableEurekaClient</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class GateWayMain9527 {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            SpringApplication.run( GateWayMain9527.class,args);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>构建好基本的网关模块之后,我们需要思考</p>
<p><strong>9527 网关如何做路由映射那？？？</strong></p>
<p>我们打开服务提供者:<code>cloud-provider-payment8001看看controller的访问地址</code></p>
<p>我们不想暴露 8001 服务端口，希望在 8001 外面套一层 9527</p>
<p>于是乎</p>
<p>配置网管 9527 的配置文件</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">server</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">9527</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">spring</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">application</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> cloud</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">gateway</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">cloud</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">gateway</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">routes</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">-</span><span class="token plain"> </span><span class="token key atrule">id</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> payment_routh </span><span class="token comment" style="color:#6A9955">#路由的ID，没有固定规则但要求唯一，建议配合服务名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">uri</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#475569">:</span><span class="token number" style="color:#B5CEA8">8001</span><span class="token plain">   </span><span class="token comment" style="color:#6A9955">#匹配后提供服务的路由地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">predicates</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token punctuation" style="color:#475569">-</span><span class="token plain"> Path=/payment/get/</span><span class="token important">**</span><span class="token plain">   </span><span class="token comment" style="color:#6A9955">#断言,路径相匹配的进行路由</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">-</span><span class="token plain"> </span><span class="token key atrule">id</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> payment_routh2</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">uri</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#475569">:</span><span class="token number" style="color:#B5CEA8">8001</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">predicates</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token punctuation" style="color:#475569">-</span><span class="token plain"> Path=/payment/lb/</span><span class="token important">**</span><span class="token plain">   </span><span class="token comment" style="color:#6A9955">#断言,路径相匹配的进行路由</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">instance</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">hostname</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> cloud</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">gateway</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">client</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">service-url</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">register-with-eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">fetch-registry</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">defaultZone</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//eureka7001.com</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">7001/eureka</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这个时候我们可以来测试一下</p>
<p>添加网关前:<a href="http://localhost:8001/payment/get/1,%E6%88%91%E4%BB%AC%E8%AE%BF%E9%97%AE%E4%BC%9A%E6%9A%B4%E9%9C%B2%E5%87%BA%E7%AB%AF%E5%8F%A3" target="_blank" rel="noopener noreferrer">http://localhost:8001/payment/get/1,我们访问会暴露出端口</a></p>
<p>添加网关后:<a href="http://localhost:9527/payment/get/1,%E6%88%91%E4%BB%AC%E8%AE%BF%E9%97%AE%E7%BD%91%E7%AE%A1,%E4%BB%96%E4%BC%9A%E5%8E%BB%E6%89%BE%E5%88%B0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%AF%B9%E8%B7%AF%E7%94%B1%E7%9A%84%E5%8C%B9%E9%85%8D%E8%B7%AF%E7%94%B1%E5%9C%B0%E5%9D%80,%E4%B9%8B%E5%90%8E%E6%96%AD%E8%A8%80%E6%8C%89%E7%85%A7%E8%A7%84%E5%88%99%E5%8C%B9%E9%85%8D%E8%B7%AF%E7%94%B1" target="_blank" rel="noopener noreferrer">http://localhost:9527/payment/get/1,我们访问网管,他会去找到配置文件对路由的匹配路由地址,之后断言按照规则匹配路由</a></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="通过微服务名实现动态路由">通过微服务名实现动态路由<a href="#通过微服务名实现动态路由" class="hash-link" aria-label="Direct link to 通过微服务名实现动态路由" title="Direct link to 通过微服务名实现动态路由">​</a></h4>
<p>​ 简单看到了网管效果之后,继续看看问题,我们现在的配置十分的膨胀,url 是匹配死的,我们需要的是动态的,</p>
<p>​ 默认情况下 Gateway 会根据注册中心的服务列表，以注册中心上微服务名为路径创建动态路由进行转发，从而实现动态路由的功能</p>
<p>这个时候我们启动 : 一个 eureka7001+两个服务提供者 8001/8002</p>
<p>此时我们要去继续修改 9527 的配置:</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">server</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">9527</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">spring</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">application</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> cloud</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">gateway</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">cloud</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">gateway</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">discovery</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token key atrule">locator</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">          </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955">#开启从注册中心动态创建路由的功能，利用微服务名进行路由</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">routes</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token punctuation" style="color:#475569">-</span><span class="token plain"> </span><span class="token key atrule">id</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> payment_routh </span><span class="token comment" style="color:#6A9955">#路由的ID，没有固定规则但要求唯一，建议配合服务名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">          </span><span class="token comment" style="color:#6A9955">#uri: http://localhost:8001   #匹配后提供服务的路由地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">          </span><span class="token key atrule">uri</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> lb</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//cloud</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">payment</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">          </span><span class="token key atrule">predicates</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token punctuation" style="color:#475569">-</span><span class="token plain"> Path=/payment/get/</span><span class="token important">**</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955">#断言,路径相匹配的进行路由</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token punctuation" style="color:#475569">-</span><span class="token plain"> </span><span class="token key atrule">id</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> payment_routh2</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">          </span><span class="token comment" style="color:#6A9955">#uri: http://localhost:8001   #匹配后提供服务的路由地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">          </span><span class="token key atrule">uri</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> lb</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//cloud</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">payment</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">          </span><span class="token key atrule">predicates</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token punctuation" style="color:#475569">-</span><span class="token plain"> Path=/payment/lb/</span><span class="token important">**</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955">#断言,路径相匹配的进行路由</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">instance</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">hostname</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> cloud</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">gateway</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">client</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">service-url</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">register-with-eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">fetch-registry</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">defaultZone</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//eureka7001.com</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">7001/eureka</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>PS</strong> :</p>
<ul>
<li>需要注意的是 uri 的协议为 lb，表示启用 Gateway 的负载均衡功能。</li>
<li>lb://serviceName 是 spring cloud gateway 在微服务中自动为我们创建的负载均衡 uri</li>
</ul>
<p>之后再次测试</p>
<p><a href="http://localhost:9527/payment/lb" target="_blank" rel="noopener noreferrer">http://localhost:9527/payment/lb</a></p>
<p>就可以发现采用了轮询的方式做负载均衡,在 8001/8002 两个端口切换</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="predicate-的使用断言的使用">Predicate 的使用断言的使用<a href="#predicate-的使用断言的使用" class="hash-link" aria-label="Direct link to Predicate 的使用断言的使用" title="Direct link to Predicate 的使用断言的使用">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="断言是什么">断言是什么?<a href="#断言是什么" class="hash-link" aria-label="Direct link to 断言是什么?" title="Direct link to 断言是什么?">​</a></h4>
<p>启动我们的 gatewat9527</p>
<p>我们会看到他在启动的时候</p>
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-uTo0vBkk-1648908821924)(<a href="https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911005125073.png" target="_blank" rel="noopener noreferrer">https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911005125073.png</a>)]</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="route-predicate-factory-这个是什么东东">Route Predicate Factory 这个是什么东东？<a href="#route-predicate-factory-这个是什么东东" class="hash-link" aria-label="Direct link to Route Predicate Factory 这个是什么东东？" title="Direct link to Route Predicate Factory 这个是什么东东？">​</a></h4>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/2f45b775a52b5d594f4ae54be87c55b1.png" alt="image-20210911005203095" class="img_ev3q"></p>
<p>Spring Cloud Gateway 将路由匹配作为 Spring WebFlux HandlerMapping 基础架构的一部分。</p>
<ul>
<li>Spring Cloud Gateway 包括许多内置的 Route Predicate 工厂。所有这些 Predicate 都与 HTTP 请求的不同属性匹配。多个 RoutePredicate 工厂可以进行组合</li>
<li>Spring Cloud Gateway 创建 Route 对象时，使用 RoutePredicateFactory 创建 Predicate 对象，Predicate 对象可以赋值给 Route。Spring Cloud Gateway 包含许多内置的 Route Predicate Factories。</li>
<li>所有这些谓词都匹配 HTTP 请求的不同属性。多种谓词工厂可以组合</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="常用的-route-predicate">常用的 Route Predicate<a href="#常用的-route-predicate" class="hash-link" aria-label="Direct link to 常用的 Route Predicate" title="Direct link to 常用的 Route Predicate">​</a></h4>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/a8834a285f25cd9f4412553a09d54357.png" alt="image-20210911005340872" class="img_ev3q"></p>
<p>我们来看一下常用的断言:</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token punctuation" style="color:#475569">-</span><span class="token plain"> Path=/payment/lb/</span><span class="token important">**</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955">#断言,路径相匹配的进行路由</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token comment" style="color:#6A9955">#- After=2020-03-08T10:59:34.102+08:00[Asia/Shanghai]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token comment" style="color:#6A9955">#- Cookie=username,zhangshuai #并且Cookie是username=zhangshuai才能访问</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token comment" style="color:#6A9955">#- Header=X-Request-Id, \d+ #请求头中要有X-Request-Id属性并且值为整数的正则表达式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token comment" style="color:#6A9955">#- Host=**.atguigu.com</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token comment" style="color:#6A9955">#- Method=GET</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token comment" style="color:#6A9955">#- Query=username, \d+ #要有参数名称并且是正整数才能路由</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>说白了，Predicate 就是为了实现一组匹配规则，让请求过来找到对应的 Route 进行处理</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="filter-的使用">Filter 的使用<a href="#filter-的使用" class="hash-link" aria-label="Direct link to Filter 的使用" title="Direct link to Filter 的使用">​</a></h3>
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-G306Lawo-1648908821924)(<a href="https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911005755967.png" target="_blank" rel="noopener noreferrer">https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911005755967.png</a>)]</p>
<p>路由过滤器可用于修改进入的 HTTP 请求和返回的 HTTP 响应，路由过滤器只能指定路由进行使用。
Spring Cloud Gateway 内置了多种路由过滤器，他们都由 GatewayFilter 的工厂类来产生</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="spring-cloud-gateway-的-filter">Spring Cloud Gateway 的 Filter<a href="#spring-cloud-gateway-的-filter" class="hash-link" aria-label="Direct link to Spring Cloud Gateway 的 Filter" title="Direct link to Spring Cloud Gateway 的 Filter">​</a></h4>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/fd9f11a8193a60172f57a38f2f45b577.png" alt="image-20210911005905238" class="img_ev3q"></p>
<blockquote>
<p>常用的 GatewayFilter:AddRequestParameter</p>
</blockquote>
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-OI1A2z64-1648908821925)(<a href="https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911005929316.png" target="_blank" rel="noopener noreferrer">https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911005929316.png</a>)]</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="自定义全局-globalfilter">自定义全局 GlobalFilter<a href="#自定义全局-globalfilter" class="hash-link" aria-label="Direct link to 自定义全局 GlobalFilter" title="Direct link to 自定义全局 GlobalFilter">​</a></h4>
<p>两个主要接口介绍:</p>
<ul>
<li>GlobalFilter : 全局过滤器</li>
<li>Ordered : 执行顺序</li>
</ul>
<p><strong>能干嘛</strong>?</p>
<ul>
<li>全局日志记录</li>
<li>统一网关鉴权</li>
<li>等等等....</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="过滤器代码">过滤器代码<a href="#过滤器代码" class="hash-link" aria-label="Direct link to 过滤器代码" title="Direct link to 过滤器代码">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class MyLogGateWayFilter implements GlobalFilter,Ordered {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        log.info(&quot;*********come in MyLogGateWayFilter: &quot;+new Date());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        String uname = exchange.getRequest().getQueryParams().getFirst(&quot;username&quot;);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        if(StringUtils.isEmpty(username)){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            log.info(&quot;*****用户名为Null 非法用户,(┬＿┬)&quot;);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            exchange.getResponse().setStatusCode(HttpStatus.NOT_ACCEPTABLE);//给人家一个回应</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            return exchange.getResponse().setComplete();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return chain.filter(exchange);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public int getOrder() {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return 0;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>使用了这个之后</p>
<p>我们的请求如果是没有带有 uname 这个参数就会被过滤,可以用来作为一些必要参数的筛选和鉴权</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="config-分布式配置中心">config 分布式配置中心<a href="#config-分布式配置中心" class="hash-link" aria-label="Direct link to config 分布式配置中心" title="Direct link to config 分布式配置中心">​</a></h2>
<p>概述:分布式系统面临的配置问题?</p>
<p>​ 微服务意味着要将单体应用中的业务拆分成一个个子服务，每个服务的粒度相对较小，因此系统中会出现大量的服务。由于每个服务都需要必要的配置信息才能运行，所以一套集中式的、动态的配置管理设施是必不可少的。
SpringCloud 提供了 ConfigServer 来解决这个问题，我们每一个微服务自己带着一个 application.yml，上百个配置文件的管理.…</p>
<p>官网 : <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/" target="_blank" rel="noopener noreferrer">https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/</a></p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/7639ee8ae29f109f0764b9d01027912e.png" alt="image-20210911010739344" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="config-是什么">config 是什么?<a href="#config-是什么" class="hash-link" aria-label="Direct link to config 是什么?" title="Direct link to config 是什么?">​</a></h3>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/ff71f7ce3c3241e9dcf5ccfa5940245f.png" alt="image-20210911010444164" class="img_ev3q"></p>
<p>​ SpringCloud Config 为微服务架构中的微服务提供集中化的外部配置支持，配置服务器为各个不同微服务应用的所有环境提供了一个中心化的外部配置。</p>
<blockquote>
<p>怎么做?</p>
</blockquote>
<p>SpringCloud Config 分为服务端和客户端两部分:</p>
<ul>
<li>
<p>​ 服务端也称为分布式配置中心，它是一个独立的微服务应用，用来连接配置服务器并为客户端提供获取配置信息，加密/解密信息等访问接口</p>
</li>
<li>
<p>​ 客户端则是通过指定的配置中心来管理应用资源，以及与业务相关的配置内容，并在启动的时候从配置中心获取和加载配置信息配置服务器默认采用 git 来存储配置信息，这样就有助于对环境配置进行版本管理，并且可以通过 git 客户端工具来方便的管理和访问配置内容</p>
</li>
</ul>
<blockquote>
<p>我们用它可以做什么?</p>
</blockquote>
<ul>
<li>集中管理配置文件</li>
<li>不同环境不同配置，动态化的配置更新，分环境部署比如 dev/test/prod/beta/release</li>
<li>运行期间动态调整配置，不再需要在每个服务部署的机器上编写配置文件，服务会向配置中心统一拉取配置自己的信息</li>
<li>当配置发生变动时，服务不需要重启即可感知到配置的变化并应用新的配置</li>
<li>将配置信息以 REST 接口的形式暴露 : post、curl 访问刷新均可....</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="前置条件">前置条件<a href="#前置条件" class="hash-link" aria-label="Direct link to 前置条件" title="Direct link to 前置条件">​</a></h3>
<blockquote>
<p>与 Github 整合配置</p>
</blockquote>
<p>由于 SpringCloud Config 默认使用 Git 来存储配置文件（也有其它方式，比如支持 svn 和本地文件，但最推荐的还是 Git，而且使用的是 http/https 访问的形式）</p>
<p>用你自己的账号在 Github 上新建一个名为 sprincloud-config 的新 Repository</p>
<p>添加上这些:</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/745570e9b2a0019dad361e2152223bbc.png" alt="image-20210911010932750" class="img_ev3q"></p>
<p>本地硬盘上新建 git 仓库并 clone</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/9d92a21734b33626e27750cb29264ce4.png" alt="image-20210911010942167" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="上手实战">上手实战<a href="#上手实战" class="hash-link" aria-label="Direct link to 上手实战" title="Direct link to 上手实战">​</a></h3>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="config-服务端配置与测试">Config 服务端配置与测试<a href="#config-服务端配置与测试" class="hash-link" aria-label="Direct link to Config 服务端配置与测试" title="Direct link to Config 服务端配置与测试">​</a></h5>
<p>新建 Module 模块<code>cloud-config-center-3344</code>它既为 Cloud 的配置中心模块 cloudConfig Center</p>
<p>导入依赖</p>
<div class="language-XML language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-config-server</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-netflix-eureka-client</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">com.atguigu.springcloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">cloud-api-commons</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">${project.version}</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-actuator</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-devtools</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">runtime</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.projectlombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">lombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-test</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">test</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>相关配置</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">server</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">3344</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">spring</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">application</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> cloud</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">config</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">center</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">cloud</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">config</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">server</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token key atrule">git</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">          </span><span class="token key atrule">uri</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> 填写你自己的github路径</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">          </span><span class="token key atrule">search-paths</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token punctuation" style="color:#475569">-</span><span class="token plain"> springcloud</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">label</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> master</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">client</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">service-url</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">defaultZone</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">7001/eureka</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>主启动</p>
<div class="language-JAVA language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@EnableConfigServer</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class ConfigCenterMain3344 {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            SpringApplication.run(ConfigCenterMain3344 .class,args);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>测试通过 Config 微服务是否可以从 Github 上获取配置内容</p>
<p>启动微服务 3344 : <a href="http://config-3344.com:3344/master/config-dev.yml" target="_blank" rel="noopener noreferrer">http://config-3344.com:3344/master/config-dev.yml</a></p>
<p><strong>读取规则</strong></p>
<p>/{label}/{application}-{profile}.yml（最推荐使用这种方式）</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/ebc656b86e68ddd09c175adad2635b94.png" alt="image-20210911011316792" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/e7093501109266f94841a9dd9a3cd947.png" alt="image-20210911011337425" class="img_ev3q"></p>
<p>成功实现了用 SpringCloud Config 通过 GitHub 获取配置信息</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="config-客户端配置与测试">Config 客户端配置与测试<a href="#config-客户端配置与测试" class="hash-link" aria-label="Direct link to Config 客户端配置与测试" title="Direct link to Config 客户端配置与测试">​</a></h5>
<p>新模块 <code>cloud-config-client-3355</code></p>
<p>依赖</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-config</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-netflix-eureka-client</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">com.atguigu.springcloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">cloud-api-commons</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">${project.version}</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-actuator</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-devtools</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">runtime</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.projectlombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">lombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-test</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">test</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>bootstrap.yml 为什么要这个样写</p>
</blockquote>
<p>applicaiton.ym1 是用户级的资源配置项 bootstrap.ym1 是系统级的，优先级更加高
I
Spring Cloud 会创建一个“Bootstrap Context”，作为 Spring 应用的<code>Application Context的父上下文。初始化的时候，BootstrapContext&#x27;负责从外部源加载配置属性并解析配置。这两个上下文共享一个从外部获取的</code>Environment&#x27;。
&#x27;Bootstrap&#x27;)属性有高优先级，默认情况下，它们不会被本地配置覆盖。<code>Bootstrap context和Application Context有着不同的约定，所以新增了一个&#x27;bootstrap.yml&#x27;文件，保证</code>Bootstrap Context 和<code>Application Context&#x27;</code>配置的分离。
要将 Client 模块下的 application.yml 文件改为 bootstrap.yml,这是很关键的，
因为 bootstrap.yml 是比 application.yml 先加载的。bootstrap.yml 优先级高于 application.yml</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">server</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">3355</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">spring</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">application</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> config</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">client</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">cloud</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">config</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">label</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> master</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> config</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">profile</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> dev</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">uri</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#475569">:</span><span class="token number" style="color:#B5CEA8">3344</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">client</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">service-url</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">defaultZone</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//eureka7001.com</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">7001/eureka</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/deaf621387ab4282c4850e426ac709a7.png" alt="image-20210911011620049" class="img_ev3q"></p>
<p>主启动类</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@EnableEurekaClient</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class ConfigClientMain3355 {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            SpringApplication.run( ConfigClientMain3355.class,args);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>业务类</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@RestController</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class ConfigClientController {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Value(&quot;${config.info}&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    private String configInfo;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @GetMapping(&quot;/configInfo&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public String getConfigInfo(){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return configInfo;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>启动 Config 配置中心 3344 微服务并自测</p>
</blockquote>
<p><a href="http://config-3344.com:3344/master/config-dev.yml" target="_blank" rel="noopener noreferrer">http://config-3344.com:3344/master/config-dev.yml</a></p>
<p>就可以读取到 git 仓库中的配置文件信息</p>
<blockquote>
<p>启动 3355 作为 Client 准备访问</p>
</blockquote>
<p><a href="http://localhost:3355/configInfo" target="_blank" rel="noopener noreferrer">http://localhost:3355/configInfo</a></p>
<p>访问到配置中心的配置信息</p>
<p><strong>成功实现了客户端 3355 访问 SpringCloud Config3344 通过 GitHub 获取配置信息</strong></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="问题随时而来分布式配置的动态刷新">问题随时而来，分布式配置的动态刷新<a href="#问题随时而来分布式配置的动态刷新" class="hash-link" aria-label="Direct link to 问题随时而来，分布式配置的动态刷新" title="Direct link to 问题随时而来，分布式配置的动态刷新">​</a></h4>
<p>场景:Linux 运维修改 GitHub 上的配置文件内容做调整</p>
<ul>
<li>刷新 3344，发现 ConfigServer 配置中心立刻响应</li>
<li>刷新 3355，发现 ConfigServer 客户端没有任何响应</li>
<li>3355 没有变化除非自己重启或者重新加载</li>
</ul>
<p>难道每次运维修改配置文件，客户端都需要重启？？噩梦 !!!!!!!</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="config-客户端之动态刷新">Config 客户端之动态刷新<a href="#config-客户端之动态刷新" class="hash-link" aria-label="Direct link to Config 客户端之动态刷新" title="Direct link to Config 客户端之动态刷新">​</a></h3>
<p>避免每次更新配置都要重启客户端微服务 3355</p>
<p>POM 引入 actuator 监控</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-actuator</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>修改配置暴露全部的信息</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">server</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">3355</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">spring</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">application</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> config</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">client</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">cloud</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">config</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">label</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> master</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> config</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">profile</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> dev</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">uri</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#475569">:</span><span class="token number" style="color:#B5CEA8">3344</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">client</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">service-url</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">defaultZone</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//eureka7001.com</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">7001/eureka</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">management</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">endpoints</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">web</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">exposure</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token key atrule">include</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;*&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>@RefreshScope</code>业务类 Controller 修改</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@RefreshScope</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@RestController</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class ConfigClientController {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@Value(&quot;${config.info}&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">private String configInfo;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@GetMapping(&quot;/configInfo&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public String getConfigInfo(){</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    return configInfo;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>配置好之后需要需要运维人员发送 Post 请求刷新 3355</p>
<ul>
<li>必须是 Post 请求</li>
<li>命令行 : curl -X POST &quot;<a href="http://localhost:3355/actuator/refresh" target="_blank" rel="noopener noreferrer">http://localhost:3355/actuator/refresh</a>&quot;</li>
</ul>
<p>请求完之后</p>
<p>不用重启也可以动态的刷新配置</p>
<ul>
<li><a href="http://localhost:3355/configInfo" target="_blank" rel="noopener noreferrer">http://localhost:3355/configInfo</a></li>
<li>成功实现了客户端 3355 刷新到最新配置内容</li>
<li>避免了服务的重启</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="还有遗留问题">还有遗留问题<a href="#还有遗留问题" class="hash-link" aria-label="Direct link to 还有遗留问题" title="Direct link to 还有遗留问题">​</a></h3>
<blockquote>
<p>这个时候新的问题又来了</p>
</blockquote>
<p>假如有多个微服务客户端 3355/3366/3377。。。。</p>
<p>每个微服务都要执行一次 post 请求，手动刷新？</p>
<p>可否广播，一次通知，处处生效？</p>
<p>我们想大范围的自动刷新，求方法,有需求就会有人来解决</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="bus-消息总线">Bus 消息总线<a href="#bus-消息总线" class="hash-link" aria-label="Direct link to Bus 消息总线" title="Direct link to Bus 消息总线">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="一言以蔽之">一言以蔽之<a href="#一言以蔽之" class="hash-link" aria-label="Direct link to 一言以蔽之" title="Direct link to 一言以蔽之">​</a></h3>
<ul>
<li>分布式自动刷新配置功能</li>
<li>Spring Cloud Bus 配合 Spring Cloud Config 使用可以实现配置的动态刷新</li>
</ul>
<blockquote>
<p>Bus 是什么?</p>
</blockquote>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/c991d8590cb9fe9fc7757e6fc4c9f0cb.png" alt="image-20210911012507764" class="img_ev3q"></p>
<blockquote>
<p>他能干什么?</p>
</blockquote>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/0d284128996cf778148ec1c7d660fadb.png" alt="image-20210911012529080" class="img_ev3q"></p>
<blockquote>
<p>为什么称之为总线?</p>
</blockquote>
<p><strong>什么是总线:</strong>
在微服务架构的系统中，通常会使用轻量级的消息代理来构建一个共用的消息主题，并让系统中所有微服务实例都连接上来。由于该主题中产生的消息会被所有实例监听和消费，所以称它为消息总线。在总线上的各个实例，都可以方便地广播一些需要让其他连接在该主题上的实例都知道的消息。
<strong>基本原理:</strong>
ConfigClient 实例都监听 MQ 中同一个 topic(默认是 springCloudBus)。当一个服务刷新数据的时候，它会把这个信息放入到 Topic 中，这样其它监听同一 Topic 的服务就能得到通知，然后去更新自身的配置。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rabbitmq-环境配置">RabbitMQ 环境配置<a href="#rabbitmq-环境配置" class="hash-link" aria-label="Direct link to RabbitMQ 环境配置" title="Direct link to RabbitMQ 环境配置">​</a></h3>
<p>安装 Erlang，下载地址：<a href="http://erlang.org/download/otp_win64_21.3.exe" target="_blank" rel="noopener noreferrer">http://erlang.org/download/otp_win64_21.3.exe</a></p>
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-yAMb74mp-1648908821935)(<a href="https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911012803187.png" target="_blank" rel="noopener noreferrer">https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911012803187.png</a>)]</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/ccab851dd6d465f9731bafbf322c6769.png" alt="image-20210911012807670" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/843abebe8e00e378c5954923e892ee8d.png" alt="image-20210911012813221" class="img_ev3q"></p>
<p>安装 RabbitMQ，下载地址 :<a href="https://dl.bintray.com/rabbitmq/all/rabbitmq-server/3.7.14/rabbitmq-server-3.7.14.exe" target="_blank" rel="noopener noreferrer">https://dl.bintray.com/rabbitmq/all/rabbitmq-server/3.7.14/rabbitmq-server-3.7.14.exe</a></p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/88eb773e3009ccc990bd416af9632948.png" alt="image-20210911012745023" class="img_ev3q"></p>
<blockquote>
<p>进入 RabbitMQ 安装目录下的 sbin 目录</p>
</blockquote>
<p>D:\rabbitmq_server-3.7.14\sbin</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/b0666eaf6141929759c02f308dee1d41.png" alt="image-20210911012845944" class="img_ev3q"></p>
<p>打开命令行 : rabbitmq-plugins enable rabbitmq_management</p>
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-3MXua8zG-1648908821938)(<a href="https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911013147089.png" target="_blank" rel="noopener noreferrer">https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911013147089.png</a>)]</p>
<p>执行完就可以看到</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/8a62c5c89b25bf30b3705c79edb28dac.png" alt="image-20210911013217828" class="img_ev3q"></p>
<p>访问地址查看是否安装成功 : <a href="http://localhost:15672/" target="_blank" rel="noopener noreferrer">http://localhost:15672/</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="springcloud-bus-动态刷新全局广播">SpringCloud Bus 动态刷新全局广播<a href="#springcloud-bus-动态刷新全局广播" class="hash-link" aria-label="Direct link to SpringCloud Bus 动态刷新全局广播" title="Direct link to SpringCloud Bus 动态刷新全局广播">​</a></h3>
<p><strong>必须先具备良好的 RabbitMQ 环境先</strong></p>
<p>演示广播效果，增加复杂度，再以 3355 为模板再制作一个 3366</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="设计思想设计思想">设计思想设计思想<a href="#设计思想设计思想" class="hash-link" aria-label="Direct link to 设计思想设计思想" title="Direct link to 设计思想设计思想">​</a></h4>
<ul>
<li>
<p>利用消息总线触发一个客户端/bus/refresh,而刷新所有客户端的配置</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/98051bc8706e8e2647ae603da06b7015.png" alt="image-20210911013435038" class="img_ev3q"></p>
</li>
<li>
<p>利用消息总线触发一个服务端 ConfigServer 的/bus/refresh 端点,而刷新所有客户端的配置（更加推荐）</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/3c28f524bd0661f05200aa5e5f17d26d.png" alt="image-20210911013532421" class="img_ev3q"></p>
</li>
<li>
<p>图二的架构显然更加合适，图一不适合的原因如下</p>
<ul>
<li>打破了微服务的职责单一性，因为微服务本身是业务模块，它本不应该承担配置刷新职责</li>
<li>破坏了微服务各节点的对等性</li>
<li>有一定的局限性。例如，微服务在迁移时，它的网络地址常常会发生变化，此时如果想要做到自动刷新，那就会增加更多的修改</li>
</ul>
</li>
</ul>
<blockquote>
<p>给 cloud-config-center-3344 配置中心服务端添加消息总线支持</p>
</blockquote>
<p>pom</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-bus-amqp</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>更新配置文件</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">server</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">3344</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">spring</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">application</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> cloud</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">config</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">center</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">cloud</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">config</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">server</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token key atrule">git</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">          </span><span class="token key atrule">uri</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//github.com/hhf19906/springcloud</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">config.git </span><span class="token comment" style="color:#6A9955">#git@github.com:hhf19906/springcloud-config.git</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">          </span><span class="token key atrule">search-paths</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token punctuation" style="color:#475569">-</span><span class="token plain"> springcloud</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">label</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> master</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">rabbitmq</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">host</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> localhost</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">5672</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">username</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> guest</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">password</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> guest</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">client</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">service-url</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">defaultZone</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">7001/eureka</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">management</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">endpoints</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">web</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">exposure</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token key atrule">include</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;bus-refresh&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>给 cloud-config-center-3355 客户端添加消息总线支持</p>
</blockquote>
<p>pom</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-bus-amqp</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-bus-amqp</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>配置</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">server</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">3355</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">spring</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">application</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> config</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">client</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">cloud</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">config</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">label</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> master</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> config</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">profile</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> dev</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">uri</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#475569">:</span><span class="token number" style="color:#B5CEA8">3344</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">rabbitmq</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">host</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> localhost</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">5672</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">username</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> guest</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">password</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> guest</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">client</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">service-url</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">defaultZone</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//eureka7001.com</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">7001/eureka</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">management</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">endpoints</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">web</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">exposure</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token key atrule">include</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;*&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>3366 和 3355 照猫画虎</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="测试">测试<a href="#测试" class="hash-link" aria-label="Direct link to 测试" title="Direct link to 测试">​</a></h4>
<p>修改 Github 上配置文件增加版本号</p>
<p>发送 Post 请求</p>
<p>curl -X POST &quot;<a href="http://localhost:3344/actuator/bus-refresh" target="_blank" rel="noopener noreferrer">http://localhost:3344/actuator/bus-refresh</a>&quot;</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/b79e1dfd91464a5e51ddc3e0e2c80c32.png" alt="image-20210911013853924" class="img_ev3q"></p>
<p>一次发送，处处生效</p>
<p>此时查看配置中心</p>
<p><a href="http://config-3344.com/config-dev.yml" target="_blank" rel="noopener noreferrer">http://config-3344.com/config-dev.yml</a></p>
<p>查看客户端</p>
<p><a href="http://localhost:3355/configInfo" target="_blank" rel="noopener noreferrer">http://localhost:3355/configInfo</a></p>
<p><a href="http://localhost:3366/configInfo" target="_blank" rel="noopener noreferrer">http://localhost:3366/configInfo</a></p>
<p>获取配置信息，发现都已经刷新了 , 一次修改，广播通知，处处生效</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="springcloud-bus-动态刷新置指定通知">SpringCloud Bus 动态刷新置指定通知<a href="#springcloud-bus-动态刷新置指定通知" class="hash-link" aria-label="Direct link to SpringCloud Bus 动态刷新置指定通知" title="Direct link to SpringCloud Bus 动态刷新置指定通知">​</a></h3>
<p>不想全部通知，只想定点通知</p>
<ul>
<li>只通知 3355</li>
<li>不通知 3366</li>
</ul>
<p>指定具体某一个实例生效而不是全部</p>
<p>公式：http:/localhost:配置中心的端口号/actuator/bus-refresh/{destination}</p>
<p>/bus/refresh 请求不再发送到具体的服务实例上，而是发给 config server 并通过 destination 参数类指定需要更新配置的服务或实例</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/52cbc9dd07117f9b6695f444fc8b33b7.png" alt="image-20210911014033662" class="img_ev3q"></p>
<p>发送完之后会发现</p>
<p>只有 3355 更新了</p>
<p>3366 没更新</p>
<blockquote>
<p>全局通知流程图</p>
</blockquote>
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-tCMdlQYB-1648908821942)(<a href="https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911014053498.png" target="_blank" rel="noopener noreferrer">https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911014053498.png</a>)]</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="stream-消息驱动">Stream 消息驱动<a href="#stream-消息驱动" class="hash-link" aria-label="Direct link to Stream 消息驱动" title="Direct link to Stream 消息驱动">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="消息驱动概述">消息驱动概述<a href="#消息驱动概述" class="hash-link" aria-label="Direct link to 消息驱动概述" title="Direct link to 消息驱动概述">​</a></h3>
<blockquote>
<p>什么是 SpringCloudStream : 官方定义 Spring Cloud Stream 是一个构建消息驱动微服务的框架。</p>
</blockquote>
<ul>
<li>应用程序通过 inputs 或者 outputs 来与 Spring Cloud Stream 中 binder 对象交互。</li>
<li>通过我们配置来 binding(绑定)，而 Spring Cloud Stream 的 binder 对象负责与消息中间件交互。所以，我们只需要搞清楚如何与 Spring Cloud Stream 交互就可以方便使用消息驱动的方式。</li>
<li>通过使用 Spring Integration 来连接消息代理中间件以实现消息事件驱动。</li>
<li>Spring Cloud Stream 为一些供应商的消息中间件产品提供了个性化的自动化配置实现,
<ul>
<li>引用了发布-订阅、消费组、分区的三个核心概念。
目前仅支持 RabbitMQ、Kafka。</li>
</ul>
</li>
</ul>
<p>屏蔽底层消息中间件的差异，降低切换版本，统一消息的编程模型</p>
<p>官网 : <a href="https://spring.io/projects/spring-cloud-stream#overview" target="_blank" rel="noopener noreferrer">https://spring.io/projects/spring-cloud-stream#overview</a></p>
<p>中文指导手册 : <a href="https://m.wang1314.com/doc/webapp/topic/20971999.html" target="_blank" rel="noopener noreferrer">https://m.wang1314.com/doc/webapp/topic/20971999.html</a></p>
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-xuCmGUaT-1648908821942)(<a href="https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911014511919.png" target="_blank" rel="noopener noreferrer">https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911014511919.png</a>)]</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="设计思想">设计思想<a href="#设计思想" class="hash-link" aria-label="Direct link to 设计思想" title="Direct link to 设计思想">​</a></h3>
<p>标准的 mq</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/52d1189a03e59a85efd9d03060034ad7.png" alt="image-20210911014551406" class="img_ev3q"></p>
<ul>
<li>生产者/消费者之间靠消息媒介传递信息内容 : Message</li>
<li>消息必须走特定的通道 消息通道 MessageChannel</li>
<li>消息通道里的消息如何被消费呢，谁负责收发处理 :消息通道 MessageChannel 的子接口 SubscribableChannel,由 MessageHandler 消息处理器订阅</li>
</ul>
<blockquote>
<p>为什么用 Cloud Stream</p>
</blockquote>
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-SOsiX8sO-1648908821943)(<a href="https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911014655210.png" target="_blank" rel="noopener noreferrer">https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911014655210.png</a>)]</p>
<p>这些中间件的差异性导致我们实际项目开发给我们造成了一定的困扰，我们如果用了两个消息队列的其中一种，后面的业务需求，我想往另外一种消息队列进行迁移，这时候无疑就是一个灾难性的，一大堆东西都要重新推倒重新做，因为它跟我们的系统耦合了，这时候 springcloud Stream 给我们提供了一种解耦合的方式。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="stream-凭什么可以统一底层差异">stream 凭什么可以统一底层差异?<a href="#stream-凭什么可以统一底层差异" class="hash-link" aria-label="Direct link to stream 凭什么可以统一底层差异?" title="Direct link to stream 凭什么可以统一底层差异?">​</a></h4>
<p>在没有绑定器这个概念的情况下，我们的 SpringBoot 应用要直接与消息中间件进行信息交互的时候，由于各消息中间件构建的初衷不同，它们的实现细节上会有较大的差异性</p>
<ul>
<li>通过定义绑定器作为中间层，完美地实现了应用程序与消息中间件细节之间的隔离。</li>
<li>通过向应用程序暴露统一的 Channel 通道，使得应用程序不需要再考虑各种不同的消息中间件实现。</li>
</ul>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/5f6f6e02bc35d603616e160dc3ee24cc.png" alt="image-20210911015050453" class="img_ev3q"></p>
<p>默认情况下，RabbitMQ 绑定器实现将每个目标映射到 TopicExchange。对于每个消费者群体。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="binder-绑定器">Binder 绑定器<a href="#binder-绑定器" class="hash-link" aria-label="Direct link to Binder 绑定器" title="Direct link to Binder 绑定器">​</a></h4>
<p>​ 在没有绑定器这个概念的情况下，我们的 SpringBoot 应用要直接与消息中间件进行信息交互的时候，由于各消息中间件构建的初衷不同，它们的实现细节上会有较大的差异性.通过定义绑定器作为中间层，完美地实现了应用程序与消息中间件细节之间的隔离。</p>
<p>​ Stream 对消息中间件的进一步封装，可以做到代码层面对中间件的无感知，甚至于动态的切换中间件(rabbitmq 切换为 kafka)，使得微服务开发的高度解耦，服务可以关注更多自己的业务流程</p>
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-ytNoZzAl-1648908821944)(<a href="https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911015213198.png" target="_blank" rel="noopener noreferrer">https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911015213198.png</a>)]</p>
<p>通过定义绑定器 Binder 作为中间层，实现了应用程序与消息中间件细节之间的隔离。</p>
<ul>
<li>INPUT 对应于消费者</li>
<li>OUTPUT 对应于生产者</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="stream-中的消息通信方式遵循了发布-订阅模式">Stream 中的消息通信方式遵循了发布-订阅模式<a href="#stream-中的消息通信方式遵循了发布-订阅模式" class="hash-link" aria-label="Direct link to Stream 中的消息通信方式遵循了发布-订阅模式" title="Direct link to Stream 中的消息通信方式遵循了发布-订阅模式">​</a></h4>
<p>Topic 主题进行广播</p>
<ul>
<li>在 RabbitMQ 就是 Exchange</li>
<li>在 kafka 中就是 Topic</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="spring-cloud-stream-标准流程套路">Spring Cloud Stream 标准流程套路<a href="#spring-cloud-stream-标准流程套路" class="hash-link" aria-label="Direct link to Spring Cloud Stream 标准流程套路" title="Direct link to Spring Cloud Stream 标准流程套路">​</a></h3>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/b8ad56b3248419f3c54389b348ea305c.png" alt="image-20210911015401977" class="img_ev3q"></p>
<ul>
<li>Binder 很方便的连接中间件，屏蔽差异</li>
<li>Channel 通道，是队列 Queue 的一种抽象，在消息通讯系统中就是实现存储和转发的媒介，通过对 Channel 对队列进行配置</li>
<li>Source 和 Sink 简单的可理解为参照对象是 Spring Cloud Stream 自身，从 Stream 发布消息就是输出，接受消息就是输入</li>
</ul>
<blockquote>
<p>编码 API 和常用注解</p>
</blockquote>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/35ebec69f29f4ae4e5ee4c6e4e5f9478.png" alt="image-20210911015452441" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="案例说明">案例说明<a href="#案例说明" class="hash-link" aria-label="Direct link to 案例说明" title="Direct link to 案例说明">​</a></h3>
<p>RabbitMQ 环境已经 OK</p>
<p><strong>工程中新建三个子模块</strong></p>
<ul>
<li>cloud-stream-rabbitmq-provider8801,作为生产者进行发消息模块</li>
<li>cloud-stream-rabbitmq-consumer8802,作为消息接收模块</li>
<li>cloud-stream-rabbitmq-consumer8803,作为消息接收模块</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="消息驱动之生产者">消息驱动之生产者<a href="#消息驱动之生产者" class="hash-link" aria-label="Direct link to 消息驱动之生产者" title="Direct link to 消息驱动之生产者">​</a></h4>
<p><code>cloud-stream-rabbitmq-provider8801</code></p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-stream-rabbit</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-eureka-server --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-netflix-eureka-client</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">com.atguigu.springcloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">cloud-api-commons</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">${project.version}</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-actuator</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-devtools</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">runtime</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.projectlombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">lombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-test</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">test</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>配置文件</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">server</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">8801</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">spring</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">application</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> cloud</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">stream</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">provider</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">cloud</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">stream</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">binders</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955"># 在此处配置要绑定的rabbitmq的服务信息；</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token key atrule">defaultRabbit</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955"># 表示定义的名称，用于于binding整合</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">          </span><span class="token key atrule">type</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> rabbit </span><span class="token comment" style="color:#6A9955"># 消息组件类型</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">          </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955"># 设置rabbitmq的相关的环境配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token key atrule">spring</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">              </span><span class="token key atrule">rabbitmq</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                </span><span class="token key atrule">host</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> localhost</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">5672</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                </span><span class="token key atrule">username</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> guest</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                </span><span class="token key atrule">password</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> guest</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">bindings</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955"># 服务的整合处理</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token key atrule">output</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955"># 这个名字是一个通道的名称</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">          </span><span class="token key atrule">destination</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> studyExchange </span><span class="token comment" style="color:#6A9955"># 表示要使用的Exchange名称定义</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">          </span><span class="token key atrule">content-type</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> application/json </span><span class="token comment" style="color:#6A9955"># 设置消息类型，本次为json，文本则设置“text/plain”</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">          </span><span class="token key atrule">binder</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> defaultRabbit </span><span class="token comment" style="color:#6A9955"># 设置要绑定的消息服务的具体设置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">client</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955"># 客户端进行Eureka注册的配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">service-url</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">defaultZone</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">7001/eureka</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">instance</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">lease-renewal-interval-in-seconds</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">2</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955"># 设置心跳的时间间隔（默认是30秒）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">lease-expiration-duration-in-seconds</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">5</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955"># 如果现在超过了5秒的间隔（默认是90秒）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">instance-id</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> send</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">8801.com </span><span class="token comment" style="color:#6A9955"># 在信息列表时显示主机名称</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">prefer-ip-address</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955"># 访问的路径变为IP地址</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>主启动类 StreamMQMain8801</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class StreamMQMain8801 {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        SpringApplication.run(StreamMQMain8801.class, args);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>业务类</p>
<p>发送消息接口</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">public interface IMessageProvider</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">{</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public String send();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>发送消息接口实现类</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@EnableBinding(Source.class) //定义消息的推送管道</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class MessageProviderImpl implements IMessageProvider</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">{</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Resource</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    private MessageChannel output; // 消息发送管道</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public String send()</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        String serial = UUID.randomUUID().toString();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        output.send(MessageBuilder.withPayload(serial).build());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        System.out.println(&quot;*****serial: &quot;+serial);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return null;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Controller</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@RestController</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class SendMessageController</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">{</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Resource</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    private IMessageProvider messageProvider;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @GetMapping(value = &quot;/sendMessage&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public String sendMessage()</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return messageProvider.send();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>测试 访问: <a href="http://localhost:8801/sendMessage" target="_blank" rel="noopener noreferrer">http://localhost:8801/sendMessage</a></p>
<p>看到控制带输出的流水号和端口号</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="消息驱动之消费者">消息驱动之消费者<a href="#消息驱动之消费者" class="hash-link" aria-label="Direct link to 消息驱动之消费者" title="Direct link to 消息驱动之消费者">​</a></h4>
<p><code>cloud-stream-rabbitmq-consumer8802</code></p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-stream-rabbit</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-eureka-server --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-netflix-eureka-client</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">com.atguigu.springcloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">cloud-api-commons</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">${project.version}</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-actuator</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-devtools</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">runtime</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.projectlombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">lombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-test</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">test</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>配置文件</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">server</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">8802</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">spring</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">application</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> cloud</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">stream</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">consumer</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">cloud</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">stream</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">binders</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955"># 在此处配置要绑定的rabbitmq的服务信息；</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token key atrule">defaultRabbit</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955"># 表示定义的名称，用于于binding整合</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">          </span><span class="token key atrule">type</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> rabbit </span><span class="token comment" style="color:#6A9955"># 消息组件类型</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">          </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955"># 设置rabbitmq的相关的环境配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token key atrule">spring</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">              </span><span class="token key atrule">rabbitmq</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                </span><span class="token key atrule">host</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> localhost</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">5672</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                </span><span class="token key atrule">username</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> guest</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                </span><span class="token key atrule">password</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> guest</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">bindings</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955"># 服务的整合处理</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token key atrule">input</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955"># 这个名字是一个通道的名称</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">          </span><span class="token key atrule">destination</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> studyExchange </span><span class="token comment" style="color:#6A9955"># 表示要使用的Exchange名称定义</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">          </span><span class="token key atrule">content-type</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> application/json </span><span class="token comment" style="color:#6A9955"># 设置消息类型，本次为json，文本则设置“text/plain”</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">          </span><span class="token key atrule">binder</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> defaultRabbit </span><span class="token comment" style="color:#6A9955"># 设置要绑定的消息服务的具体设置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">client</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955"># 客户端进行Eureka注册的配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">service-url</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">defaultZone</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">7001/eureka</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">instance</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">lease-renewal-interval-in-seconds</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">2</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955"># 设置心跳的时间间隔（默认是30秒）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">lease-expiration-duration-in-seconds</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">5</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955"># 如果现在超过了5秒的间隔（默认是90秒）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">instance-id</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> receive</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">8802.com </span><span class="token comment" style="color:#6A9955"># 在信息列表时显示主机名称</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">prefer-ip-address</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955"># 访问的路径变为IP地址</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>主启动类 StreamMQMain8802</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class StreamMQMain8802 {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        SpringApplication.run(StreamMQMain8802.class, args);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>业务类</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@EnableBinding(Sink.class)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class ReceiveMessageListenerController {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Value(&quot;${server.port}&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    private String serverPort;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @StreamListener(Sink.INPUT)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public void input(Message&lt;String&gt; message) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        System.out.println(&quot;消费者1号，接受：&quot;+message.getPayload()+&quot;\t port:&quot;+serverPort);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>测试 8801 发送 8802 接收消息</p>
<p><a href="http://localhost:8801/sendMessage" target="_blank" rel="noopener noreferrer">http://localhost:8801/sendMessage</a></p>
<p>这个时候 8802 会就显示收到的消息</p>
<p>依照 8802，clone 出来一份运行 8803</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="运行后两个问题">运行后两个问题<a href="#运行后两个问题" class="hash-link" aria-label="Direct link to 运行后两个问题" title="Direct link to 运行后两个问题">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="有重复消费问题">有重复消费问题<a href="#有重复消费问题" class="hash-link" aria-label="Direct link to 有重复消费问题" title="Direct link to 有重复消费问题">​</a></h4>
<p>目前是 8802/8803 同时都收到了，存在重复消费问题</p>
<blockquote>
<p>如何解决?</p>
</blockquote>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/591f6860615fa961244d6c1810d6da34.png" alt="image-20210911020152504" class="img_ev3q"></p>
<p>同一组的消费者是竞争关系,只有一个可以消费</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="原理">原理<a href="#原理" class="hash-link" aria-label="Direct link to 原理" title="Direct link to 原理">​</a></h5>
<p>微服务应用放置于同一个 group 中，就能够保证消息只会被其中一个应用消费一次。不同的组是可以消费的，同一个组内会发生竞争关系，只有其中一个可以消费。</p>
<p>8802/8803 实现了轮询分组，每次只有一个消费者 8801 模块的发的消息只能被 8802 或 8803 其中一个接收到，这样避免了重复消费</p>
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-3fpi7N3K-1648908821945)(<a href="https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911020259779.png" target="_blank" rel="noopener noreferrer">https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911020259779.png</a>)]</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="消息持久化问题">消息持久化问题<a href="#消息持久化问题" class="hash-link" aria-label="Direct link to 消息持久化问题" title="Direct link to 消息持久化问题">​</a></h4>
<p>通过上述，解决了重复消费问题，再看看持久化</p>
<ul>
<li>8803 的分组 group:atguiguA 没有去掉</li>
<li>8803 的分组 group:atguiguA 没有去掉</li>
</ul>
<p>8801 先发送 4 条信息到 rabbitmq</p>
<ul>
<li>先启动 8802，无分组属性配置，后台没有打出来消息</li>
<li>先启动 8803，有分组属性配置，后台打出来了 MQ 上的消息</li>
</ul>
<p>总结:有分组的消费者,在启动后可以读取分组的信息</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sleuth-分布式请求链路追踪">Sleuth 分布式请求链路追踪<a href="#sleuth-分布式请求链路追踪" class="hash-link" aria-label="Direct link to Sleuth 分布式请求链路追踪" title="Direct link to Sleuth 分布式请求链路追踪">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="概述">概述<a href="#概述" class="hash-link" aria-label="Direct link to 概述" title="Direct link to 概述">​</a></h3>
<p>为什么会出现这个技术？需要解决哪些问题？
官网:<a href="https://github.com/spring-cloud/spring-cloud-sleuth" target="_blank" rel="noopener noreferrer">https://github.com/spring-cloud/spring-cloud-sleuth</a></p>
<ul>
<li>Spring Cloud Sleuth 提供了一套完整的服务跟踪的解决方案</li>
<li>在分布式系统中提供追踪解决方案并且兼容支持了 zipkin</li>
</ul>
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-2WRKDbHA-1648908821946)(<a href="https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911020733858.png" target="_blank" rel="noopener noreferrer">https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911020733858.png</a>)]</p>
<p>在我们服务调用的时候经常会有</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/7df2900088dbbb1d0b08ef0649ebfc47.png" alt="image-20210911020849669" class="img_ev3q"></p>
<p>一个服务调一个服务多个微服务调用</p>
<p>为了方便我们查看服务之间的调用层次</p>
<p>我们产生的了链路追踪</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="搭建链路监控步骤">搭建链路监控步骤<a href="#搭建链路监控步骤" class="hash-link" aria-label="Direct link to 搭建链路监控步骤" title="Direct link to 搭建链路监控步骤">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1zipkin">1.zipkin<a href="#1zipkin" class="hash-link" aria-label="Direct link to 1.zipkin" title="Direct link to 1.zipkin">​</a></h4>
<p>SpringCloud 从 F 版起已不需要自己构建 Zipkin server 了，只需要调用 jar 包即可</p>
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-gx7k62J2-1648908821946)(<a href="https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911021126436.png" target="_blank" rel="noopener noreferrer">https://cdn.jsdelivr.net/gh/Doomwatcher2004/my-image-host@master/%20img%20/image-20210911021126436.png</a>)]</p>
<p>运行 jar</p>
<p>查看 <a href="http://localhost:9411/zipkin/" target="_blank" rel="noopener noreferrer">http://localhost:9411/zipkin/</a></p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/93d85cf5cdda14f1899baf9ac98e022a.png" alt="image-20210911021200920" class="img_ev3q"></p>
<p>上图看起来链路十分的复杂</p>
<p>下图相对简单清晰一些</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/d758b77f5d5f870b15ddecfa063d4a58.png" alt="image-20210911021217716" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2服务提供者">2.服务提供者<a href="#2服务提供者" class="hash-link" aria-label="Direct link to 2.服务提供者" title="Direct link to 2.服务提供者">​</a></h4>
<p>继续找到我们最初的服务提供者<code>cloud-provider-payment8001</code></p>
<p>依赖</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955">&lt;!--包含了sleuth+zipkin--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-zipkin</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>配置</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">server</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">8001</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">spring</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">application</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> cloud</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">payment</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">zipkin</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">base-url</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#475569">:</span><span class="token number" style="color:#B5CEA8">9411</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">sleuth</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">sampler</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">probability</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">datasource</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> com.alibaba.druid.pool.DruidDataSource</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">driver-class-name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> org.gjt.mm.mysql.Driver</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">url</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">username</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">password</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">mybatis</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">mapperLocations</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> classpath</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">mapper/</span><span class="token important">*.xml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">type-aliases-package</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> com.atguigu.springcloud.entities</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">client</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">register-with-eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">fetchRegistry</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">service-url</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">defaultZone</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//eureka7001.com</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">7001/eureka</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain">http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//eureka7002.com</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">7002/eureka </span><span class="token comment" style="color:#6A9955">#集群版</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">instance</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">instance-id</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> payment8001</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">prefer-ip-address</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>添加一个新方法</p>
<div class="language-JAVA language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @GetMapping(&quot;/payment/zipkin&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public String paymentZipkin()</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return &quot;hi ,i&#x27;am paymentzipkin server fall back，welcome to atguigu，O(∩_∩)O哈哈~&quot;;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3服务消费者调用方">3.服务消费者（调用方）<a href="#3服务消费者调用方" class="hash-link" aria-label="Direct link to 3.服务消费者（调用方）" title="Direct link to 3.服务消费者（调用方）">​</a></h4>
<p>久违的服务者 <code> cloud-consumer-order80</code></p>
<p>依赖</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain"> </span><span class="token comment" style="color:#6A9955">&lt;!--包含了sleuth+zipkin--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-zipkin</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>配置</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">server</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">spring</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">application</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> cloud</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">order</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">zipkin</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">base-url</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#475569">:</span><span class="token number" style="color:#B5CEA8">9411</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">sleuth</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">sampler</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">probability</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">client</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token comment" style="color:#6A9955">#表示是否将自己注册进EurekaServer默认为true。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">register-with-eureka</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token comment" style="color:#6A9955">#是否从EurekaServer抓取已有的注册信息，默认为true。单节点无所谓，集群必须设置为true才能配合ribbon使用负载均衡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">fetchRegistry</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">service-url</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token comment" style="color:#6A9955">#单机</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token comment" style="color:#6A9955">#defaultZone: http://localhost:7001/eureka</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token comment" style="color:#6A9955"># 集群</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">defaultZone</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//eureka7001.com</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">7001/eureka</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain">http</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//eureka7002.com</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">7002/eureka </span><span class="token comment" style="color:#6A9955"># 集群版</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>业务类 OrderController</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain"> // ====================&gt; zipkin+sleuth</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @GetMapping(&quot;/consumer/payment/zipkin&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public String paymentZipkin()</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        String result = restTemplate.getForObject(&quot;http://localhost:8001&quot;+&quot;/payment/zipkin/&quot;, String.class);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return result;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4依次启动-eureka7001800180">4.依次启动 eureka7001/8001/80<a href="#4依次启动-eureka7001800180" class="hash-link" aria-label="Direct link to 4.依次启动 eureka7001/8001/80" title="Direct link to 4.依次启动 eureka7001/8001/80">​</a></h4>
<p>80 调用 8001 几次测试下</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5打开浏览器访问httplocalhost9411">5.打开浏览器访问:http:localhost:9411<a href="#5打开浏览器访问httplocalhost9411" class="hash-link" aria-label="Direct link to 5.打开浏览器访问:http:localhost:9411" title="Direct link to 5.打开浏览器访问:http:localhost:9411">​</a></h4>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/b449d8d5d7e4ab240f2e7feabbbe9665.png" alt="image-20210911021543445" class="img_ev3q"></p>
<p>查看层级 查看依赖关系</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/c090dafb5e0327b5f542aee900e815ed.png" alt="image-20210911021554312" class="img_ev3q"></p>
<p>到这里 springcloud netflix 的学习就结束啦 !!! 完结撒花</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Java/SpringCloud Netflix.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Java/SpringCloud Alibaba"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">springCloudAlibaba</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Java/Spring内置MVC框架：SpringMVC"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">SpringMVC</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#整理知识" class="table-of-contents__link toc-highlight">整理知识</a></li><li><a href="#微服务" class="table-of-contents__link toc-highlight">微服务</a><ul><li><a href="#我们从技术维度理解一下" class="table-of-contents__link toc-highlight">我们从技术维度理解一下</a></li><li><a href="#微服务与微服务架构" class="table-of-contents__link toc-highlight">微服务与微服务架构</a></li><li><a href="#微服务的有缺点" class="table-of-contents__link toc-highlight">微服务的有缺点</a></li><li><a href="#微服务技术栈" class="table-of-contents__link toc-highlight">微服务技术栈</a></li><li><a href="#为什么我们要选择-springcloud-作为微服务架构呢" class="table-of-contents__link toc-highlight">为什么我们要选择 SpringCloud 作为微服务架构呢</a></li></ul></li><li><a href="#springcloud-入门概述" class="table-of-contents__link toc-highlight">springcloud 入门概述</a><ul><li><a href="#springcloud-是什么" class="table-of-contents__link toc-highlight"><strong>springcloud 是什么？</strong></a></li><li><a href="#springboot-和-springcloud-的关系" class="table-of-contents__link toc-highlight">springboot 和 springcloud 的关系</a></li><li><a href="#dubbo-和-springcloud-技术选型" class="table-of-contents__link toc-highlight">Dubbo 和 springcloud 技术选型</a></li><li><a href="#springcloud-下载" class="table-of-contents__link toc-highlight">springcloud 下载</a></li></ul></li><li><a href="#上手实战咯" class="table-of-contents__link toc-highlight">上手实战咯</a><ul><li><a href="#cloud-项目搭建" class="table-of-contents__link toc-highlight">cloud 项目搭建</a></li><li><a href="#是不是以为这样就结束了" class="table-of-contents__link toc-highlight">是不是以为这样就结束了？</a></li></ul></li><li><a href="#eureka-服务注册与发现" class="table-of-contents__link toc-highlight">Eureka 服务注册与发现</a><ul><li><a href="#单项目-eurekademo" class="table-of-contents__link toc-highlight">单项目 Eurekademo</a></li><li><a href="#服务的注册" class="table-of-contents__link toc-highlight">服务的注册</a></li><li><a href="#eureka-的自我保护机制" class="table-of-contents__link toc-highlight">Eureka 的自我保护机制</a></li><li><a href="#eureka-集群原理" class="table-of-contents__link toc-highlight">Eureka 集群原理</a></li></ul></li><li><a href="#ribbon-负载均衡" class="table-of-contents__link toc-highlight">Ribbon 负载均衡</a><ul><li><a href="#lb负载均衡" class="table-of-contents__link toc-highlight">LB（负载均衡）</a></li><li><a href="#ribbon-能够做些什么" class="table-of-contents__link toc-highlight">Ribbon 能够做些什么</a></li><li><a href="#ribbon-负载均衡算法这里由于算法实在不是咱的擅长就跳过了手写算法那个一节课" class="table-of-contents__link toc-highlight">Ribbon 负载均衡算法(这里由于算法实在不是咱的擅长就跳过了手写算法那个一节课)</a></li></ul></li><li><a href="#openfeign" class="table-of-contents__link toc-highlight">openFeign</a><ul><li><a href="#feign-是什么" class="table-of-contents__link toc-highlight">Feign 是什么?</a></li><li><a href="#feign-能干什么" class="table-of-contents__link toc-highlight">Feign 能干什么?</a></li><li><a href="#openfeign-超时控制" class="table-of-contents__link toc-highlight">OpenFeign 超时控制</a></li><li><a href="#openfeign-日志打印功能" class="table-of-contents__link toc-highlight">OpenFeign 日志打印功能</a></li></ul></li><li><a href="#hystrix-断路器" class="table-of-contents__link toc-highlight">Hystrix 断路器</a><ul><li><a href="#有需求那就有人出手解决于是乎-出现了" class="table-of-contents__link toc-highlight">有需求那就有人出手解决于是乎 出现了</a></li><li><a href="#hystrix-重要概念" class="table-of-contents__link toc-highlight">Hystrix 重要概念</a></li><li><a href="#服务降级-实例模块编写" class="table-of-contents__link toc-highlight">服务降级: 实例模块编写</a></li><li><a href="#服务熔断--实力模块编写" class="table-of-contents__link toc-highlight">服务熔断 : 实力模块编写</a></li></ul></li><li><a href="#gateway-新一代网关" class="table-of-contents__link toc-highlight">Gateway 新一代网关</a><ul><li><a href="#技术背景" class="table-of-contents__link toc-highlight">技术背景</a></li><li><a href="#gateway-三大核心概念" class="table-of-contents__link toc-highlight">Gateway 三大核心概念</a></li><li><a href="#gateway-工作流程" class="table-of-contents__link toc-highlight">Gateway 工作流程</a></li><li><a href="#demo-实战" class="table-of-contents__link toc-highlight">demo 实战</a></li><li><a href="#predicate-的使用断言的使用" class="table-of-contents__link toc-highlight">Predicate 的使用断言的使用</a></li><li><a href="#filter-的使用" class="table-of-contents__link toc-highlight">Filter 的使用</a></li></ul></li><li><a href="#config-分布式配置中心" class="table-of-contents__link toc-highlight">config 分布式配置中心</a><ul><li><a href="#config-是什么" class="table-of-contents__link toc-highlight">config 是什么?</a></li><li><a href="#前置条件" class="table-of-contents__link toc-highlight">前置条件</a></li><li><a href="#上手实战" class="table-of-contents__link toc-highlight">上手实战</a></li><li><a href="#config-客户端之动态刷新" class="table-of-contents__link toc-highlight">Config 客户端之动态刷新</a></li><li><a href="#还有遗留问题" class="table-of-contents__link toc-highlight">还有遗留问题</a></li></ul></li><li><a href="#bus-消息总线" class="table-of-contents__link toc-highlight">Bus 消息总线</a><ul><li><a href="#一言以蔽之" class="table-of-contents__link toc-highlight">一言以蔽之</a></li><li><a href="#rabbitmq-环境配置" class="table-of-contents__link toc-highlight">RabbitMQ 环境配置</a></li><li><a href="#springcloud-bus-动态刷新全局广播" class="table-of-contents__link toc-highlight">SpringCloud Bus 动态刷新全局广播</a></li><li><a href="#springcloud-bus-动态刷新置指定通知" class="table-of-contents__link toc-highlight">SpringCloud Bus 动态刷新置指定通知</a></li></ul></li><li><a href="#stream-消息驱动" class="table-of-contents__link toc-highlight">Stream 消息驱动</a><ul><li><a href="#消息驱动概述" class="table-of-contents__link toc-highlight">消息驱动概述</a></li><li><a href="#设计思想" class="table-of-contents__link toc-highlight">设计思想</a></li><li><a href="#spring-cloud-stream-标准流程套路" class="table-of-contents__link toc-highlight">Spring Cloud Stream 标准流程套路</a></li><li><a href="#案例说明" class="table-of-contents__link toc-highlight">案例说明</a></li><li><a href="#运行后两个问题" class="table-of-contents__link toc-highlight">运行后两个问题</a></li></ul></li><li><a href="#sleuth-分布式请求链路追踪" class="table-of-contents__link toc-highlight">Sleuth 分布式请求链路追踪</a><ul><li><a href="#概述" class="table-of-contents__link toc-highlight">概述</a></li><li><a href="#搭建链路监控步骤" class="table-of-contents__link toc-highlight">搭建链路监控步骤</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">  来自冷环渊的技术支持与文档创作 @2025</div></div></div></footer></div>
</body>
</html>