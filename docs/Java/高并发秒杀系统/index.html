<!doctype html>
<html lang="cn" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Java/高并发秒杀系统" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">高并发秒杀系统 | 小冷の代码世界</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://doomwatcher2004.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://doomwatcher2004.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://doomwatcher2004.github.io/docs/Java/高并发秒杀系统"><meta data-rh="true" property="og:locale" content="cn"><meta data-rh="true" name="docusaurus_locale" content="cn"><meta data-rh="true" name="docsearch:language" content="cn"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="高并发秒杀系统 | 小冷の代码世界"><meta data-rh="true" name="description" content="分析需求"><meta data-rh="true" property="og:description" content="分析需求"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://doomwatcher2004.github.io/docs/Java/高并发秒杀系统"><link data-rh="true" rel="alternate" href="https://doomwatcher2004.github.io/docs/Java/高并发秒杀系统" hreflang="cn"><link data-rh="true" rel="alternate" href="https://doomwatcher2004.github.io/docs/Java/高并发秒杀系统" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.15cbc4ab.css">
<script src="/assets/js/runtime~main.36e9e1ef.js" defer="defer"></script>
<script src="/assets/js/main.602a8fec.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="小冷の代码世界" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="小冷の代码世界" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">小冷の代码世界</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/Java/Docker 快速入门">Java知识库</a><a class="navbar__item navbar__link" href="/docs/Web/JavaScript 高级">前端知识库</a><a class="navbar__item navbar__link" sidebarid="GodotSidebar" href="/docs/Godot">Godot游戏开发</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Doomwatcher2004" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Docker 快速入门">Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Java 8 更新的新特性 （函数式接口 lambda stream option）">Java8 新特性</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Java后端进阶之路： JavaWeb">javaweb</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Mybatis">Mybatis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Netty+springboot实现IM即时通讯服务端">Netty+springboot实现IM即时通讯服务端</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Netty_HTTP文件列表服务器">Netty_HTTP文件列表服务器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Netty_模拟Redis的客户端">Netty_模拟Redis的客户端</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Netty网络框架">Netty 网络框架</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Nginx">Nginx</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Redis 数据结构操作入门">Redis 数据结构操作入门</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Spring Aop 底层责任链思路实现">Spring Aop 底层责任链思路实现</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Spring5 Webflux 响应式编程">Spring5 Webflux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/SpringBoot 解决企业级复杂性简化开发的神奇">微服务阶段</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/SpringCloud Alibaba">springCloudAlibaba</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/SpringCloud Netflix">springcloud2020</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Spring内置MVC框架：SpringMVC">SpringMVC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/mybatis plus">mybatis plus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/redis问题的常见解决方案">redis问题的常见解决方案</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/使用Netty+zookeeper开发一款高性能LRpc">RPC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/六道入门树题目带你走入树结构的世界">六道入门树题目带你走入树结构的世界</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/分布式项目中锁的应用（本地锁-redis【setnx】-redisson-springcache）">分布式项目中锁的应用（本地锁-redis【setnx】-redisson-springcache）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/多线程进阶 JUC并发编程">多线程进阶 JUC 并发编程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/大前端进阶（ES6）">ES6</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/快速入门RabbitMQ并且加入项目实战">快速入门RabbitMQ并且加入项目实战</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/快速入门分布式系统与Dubbo+zookeeper">分布式系统简述：</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/掌握极简服务器开发的优秀框架 ：Spring">Spring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/搜索引擎 _ Elasticsearch">Elasticsearch</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/数据结构与算法">数据结构与算法</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/理解IOC 手写springIOC">Spring 手撕 IOC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/线程池详解与异步任务编排使用案例">线程池详解与异步任务编排使用案例</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/通透百万数据秒级排序  快速排序">通透百万数据秒级排序  快速排序</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/阿里淘系单点登录中心">阿里淘系单点登录中心</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/Java/高并发秒杀系统">高并发秒杀系统</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">高并发秒杀系统</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>高并发秒杀系统</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="分析需求">分析需求<a href="#分析需求" class="hash-link" aria-label="Direct link to 分析需求" title="Direct link to 分析需求">​</a></h2>
<blockquote>
<p>场景分析</p>
</blockquote>
<ul>
<li>秒杀时大量用户会在同一时间同时进行抢购，网站瞬时访问流量激增。</li>
<li>秒杀一般是访问请求数量远远大于库存数量，只有少部分用户能够秒杀成功。</li>
<li>秒杀业务流程比较简单，一般就是下订单减库存。</li>
</ul>
<blockquote>
<p>问题分析</p>
</blockquote>
<p>秒杀系统一般要注意的问题就是 :</p>
<ol>
<li>库存少卖，超卖问题（原子性）</li>
<li>流量削峰，这里我们设定的时候每个用户只能秒杀一次所以比较好处理</li>
</ol>
<blockquote>
<p>执行流程</p>
</blockquote>
<ul>
<li>初始化数据，提前预热要秒杀的商品（项目里设置为启动，如果秒杀列表有就预热）</li>
<li>使用 redis 缓存秒杀的商品信息，使用 redis 来承担秒杀的压力最后生产秒杀到的用户，再到 mysql 生成订单</li>
<li>在秒杀时使用（事务，分布式锁两种方式都实现）对商品库存，保证原子性</li>
</ul>
<blockquote>
<p>设计思路图</p>
</blockquote>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/d2b648c95b6ddb7e71fad594ce58db0d.png" alt="image-20220308165057681" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="秒杀系统">秒杀系统<a href="#秒杀系统" class="hash-link" aria-label="Direct link to 秒杀系统" title="Direct link to 秒杀系统">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="技术选型">技术选型<a href="#技术选型" class="hash-link" aria-label="Direct link to 技术选型" title="Direct link to 技术选型">​</a></h3>
<p><strong>开发语言 : Java 8 或 Java 11</strong></p>
<p><strong>框架技术： SpringBoot2.x ，Mybatis-plus ，Thymeleaf</strong></p>
<p><strong>中间件： Redis</strong></p>
<p><strong>数据库：MySQL 8.0</strong></p>
<p><strong>数据源： druid 1.16</strong></p>
<p><strong>测试工具： apache jmeter</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="数据库表设计">数据库表设计<a href="#数据库表设计" class="hash-link" aria-label="Direct link to 数据库表设计" title="Direct link to 数据库表设计">​</a></h3>
<p>三张表，分别是</p>
<ol>
<li>商品表： id 商品 id 商品 name 商品图片 商品类别 商品价格 库存</li>
<li>秒杀商品表 ： id 商品 id 秒杀开始时间 秒杀结束时间 秒杀价 可秒杀的数量</li>
<li>订单表 id 订单 id 商品 id 秒杀价格 用户 id 地址 电话</li>
</ol>
<blockquote>
<p>sql 表</p>
</blockquote>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token keyword" style="color:#0c4a6e">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DATABASE</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955">/*!32312 IF NOT EXISTS*/</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">seckill</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955">/*!40100 DEFAULT CHARACTER SET utf8 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">USE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">seckill</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">DROP</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">IF</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">EXISTS</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">goods</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">goods</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">int</span><span class="token plain"> </span><span class="token operator" style="color:#475569">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">AUTO_INCREMENT</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">goods_id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">varchar</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">100</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">CHARACTER</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">SET</span><span class="token plain"> utf8 </span><span class="token keyword" style="color:#0c4a6e">COLLATE</span><span class="token plain"> utf8_general_ci </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;商品id&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">goods_name</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">varchar</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">100</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;商品名字&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">goodtype</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">varchar</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">100</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;商品类别&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">price</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">double</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;商品价格&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">img_path</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">varchar</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">200</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;商品图片地址&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token keyword" style="color:#0c4a6e">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">ENGINE</span><span class="token operator" style="color:#475569">=</span><span class="token keyword" style="color:#0c4a6e">InnoDB</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">AUTO_INCREMENT</span><span class="token operator" style="color:#475569">=</span><span class="token number" style="color:#B5CEA8">6</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">CHARSET</span><span class="token operator" style="color:#475569">=</span><span class="token plain">utf8mb3</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token comment" style="color:#6A9955">/*Data for the table `goods` */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">insert</span><span class="token plain">  </span><span class="token keyword" style="color:#0c4a6e">into</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">goods</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">(</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">,</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">goods_id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">,</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">goods_name</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">,</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">goodtype</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">,</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">price</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">,</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">img_path</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">values</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">5</span><span class="token punctuation" style="color:#475569">,</span><span class="token string" style="color:#64748b">&#x27;1001&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token string" style="color:#64748b">&#x27;华为手机&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token string" style="color:#64748b">&#x27;电子用品&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token number" style="color:#B5CEA8">5000</span><span class="token punctuation" style="color:#475569">,</span><span class="token string" style="color:#64748b">&#x27;/img/huaweiphone.jpg&#x27;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token comment" style="color:#6A9955">/*Table structure for table `goodsorder` */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">DROP</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">IF</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">EXISTS</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">goodsorder</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">goodsorder</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">int</span><span class="token plain"> </span><span class="token operator" style="color:#475569">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">AUTO_INCREMENT</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">order_id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">varchar</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">100</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">varchar</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">100</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">goods_id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">varchar</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">100</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">telephone</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">varchar</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">20</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">address</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">varchar</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">100</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token keyword" style="color:#0c4a6e">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">ENGINE</span><span class="token operator" style="color:#475569">=</span><span class="token keyword" style="color:#0c4a6e">InnoDB</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">AUTO_INCREMENT</span><span class="token operator" style="color:#475569">=</span><span class="token number" style="color:#B5CEA8">10</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">CHARSET</span><span class="token operator" style="color:#475569">=</span><span class="token plain">utf8mb3</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token comment" style="color:#6A9955">/*Data for the table `goodsorder` */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token comment" style="color:#6A9955">/*Table structure for table `seckillgoods` */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">DROP</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">IF</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">EXISTS</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">seckillgoods</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">seckillgoods</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">bigint</span><span class="token plain"> </span><span class="token operator" style="color:#475569">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">AUTO_INCREMENT</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">goods_id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">varchar</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">100</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">seckill_price</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">double</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;秒杀价格&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">stock_num</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">int</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;秒杀库存&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">start_time</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">datetime</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;开始时间&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">end_time</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">datetime</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;结束时间&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token keyword" style="color:#0c4a6e">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">ENGINE</span><span class="token operator" style="color:#475569">=</span><span class="token keyword" style="color:#0c4a6e">InnoDB</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">AUTO_INCREMENT</span><span class="token operator" style="color:#475569">=</span><span class="token number" style="color:#B5CEA8">2</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">CHARSET</span><span class="token operator" style="color:#475569">=</span><span class="token plain">utf8mb3</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token comment" style="color:#6A9955">/*Data for the table `seckillgoods` */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">insert</span><span class="token plain">  </span><span class="token keyword" style="color:#0c4a6e">into</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">seckillgoods</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">(</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">,</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">goods_id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">,</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">seckill_price</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">,</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">stock_num</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">,</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">start_time</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">,</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">end_time</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">values</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">1</span><span class="token punctuation" style="color:#475569">,</span><span class="token string" style="color:#64748b">&#x27;1001&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token number" style="color:#B5CEA8">3599</span><span class="token punctuation" style="color:#475569">,</span><span class="token number" style="color:#B5CEA8">10</span><span class="token punctuation" style="color:#475569">,</span><span class="token string" style="color:#64748b">&#x27;2022-03-07 00:00:00&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token string" style="color:#64748b">&#x27;2022-03-09 00:00:00&#x27;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="项目配置文件">项目配置文件<a href="#项目配置文件" class="hash-link" aria-label="Direct link to 项目配置文件" title="Direct link to 项目配置文件">​</a></h3>
<p><code>application.yml</code></p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">spring:</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  datasource:</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    username: root</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    password: root</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    url: jdbc:mysql://localhost:3306/seckill?		 userSSL=true&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=GMT%2B8</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    driver-class-name: com.mysql.cj.jdbc.Driver</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  redis:</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    database: 0</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    host: 120.79.14.203</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    port: 6379</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    password: root</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    timeout: 1000</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  thymeleaf:</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    cache: false</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    prefix: classpath:/templates/</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    suffix: .html</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">mybatis-plus:</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  configuration:</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    map-underscore-to-camel-case: false</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  #  configuration:</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  #    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  mapper-locations: classpath:mapper/*</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>redis 配置类</p>
</blockquote>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class RedisConfig {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">     * @author 冷环渊 Doomwatcher</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">     * @context:redis 存储数据 序列化方式</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">     * @date: 2022/3/7 21:19</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">     * @param redisConnectionFactory</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">     * @return: org.springframework.data.redis.core.RedisTemplate&lt;java.lang.String, java.lang.Object&gt;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                                                               redisConnectionFactory) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        RedisTemplate&lt;String, Object&gt; redisTemplate = new RedisTemplate&lt;&gt;();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        //声明 key 和 value 的序列化方式</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        StringRedisSerializer keySerializer = new StringRedisSerializer();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        GenericFastJsonRedisSerializer valueSerializer = new GenericFastJsonRedisSerializer();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        redisTemplate.setKeySerializer(keySerializer);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        redisTemplate.setValueSerializer(valueSerializer);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        redisTemplate.setHashKeySerializer(keySerializer);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        redisTemplate.setValueSerializer(valueSerializer);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        //多种的序列化方式 最好是谁序列化的谁处理</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        //GenericFastJsonRedisSerializer</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        //Jackson2JsonRedisSerializer</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return redisTemplate;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>redis 工具类</p>
</blockquote>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">package com.hyc.seckillsystem.util;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.beans.factory.annotation.Autowired;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.data.redis.core.RedisTemplate;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.data.redis.core.SessionCallback;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.data.redis.core.script.RedisScript;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import org.springframework.stereotype.Component;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import java.util.List;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">import java.util.concurrent.TimeUnit;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"> * @projectName: seckillsystem</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"> * @package: com.hyc.seckillsystem.util</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"> * @className: RedisUtil</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"> * @author: 冷环渊 doomwatcher</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"> * @description: TODO</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"> * @date: 2022/3/7 21:25</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"> * @version: 1.0</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class RedisUtil {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    private RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    //    设置缓存</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public void set(String key, Object value) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        redisTemplate.opsForValue().set(key, value);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">//设置缓存和超时时间</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public void set(String key, Object value, long timeout) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        redisTemplate.opsForValue().set(key, value, timeout, TimeUnit.SECONDS);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    //获取命中key 的内容</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public Object get(String key) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        if (!redisTemplate.hasKey(key)) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            return null;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return redisTemplate.opsForValue().get(key);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    //递减操作</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public void decr(String key) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        redisTemplate.opsForValue().decrement(key);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    //触发 提交 参数里的sessionCallback 队列里的命令</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public Object execute(SessionCallback sessionCallback) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return redisTemplate.execute(sessionCallback);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    // 使用脚本语言</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public Object execute(RedisScript script, List keylist) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return redisTemplate.execute(script, keylist);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">// 是否存在 key</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public boolean hasKey(String key) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return redisTemplate.hasKey(key);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="商品列表">商品列表<a href="#商品列表" class="hash-link" aria-label="Direct link to 商品列表" title="Direct link to 商品列表">​</a></h3>
<p>商品列表界面，是比较简单的，设计思路还是基于传统的三层开发</p>
<p><code>Controller -&gt; servier -&gt; dao</code>这样的分层开发模式</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/2a6b4645e71d6b4b26c883b3dceba13e.png" alt="image-20220308165851328" class="img_ev3q"></p>
<blockquote>
<p>实体类</p>
</blockquote>
<p>这里为了方面展示，就展示实体类的属性，小伙伴们自行补充 getter/setter 以及构造方法等</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">public class goods {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Id</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @TableId(type = IdType.AUTO)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    private Integer id;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    private String goods_id;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    private String goods_name;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    private String goodtype;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    private double price;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    private String img_path;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @TableField(exist = false)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    private SeckillGoods seckillgoods;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>DAO</p>
</blockquote>
<p>虽然使用了 mybatis-plus 但是我们还是根据自己的查询需求新增了自己的方法，</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@Repository</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public interface GoodsMapper extends BaseMapper&lt;goods&gt; {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    goods getGoodsByGoodsId(String goodId);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    List&lt;goods&gt; selectGoods();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    List&lt;goods&gt; getGoodList();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>映射文件</p>
</blockquote>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token prolog" style="color:#000080">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token doctype punctuation" style="color:#475569">&lt;!</span><span class="token doctype doctype-tag">DOCTYPE</span><span class="token doctype"> </span><span class="token doctype name">mapper</span><span class="token doctype"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token doctype">        </span><span class="token doctype name">PUBLIC</span><span class="token doctype"> </span><span class="token doctype string" style="color:#64748b">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><span class="token doctype"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token doctype">        </span><span class="token doctype string" style="color:#64748b">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span><span class="token doctype punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">mapper</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">namespace</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">com.hyc.seckillsystem.dao.GoodsMapper</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">select</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">getGoodsByGoodsId</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">resultType</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">com.hyc.seckillsystem.pojo.goods</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        select seckill.goods.goods_id,</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">               seckill.goods.goods_name,</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">               seckill.goods.goodtype,</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">               seckill.goods.price,</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">               seckill.goods.img_path</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        from seckill.goods</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        where goods_id = #{goodId};</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">select</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">select</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">getGoodList</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">resultType</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">com.hyc.seckillsystem.pojo.goods</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        select seckill.goods.goods_id,</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">               seckill.goods.goods_name,</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">               seckill.goods.goodtype,</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">               seckill.goods.price,</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">               seckill.goods.img_path</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        from seckill.goods</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">select</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">resultMap</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">goodsResult</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">com.hyc.seckillsystem.pojo.goods</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">id</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">property</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">id</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">column</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">id</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag punctuation" style="color:#475569">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">result</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">property</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">goods_id</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">column</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">goods_id</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag punctuation" style="color:#475569">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">result</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">property</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">goods_name</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">column</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">goods_name</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag punctuation" style="color:#475569">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">result</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">property</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">goodtype</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">column</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">goods_type</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag punctuation" style="color:#475569">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">result</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">property</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">price</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">column</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">price</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag punctuation" style="color:#475569">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">result</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">property</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">img_path</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">column</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">img_path</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag punctuation" style="color:#475569">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">association</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">property</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">seckillgoods</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">javaType</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">com.hyc.seckillsystem.pojo.SeckillGoods</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">result</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">property</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">seckill_price</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">column</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">seckill_price</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag punctuation" style="color:#475569">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">result</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">property</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">stock_num</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">column</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">stock_num</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag punctuation" style="color:#475569">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">association</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">resultMap</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">select</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">selectGoods</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag" style="color:#0ea5e9"> </span><span class="token tag attr-name" style="color:#0c4a6e">resultMap</span><span class="token tag attr-value punctuation attr-equals" style="color:#475569">=</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag attr-value" style="color:#64748b">goodsResult</span><span class="token tag attr-value punctuation" style="color:#475569">&quot;</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        SELECT a.`goods_id`,</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">               a.`goods_name`,</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">               a.`goodtype`,</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">               a.`price`,</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">               a.`img_path`,</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">               b.`seckill_price`,</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">               b.`stock_num`</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        FROM seckill.goods AS a</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                 LEFT JOIN seckill.seckillgoods AS b</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                           ON a.`goods_id` = b.`goods_id`</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">select</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">mapper</span><span class="token tag punctuation" style="color:#475569">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>service 实现类</p>
</blockquote>
<p>两种查找商品数据的方法</p>
<ol>
<li><code>getlist：</code>逐个表 匹配查询</li>
<li><code>selectGoods</code>链表查询</li>
</ol>
<p>返回商品详情(包括秒杀价格等)VO <code>getGoodsDetail(String goodId)</code></p>
<p>service 层的设计思路就是 调用 DAO 层接口 实现对数据库中取出数据的处理,并且提供给 controller 封装好的接口</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@Service</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class GoodsServiceImpl implements GoodsService {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    GoodsMapper goodsMapper;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    SeckillGoodsMapper seckillGoodsMapper;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">     * @author 冷环渊 Doomwatcher</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">     * @context:逐个表 匹配查询</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">     * @date: 2022/3/7 16:20</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">     * @param</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">     * @return: java.util.List&lt;com.hyc.seckillsystem.vo.GoodVo&gt;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public List&lt;GoodVo&gt; getlist() {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        /* 两种方式</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">         * 每个表单独查询</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">         * 从第一个表查多个数据，再根据数据去第二个表中查询</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">         * */</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        List&lt;goods&gt; goods = goodsMapper.getGoodList();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        ArrayList&lt;GoodVo&gt; result = new ArrayList&lt;&gt;();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        for (goods good : goods) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            Map&lt;String, Object&gt; map = new HashMap();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            map.put(&quot;goods_id&quot;, good.getGoods_id());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            SeckillGoods seckillGoods = seckillGoodsMapper.getSeckillByGoodsId(good.getGoods_id());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            GoodVo vo = new GoodVo();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            vo.setGoodsId(good.getGoods_id());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            vo.setGoodsName(good.getGoods_name());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            vo.setGoodType(good.getGoodtype());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            vo.setPrice(good.getPrice());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            vo.setImgPath(good.getImg_path());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            vo.setSeckillPrice(seckillGoods.getSeckill_price());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            vo.setStockNum(seckillGoods.getStock_num());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            result.add(vo);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return result;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    //返回秒杀商品详情页面</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public GoodsDetailVo getGoodsDetail(String goodId) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        SeckillGoods seckillGoods = seckillGoodsMapper.getSeckillByGoodsId(goodId);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        goods good = goodsMapper.getGoodsByGoodsId(goodId);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        //商品表信息1</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        GoodsDetailVo goodsDetailVo = new GoodsDetailVo();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        goodsDetailVo.setGoodsId(good.getGoods_id());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        goodsDetailVo.setGoodsName(good.getGoods_name());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        goodsDetailVo.setGoodType(good.getGoodtype());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        goodsDetailVo.setPrice(good.getPrice());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        goodsDetailVo.setImgPath(good.getImg_path());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        //秒杀表信息</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        goodsDetailVo.setSeckillPrice(seckillGoods.getSeckill_price());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        goodsDetailVo.setStockNum(seckillGoods.getStock_num());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        goodsDetailVo.setStartTime(seckillGoods.getStart_time());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        goodsDetailVo.setEndTime(seckillGoods.getEnd_time());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return goodsDetailVo;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">     * @author 冷环渊 Doomwatcher</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">     * @context: 联表查询</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">     * @date: 2022/3/7 16:20</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">     * @param</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">     * @return: com.hyc.seckillsystem.vo.GoodVo</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public List&lt;GoodVo&gt; selectGoods() {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        List&lt;goods&gt; goods = goodsMapper.selectGoods();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        ArrayList&lt;GoodVo&gt; result = new ArrayList&lt;&gt;();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        for (goods good : goods) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            GoodVo vo = new GoodVo();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            vo.setGoodsId(good.getGoods_id());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            vo.setGoodsName(good.getGoods_name());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            vo.setGoodType(good.getGoodtype());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            vo.setPrice(good.getPrice());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            vo.setImgPath(good.getImg_path());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            vo.setSeckillPrice(good.getSeckillGoods().getSeckill_price());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            vo.setStockNum(good.getSeckillGoods().getStock_num());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            result.add(vo);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return result;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>Controller</p>
</blockquote>
<p>Controller 层,负责控制接口数据和渲染界面的值传递 , 跳转 , 这里基本上不包含业务代码</p>
<p>尽可能的再 service 层 封装好方法 让 Controller 只负责调用</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@Controller</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class GoodsController {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    GoodsService goodsService;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @GetMapping(value = &quot;/index&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public String list(Model model) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        //    逐层调用</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        List&lt;GoodVo&gt; getlist = goodsService.getlist();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        model.addAttribute(&quot;goodslist&quot;, getlist);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return &quot;list&quot;;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @GetMapping(value = &quot;/goodDetail/{goodsId}&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public String getGoodDetail(@PathVariable String goodsId, Model model) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        GoodsDetailVo goodsDetail = goodsService.getGoodsDetail(goodsId);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        model.addAttribute(&quot;GoodsDetail&quot;, goodsDetail);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        //获取到时间</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        Date startTime = goodsDetail.getStartTime();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        Date endTime = goodsDetail.getEndTime();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        Date nowtime = new Date();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        /*设置状态值</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">         * 0 未开始</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">         * 1 正在秒杀</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">         * 2 秒杀结束</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">         * */</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        int status;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        int remainSeconds = -1;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        if (nowtime.before(startTime)) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            //    秒杀未开始</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            status = 0;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            remainSeconds = (int) ((startTime.getTime() - nowtime.getTime()) / 1000);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        } else if (nowtime.after(endTime)) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            //秒杀已经结束</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            status = 2;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        } else {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            //正在秒杀中</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            status = 1;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        model.addAttribute(&quot;status&quot;, status);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        model.addAttribute(&quot;remainSeconds&quot;, remainSeconds);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return &quot;Detail&quot;;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="秒杀商品">秒杀商品<a href="#秒杀商品" class="hash-link" aria-label="Direct link to 秒杀商品" title="Direct link to 秒杀商品">​</a></h3>
<p>这里才是我们的重头戏这里我们主要讲解使用思路，不过多的去展示无用代码如实体类等，我们这里从最开始的</p>
<ol>
<li>直接处理</li>
<li>redis 事务处理</li>
<li>分布式锁 Lua 处理</li>
</ol>
<p>三种方式 由浅至深的来理解秒杀的思路和超卖问题的解决</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="直接处理">直接处理<a href="#直接处理" class="hash-link" aria-label="Direct link to 直接处理" title="Direct link to 直接处理">​</a></h4>
<ul>
<li>判断用户 id 的有效性 我们没有用户</li>
<li>判断 goodsid 的有效性</li>
<li>判断当前是否处于可以秒杀的状态</li>
<li>判断是否有剩余库存</li>
<li>判断用户的秒杀权限（是否秒杀过）</li>
<li>减少库存</li>
<li>生成新的订单</li>
</ul>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">public String handle(String userId, String goodsId) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    String stockkey = goodsId + &quot;_count&quot;;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    String startTimekey = goodsId + &quot;_startTime&quot;;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    String userkey = goodsId + &quot;_&quot; + userId;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    String dateStr = (String) redisUtil.get(startTimekey);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    SimpleDateFormat format = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    Date startTime = null;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        startTime = format.parse(dateStr);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    } catch (ParseException e) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        e.printStackTrace();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    if (startTime == null || new Date().before(startTime)) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return &quot;秒杀还没开始&quot;;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    int stockNum = (int) redisUtil.get(stockkey);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    if (stockNum &lt;= 0) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return &quot;秒杀一空&quot;;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    if (redisUtil.get(userkey) != null) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return &quot;用户秒杀成功过了&quot;;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    //减少库存</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    redisUtil.decr(stockkey);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    //限额 1 可以这么处理</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    //如果限额 多个 可以获取value 自增</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    redisUtil.set(goodsId + &quot;_&quot; + userId, 1);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    return userId + &quot;用户秒杀成功&quot;;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>测试</p>
</blockquote>
<p>这个时候启动 jmeter 来测试一下接口的结果</p>
<ul>
<li>库存 10</li>
<li>一百个线程 抢这 10 个 手机</li>
</ul>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/9c8c34c16a0d2654dcf5df45b04b1c2d.png" alt="image-20220308174255775" class="img_ev3q"></p>
<p>查看 redis 中 库存 key 的数量 为 -4</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/60ea48e5f6961fef46ea1406c58173c3.png" alt="image-20220308174432576" class="img_ev3q"></p>
<p>再次测试</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/e870a0b8eecdf563616dfacf32097552.png" alt="image-20220308174916436" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/f32c2861b580f5bbd52537a6edc312f0.png" alt="image-20220308174744088" class="img_ev3q"></p>
<p>通过测试和查看日志可以看到，我们直接处理，系统不行不能在第一时间反应过来是否超过了库存，导致特价商品被超额卖出，那这个问题怎么解决呢？</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="事务处理">事务处理<a href="#事务处理" class="hash-link" aria-label="Direct link to 事务处理" title="Direct link to 事务处理">​</a></h4>
<p>优秀成熟的数据库 一定会有对事务的支持， redis 也不例外</p>
<p>Redis 的事务在不出现异常的时候是原子操作，exec 是触发事务执行的命令</p>
<p>相关命令：</p>
<ul>
<li>watch 设置一个 key 表示开始对这个 key 的命令监听</li>
<li>multi 将 后续的命令 加入到执行队列里</li>
<li>exec 出发执行队列里的命令</li>
<li>discard 停止提交，redis 不能回滚</li>
</ul>
<blockquote>
<p>使用事务</p>
</blockquote>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">    public String handleByTrans(String userId, String goodsId) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        String stockkey = goodsId + &quot;_count&quot;;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        String startTimekey = goodsId + &quot;_startTime&quot;;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        String userkey = goodsId + &quot;_&quot; + userId;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        String dateStr = (String) redisUtil.get(startTimekey);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        SimpleDateFormat format = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        Date startTime = null;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            startTime = format.parse(dateStr);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        } catch (ParseException e) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            e.printStackTrace();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        if (startTime == null || new Date().before(startTime)) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            return &quot;秒杀还没开始&quot;;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        if (redisUtil.get(userkey) != null) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            return &quot;用户秒杀成功过了&quot;;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        SessionCallback sessionCallback = new SessionCallback() {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            @Override</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            public Object execute(RedisOperations redisOperations) throws DataAccessException {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                // 编写事务逻辑</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                // 调用 watch 开始事务， mutil 开始将之后的命令加入队列 exec 执行队列里的命令</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                redisOperations.watch(stockkey);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                int stockNum = (int) redisUtil.get(stockkey);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                if (stockNum &lt;= 0) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                    return &quot;秒杀一空&quot;;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                redisOperations.multi();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                redisUtil.decr(stockkey);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                redisUtil.set(userkey, 1);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                return redisOperations.exec();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        redisUtil.execute(sessionCallback);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        if (redisUtil.hasKey(userkey)) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            return userId;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return userId + &quot;秒杀失败&quot;;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>测试</p>
</blockquote>
<p>和之前一样的案例 100 抢 10</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/9d4673f91e9804263d7fa6eeb29d9810.png" alt="image-20220308175622279" class="img_ev3q"></p>
<p>可以发现使用了 事务之后我们解决了超卖的问题</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="举一反三">举一反三<a href="#举一反三" class="hash-link" aria-label="Direct link to 举一反三" title="Direct link to 举一反三">​</a></h4>
<p>那除了事务 还有什么方式可以解决超卖问题呢？</p>
<p>脚本语言 ： lua</p>
<p>redis 是支持执行脚本语言的且一段脚本执行的时候是不会被其他操作影响的，保证原子性</p>
<blockquote>
<p>编写 lua 脚本</p>
</blockquote>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">--接受到参数1</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">local userId = KEYS[1];</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">--接收到参数2</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">local goodsId = KEYS[2];</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">--redis中的 key 存储为 局部变量</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">--秒杀商品数量</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">--.. 是lua 里面字符串的拼接</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">local cntkey = goodsId .. &quot;_count&quot;;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">--秒杀用户 id</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">local orderkey = goodsId .. &quot;_&quot; .. userId;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">--判断是否秒杀过</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">local orderExists = redis.call(&quot;get&quot;, orderkey);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">if (orderExists and tonumber(orderExists) == 1) then</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    return 2;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">end</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">--判断库存是否为空</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">local num = redis.call(&quot;get&quot;, cntkey);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">if (num and tonumber(num) &lt;= 0) then</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">else</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    --    秒杀成功</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    redis.call(&quot;decr&quot;, cntkey);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    redis.call(&quot;set&quot;, orderkey, 1);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">end</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">return 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>实例代码</p>
</blockquote>
<p>我们可以使用 DefaultRedisScript 类 来执行我们写在 resouce 下的 lua 脚本</p>
<p><code> script.setScriptSource(new ResourceScriptSource(                 new ClassPathResource(&quot;lua/sekill.lua&quot;)));</code></p>
<p>设置脚本的位置，之后用之前工具类封装的 redis 方法将脚本和需要的参数 list 传入执行即可</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">    //使用lua 脚本 保证原子性 （分布式锁）</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public String handleByLua(String userId, String goodsId) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        String startTimekey = goodsId + &quot;_startTime&quot;;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        String dateStr = (String) redisUtil.get(startTimekey);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        SimpleDateFormat format = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        Date startTime = null;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            startTime = format.parse(dateStr);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        } catch (ParseException e) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            e.printStackTrace();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        if (startTime == null || new Date().before(startTime)) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            return &quot;秒杀还没开始&quot;;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        DefaultRedisScript&lt;Long&gt; script = new DefaultRedisScript&lt;&gt;();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        //设置返回脚本类型</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        script.setResultType(Long.class);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        script.setScriptSource(new ResourceScriptSource(</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                new ClassPathResource(&quot;lua/sekill.lua&quot;)));</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        List&lt;String&gt; keylist = new ArrayList&lt;&gt;();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        keylist.add(userId);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        keylist.add(goodsId);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        Object execute = redisUtil.execute(script, keylist);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        String resultStr = String.valueOf(execute);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        if (&quot;0&quot;.equals(resultStr)) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            return &quot;秒杀库存已经空了&quot;;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        } else if (&quot;1&quot;.equals(resultStr)) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            return userId;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        } else if (&quot;2&quot;.equals(resultStr)) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            return &quot;该用户秒杀过了 =&gt;&quot; + userId;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        } else {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            return &quot;秒杀和抢购可能出了点问题，正在紧急维护&quot;;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>测试</p>
</blockquote>
<p>同样的 100 -》 10 ,从结果来看，也是保证了不超卖，不少卖的</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/ad1a7b43eb53f827903532b09895b520.png" alt="image-20220308175958242" class="img_ev3q"></p>
<p>解决了秒杀的问题,剩下就是将秒杀之后的成功用户信息和商品信息传给订单模块即可</p>
<blockquote>
<p>Controller</p>
</blockquote>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@Controller</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class redisController {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    redisService redisService;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    RedisUtil redisUtil;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    // 为了 方面测试 每次重启项目都会重置秒杀次数</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @PostConstruct</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public void initdata() {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        redisService.initdata();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @PostMapping(value = &quot;/seckillAPI&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public String seckill(String userId, String goodsId, Model model) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        String key = goodsId + &quot;_&quot; + userId;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        if (userId == null || goodsId == null) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            return &quot;参数异常&quot;;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        String result = redisService.seckill(userId, goodsId);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        if (redisUtil.hasKey(key)) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            log.info(result);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            model.addAttribute(&quot;userId&quot;, result);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            model.addAttribute(&quot;goodsId&quot;, goodsId);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return &quot;order&quot;;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="生成订单">生成订单<a href="#生成订单" class="hash-link" aria-label="Direct link to 生成订单" title="Direct link to 生成订单">​</a></h3>
<p>解决了秒杀的问题，生成订单其实就简单和常规的不少</p>
<p>就是查询 必要的信息生成一个订单信息</p>
<blockquote>
<p>service 实现类</p>
</blockquote>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@Service</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class orderServiceImpl implements orderService {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    GoodsMapper goodsMapper;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    SeckillGoodsMapper seckillGoodsMapper;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    orderMapper ordermapper;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public orderVo createOrder(order order) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        int insert = ordermapper.insert(order);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        if (insert != 0) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            List&lt;order&gt; orders = ordermapper.selectList(null);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            for (order o : orders) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                goods goods = goodsMapper.getGoodsByGoodsId(o.getGoods_id());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                SeckillGoods seckillGoods = seckillGoodsMapper.getSeckillByGoodsId(o.getGoods_id());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                orderVo orderVo = new orderVo();</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                orderVo.setOrderId(String.valueOf(o.getId()));</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                orderVo.setUserId(o.getUser_id());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                orderVo.setGoodsId(o.getGoods_id());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                orderVo.setTelephone(o.getTelephone());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                orderVo.setAddress(o.getAddress());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                orderVo.setImgPath(goods.getImg_path());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                orderVo.setSeckillPrice(seckillGoods.getSeckill_price());</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                return orderVo;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return null;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>Controller</p>
</blockquote>
<p>等待用户 确认信息之后 就可以生成订单 同步到数据库了</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">@Controller</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">public class orderController {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    orderService orderService;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    @PostMapping(value = &quot;/create&quot;)</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    public String createOrder(order order, Model model) {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        orderVo order1 = orderService.createOrder(order);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        model.addAttribute(&quot;orderinfo&quot;, order1);</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        return &quot;success&quot;;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="流程展示">流程展示<a href="#流程展示" class="hash-link" aria-label="Direct link to 流程展示" title="Direct link to 流程展示">​</a></h2>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/a096c3bdb821102230eeec4c161dd6ff.png" alt="image-20220308182706212" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/5a538ec3f46c7352367570ac623c1a29.png" alt="image-20220308182722476" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/46c0322ff764b5c6fb34be4ff48bed0d.png" alt="image-20220308182733907" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/5697205d51b3adc38ed0faf3fe0b34fd.png" alt="image-20220308182751989" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>设计一个秒杀项目 其实要考虑的东西十分的多，我们这次的系统也不是最终的版本，先做出来的核心的，</p>
<p>套用鱼皮的话 先有 再调优 追求更好</p>
<blockquote>
<p>拓展</p>
</blockquote>
<ul>
<li>页面动静分离</li>
<li>nginx ip 分流</li>
<li>MQ 流量削峰，异步任务</li>
<li>前端验证码</li>
<li>数据库与缓存同步策略（MQ redis 都可以实现）</li>
</ul>
<p>上述都是我学过的知识点暂时并且实战过，会在今后不断的将优化功能实现出来</p>
<p>这些都是我在考虑的范围内，今后会不断的学习 晚上其中的内容，</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Java/阿里淘系单点登录中心"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">阿里淘系单点登录中心</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#分析需求" class="table-of-contents__link toc-highlight">分析需求</a></li><li><a href="#秒杀系统" class="table-of-contents__link toc-highlight">秒杀系统</a><ul><li><a href="#技术选型" class="table-of-contents__link toc-highlight">技术选型</a></li><li><a href="#数据库表设计" class="table-of-contents__link toc-highlight">数据库表设计</a></li><li><a href="#项目配置文件" class="table-of-contents__link toc-highlight">项目配置文件</a></li><li><a href="#商品列表" class="table-of-contents__link toc-highlight">商品列表</a></li><li><a href="#秒杀商品" class="table-of-contents__link toc-highlight">秒杀商品</a></li><li><a href="#生成订单" class="table-of-contents__link toc-highlight">生成订单</a></li></ul></li><li><a href="#流程展示" class="table-of-contents__link toc-highlight">流程展示</a></li><li><a href="#总结" class="table-of-contents__link toc-highlight">总结</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">  来自冷环渊的技术支持与文档创作 @2025</div></div></div></footer></div>
</body>
</html>