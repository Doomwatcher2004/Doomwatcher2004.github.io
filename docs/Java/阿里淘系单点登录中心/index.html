<!doctype html>
<html lang="cn" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Java/阿里淘系单点登录中心" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">阿里淘系单点登录中心 | 小冷の代码世界</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://doomwatcher2004.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://doomwatcher2004.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://doomwatcher2004.github.io/docs/Java/阿里淘系单点登录中心"><meta data-rh="true" property="og:locale" content="cn"><meta data-rh="true" name="docusaurus_locale" content="cn"><meta data-rh="true" name="docsearch:language" content="cn"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="阿里淘系单点登录中心 | 小冷の代码世界"><meta data-rh="true" name="description" content="前言"><meta data-rh="true" property="og:description" content="前言"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://doomwatcher2004.github.io/docs/Java/阿里淘系单点登录中心"><link data-rh="true" rel="alternate" href="https://doomwatcher2004.github.io/docs/Java/阿里淘系单点登录中心" hreflang="cn"><link data-rh="true" rel="alternate" href="https://doomwatcher2004.github.io/docs/Java/阿里淘系单点登录中心" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.15cbc4ab.css">
<script src="/assets/js/runtime~main.4abb65a5.js" defer="defer"></script>
<script src="/assets/js/main.7b9af782.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="小冷の代码世界" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="小冷の代码世界" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">小冷の代码世界</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/Java/Docker 快速入门">Java知识库</a><a class="navbar__item navbar__link" href="/docs/Web/JavaScript 高级">前端知识库</a><a class="navbar__item navbar__link" href="/docs/Godot/">Godot游戏开发</a><a class="navbar__item navbar__link" href="/docs/finish/finishRpc">Finish系列手写中间件</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Doomwatcher2004" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Docker 快速入门">Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Java 8 更新的新特性 （函数式接口 lambda stream option）">Java8 新特性</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Java后端进阶之路： JavaWeb">javaweb</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Mybatis">Mybatis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Netty+springboot实现IM即时通讯服务端">Netty+springboot实现IM即时通讯服务端</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Netty_HTTP文件列表服务器">Netty_HTTP文件列表服务器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Netty_模拟Redis的客户端">Netty_模拟Redis的客户端</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Netty网络框架">Netty 网络框架</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Nginx">Nginx</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Redis 数据结构操作入门">Redis 数据结构操作入门</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Spring Aop 底层责任链思路实现">Spring Aop 底层责任链思路实现</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Spring5 Webflux 响应式编程">Spring5 Webflux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/SpringBoot 解决企业级复杂性简化开发的神奇">微服务阶段</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/SpringCloud Alibaba">springCloudAlibaba</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/SpringCloud Netflix">springcloud2020</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Spring内置MVC框架：SpringMVC">SpringMVC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/mybatis plus">mybatis plus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/redis问题的常见解决方案">redis问题的常见解决方案</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/六道入门树题目带你走入树结构的世界">六道入门树题目带你走入树结构的世界</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/分布式项目中锁的应用（本地锁-redis【setnx】-redisson-springcache）">分布式项目中锁的应用（本地锁-redis【setnx】-redisson-springcache）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/多线程进阶 JUC并发编程">多线程进阶 JUC 并发编程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/大前端进阶（ES6）">ES6</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/快速入门RabbitMQ并且加入项目实战">快速入门RabbitMQ并且加入项目实战</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/快速入门分布式系统与Dubbo+zookeeper">分布式系统简述：</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/掌握极简服务器开发的优秀框架 ：Spring">Spring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/搜索引擎 _ Elasticsearch">Elasticsearch</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/数据结构与算法">数据结构与算法</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/理解IOC 手写springIOC">Spring 手撕 IOC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/简易aiweb">Java入门Spring AI应用开发</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/线程池详解与异步任务编排使用案例">线程池详解与异步任务编排使用案例</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/通透百万数据秒级排序  快速排序">通透百万数据秒级排序  快速排序</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/Java/阿里淘系单点登录中心">阿里淘系单点登录中心</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/高并发秒杀系统">高并发秒杀系统</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">阿里淘系单点登录中心</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>阿里淘系单点登录中心</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a href="#前言" class="hash-link" aria-label="Direct link to 前言" title="Direct link to 前言">​</a></h2>
<blockquote>
<p>★ 这里是小冷的博客
✓ 优质技术好文见专栏
个人公众号，分享一些技术上的文章，以及遇到的坑
当前系列：单点登录
源代码 git 仓库 ‘
单点登录代码地址 <a href="https://gitee.com/cold-abyss_admin/SSO_self" target="_blank" rel="noopener noreferrer"> 仓库地址</a></p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="生活中的事情">生活中的事情<a href="#生活中的事情" class="hash-link" aria-label="Direct link to 生活中的事情" title="Direct link to 生活中的事情">​</a></h2>
<p>最近购物的时候遇到一个很奇妙的情况，我发现我只在天猫登录了，之后去淘宝买东西的时候，完全不虚要登录，这是为什么？</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/efcdacf1d084d1e0d4587620667cc1f9.png" alt="image-20220119194805596" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/4e46cdbf069c4344f4a0c23c29fb6d7b.png" alt="image-20220119000920797" class="img_ev3q"></p>
<p>首先我去天猫登录一下，之后刷新淘宝来看看，登录天猫之后，直接去刷新淘宝页面</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/a8cf51a3842c086e69559d701e7a8d4f.png" alt="image-20220119001400861" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/a85c3122f9b6288dccaa2b0efb4779e8.png" alt="image-20220119001424858" class="img_ev3q"></p>
<p>我们会发现淘宝也登录了，为什么可以这么方便呢？这里就用到了单点登录的概念。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="什么是单点登录">什么是单点登录<a href="#什么是单点登录" class="hash-link" aria-label="Direct link to 什么是单点登录" title="Direct link to 什么是单点登录">​</a></h2>
<p>单点登录在大型网站里使用得非常频繁，例如，阿里旗下有淘宝、天猫、支付宝,阿里巴巴，等网站，还有背后的成百上千的子系统，用户一次操作或交易可能涉及到几十个子系统的协 作，如果每个子系统都需要用户认证，不仅用户会疯掉，各子系统也会为这种重复认证授权的逻辑搞疯掉。</p>
<p>单点登录在大型网站里使用得非常频繁，例如，阿里旗下有淘宝、天猫、支付宝,阿里巴巴，阿里妈妈， 阿里妹妹等网站，还有背后的成百上千的子系统，用户一次操作或交易可能涉及到几十个子系统的协 作，如果每个子系统都需要用户认证，不仅用户会疯掉，各子系统也会为这种重复认证授权的逻辑搞疯 掉。</p>
<p>==所以，单点登录要解决的就是，用户只需要登录一次就可以访问所有相互信任的应用系统。==</p>
<p>单点登录（Single Sign On），简称为 SSO，是目前比较流行的企业业务整合的解决方案之一。SSO 并 不能算是一种架构，只能说是一个解决方案。SSO 核心意义就一句话：一处登录，处处登录；一处注 销，处处注销。就是在多个应用系统中，用户只需要登录一次就可以访问所有相互信任的应用系统，即 用户只需要记住一组用户名和密码就可以登录所有有权限的系统。</p>
<p>使用“单点登录”还是 SOA 时代的需求之一。在面向服务的架构中，服务和服务之间，程序和程序 之间的通讯大量存在，服务之间的安全认证是 SOA 应用的难点之一，应此建立“单点登录”的系统体系能 够大大简化 SOA 的安全问题，提高服务之间的合作效率。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="简谈-sso-的发展">简谈 SSO 的发展<a href="#简谈-sso-的发展" class="hash-link" aria-label="Direct link to 简谈 SSO 的发展" title="Direct link to 简谈 SSO 的发展">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="早期的单机部署">早期的单机部署<a href="#早期的单机部署" class="hash-link" aria-label="Direct link to 早期的单机部署" title="Direct link to 早期的单机部署">​</a></h3>
<p>早期我们开发 web 应用都是所有的包放在一起打成一个 war 包放入 tomcat 容器来运行的,所有的功能,所 有的业务,后台管理,门户界面,都是由这一个 war 来支持的,这样的单应用,也称之为单体应用,因为十分不好 扩展和拆分。</p>
<p>在单体应用下,用户的登录以及权限就显得十分简单：过滤器,用户登录成功后,把相关信息放入会话 中,HTTP 维护这个会话,再每次用户请求服务器的时候来验证这个会话即可</p>
<p>验证登录的这个会话就是 session,维护了用户状态,也就是所谓的 HTTP 有状态协议,我们经常可以在浏览 器中看到 JSESSIONID,这个就是用来维持这个关系的 key。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="分布式集群部署">分布式集群部署<a href="#分布式集群部署" class="hash-link" aria-label="Direct link to 分布式集群部署" title="Direct link to 分布式集群部署">​</a></h3>
<p>==由于网站的访问量越来也大，单机部署已经是巨大瓶颈，所以才有了后来的分布式集群部署。==
例如：如 果引入集群的概念,1 单应用可能重新部署在 3 台 tomcat 以上服务器,使用 nginx 来实现反向代理, 此时,这个 session 就无法在这 3 台 tomcat 上共享,用户信息会丢失，所以不得不考虑多服务器之间的 session 同步问 题，这就是单点登录的来源。</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/717a7a72a5869f2b24c5c98dcac35b6a.png" alt="image-20220118195145433" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="多种解决方案">多种解决方案<a href="#多种解决方案" class="hash-link" aria-label="Direct link to 多种解决方案" title="Direct link to 多种解决方案">​</a></h2>
<p>单点登录的实现方案，一般就包含以下三种：</p>
<ul>
<li>Cookies</li>
<li>Session 同步</li>
<li>分布式 Session 方式</li>
</ul>
<p>目前的大型网站都是采用分布式 Session 的方式。我先从 cookie 的实现谈起，你就能很清楚的知道为什 么需要分布式 session 方式实现单点登录。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="基于-cookie-的单点登录">基于 Cookie 的单点登录<a href="#基于-cookie-的单点登录" class="hash-link" aria-label="Direct link to 基于 Cookie 的单点登录" title="Direct link to 基于 Cookie 的单点登录">​</a></h3>
<p>最简单的单点登录实现方式，是使用 cookie 作为媒介，存放用户凭证。 用户登录父应用之后，应用返回 一个加密的 cookie，当用户访问子应用的时候，携带上这个 cookie，授权应用解密 cookie 并进行校验， 校验通过则登录当前用户。</p>
<p>不难发现以上方式把信任存储在客户端的 Cookie 中，这种方式很容易令人质疑：</p>
<ul>
<li>Cookie 不安全</li>
<li>不能跨域实现免登</li>
</ul>
<p>对于第一个问题，通过加密 Cookie 可以保证安全性，当然这是在源代码不泄露的前提下。如果 Cookie 的加密算法泄露，攻击者通过伪造 Cookie 则可以伪造特定用户身份，这是很危险的。 对于第二个问题，不能跨域实现免登更是硬伤。所以，才有了以下的分布式 session 方案</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="分布式-session-单点登录">分布式 session 单点登录<a href="#分布式-session-单点登录" class="hash-link" aria-label="Direct link to 分布式 session 单点登录" title="Direct link to 分布式 session 单点登录">​</a></h3>
<p>我们这次就是基于 redis 的单点登录</p>
<p>例如，阿里有很多系统分割为多个子系统，独立部署后，不可避免的会遇到会话管理的问题，类似这样 的电商网站一般采用分布式 Session 实现。 再进一步可以根据分布式 Session+redis，建立完善的单点登录或账户管理系统。</p>
<p>流程运行：</p>
<ol>
<li>用户第一次登录时，将会话信息（用户 Id 和用户信息），比如以用户 Id 为 Key，写入分布式 Session；</li>
<li>用户再次登录时，获取分布式 Session，是否有会话信息，如果没有则调到登录页</li>
<li>一般采用 Cache 中间件实现，建议使用 Redis，因此它有持久化功能，方便分布式 Session 宕机后， 可以从持久化存储中加载会话信息；</li>
<li>存入会话时，可以设置会话保持的时间，比如 15 分钟，超过后自动超时；</li>
</ol>
<p>结合 Cache 中间件实现的分布式 Session，可以很好的模拟 Session 会话。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="常见方案">常见方案<a href="#常见方案" class="hash-link" aria-label="Direct link to 常见方案" title="Direct link to 常见方案">​</a></h3>
<p>实现单点登录说到底就是要解决如何产生和存储那个信任，再就是其他系统如何验证这个信任的有效 性，</p>
<p>因此要点也就以下两个：</p>
<ul>
<li>存储信任 <del>服务器生产</del></li>
<li>验证信任 ~ 拿到服务器再次验证~</li>
</ul>
<p><strong>身份认证技术：</strong></p>
<ul>
<li>cas（单点登录）</li>
<li>Spring Security OAuth2（第三方登录授权：QQ 登陆）</li>
<li>jwt (客户端 token：原生)</li>
</ul>
<p><strong>安全控制框架：</strong></p>
<ol>
<li>spring-security</li>
<li>shiro</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="设计思路与环境">设计思路与环境<a href="#设计思路与环境" class="hash-link" aria-label="Direct link to 设计思路与环境" title="Direct link to 设计思路与环境">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="环境">环境<a href="#环境" class="hash-link" aria-label="Direct link to 环境" title="Direct link to 环境">​</a></h3>
<p>JDK 11</p>
<p>maven3.6.2</p>
<p>redis 6</p>
<p>springboot 2.x</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="设计与编写思路">设计与编写思路<a href="#设计与编写思路" class="hash-link" aria-label="Direct link to 设计与编写思路" title="Direct link to 设计与编写思路">​</a></h3>
<p>单点登录验证中心：</p>
<ul>
<li>islogin：验证是否有 token，并且设置对应 user 的限时 key</li>
<li>checklogin：检查有没有 token，没有的话就带着请求地址转发到 login 登录，如果有 token 就返回 token 给客户端做二次请求校验</li>
<li>verify： 校验 token 是否正确，返回布尔值</li>
<li>注销</li>
</ul>
<p>客户端思路：</p>
<ul>
<li>请求工具封装</li>
<li>拦截器：http 请求验证是否有登陆过，如果没有转发到检查登录</li>
<li>服务器登录完整之后会转发会客户端，拦截器判断是否有 token 参数，获取 token 请求验证中心二次验证，通过的话放行</li>
</ul>
<p>功能流程图</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/d50f646275ce286189b94f184525b1e0.png" alt="image-20220119003340402" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ss0_server-主要实现">SS0_server 主要实现<a href="#ss0_server-主要实现" class="hash-link" aria-label="Direct link to SS0_server 主要实现" title="Direct link to SS0_server 主要实现">​</a></h3>
<p><strong>客户端拦截器请求处理</strong>：</p>
<p>拦截器：请求 islogin 判断有没有登录</p>
<p>server：返回登录判断结果，如果检查到 redis 有 token 就生成对应的限时 userkey</p>
<p>拦截器：如果没有登陆过，并且 token 为 null 那么就请求 checklofin</p>
<p>server：检查没有 token，代表第一次请求转发到 login 登录并且返回携带 token 返回</p>
<p>拦截器：检测到 token 请求二次校验，</p>
<p>server:返回与 redis 和 tokenmap 的校验结果</p>
<p>拦截器：根据结果判断是否重新请求 checklogin 或者通过</p>
<p>下面代码实现上述流程的 server 处理</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="服务端核心功能">服务端核心功能<a href="#服务端核心功能" class="hash-link" aria-label="Direct link to 服务端核心功能" title="Direct link to 服务端核心功能">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="logincontroller">logincontroller<a href="#logincontroller" class="hash-link" aria-label="Direct link to logincontroller" title="Direct link to logincontroller">​</a></h4>
<ul>
<li>islogin：验证是否有 token，并且设置对应 user 的限时 key</li>
<li>checklogin：检查有没有 token，没有的话就带着请求地址转发到 login 登录，如果有 token 就返回 token 给客户端做二次请求校验</li>
<li>verify： 校验 token 是否正确，返回布尔值</li>
<li>注销</li>
</ul>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955">/**</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @projectName: SSO_self</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @package: com.hyc.sso_server.controller</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @className: loginController</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @author: 冷环渊 doomwatcher</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @description: TODO</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @date: 2022/1/9 12:44</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @version: 1.0</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token annotation punctuation" style="color:#475569">@Controller</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">class</span><span class="token plain"> loginController </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@Autowired</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token class-name" style="color:#0ea5e9">StringRedisTemplate</span><span class="token plain"> redisTemplate</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@RequestMapping</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;/index&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">login</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">return</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;login&quot;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token class-name" style="color:#0ea5e9">UserAndPassword</span><span class="token plain"> userAndPassword </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">new</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">UserAndPassword</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@RequestMapping</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;/login&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">login</span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> username</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> password</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> redirectUrl</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">RedirectAttributes</span><span class="token plain"> model</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token class-name" style="color:#0ea5e9">System</span><span class="token punctuation" style="color:#475569">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">println</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;loginuser&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#475569">+</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;\t&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#475569">+</span><span class="token plain"> username </span><span class="token operator" style="color:#475569">+</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;\t&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#475569">+</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;password&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#475569">+</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;\t&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#475569">+</span><span class="token plain"> password</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">//模拟登录数据库设计</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;admin&quot;</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">equals</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">username</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token operator" style="color:#475569">&amp;&amp;</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;123456&quot;</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">equals</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">password</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token comment" style="color:#6A9955">//校验成功</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token comment" style="color:#6A9955">//    1. 创建token</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> token </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token constant" style="color:#0f172a">UUID</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">randomUUID</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">toString</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token class-name" style="color:#0ea5e9">System</span><span class="token punctuation" style="color:#475569">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">println</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;token创建成功==&gt;&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#475569">+</span><span class="token plain"> token</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token comment" style="color:#6A9955">//    2. 需要把令牌信息收入到数据库中</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token comment" style="color:#6A9955">//if (redisTemplate.hasKey(&quot;token&quot;)) {</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token comment" style="color:#6A9955">//    redisTemplate.delete(&quot;token&quot;);</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token comment" style="color:#6A9955">//}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            redisTemplate</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">opsForSet</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">add</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;token&quot;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> token</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            userAndPassword</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">setUsername</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">username</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            userAndPassword</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">setPassword</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">password</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            userTokenMap</span><span class="token punctuation" style="color:#475569">.</span><span class="token plain">tokenmap</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">put</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">username</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> token</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token comment" style="color:#6A9955">//    3.重定向到redirecturl</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            model</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">addAttribute</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;token&quot;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> token</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            model</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">addAttribute</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;username&quot;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> username</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token class-name" style="color:#0ea5e9">System</span><span class="token punctuation" style="color:#475569">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">println</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">redirectUrl</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token keyword" style="color:#0c4a6e">return</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;redirect:&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#475569">+</span><span class="token plain"> redirectUrl</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">//如果密码不正确，重新的返回登录页面</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token class-name" style="color:#0ea5e9">System</span><span class="token punctuation" style="color:#475569">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">println</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;用户密码不正确，重复回到登录页面&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        model</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">addAttribute</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;redirectUrl&quot;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> redirectUrl</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">return</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;login&quot;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token comment" style="color:#6A9955">//检查登录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@RequestMapping</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;/checkLogin&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">checklogin</span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> redirectUrl</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">Model</span><span class="token plain"> model</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> getgenretetoken </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> userTokenMap</span><span class="token punctuation" style="color:#475569">.</span><span class="token plain">tokenmap</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">get</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">userAndPassword</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getUsername</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token class-name" style="color:#0ea5e9">Set</span><span class="token generics punctuation" style="color:#475569">&lt;</span><span class="token generics class-name" style="color:#0ea5e9">String</span><span class="token generics punctuation" style="color:#475569">&gt;</span><span class="token plain"> token </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> redisTemplate</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">opsForSet</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">members</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;token&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token operator" style="color:#475569">!</span><span class="token plain">token</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">contains</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">getgenretetoken</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token comment" style="color:#6A9955">//    没有全局会话的话 跳转带统一认证中心的登陆界面</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token comment" style="color:#6A9955">// 携带转发来的地址 一起转发回去</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            model</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">addAttribute</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;redirectUrl&quot;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> redirectUrl</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token keyword" style="color:#0c4a6e">return</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;login&quot;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token comment" style="color:#6A9955">//   全局会话 取出令牌信息 重定向到 redirecturl</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            model</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">addAttribute</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;token&quot;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> getgenretetoken</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            model</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">addAttribute</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;username&quot;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> userAndPassword</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getUsername</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token keyword" style="color:#0c4a6e">return</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;redirect:&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#475569">+</span><span class="token plain"> redirectUrl</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@RequestMapping</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;/islogin&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@ResponseBody</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">islogin</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> getgenretetoken </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> userTokenMap</span><span class="token punctuation" style="color:#475569">.</span><span class="token plain">tokenmap</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">get</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">userAndPassword</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getUsername</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token class-name" style="color:#0ea5e9">Set</span><span class="token generics punctuation" style="color:#475569">&lt;</span><span class="token generics class-name" style="color:#0ea5e9">String</span><span class="token generics punctuation" style="color:#475569">&gt;</span><span class="token plain"> token </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> redisTemplate</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">opsForSet</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">members</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;token&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token operator" style="color:#475569">!</span><span class="token plain">token</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">contains</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">getgenretetoken</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token keyword" style="color:#0c4a6e">return</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;false&quot;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> islogin </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">null</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token keyword" style="color:#0c4a6e">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">redisTemplate</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">hasKey</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">userAndPassword</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getUsername</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                islogin </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> redisTemplate</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">opsForValue</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">get</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">userAndPassword</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getUsername</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                islogin </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">valueOf</span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">RedisUtils</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">cacheValue</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">userAndPassword</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getUsername</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;true&quot;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">30</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token keyword" style="color:#0c4a6e">return</span><span class="token plain"> islogin</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token comment" style="color:#6A9955">//校验token 是否是验证中心产生</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@RequestMapping</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;/verify&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@ResponseBody</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">verifytoken</span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> token</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">redisTemplate</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">opsForSet</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">isMember</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;token&quot;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> token</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token class-name" style="color:#0ea5e9">System</span><span class="token punctuation" style="color:#475569">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">println</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;服务端token验证ok===&gt;&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#475569">+</span><span class="token plain"> token</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token keyword" style="color:#0c4a6e">return</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;true&quot;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">return</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;false&quot;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@RequestMapping</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;/loginOut&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@ResponseBody</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">loginout</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token class-name" style="color:#0ea5e9">RedisUtils</span><span class="token punctuation" style="color:#475569">.</span><span class="token plain">redisTemplate</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">delete</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;token&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token class-name" style="color:#0ea5e9">RedisUtils</span><span class="token punctuation" style="color:#475569">.</span><span class="token plain">redisTemplate</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">delete</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;islogin&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token class-name" style="color:#0ea5e9">System</span><span class="token punctuation" style="color:#475569">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">println</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;删除成功&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">return</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;注销成功&quot;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="redis-监听器">redis 监听器<a href="#redis-监听器" class="hash-link" aria-label="Direct link to redis 监听器" title="Direct link to redis 监听器">​</a></h4>
<p>检查 userkey 是否过期，redis 触发过期时间就删除对应的 token</p>
<p>配置：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token annotation punctuation" style="color:#475569">@Configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">class</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">RedisConfiguration</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@Autowired</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">private</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">RedisConnectionFactory</span><span class="token plain"> redisConnectionFactory</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token comment" style="color:#6A9955">//配置 将spring的 redis链接工厂放入监听容器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@Bean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">RedisMessageListenerContainer</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">redisMessageListenerContainer</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token class-name" style="color:#0ea5e9">RedisMessageListenerContainer</span><span class="token plain"> redisMessageListenerContainer </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">new</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">RedisMessageListenerContainer</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        redisMessageListenerContainer</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">setConnectionFactory</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">redisConnectionFactory</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">return</span><span class="token plain"> redisMessageListenerContainer</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token comment" style="color:#6A9955">//将自定义的监听器放入容器中</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@Bean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> keyexpireListener </span><span class="token function" style="color:#0e7490">keyExpiredListener</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">return</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">new</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">keyexpireListener</span><span class="token punctuation" style="color:#475569">(</span><span class="token keyword" style="color:#0c4a6e">this</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">redisMessageListenerContainer</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>自定义监听器</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955">/**</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @projectName: SSO_self</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @package: com.hyc.sso_server.Listener</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @className: keyexpireListener</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @author: 冷环渊 doomwatcher</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @description: TODO</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @date: 2022/1/11 17:30</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @version: 1.0</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">class</span><span class="token plain"> keyexpireListener </span><span class="token keyword" style="color:#0c4a6e">extends</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">KeyExpirationEventMessageListener</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token comment" style="color:#6A9955">//日志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">private</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">static</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">final</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">Logger</span><span class="token plain"> </span><span class="token constant" style="color:#0f172a">LOGGER</span><span class="token plain"> </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">LoggerFactory</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getLogger</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">keyexpireListener</span><span class="token punctuation" style="color:#475569">.</span><span class="token keyword" style="color:#0c4a6e">class</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token comment" style="color:#6A9955">/**</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955">     * @param listenerContainer must not be {@literal null}.</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">keyexpireListener</span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">RedisMessageListenerContainer</span><span class="token plain"> listenerContainer</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">super</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">listenerContainer</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token comment" style="color:#6A9955">//实现信息方法，打印监听日志，后续可能对过期key处理</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token comment" style="color:#6A9955">/*redis key 过期：pattern=__keyevent@*__:expired,channel=__keyevent@0__:expired,key=name</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955">     * 测试完毕</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955">     * */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">void</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">onMessage</span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">Message</span><span class="token plain"> message</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">byte</span><span class="token punctuation" style="color:#475569">[</span><span class="token punctuation" style="color:#475569">]</span><span class="token plain"> pattern</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> channel </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">new</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">message</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getChannel</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">StandardCharsets</span><span class="token punctuation" style="color:#475569">.</span><span class="token constant" style="color:#0f172a">UTF_8</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">//过期的key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> key </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">new</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">message</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getBody</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">StandardCharsets</span><span class="token punctuation" style="color:#475569">.</span><span class="token constant" style="color:#0f172a">UTF_8</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">//  如果登录令牌过期,则删除token 要求用户重新登录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> s </span><span class="token operator" style="color:#475569">:</span><span class="token plain"> userTokenMap</span><span class="token punctuation" style="color:#475569">.</span><span class="token plain">tokenmap</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">keySet</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token keyword" style="color:#0c4a6e">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">equals</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">s</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                </span><span class="token class-name" style="color:#0ea5e9">RedisUtils</span><span class="token punctuation" style="color:#475569">.</span><span class="token plain">redisTemplate</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">opsForSet</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">remove</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;token&quot;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> userTokenMap</span><span class="token punctuation" style="color:#475569">.</span><span class="token plain">tokenmap</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">get</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                </span><span class="token class-name" style="color:#0ea5e9">System</span><span class="token punctuation" style="color:#475569">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">println</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;删除成功&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token constant" style="color:#0f172a">LOGGER</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">info</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;redis key 过期：pattern={},channel={},key={}&quot;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">new</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">pattern</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> channel</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="客户端核心">客户端核心<a href="#客户端核心" class="hash-link" aria-label="Direct link to 客户端核心" title="Direct link to 客户端核心">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="sso-请求工具">SSO 请求工具<a href="#sso-请求工具" class="hash-link" aria-label="Direct link to SSO 请求工具" title="Direct link to SSO 请求工具">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">class</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">SSOClientUtil</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">private</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">static</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">Properties</span><span class="token plain"> ssoProperties </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">new</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">Properties</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">static</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> </span><span class="token constant" style="color:#0f172a">SERVER_URL_PREFIX</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955">//统一认证中心地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">static</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> </span><span class="token constant" style="color:#0f172a">CLIENT_HOST_URL</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955">//当前客户端地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">static</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            ssoProperties</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">load</span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">SSOClientUtil</span><span class="token punctuation" style="color:#475569">.</span><span class="token keyword" style="color:#0c4a6e">class</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getClassLoader</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getResourceAsStream</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;sso.properties&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">IOException</span><span class="token plain"> e</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            e</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">printStackTrace</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token constant" style="color:#0f172a">SERVER_URL_PREFIX</span><span class="token plain"> </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> ssoProperties</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getProperty</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;server-url-prefix&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token constant" style="color:#0f172a">CLIENT_HOST_URL</span><span class="token plain"> </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> ssoProperties</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getProperty</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;client-host-url&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token comment" style="color:#6A9955">/**</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955">     * 当客户端请求被拦截,跳往统一认证中心,需要带redirectUrl的参数,统一认证中心登录后回调的地址</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">static</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">getRedirectUrl</span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">HttpServletRequest</span><span class="token plain"> request</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">//获取请求URL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">return</span><span class="token plain"> </span><span class="token constant" style="color:#0f172a">CLIENT_HOST_URL</span><span class="token plain"> </span><span class="token operator" style="color:#475569">+</span><span class="token plain"> request</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getServletPath</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token comment" style="color:#6A9955">/**</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955">     * 根据request获取跳转到统一认证中心的地址,通过Response跳转到指定的地址</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">static</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">void</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">redirectToSSOURL</span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">HttpServletRequest</span><span class="token plain"> request</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">HttpServletResponse</span><span class="token plain"> response</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">throws</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">IOException</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> redirectUrl </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">getRedirectUrl</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token class-name" style="color:#0ea5e9">StringBuilder</span><span class="token plain"> url </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">new</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">StringBuilder</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">50</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                </span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">append</span><span class="token punctuation" style="color:#475569">(</span><span class="token constant" style="color:#0f172a">SERVER_URL_PREFIX</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                </span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">append</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;/checkLogin?redirectUrl=&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                </span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">append</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">redirectUrl</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        response</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">sendRedirect</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">toString</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">static</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">void</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">redirectToSSOURL</span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">HttpServletRequest</span><span class="token plain"> request</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">HttpServletResponse</span><span class="token plain"> response</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> token</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">throws</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">IOException</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> redirectUrl </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">getRedirectUrl</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token class-name" style="color:#0ea5e9">StringBuilder</span><span class="token plain"> url </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">new</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">StringBuilder</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">50</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                </span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">append</span><span class="token punctuation" style="color:#475569">(</span><span class="token constant" style="color:#0f172a">SERVER_URL_PREFIX</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                </span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">append</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;/checkLogin?redirectUrl=&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                </span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">append</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">redirectUrl</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                </span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">append</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;&amp;token=&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                </span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">append</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">token</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        response</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">sendRedirect</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">toString</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token comment" style="color:#6A9955">/**</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955">     * 获取客户端的完整登出地址</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">static</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">getClientLogOutUrl</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">return</span><span class="token plain"> </span><span class="token constant" style="color:#0f172a">CLIENT_HOST_URL</span><span class="token plain"> </span><span class="token operator" style="color:#475569">+</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;/loginOut&quot;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token comment" style="color:#6A9955">/**</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955">     * 获取认证中心的登出地址</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">static</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">getServerLogOutUrl</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">return</span><span class="token plain"> </span><span class="token constant" style="color:#0f172a">SERVER_URL_PREFIX</span><span class="token plain"> </span><span class="token operator" style="color:#475569">+</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;/loginOut&quot;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>对应配置文件</p>
<div class="language-properties codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-properties codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">server-url-prefix=http://www.sso.com:8001</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">client-host-url=http://www.tm.com:8003</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="http-请求工具"><strong>http 请求工具</strong><a href="#http-请求工具" class="hash-link" aria-label="Direct link to http-请求工具" title="Direct link to http-请求工具">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955">/**</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @projectName: SSO_self</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @package: com.hyc.http</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @className: HttpUitl</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @author: 冷环渊 doomwatcher</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @description: TODO</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @date: 2022/1/9 0:52</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @version: 1.0</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">class</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">HttpUitl</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">static</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">sendHttpRequest</span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> httpurl</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">Map</span><span class="token generics punctuation" style="color:#475569">&lt;</span><span class="token generics class-name" style="color:#0ea5e9">String</span><span class="token generics punctuation" style="color:#475569">,</span><span class="token generics"> </span><span class="token generics class-name" style="color:#0ea5e9">String</span><span class="token generics punctuation" style="color:#475569">&gt;</span><span class="token plain"> parms</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">throws</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">//定义需要访问的地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token class-name" style="color:#0ea5e9">URL</span><span class="token plain"> url </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">new</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">URL</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">httpurl</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">//连接 URL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token class-name" style="color:#0ea5e9">HttpURLConnection</span><span class="token plain"> connect </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">HttpURLConnection</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> url</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">openConnection</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">//请求方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        connect</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">setRequestMethod</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;POST&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">//携带参数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        connect</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">setDoOutput</span><span class="token punctuation" style="color:#475569">(</span><span class="token boolean">true</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">parms </span><span class="token operator" style="color:#475569">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">null</span><span class="token plain"> </span><span class="token operator" style="color:#475569">&amp;&amp;</span><span class="token plain"> parms</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">size</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token operator" style="color:#475569">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">0</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token class-name" style="color:#0ea5e9">StringBuffer</span><span class="token plain"> sb </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">new</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">StringBuffer</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token keyword" style="color:#0c4a6e">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">Map</span><span class="token class-name punctuation" style="color:#475569">.</span><span class="token class-name" style="color:#0ea5e9">Entry</span><span class="token generics punctuation" style="color:#475569">&lt;</span><span class="token generics class-name" style="color:#0ea5e9">String</span><span class="token generics punctuation" style="color:#475569">,</span><span class="token generics"> </span><span class="token generics class-name" style="color:#0ea5e9">String</span><span class="token generics punctuation" style="color:#475569">&gt;</span><span class="token plain"> par </span><span class="token operator" style="color:#475569">:</span><span class="token plain"> parms</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">entrySet</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                sb</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">append</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;&amp;&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">append</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">par</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getKey</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">append</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;=&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">append</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">par</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getValue</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            connect</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getOutputStream</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">write</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">sb</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">substring</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">1</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">toString</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getBytes</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;UTF-8&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">// 发起请求</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        connect</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">connect</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">//接受返回值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> response </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">StreamUtils</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">copyToString</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">connect</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getInputStream</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">Charset</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">forName</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;UTF-8&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">return</span><span class="token plain"> response</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="拦截器">拦截器<a href="#拦截器" class="hash-link" aria-label="Direct link to 拦截器" title="Direct link to 拦截器">​</a></h4>
<ul>
<li>请求校验</li>
<li>二次校验</li>
<li>拦截判断</li>
</ul>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955">/**</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @projectName: SSO_self</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @package: com.hyc.ssoclienttb.interceptor</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @className: ssoInterceptor</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @author: 冷环渊 doomwatcher</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @description: TODO</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @date: 2022/1/9 20:20</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * @version: 1.0</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">class</span><span class="token plain"> ssoInterceptor </span><span class="token keyword" style="color:#0c4a6e">implements</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">HandlerInterceptor</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">boolean</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">preHandle</span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">HttpServletRequest</span><span class="token plain"> request</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">HttpServletResponse</span><span class="token plain"> response</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">Object</span><span class="token plain"> handler</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">throws</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> httpuri </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">SSOClientUtil</span><span class="token punctuation" style="color:#475569">.</span><span class="token constant" style="color:#0f172a">SERVER_URL_PREFIX</span><span class="token plain"> </span><span class="token operator" style="color:#475569">+</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;/islogin&quot;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token class-name" style="color:#0ea5e9">HashMap</span><span class="token generics punctuation" style="color:#475569">&lt;</span><span class="token generics class-name" style="color:#0ea5e9">String</span><span class="token generics punctuation" style="color:#475569">,</span><span class="token generics"> </span><span class="token generics class-name" style="color:#0ea5e9">String</span><span class="token generics punctuation" style="color:#475569">&gt;</span><span class="token plain"> isloginparms </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">new</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">HashMap</span><span class="token generics punctuation" style="color:#475569">&lt;</span><span class="token generics punctuation" style="color:#475569">&gt;</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> islogin </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">HttpUitl</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">sendHttpRequest</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">httpuri</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> isloginparms</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">islogin</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">equals</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;true&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token keyword" style="color:#0c4a6e">return</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">//判断地址栏是否有携带token参数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> token </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getParameter</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;token&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token class-name" style="color:#0ea5e9">System</span><span class="token punctuation" style="color:#475569">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">println</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">token</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token operator" style="color:#475569">!</span><span class="token class-name" style="color:#0ea5e9">StringUtils</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">isEmpty</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">token</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token class-name" style="color:#0ea5e9">System</span><span class="token punctuation" style="color:#475569">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">println</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;检测到token信息，需要去sso服务器验证！&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token comment" style="color:#6A9955">//    token 信息不为空 说明拥有令牌，我们需要去认证中心检查这个令牌，以防伪造</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> httpURL </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">SSOClientUtil</span><span class="token punctuation" style="color:#475569">.</span><span class="token constant" style="color:#0f172a">SERVER_URL_PREFIX</span><span class="token plain"> </span><span class="token operator" style="color:#475569">+</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;/verify&quot;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token class-name" style="color:#0ea5e9">HashMap</span><span class="token generics punctuation" style="color:#475569">&lt;</span><span class="token generics class-name" style="color:#0ea5e9">String</span><span class="token generics punctuation" style="color:#475569">,</span><span class="token generics"> </span><span class="token generics class-name" style="color:#0ea5e9">String</span><span class="token generics punctuation" style="color:#475569">&gt;</span><span class="token plain"> parms </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">new</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">HashMap</span><span class="token generics punctuation" style="color:#475569">&lt;</span><span class="token generics punctuation" style="color:#475569">&gt;</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token comment" style="color:#6A9955">//放入登出的位置和token</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            parms</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">put</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;token&quot;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> token</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token keyword" style="color:#0c4a6e">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> isverify </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">HttpUitl</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">sendHttpRequest</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">httpURL</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> parms</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                </span><span class="token keyword" style="color:#0c4a6e">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;true&quot;</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">equals</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">isverify</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                    </span><span class="token comment" style="color:#6A9955">//    如果返回的字符串是true 说明这个token是由统一认证中心产生的</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                    </span><span class="token class-name" style="color:#0ea5e9">System</span><span class="token punctuation" style="color:#475569">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">println</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;检测到token信息，验证通过&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                    </span><span class="token keyword" style="color:#0c4a6e">return</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                    </span><span class="token class-name" style="color:#0ea5e9">SSOClientUtil</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">redirectToSSOURL</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> response</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                    </span><span class="token keyword" style="color:#0c4a6e">return</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">Exception</span><span class="token plain"> e</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                e</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">printStackTrace</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">//不存在用通过我们的认证工具类 转发到对应的认证界面 ssoclientuitl</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token class-name" style="color:#0ea5e9">SSOClientUtil</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">redirectToSSOURL</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> response</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">return</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="实现效果">实现效果<a href="#实现效果" class="hash-link" aria-label="Direct link to 实现效果" title="Direct link to 实现效果">​</a></h2>
<p>此时 redis 的 keys 的状态</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/1ccdb16f8807614ba283203d0725734a.png" alt="image-20220119011839039" class="img_ev3q"></p>
<p>这里我们启动三个项目</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/b4e07b41e4c5c68267959c437e749f2a.png" alt="image-20220119011906060" class="img_ev3q"></p>
<p>访问两个客户端</p>
<ul>
<li><a href="http://www.sso.com:8001/checkLogin?redirectUrl=http://www.tm.com:8003/tmall" target="_blank" rel="noopener noreferrer">http://www.sso.com:8001/checkLogin?redirectUrl=http://www.tm.com:8003/tmall</a></li>
<li><a href="http://www.sso.com:8001/checkLogin?redirectUrl=http://www.tb.com:8002/taobao" target="_blank" rel="noopener noreferrer">http://www.sso.com:8001/checkLogin?redirectUrl=http://www.tb.com:8002/taobao</a></li>
</ul>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/2b265cb94cda3d3ad9f049ee51ba1975.png" alt="image-20220119011948500" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/b611cba5f202d066c99c8f597391b41f.png" alt="image-20220119012000005" class="img_ev3q"></p>
<p>可以看出我们这两个都是没有登陆过的，接下来我们登录其中一个客户端</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/79333bd0f200e67956490e58b4186ec1.png" alt="image-20220119012057882" class="img_ev3q"></p>
<p>此时查看 redis 状态</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/9758ec0032b13d04f3eb4de6a98ab1ad.png" alt="image-20220119012106532" class="img_ev3q"></p>
<p>之后刷新另一个</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/23210df86b0bf4cf2dc28f256c9abaa2.png" alt="image-20220119012118976" class="img_ev3q"></p>
<p>会发现淘宝客户端登录之后，天猫不需要登录，也可以直接进入首页。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Java/通透百万数据秒级排序  快速排序"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">通透百万数据秒级排序  快速排序</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Java/高并发秒杀系统"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">高并发秒杀系统</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#前言" class="table-of-contents__link toc-highlight">前言</a></li><li><a href="#生活中的事情" class="table-of-contents__link toc-highlight">生活中的事情</a></li><li><a href="#什么是单点登录" class="table-of-contents__link toc-highlight">什么是单点登录</a></li><li><a href="#简谈-sso-的发展" class="table-of-contents__link toc-highlight">简谈 SSO 的发展</a><ul><li><a href="#早期的单机部署" class="table-of-contents__link toc-highlight">早期的单机部署</a></li><li><a href="#分布式集群部署" class="table-of-contents__link toc-highlight">分布式集群部署</a></li></ul></li><li><a href="#多种解决方案" class="table-of-contents__link toc-highlight">多种解决方案</a><ul><li><a href="#基于-cookie-的单点登录" class="table-of-contents__link toc-highlight">基于 Cookie 的单点登录</a></li><li><a href="#分布式-session-单点登录" class="table-of-contents__link toc-highlight">分布式 session 单点登录</a></li><li><a href="#常见方案" class="table-of-contents__link toc-highlight">常见方案</a></li></ul></li><li><a href="#设计思路与环境" class="table-of-contents__link toc-highlight">设计思路与环境</a><ul><li><a href="#环境" class="table-of-contents__link toc-highlight">环境</a></li><li><a href="#设计与编写思路" class="table-of-contents__link toc-highlight">设计与编写思路</a></li><li><a href="#ss0_server-主要实现" class="table-of-contents__link toc-highlight">SS0_server 主要实现</a></li><li><a href="#服务端核心功能" class="table-of-contents__link toc-highlight">服务端核心功能</a></li><li><a href="#客户端核心" class="table-of-contents__link toc-highlight">客户端核心</a></li></ul></li><li><a href="#实现效果" class="table-of-contents__link toc-highlight">实现效果</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">  来自冷环渊的技术支持与文档创作 @2025</div></div></div></footer></div>
</body>
</html>