<!doctype html>
<html lang="cn" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Java/SpringCloud Alibaba" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">springCloudAlibaba | 小冷の代码世界</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://doomwatcher2004.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://doomwatcher2004.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://doomwatcher2004.github.io/docs/Java/SpringCloud Alibaba"><meta data-rh="true" property="og:locale" content="cn"><meta data-rh="true" name="docusaurus_locale" content="cn"><meta data-rh="true" name="docsearch:language" content="cn"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="springCloudAlibaba | 小冷の代码世界"><meta data-rh="true" name="description" content="什么是 nacos"><meta data-rh="true" property="og:description" content="什么是 nacos"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://doomwatcher2004.github.io/docs/Java/SpringCloud Alibaba"><link data-rh="true" rel="alternate" href="https://doomwatcher2004.github.io/docs/Java/SpringCloud Alibaba" hreflang="cn"><link data-rh="true" rel="alternate" href="https://doomwatcher2004.github.io/docs/Java/SpringCloud Alibaba" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.15cbc4ab.css">
<script src="/assets/js/runtime~main.3e566960.js" defer="defer"></script>
<script src="/assets/js/main.cae173d3.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="小冷の代码世界" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="小冷の代码世界" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">小冷の代码世界</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/Java/Docker 快速入门">Java知识库</a><a class="navbar__item navbar__link" href="/docs/Web/JavaScript 高级">前端知识库</a><a class="navbar__item navbar__link" href="/docs/Godot/">Godot游戏开发</a><a class="navbar__item navbar__link" href="/docs/finish/finishRpc">Finish系列手写中间件</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Doomwatcher2004" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Docker 快速入门">Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Java 8 更新的新特性 （函数式接口 lambda stream option）">Java8 新特性</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Java后端进阶之路： JavaWeb">javaweb</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Mybatis">Mybatis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Netty+springboot实现IM即时通讯服务端">Netty+springboot实现IM即时通讯服务端</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Netty_HTTP文件列表服务器">Netty_HTTP文件列表服务器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Netty_模拟Redis的客户端">Netty_模拟Redis的客户端</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Netty网络框架">Netty 网络框架</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Nginx">Nginx</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Redis 数据结构操作入门">Redis 数据结构操作入门</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Spring Aop 底层责任链思路实现">Spring Aop 底层责任链思路实现</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Spring5 Webflux 响应式编程">Spring5 Webflux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/SpringBoot 解决企业级复杂性简化开发的神奇">微服务阶段</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/Java/SpringCloud Alibaba">springCloudAlibaba</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/SpringCloud Netflix">springcloud2020</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/Spring内置MVC框架：SpringMVC">SpringMVC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/mybatis plus">mybatis plus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/redis问题的常见解决方案">redis问题的常见解决方案</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/六道入门树题目带你走入树结构的世界">六道入门树题目带你走入树结构的世界</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/分布式项目中锁的应用（本地锁-redis【setnx】-redisson-springcache）">分布式项目中锁的应用（本地锁-redis【setnx】-redisson-springcache）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/多线程进阶 JUC并发编程">多线程进阶 JUC 并发编程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/大前端进阶（ES6）">ES6</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/快速入门RabbitMQ并且加入项目实战">快速入门RabbitMQ并且加入项目实战</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/快速入门分布式系统与Dubbo+zookeeper">分布式系统简述：</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/掌握极简服务器开发的优秀框架 ：Spring">Spring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/搜索引擎 _ Elasticsearch">Elasticsearch</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/数据结构与算法">数据结构与算法</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/理解IOC 手写springIOC">Spring 手撕 IOC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/简易aiweb">Java入门Spring AI应用开发</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/线程池详解与异步任务编排使用案例">线程池详解与异步任务编排使用案例</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/通透百万数据秒级排序  快速排序">通透百万数据秒级排序  快速排序</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/阿里淘系单点登录中心">阿里淘系单点登录中心</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Java/高并发秒杀系统">高并发秒杀系统</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">springCloudAlibaba</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>springCloudAlibaba</h1></header>
<h1>Nacos</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="什么是-nacos">什么是 nacos<a href="#什么是-nacos" class="hash-link" aria-label="Direct link to 什么是 nacos" title="Direct link to 什么是 nacos">​</a></h2>
<p>nacos (Nacos：Dynamic Naming and Configuration Service) 一个更易于构建云原生应用的动态服务发
现，配置管理和服务管理中心</p>
<p>Nacos 就是注册中心+配置中心的组合 等价于 netflix 版本的 Eureka+Config+Bus+zik</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="解决了什么痛点">解决了什么痛点<a href="#解决了什么痛点" class="hash-link" aria-label="Direct link to 解决了什么痛点" title="Direct link to 解决了什么痛点">​</a></h3>
<ul>
<li>之前我们在 netflix 版本遇到的配置需要手动的区分发信息，</li>
<li>杜绝了我们需要专门自己建一个注册中心的包，阿里给我们提供了开箱即用的发行版本，我们只需要简单的配置，直接脚本启动</li>
<li>可以直接查看到集群信息，和调用链路</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="如何获得和社区文档">如何获得和社区文档<a href="#如何获得和社区文档" class="hash-link" aria-label="Direct link to 如何获得和社区文档" title="Direct link to 如何获得和社区文档">​</a></h3>
<p><strong>下载地址 ：<a href="https://github.com/alibaba/Nacos" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/Nacos</a></strong></p>
<p><strong>中文文档地址　：<a href="https://nacos.io/zh-cn/index.html" target="_blank" rel="noopener noreferrer">https://nacos.io/zh-cn/index.html</a></strong></p>
<p><strong>官方文档地址　：<a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_nacos_discovery" target="_blank" rel="noopener noreferrer">https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_nacos_discovery</a></strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="主流注册中心对比">主流注册中心对比<a href="#主流注册中心对比" class="hash-link" aria-label="Direct link to 主流注册中心对比" title="Direct link to 主流注册中心对比">​</a></h3>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZG9vbXdhdGNoZXI=,size_20,color_FFFFFF,t_70,g_se,x_16.png" alt="在这里插入图片描述" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="安装-nacos">安装 nacos<a href="#安装-nacos" class="hash-link" aria-label="Direct link to 安装 nacos" title="Direct link to 安装 nacos">​</a></h3>
<p>环境：</p>
<ul>
<li>java 8</li>
<li>Maven</li>
</ul>
<p>解压安装包，直接运行 bin 目录下的 startup.cmd
2.xx 版本，需要修改单机版本，然后用命令启动 startup.cmd -m standalone
命令运行成功后直接访问 <a href="http://localhost:8848/nacos" target="_blank" rel="noopener noreferrer">http://localhost:8848/nacos</a>
就是这么简单
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZG9vbXdhdGNoZXI=,size_20,color_FFFFFF,t_70,g_se,x_16-16808659134053.png" alt="在这里插入图片描述" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="作为服务注册中心">作为服务注册中心<a href="#作为服务注册中心" class="hash-link" aria-label="Direct link to 作为服务注册中心" title="Direct link to 作为服务注册中心">​</a></h2>
<p>我们新建两个模块
基于 nacos 的服务提供者集群：cloudalibaba-provider-payment9001
基于 nacos 的服务提供者集群：cloudalibaba-provider-payment9002</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cloudalibaba-provider-payment9001">cloudalibaba-provider-payment9001<a href="#cloudalibaba-provider-payment9001" class="hash-link" aria-label="Direct link to cloudalibaba-provider-payment9001" title="Direct link to cloudalibaba-provider-payment9001">​</a></h3>
<p>nacos 需要的主要依赖包</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">com.alibaba.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-alibaba-nacos-discovery</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-actuator</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>核心配置文件</strong></p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">server</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">9001</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">spring</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">application</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> nacos</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">payment</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">provider</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">cloud</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token comment" style="color:#6A9955">#注册到nacos</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">nacos</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">discovery</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token key atrule">server-addr</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> localhost</span><span class="token punctuation" style="color:#475569">:</span><span class="token number" style="color:#B5CEA8">8848</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955">#配置Nacos地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">management</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">endpoints</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">web</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">exposure</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token key atrule">include</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;*&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>配置注意项</p>
<ul>
<li>一定要导入服务暴露</li>
<li>配置的时候 要加入 nacos 的地址</li>
</ul>
<p>编写一个方法测试</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token keyword" style="color:#0c4a6e">package</span><span class="token plain"> </span><span class="token namespace">com</span><span class="token namespace punctuation" style="color:#475569">.</span><span class="token namespace">atguigu</span><span class="token namespace punctuation" style="color:#475569">.</span><span class="token namespace">springcloud</span><span class="token namespace punctuation" style="color:#475569">.</span><span class="token namespace">alibaba</span><span class="token namespace punctuation" style="color:#475569">.</span><span class="token namespace">controller</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">import</span><span class="token plain"> </span><span class="token import namespace">org</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">springframework</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">beans</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">factory</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">annotation</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import class-name" style="color:#0ea5e9">Value</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">import</span><span class="token plain"> </span><span class="token import namespace">org</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">springframework</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">web</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">bind</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">annotation</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import class-name" style="color:#0ea5e9">GetMapping</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">import</span><span class="token plain"> </span><span class="token import namespace">org</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">springframework</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">web</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">bind</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">annotation</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import class-name" style="color:#0ea5e9">PathVariable</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">import</span><span class="token plain"> </span><span class="token import namespace">org</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">springframework</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">web</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">bind</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">annotation</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import class-name" style="color:#0ea5e9">RestController</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token annotation punctuation" style="color:#475569">@RestController</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">class</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">PaymentController</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@Value</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;${server.port}&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">private</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> serverPort</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@GetMapping</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">value </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;/payment/nacos/{id}&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">getPayment</span><span class="token punctuation" style="color:#475569">(</span><span class="token annotation punctuation" style="color:#475569">@PathVariable</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;id&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">Integer</span><span class="token plain"> id</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">return</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;nacos registry, serverPort: &quot;</span><span class="token operator" style="color:#475569">+</span><span class="token plain"> serverPort</span><span class="token operator" style="color:#475569">+</span><span class="token string" style="color:#64748b">&quot;\t id&quot;</span><span class="token operator" style="color:#475569">+</span><span class="token plain">id</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>主启动类加上注解</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token keyword" style="color:#0c4a6e">import</span><span class="token plain"> </span><span class="token import namespace">org</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">springframework</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">boot</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import class-name" style="color:#0ea5e9">SpringApplication</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">import</span><span class="token plain"> </span><span class="token import namespace">org</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">springframework</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">boot</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">autoconfigure</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import class-name" style="color:#0ea5e9">SpringBootApplication</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">import</span><span class="token plain"> </span><span class="token import namespace">org</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">springframework</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">cloud</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">client</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">discovery</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import class-name" style="color:#0ea5e9">EnableDiscoveryClient</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token annotation punctuation" style="color:#475569">@EnableDiscoveryClient</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token annotation punctuation" style="color:#475569">@SpringBootApplication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">class</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">PaymentMain9001</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">static</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">void</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">main</span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token punctuation" style="color:#475569">[</span><span class="token punctuation" style="color:#475569">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token class-name" style="color:#0ea5e9">SpringApplication</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">run</span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">PaymentMain9001</span><span class="token punctuation" style="color:#475569">.</span><span class="token keyword" style="color:#0c4a6e">class</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain">args</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>启动服务，就可以在 nacos 中看到我们的服务了
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZG9vbXdhdGNoZXI=,size_20,color_FFFFFF,t_70,g_se,x_16-16808659134054.png" alt="在这里插入图片描述" class="img_ev3q">
集群另一个模块 参考 9001 的编写方式</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="作为服务配置中心">作为服务配置中心<a href="#作为服务配置中心" class="hash-link" aria-label="Direct link to 作为服务配置中心" title="Direct link to 作为服务配置中心">​</a></h2>
<p>我们来建一个 demo 来体验一下，nacos 的动态配置
配置模块 ：cloudalibaba-config-nacos-client3377</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="基础配置">基础配置<a href="#基础配置" class="hash-link" aria-label="Direct link to 基础配置" title="Direct link to 基础配置">​</a></h3>
<p>导入需要的 jar 包</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token comment" style="color:#6A9955">&lt;!--nacos-config--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">com.alibaba.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-alibaba-nacos-config</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token comment" style="color:#6A9955">&lt;!--nacos-discovery--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">com.alibaba.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-alibaba-nacos-discovery</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token comment" style="color:#6A9955">&lt;!--web + actuator--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-actuator</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token comment" style="color:#6A9955">&lt;!--一般基础配置--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-devtools</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">runtime</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.projectlombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">lombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-test</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">test</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>编写配置文件
这里引入一个概念</p>
<p>bootstrap 的启动优先级比 application 高
为了确保我们的 nacos 上的配置被加载成功</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">server</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">3377</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">spring</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">application</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> nacos</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">config</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">client</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">cloud</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">nacos</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">discovery</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token key atrule">server-addr</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> localhost</span><span class="token punctuation" style="color:#475569">:</span><span class="token number" style="color:#B5CEA8">8848</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955">#服务注册中心地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">config</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token key atrule">server-addr</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> localhost</span><span class="token punctuation" style="color:#475569">:</span><span class="token number" style="color:#B5CEA8">8848</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955">#配置中心地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token key atrule">file-extension</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> yaml </span><span class="token comment" style="color:#6A9955">#指定yaml格式的配置</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>编写一个查看测试信息的 controller</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token keyword" style="color:#0c4a6e">package</span><span class="token plain"> </span><span class="token namespace">com</span><span class="token namespace punctuation" style="color:#475569">.</span><span class="token namespace">atguigu</span><span class="token namespace punctuation" style="color:#475569">.</span><span class="token namespace">springcloud</span><span class="token namespace punctuation" style="color:#475569">.</span><span class="token namespace">alibaba</span><span class="token namespace punctuation" style="color:#475569">.</span><span class="token namespace">controller</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">import</span><span class="token plain"> </span><span class="token import namespace">org</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">springframework</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">beans</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">factory</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">annotation</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import class-name" style="color:#0ea5e9">Value</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">import</span><span class="token plain"> </span><span class="token import namespace">org</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">springframework</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">cloud</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">context</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">config</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">annotation</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import class-name" style="color:#0ea5e9">RefreshScope</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">import</span><span class="token plain"> </span><span class="token import namespace">org</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">springframework</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">web</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">bind</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">annotation</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import class-name" style="color:#0ea5e9">GetMapping</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">import</span><span class="token plain"> </span><span class="token import namespace">org</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">springframework</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">web</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">bind</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import namespace">annotation</span><span class="token import namespace punctuation" style="color:#475569">.</span><span class="token import class-name" style="color:#0ea5e9">RestController</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token annotation punctuation" style="color:#475569">@RestController</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token annotation punctuation" style="color:#475569">@RefreshScope</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">class</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">ConfigClientController</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@Value</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;${config.info}&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">private</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> configInfo</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@GetMapping</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;/config/info&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">getConfigInfo</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">return</span><span class="token plain"> configInfo</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>RefreshScope</code> 我们可以使用 cloud 的原生注解，来实现动态查看配置刷新，</p>
<p><strong>创建一个 nacos 上的配置</strong>
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZG9vbXdhdGNoZXI=,size_20,color_FFFFFF,t_70,g_se,x_16-16808659134055.png" alt="在这里插入图片描述" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-中的配置规则">nacos 中的配置规则<a href="#nacos-中的配置规则" class="hash-link" aria-label="Direct link to nacos 中的配置规则" title="Direct link to nacos 中的配置规则">​</a></h3>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZG9vbXdhdGNoZXI=,size_20,color_FFFFFF,t_70,g_se,x_16-16808659134066.png" alt="在这里插入图片描述" class="img_ev3q">
之后启动就可以在 nacos 上更改配置了</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-配置持久化">nacos 配置持久化<a href="#nacos-配置持久化" class="hash-link" aria-label="Direct link to nacos 配置持久化" title="Direct link to nacos 配置持久化">​</a></h2>
<p>我们可以试验一下，配置都时候 nacos 是自带了一个嵌入式数据库 derby
我们这里可以修改设置，到自己的 mysql 上
先去 nacos 的文件夹中找到，nacos 的 sql 的脚本
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZG9vbXdhdGNoZXI=,size_20,color_FFFFFF,t_70,g_se,x_16-16808659134067.png" alt="在这里插入图片描述" class="img_ev3q">
导入到 mysql 中 创建一个数据库 nacos_config
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/e05e4c0e8c1b4b1b8d74854bc37ac02d.png" alt="在这里插入图片描述" class="img_ev3q">
之后找到 application 文件
修改配置</p>
<div class="language-properties codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-properties codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">spring.datasource.platform=mysql</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">db.num=1</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">db.url.0=jdbc:mysql://127.0.0.1:3306/nacos_config_tmall?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;serverTimezone=UTC</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">db.user=root</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">db.password=root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>之后启动 nacos ，就会看到全新的 naocs 我们之后再创建的各种配置，就会保存在我们自己创建的数据库中</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="小结">小结<a href="#小结" class="hash-link" aria-label="Direct link to 小结" title="Direct link to 小结">​</a></h2>
<p>使用过 Eureka 之后，使用 nacos，感受到 nacos 是十分优秀的一款注册中心，我们可以快速启动，省去了很多的配置，这个技术简化了我们想要使用注册中心和动态配置查看链路需要的繁琐配置，</p>
<h1>Sentinel</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sentinel-是什么">Sentinel 是什么<a href="#sentinel-是什么" class="hash-link" aria-label="Direct link to Sentinel 是什么" title="Direct link to Sentinel 是什么">​</a></h2>
<p>独立于项目外的 服务流量控制台，可以用于熔断 防止服务崩溃无响应，服务重启，流量限制等
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZG9vbXdhdGNoZXI=,size_20,color_FFFFFF,t_70,g_se,x_16-16808659134068.png" alt="在这里插入图片描述" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="能做什么-针对于什么场景">能做什么 针对于什么场景<a href="#能做什么-针对于什么场景" class="hash-link" aria-label="Direct link to 能做什么 针对于什么场景" title="Direct link to 能做什么 针对于什么场景">​</a></h2>
<p><strong>sentinel 给我们带来的服务</strong></p>
<ul>
<li>Sentinel 独立于项目外，开箱即用</li>
<li>控制台可以可视化的实时监控和服务规则配置</li>
<li>可以无缝配合 cloud 的注册中心 最佳匹配 nacos，也可以使用其他的如 Eureka apollo zookeeper 等</li>
</ul>
<p><strong>解决了什么场景问题</strong></p>
<ul>
<li>服务雪崩</li>
<li>服务降级</li>
<li>服务熔断</li>
<li>服务限流</li>
</ul>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZG9vbXdhdGNoZXI=,size_20,color_FFFFFF,t_70,g_se,x_16-16808659134069.png" alt="在这里插入图片描述" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="如何获取">如何获取<a href="#如何获取" class="hash-link" aria-label="Direct link to 如何获取" title="Direct link to 如何获取">​</a></h2>
<p>下载地址 ：<a href="https://github.com/alibaba/Sentinel/releases" target="_blank" rel="noopener noreferrer">sentinel 下载地址</a>
文档地址 ：<a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_sentinel" target="_blank" rel="noopener noreferrer">sentinel 文档地址</a></p>
<p>Sentinel 组件由两部分组成</p>
<ul>
<li>使用 sentinel 的服务</li>
<li>sentinel 的服务控制台</li>
</ul>
<p>安装环境我们只需要有 java 8 以上就可以了
下载完成之后，直接运行 java -jar 启动查看即可
<code>java -jar sentinel-dashboard-1.7.0.jar </code></p>
<p>我们只需要访问 默认的启动端口就可以看到 sentinel 的控制台了
账号和密码均为 ：sentinel</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="演示工程-8401">演示工程 8401<a href="#演示工程-8401" class="hash-link" aria-label="Direct link to 演示工程 8401" title="Direct link to 演示工程 8401">​</a></h2>
<p>我们主要以介绍 sentinel 实战，对于演示工程，选核心部分展示
核心依赖</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">com.alibaba.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-alibaba-nacos-discovery</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">com.alibaba.csp</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">sentinel-datasource-nacos</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">com.alibaba.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-alibaba-sentinel</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>演示项目配置</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">server</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">8401</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">spring</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">application</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> cloudalibaba</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">sentinel</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">cloud</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">nacos</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">discovery</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token key atrule">server-addr</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> localhost</span><span class="token punctuation" style="color:#475569">:</span><span class="token number" style="color:#B5CEA8">8848</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">sentinel</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">transport</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token key atrule">dashboard</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> localhost</span><span class="token punctuation" style="color:#475569">:</span><span class="token number" style="color:#B5CEA8">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">8719</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955">#默认8719，假如被占用了会自动从8719开始依次+1扫描。直至找到未被占用的端口</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">management</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">endpoints</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">web</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">exposure</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token key atrule">include</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;*&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>编写一个 controller 来演示</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token annotation punctuation" style="color:#475569">@RestController</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">class</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">FlowLimitController</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@GetMapping</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;/testA&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">testA</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">return</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;------testA&quot;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@GetMapping</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;/testB&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">testB</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">return</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;------testB&quot;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>之后启动 nacos 和 sentinel 这个时候你访问 sentinel 会发现什么也没有
<strong>为什么？</strong>
应为 sentinel 是懒加载的，我们访问其中一个方法，就会在 sentinel 中看到我们项目
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZG9vbXdhdGNoZXI=,size_20,color_FFFFFF,t_70,g_se,x_16-168086591340610.png" alt="在这里插入图片描述" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="流控规则">流控规则<a href="#流控规则" class="hash-link" aria-label="Direct link to 流控规则" title="Direct link to 流控规则">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="基础流控">基础流控<a href="#基础流控" class="hash-link" aria-label="Direct link to 基础流控" title="Direct link to 基础流控">​</a></h3>
<p>我们可以看到面板
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZG9vbXdhdGNoZXI=,size_20,color_FFFFFF,t_70,g_se,x_16-168086591340611.png" alt="在这里插入图片描述" class="img_ev3q"></p>
<ul>
<li>
<p>资源名:唯一名称，默认请求路径</p>
</li>
<li>
<p>针对来源: Sentinel 可以针对调用者进行限流，填写微服务名，默认 default (不区分来源)阈值类型/单机阈值:</p>
</li>
<li>
<p>QPs(每秒钟的请求数量):当调用该 api 的 QPS 达到阈值的时候，进行限流。线程数:当调用该 api 的线程数达到阈值的时候，进行限流</p>
</li>
<li>
<p>是否集群:不需要集群</p>
</li>
<li>
<p>流控模式:</p>
<ul>
<li>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">直接: api达到限流条件时，直接限流</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">关联:当关联的资源达到阈值时，就限流自己</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">链路:只记录指定链路上的流量（指定资源从入口资源进来的流量，如果达到阈值，就进行限流)【api级别的针对来源】</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
</li>
<li>
<p>流控效果:</p>
<ul>
<li>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">快速失败:直接失败，抛异常</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">Warm Up:根据codeFactor (冷加载因子，默认3)的值，从阈值codeFactor，经过预热时长，才达到设置的QPS阈值</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">排队等待:匀速排队，让请求以匀速的速度通过，阈值类型必须设置为QPS，否则无效</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="直接失败">直接失败<a href="#直接失败" class="hash-link" aria-label="Direct link to 直接失败" title="Direct link to 直接失败">​</a></h3>
<p>快速失败，配置如下：</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZG9vbXdhdGNoZXI=,size_20,color_FFFFFF,t_70,g_se,x_16-168086591340612.png" alt="在这里插入图片描述" class="img_ev3q"></p>
<p>之后我们快速访问 testa 就会发现 Blocked by Sentinel (flow limiting)
触发了 sentinel 的默认提示
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/e9d658779b6143659b6117de07914978.png" alt="在这里插入图片描述" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="关联">关联<a href="#关联" class="hash-link" aria-label="Direct link to 关联" title="Direct link to 关联">​</a></h3>
<p>当关联的资源达到阈值时，就限流自己
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZG9vbXdhdGNoZXI=,size_20,color_FFFFFF,t_70,g_se,x_16-168086591340713.png" alt="在这里插入图片描述" class="img_ev3q">
只要我们访问 b 超过了 qps a 就会把自己限流</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="高级配置">高级配置<a href="#高级配置" class="hash-link" aria-label="Direct link to 高级配置" title="Direct link to 高级配置">​</a></h2>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="预热-warm-up">预热 Warm Up<a href="#预热-warm-up" class="hash-link" aria-label="Direct link to 预热 Warm Up" title="Direct link to 预热 Warm Up">​</a></h4>
<p>**Warm Up ( RuleConstant.CONTROL_BEHAVIOR_UARM_uP）**方式，即预热/冷启动方式。当系统长期处于低水位的情况下，当流量突然增加时，直接把系统拉升到高水位可能瞬间把系统压垮。通过&quot;冷启动”，让通过的流量缓慢增加，在一定时间内逐渐增加到阈值上限，给冷系统一个预热的时间，避免冷系统被压垮。详细文档可以参考流量控制-Warm Up 文档，具体的例子可以参见
WarmUpFlowDemo。</p>
<p>公式：阈值除以 coldFactor（默认值为 3），经过预热时长后才会达到阈值
默认 coldFactor 为 3，即请求 QPS 从 threshold/3 开始，经预热时长逐渐升至设定的 QPS 阈值。</p>
<p><strong>适合应用场景</strong>
大量数据情况 ： 如秒杀
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZG9vbXdhdGNoZXI=,size_20,color_FFFFFF,t_70,g_se,x_16-168086591340714.png" alt="在这里插入图片描述" class="img_ev3q">
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZG9vbXdhdGNoZXI=,size_20,color_FFFFFF,t_70,g_se,x_16-168086591340715.png" alt="在这里插入图片描述" class="img_ev3q">
这里设置好之后，我们去访问，会发现，当到了阈值之后，慢慢的还是可以访问，直到 10</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="排队等待">排队等待<a href="#排队等待" class="hash-link" aria-label="Direct link to 排队等待" title="Direct link to 排队等待">​</a></h3>
<p>匀速排队
匀速排队（ RuleConstant.CONTROL_BEHAVIOR_RATE_LTIMITER）方式会严格控制请求通过的间隔时间，也即是让请求以均匀的速度通过，对应的是漏桶算法。详细文档可以参考流星控制–匀速器模式，具体的例子可以参见 PaceFlowDemo。
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZG9vbXdhdGNoZXI=,size_20,color_FFFFFF,t_70,g_se,x_16-168086591340716.png" alt="在这里插入图片描述" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZG9vbXdhdGNoZXI=,size_20,color_FFFFFF,t_70,g_se,x_16-168086591340717.png" alt="在这里插入图片描述" class="img_ev3q">
匀速排队，阈值必须设置为 QPS
在一定时间内，逐渐处理进入到的请求，而不是第一时间拒绝请求</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>Sentinel 这个控制台，十分到强大，给我们带来了很多很多可以使用的服务规则，我们这里主要介绍了流控，这只是 Sentinel 的冰山一角，</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/e1d805c249874b15b0aa7d84553bc971.png" alt="在这里插入图片描述" class="img_ev3q"></p>
<p>Sentinel 可以看到，还有很多模块可以根据不同的场景和需求是了解，
天道酬勤，我们一起进步吧</p>
<h1>Seata 处理分布式事务</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="分布式问题的出现">分布式问题的出现<a href="#分布式问题的出现" class="hash-link" aria-label="Direct link to 分布式问题的出现" title="Direct link to 分布式问题的出现">​</a></h2>
<p>出现分不是之前 ：单机单库没这个问题
出现分布式之后
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZG9vbXdhdGNoZXI=,size_19,color_FFFFFF,t_70,g_se,x_16.png" alt="在这里插入图片描述" class="img_ev3q">
我们分开的模块，原来模块都有独立的数据源，那么我如何保证一致性呢？
一次业务操作需要跨多个数据源或需要跨多个系统进行远程调用，就会产生分布式事务问题
这个时候就需要一套解决方案，那么 seata 营运而生</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="seata-简介">Seata 简介<a href="#seata-简介" class="hash-link" aria-label="Direct link to Seata 简介" title="Direct link to Seata 简介">​</a></h2>
<p>Seata 是一款开源的分布式事务解决方案，致力于在微服务架构下提供高性能和简单易用的分布式事务服务
官网地址 ：<a href="http://seata.io/zh-cn/" target="_blank" rel="noopener noreferrer">http://seata.io/zh-cn/</a>
下载地址 ：<a href="https://github.com/seata/seata/releases" target="_blank" rel="noopener noreferrer">https://github.com/seata/seata/releases</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="seata-能给我们带来什么">Seata 能给我们带来什么<a href="#seata-能给我们带来什么" class="hash-link" aria-label="Direct link to Seata 能给我们带来什么" title="Direct link to Seata 能给我们带来什么">​</a></h2>
<p>先介绍一下 seata 的三个核心组件和一个全局 id</p>
<ul>
<li>全局唯一的事务 ID 当开启事务就会生成 xid，凭借这个 id 来标识是哪个事务</li>
</ul>
<p>三个组件</p>
<ul>
<li>Transaction Coordinator(TC) ：事务协调器，维护全局事务的运行状态，负责协调并驱动全局事务的提交或回滚;</li>
<li>Transaction Manager(TM) ： 控制全局事务的边界，负责开启一个全局事务，并最终发起全局提交或全局回滚的决议;</li>
<li>Resource Manager(RM) : 控制分支事务，负责分支注册，状态汇报，并接收事务协调器的指令，驱动分支（本地）事务的提交和回滚；</li>
</ul>
<p>举个例子 ： 一个典型的分布式事务过程</p>
<ul>
<li>TM 向 TC 申请开启一个全局事务，</li>
<li>全局事务创建成功并生成一个全局唯一的 XID;XID 在微服务调用链路的上下文中传播;</li>
<li>RM 向 TC 注册分支事务，将其纳入 XID 对应全局事务的管辖;</li>
<li>TM 向 TC 发起针对 XID 的全局提交或回滚决议;</li>
<li>TC 调度 XID 下管辖的全部分支事务完成提交或回滚请求。
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZG9vbXdhdGNoZXI=,size_20,color_FFFFFF,t_70,g_se,x_16-168086591340718.png" alt="在这里插入图片描述" class="img_ev3q"></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="seata-安装和配置">seata 安装和配置<a href="#seata-安装和配置" class="hash-link" aria-label="Direct link to seata 安装和配置" title="Direct link to seata 安装和配置">​</a></h2>
<p>我们首先需要有的环境</p>
<ul>
<li>java 8</li>
<li>mysql
演示版本为 0.9 版本， 1.0 之后有变化，有升级需求查看官方文档升级</li>
</ul>
<p>下载完成之后，进入到 config 文件夹中</p>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZG9vbXdhdGNoZXI=,size_20,color_FFFFFF,t_70,g_se,x_16-168086591340719.png" alt="在这里插入图片描述" class="img_ev3q">
我们可以创建副本吗，避免修改玩坏了，
这里我们配置 file 先
找到 service 模块 自定义名字</p>
<blockquote>
<p>vgroup_mapping.fsp_tx_group = &quot;default&quot;</p>
</blockquote>
<p>store 模块</p>
<blockquote>
<p>mode = &quot;db&quot;
url = &quot;jdbc:mysql://127.0.0.1:3306/seata&quot;
user = &quot;root&quot;
password = &quot;你自己的密码&quot;</p>
</blockquote>
<p>配置玩之后，我们去配置 registry.conf,配置自己 nacos 的相关信息</p>
<blockquote>
<p>registry { # file 、nacos 、eureka、redis、zk、consul、etcd3、sofa
type = &quot;nacos&quot;
nacos {
serverAddr = &quot;localhost:8848&quot;
namespace = &quot;&quot;
cluster = &quot;default&quot;
}</p>
</blockquote>
<p>之后去 数据库中 导入 seata 的数据库脚本
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/41b99d692ea54d42ba9a3c1cb58b732f.png" alt="在这里插入图片描述" class="img_ev3q">
启动即可</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="演示示例">演示示例<a href="#演示示例" class="hash-link" aria-label="Direct link to 演示示例" title="Direct link to 演示示例">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="准备环境">准备环境<a href="#准备环境" class="hash-link" aria-label="Direct link to 准备环境" title="Direct link to 准备环境">​</a></h3>
<p>创建三个库</p>
<ul>
<li>seata_order: 存储订单的数据库</li>
<li>seata_storage:存储库存的数据库</li>
<li>seata_account: 存储账户信息的数据库</li>
</ul>
<p>建库 sql</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token keyword" style="color:#0c4a6e">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DATABASE</span><span class="token plain"> seata_order；</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DATABASE</span><span class="token plain"> seata_storage；</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DATABASE</span><span class="token plain"> seata_account；</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>seata_order 库下建 t_order 表</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token keyword" style="color:#0c4a6e">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">TABLE</span><span class="token plain"> t_order</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">BIGINT</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">11</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token operator" style="color:#475569">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">AUTO_INCREMENT</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">KEY</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">BIGINT</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">11</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;用户id&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">product_id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">BIGINT</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">11</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;产品id&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">count</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">INT</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">11</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;数量&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">money</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DECIMAL</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">11</span><span class="token punctuation" style="color:#475569">,</span><span class="token number" style="color:#B5CEA8">0</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;金额&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">status</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">INT</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">1</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;订单状态：0：创建中; 1：已完结&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">ENGINE</span><span class="token operator" style="color:#475569">=</span><span class="token keyword" style="color:#0c4a6e">INNODB</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">AUTO_INCREMENT</span><span class="token operator" style="color:#475569">=</span><span class="token number" style="color:#B5CEA8">7</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">CHARSET</span><span class="token operator" style="color:#475569">=</span><span class="token plain">utf8</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#475569">*</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">FROM</span><span class="token plain"> t_order</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>seata_storage 库下建 t_storage 表</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token keyword" style="color:#0c4a6e">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">TABLE</span><span class="token plain"> t_storage</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">BIGINT</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">11</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token operator" style="color:#475569">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">AUTO_INCREMENT</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">KEY</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">product_id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">BIGINT</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">11</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;产品id&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">total</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">INT</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">11</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;总库存&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">used</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">INT</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">11</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;已用库存&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">residue</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">INT</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">11</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;剩余库存&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">ENGINE</span><span class="token operator" style="color:#475569">=</span><span class="token keyword" style="color:#0c4a6e">INNODB</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">AUTO_INCREMENT</span><span class="token operator" style="color:#475569">=</span><span class="token number" style="color:#B5CEA8">2</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">CHARSET</span><span class="token operator" style="color:#475569">=</span><span class="token plain">utf8</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">INTO</span><span class="token plain"> seata_storage</span><span class="token punctuation" style="color:#475569">.</span><span class="token plain">t_storage</span><span class="token punctuation" style="color:#475569">(</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">,</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">product_id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">,</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">total</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">,</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">used</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">,</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">residue</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">VALUES</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&#x27;1&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token string" style="color:#64748b">&#x27;1&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token string" style="color:#64748b">&#x27;100&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token string" style="color:#64748b">&#x27;0&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token string" style="color:#64748b">&#x27;100&#x27;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#475569">*</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">FROM</span><span class="token plain"> t_storage</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>seata_account 库下建 t_account 表</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token keyword" style="color:#0c4a6e">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">TABLE</span><span class="token plain"> t_account</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">BIGINT</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">11</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token operator" style="color:#475569">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">AUTO_INCREMENT</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">KEY</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;id&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">BIGINT</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">11</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;用户id&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">total</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DECIMAL</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">10</span><span class="token punctuation" style="color:#475569">,</span><span class="token number" style="color:#B5CEA8">0</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;总额度&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">used</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DECIMAL</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">10</span><span class="token punctuation" style="color:#475569">,</span><span class="token number" style="color:#B5CEA8">0</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;已用余额&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">residue</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DECIMAL</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">10</span><span class="token punctuation" style="color:#475569">,</span><span class="token number" style="color:#B5CEA8">0</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;0&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;剩余可用额度&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">ENGINE</span><span class="token operator" style="color:#475569">=</span><span class="token keyword" style="color:#0c4a6e">INNODB</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">AUTO_INCREMENT</span><span class="token operator" style="color:#475569">=</span><span class="token number" style="color:#B5CEA8">2</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">CHARSET</span><span class="token operator" style="color:#475569">=</span><span class="token plain">utf8</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">INTO</span><span class="token plain"> seata_account</span><span class="token punctuation" style="color:#475569">.</span><span class="token plain">t_account</span><span class="token punctuation" style="color:#475569">(</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">,</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">user_id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">,</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">total</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">,</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">used</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">,</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">residue</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">VALUES</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&#x27;1&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token string" style="color:#64748b">&#x27;1&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token string" style="color:#64748b">&#x27;1000&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token string" style="color:#64748b">&#x27;0&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token string" style="color:#64748b">&#x27;1000&#x27;</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#475569">*</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">FROM</span><span class="token plain"> t_account</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>之后在三个数据库 创建 undo_log 表</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token keyword" style="color:#0c4a6e">drop</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">table</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">undo_log</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">undo_log</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">bigint</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">20</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token operator" style="color:#475569">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">AUTO_INCREMENT</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">branch_id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">bigint</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">20</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token operator" style="color:#475569">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">xid</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">varchar</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">100</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token operator" style="color:#475569">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">context</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">varchar</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">128</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token operator" style="color:#475569">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">rollback_info</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">longblob</span><span class="token plain"> </span><span class="token operator" style="color:#475569">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">log_status</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">int</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">11</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token operator" style="color:#475569">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">log_created</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">datetime</span><span class="token plain"> </span><span class="token operator" style="color:#475569">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">log_modified</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">datetime</span><span class="token plain"> </span><span class="token operator" style="color:#475569">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">ext</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">varchar</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">100</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token keyword" style="color:#0c4a6e">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token keyword" style="color:#0c4a6e">UNIQUE</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">KEY</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">ux_undo_log</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">xid</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">,</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token identifier">branch_id</span><span class="token identifier punctuation" style="color:#475569">`</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">ENGINE</span><span class="token operator" style="color:#475569">=</span><span class="token keyword" style="color:#0c4a6e">InnoDB</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">AUTO_INCREMENT</span><span class="token operator" style="color:#475569">=</span><span class="token number" style="color:#B5CEA8">1</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">CHARSET</span><span class="token operator" style="color:#475569">=</span><span class="token plain">utf8</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>最终效果
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZG9vbXdhdGNoZXI=,size_10,color_FFFFFF,t_70,g_se,x_16.png" alt="在这里插入图片描述" class="img_ev3q"></p>
<p>之后构建三个模块</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="新建订单-order-module">新建订单 Order-Module<a href="#新建订单-order-module" class="hash-link" aria-label="Direct link to 新建订单 Order-Module" title="Direct link to 新建订单 Order-Module">​</a></h3>
<p>引入依赖</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!--nacos--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">com.alibaba.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-alibaba-nacos-discovery</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!--seata--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">com.alibaba.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-alibaba-seata</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">exclusions</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">exclusion</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">seata-all</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                    </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">io.seata</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">                </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">exclusion</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">exclusions</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">io.seata</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">seata-all</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">0.9.0</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!--feign--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-cloud-starter-openfeign</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!--web-actuator--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-actuator</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">&lt;!--mysql-druid--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">mysql</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">mysql-connector-java</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">5.1.37</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">com.alibaba</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">druid-spring-boot-starter</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">1.1.10</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.mybatis.spring.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">mybatis-spring-boot-starter</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">2.0.0</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">version</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">spring-boot-starter-test</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">test</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">scope</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">org.projectlombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">groupId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">lombok</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">artifactId</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">            </span><span class="token tag punctuation" style="color:#475569">&lt;</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">optional</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependency</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token tag punctuation" style="color:#475569">&lt;/</span><span class="token tag" style="color:#0ea5e9">dependencies</span><span class="token tag punctuation" style="color:#475569">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>配置文件</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">server</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">2001</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">spring</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">application</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> seata</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">order</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">cloud</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">alibaba</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">seata</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">#自定义事务组名称需要与seata-server中的对应</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token key atrule">tx-service-group</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> fsp_tx_group</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">nacos</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">discovery</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token key atrule">server-addr</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> localhost</span><span class="token punctuation" style="color:#475569">:</span><span class="token number" style="color:#B5CEA8">8848</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">datasource</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">driver-class-name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> com.mysql.jdbc.Driver</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">url</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> jdbc</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">mysql</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">3306/seata_order</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">username</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">password</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">1111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">feign</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">hystrix</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">logging</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">level</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">io</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">seata</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> info</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">mybatis</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">mapperLocations</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> classpath</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">mapper/</span><span class="token important">*.xml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>之后将 <code>.file.conf</code>和<code>registry.conf</code>两个文件放入到项目 resource 文件夹中
创建实体类
这里业务类我们使用的是 openfeign 来作为调用的组件</p>
<ul>
<li>OrderService</li>
</ul>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">interface</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">OrderService</span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">void</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">create</span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">Order</span><span class="token plain"> order</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>实现类
这里我们使用
<code>@GlobalTransactional(name = &quot;fsp-create-order&quot;,rollbackFor = Exception.class)</code>开启全局注解</p>
<p>name 是我们的事务名字
之后回掉方法是异常 class</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token annotation punctuation" style="color:#475569">@Service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token annotation punctuation" style="color:#475569">@Slf4j</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">class</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">OrderServiceImpl</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">implements</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">OrderService</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@Resource</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">private</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">OrderDao</span><span class="token plain"> orderDao</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@Resource</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">private</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">StorageService</span><span class="token plain"> storageService</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@Resource</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">private</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">AccountService</span><span class="token plain"> accountService</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token comment" style="color:#6A9955">/**</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955">     * 创建订单-&gt;调用库存服务扣减库存-&gt;调用账户服务扣减账户余额-&gt;修改订单状态</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@GlobalTransactional</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">name </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;fsp-create-order&quot;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain">rollbackFor </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">Exception</span><span class="token punctuation" style="color:#475569">.</span><span class="token keyword" style="color:#0c4a6e">class</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">void</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">create</span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">Order</span><span class="token plain"> order</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        log</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">info</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;-----&gt;开始新建订单&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">//新建订单</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        orderDao</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">create</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">order</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">//扣减库存</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        log</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">info</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;-----&gt;订单微服务开始调用库存，做扣减Count&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        storageService</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">decrease</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">order</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getProductId</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain">order</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getCount</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        log</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">info</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;-----&gt;订单微服务开始调用库存，做扣减end&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">//扣减账户</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        log</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">info</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;-----&gt;订单微服务开始调用账户，做扣减Money&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        accountService</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">decrease</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">order</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getUserId</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain">order</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getMoney</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        log</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">info</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;-----&gt;订单微服务开始调用账户，做扣减end&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token comment" style="color:#6A9955">//修改订单状态，从零到1代表已经完成</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        log</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">info</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;-----&gt;修改订单状态开始&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        orderDao</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">update</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">order</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getUserId</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">,</span><span class="token number" style="color:#B5CEA8">0</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        log</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">info</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;-----&gt;修改订单状态结束&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        log</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">info</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;-----&gt;下订单结束了&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>StorageService</li>
</ul>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token annotation punctuation" style="color:#475569">@FeignClient</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">value </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;seata-storage-service&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">interface</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">StorageService</span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">   </span><span class="token annotation punctuation" style="color:#475569">@PostMapping</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">value </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;/storage/decrease&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">   </span><span class="token class-name" style="color:#0ea5e9">CommonResult</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">decrease</span><span class="token punctuation" style="color:#475569">(</span><span class="token annotation punctuation" style="color:#475569">@RequestParam</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;productId&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">Long</span><span class="token plain"> productId</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token annotation punctuation" style="color:#475569">@RequestParam</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;count&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">Integer</span><span class="token plain"> count</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>AccountService</li>
</ul>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token annotation punctuation" style="color:#475569">@FeignClient</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">value </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;seata-account-service&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">interface</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">AccountService</span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">   </span><span class="token annotation punctuation" style="color:#475569">@PostMapping</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">value </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;/account/decrease&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">   </span><span class="token class-name" style="color:#0ea5e9">CommonResult</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">decrease</span><span class="token punctuation" style="color:#475569">(</span><span class="token annotation punctuation" style="color:#475569">@RequestParam</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;userId&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">Long</span><span class="token plain"> userId</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token annotation punctuation" style="color:#475569">@RequestParam</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;money&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">BigDecimal</span><span class="token plain"> money</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>MyBatisConfig</li>
</ul>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token annotation punctuation" style="color:#475569">@Configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token annotation punctuation" style="color:#475569">@MapperScan</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">{</span><span class="token string" style="color:#64748b">&quot;com.atguigu.springcloud.alibaba.dao&quot;</span><span class="token punctuation" style="color:#475569">}</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">class</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">MyBatisConfig</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>DataSourceProxyConfig（配置 seata 的代理，）</li>
</ul>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token annotation punctuation" style="color:#475569">@Configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">class</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">DataSourceProxyConfig</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@Value</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;${mybatis.mapperLocations}&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">private</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">String</span><span class="token plain"> mapperLocations</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@Bean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@ConfigurationProperties</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">prefix </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;spring.datasource&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">DataSource</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">druidDataSource</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">return</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">new</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">DruidDataSource</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@Bean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">DataSourceProxy</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">dataSourceProxy</span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">DataSource</span><span class="token plain"> dataSource</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">return</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">new</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">DataSourceProxy</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">dataSource</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@Bean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">SqlSessionFactory</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">sqlSessionFactoryBean</span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">DataSourceProxy</span><span class="token plain"> dataSourceProxy</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">throws</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token class-name" style="color:#0ea5e9">SqlSessionFactoryBean</span><span class="token plain"> sqlSessionFactoryBean </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">new</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">SqlSessionFactoryBean</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        sqlSessionFactoryBean</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">setDataSource</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">dataSourceProxy</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        sqlSessionFactoryBean</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">setMapperLocations</span><span class="token punctuation" style="color:#475569">(</span><span class="token keyword" style="color:#0c4a6e">new</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">PathMatchingResourcePatternResolver</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getResources</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">mapperLocations</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        sqlSessionFactoryBean</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">setTransactionFactory</span><span class="token punctuation" style="color:#475569">(</span><span class="token keyword" style="color:#0c4a6e">new</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">SpringManagedTransactionFactory</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">return</span><span class="token plain"> sqlSessionFactoryBean</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getObject</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="新建库存-storage-module">新建库存 Storage-Module<a href="#新建库存-storage-module" class="hash-link" aria-label="Direct link to 新建库存 Storage-Module" title="Direct link to 新建库存 Storage-Module">​</a></h3>
<p>pom 基本一致，就不重复复制了，直接上配置</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">server</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">2002</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">spring</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">application</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> seata</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">storage</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">cloud</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">alibaba</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">seata</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token key atrule">tx-service-group</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> fsp_tx_group</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">nacos</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">discovery</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token key atrule">server-addr</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> localhost</span><span class="token punctuation" style="color:#475569">:</span><span class="token number" style="color:#B5CEA8">8848</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">datasource</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">driver-class-name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> com.mysql.jdbc.Driver</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">url</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> jdbc</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">mysql</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">3306/seata_storage</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">username</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">password</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">logging</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">level</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">io</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">seata</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> info</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">mybatis</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">mapperLocations</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> classpath</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">mapper/</span><span class="token important">*.xml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>之后将 <code>.file.conf</code>和<code>registry.conf</code>两个文件放入到项目 resource 文件夹中
这里就略过实体类了，直接实现类，主要感受 seata 带来的事务</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token annotation punctuation" style="color:#475569">@Service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">class</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">StorageServiceImpl</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">implements</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">StorageService</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">private</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">static</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">final</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">Logger</span><span class="token plain"> </span><span class="token constant" style="color:#0f172a">LOGGER</span><span class="token plain"> </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">LoggerFactory</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getLogger</span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">StorageServiceImpl</span><span class="token punctuation" style="color:#475569">.</span><span class="token keyword" style="color:#0c4a6e">class</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@Resource</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">private</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">StorageDao</span><span class="token plain"> storageDao</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">     </span><span class="token comment" style="color:#6A9955">// 扣减库存</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">void</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">decrease</span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">Long</span><span class="token plain"> productId</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">Integer</span><span class="token plain"> count</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token constant" style="color:#0f172a">LOGGER</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">info</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;-------&gt;storage-service中扣减库存开始&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        storageDao</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">decrease</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">productId</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain">count</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token constant" style="color:#0f172a">LOGGER</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">info</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;-------&gt;storage-service中扣减库存结束&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如下两个配置与模块一一致</p>
<ul>
<li>MyBatisConfig</li>
<li>DataSourceProxyConfig</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="新建账户-account-module">新建账户 Account-Module<a href="#新建账户-account-module" class="hash-link" aria-label="Direct link to 新建账户 Account-Module" title="Direct link to 新建账户 Account-Module">​</a></h3>
<p>配置文件</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token key atrule">server</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">2003</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">spring</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">application</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> seata</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">account</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">cloud</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">alibaba</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">seata</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token key atrule">tx-service-group</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> fsp_tx_group</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">nacos</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">discovery</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token key atrule">server-addr</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> localhost</span><span class="token punctuation" style="color:#475569">:</span><span class="token number" style="color:#B5CEA8">8848</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">datasource</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">driver-class-name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> com.mysql.jdbc.Driver</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">url</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> jdbc</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">mysql</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">3306/seata_account</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">username</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">password</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">1111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">feign</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">hystrix</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">logging</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">level</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token key atrule">io</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token key atrule">seata</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> info</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token key atrule">mybatis</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token key atrule">mapperLocations</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> classpath</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">mapper/</span><span class="token important">*.xml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>之后将 <code>.file.conf</code>和<code>registry.conf</code>两个文件放入到项目 resource 文件夹中</p>
<p>实现类</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955">/**</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> * 账户业务实现类</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token annotation punctuation" style="color:#475569">@Service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">class</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">AccountServiceImpl</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">implements</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">AccountService</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">private</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">static</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">final</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">Logger</span><span class="token plain"> </span><span class="token constant" style="color:#0f172a">LOGGER</span><span class="token plain"> </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">LoggerFactory</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">getLogger</span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">AccountServiceImpl</span><span class="token punctuation" style="color:#475569">.</span><span class="token keyword" style="color:#0c4a6e">class</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@Resource</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token class-name" style="color:#0ea5e9">AccountDao</span><span class="token plain"> accountDao</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token comment" style="color:#6A9955">/**</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955">     * 扣减账户余额</span><br></span><span class="token-line" style="color:#0f172a"><span class="token comment" style="color:#6A9955">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#475569">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">public</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">void</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">decrease</span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">Long</span><span class="token plain"> userId</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">BigDecimal</span><span class="token plain"> money</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">         </span><span class="token constant" style="color:#0f172a">LOGGER</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">info</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;-------&gt;account-service中扣减账户余额开始&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token keyword" style="color:#0c4a6e">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">TimeUnit</span><span class="token punctuation" style="color:#475569">.</span><span class="token constant" style="color:#0f172a">SECONDS</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">sleep</span><span class="token punctuation" style="color:#475569">(</span><span class="token number" style="color:#B5CEA8">20</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token class-name" style="color:#0ea5e9">InterruptedException</span><span class="token plain"> e</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"> e</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">printStackTrace</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        accountDao</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">decrease</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">userId</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain">money</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token constant" style="color:#0f172a">LOGGER</span><span class="token punctuation" style="color:#475569">.</span><span class="token function" style="color:#0e7490">info</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&quot;-------&gt;account-service中扣减账户余额结束&quot;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这里我们设置超时，之后去创建订单，看看是否成功</p>
<p><a href="http://localhost:2001/order/create?userId=1&amp;productId=1&amp;count=10&amp;money=100" target="_blank" rel="noopener noreferrer">http://localhost:2001/order/create?userId=1&amp;productId=1&amp;count=10&amp;money=100</a>
我们会发现，数据库没变化，出现超时异常，立刻就回滚了</p>
<p>当我们把超时代码注释，再次创建订单，数据库的值就变化了
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/4fe7de7ff4fa41dfb3e958864f97e1a7.png" alt="在这里插入图片描述" class="img_ev3q">
只是配置了一下，添加了个全局事务注解，就可以实现分布式事务了，这其中 seata 做了什么呢？</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="seata-原理">seata 原理<a href="#seata-原理" class="hash-link" aria-label="Direct link to seata 原理" title="Direct link to seata 原理">​</a></h2>
<p>分布式事务的执行流程</p>
<ul>
<li>TM 开启分布式事务(TM 向 TC 注册全局事务记录)</li>
<li>换业务场景，编排数据库，服务等事务内资源（RM 向 TC 汇报资源准备状态）</li>
<li>TM 结束分布式事务，事务一阶段结束（TM 通知 TC 提交/回滚分布式事务）</li>
<li>TC 汇总事务信息，决定分布式事务是提交还是回滚</li>
<li>TC 通知所有 RM 提交/回滚资源，事务二阶段结束。</li>
</ul>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZG9vbXdhdGNoZXI=,size_20,color_FFFFFF,t_70,g_se,x_16-168086591340720.png" alt="在这里插入图片描述" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="seata-的几种模式">seata 的几种模式<a href="#seata-的几种模式" class="hash-link" aria-label="Direct link to seata 的几种模式" title="Direct link to seata 的几种模式">​</a></h3>
<p><strong>AT 模式如何做到对业务的无侵入</strong>
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZG9vbXdhdGNoZXI=,size_20,color_FFFFFF,t_70,g_se,x_16-168086591340821.png" alt="在这里插入图片描述" class="img_ev3q">
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZG9vbXdhdGNoZXI=,size_20,color_FFFFFF,t_70,g_se,x_16-168086591340822.png" alt="在这里插入图片描述" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="一阶段">一阶段<a href="#一阶段" class="hash-link" aria-label="Direct link to 一阶段" title="Direct link to 一阶段">​</a></h3>
<p>在一阶段，Seata 会拦截“业务 SQL”,</p>
<ol>
<li>解析 SQL 语义，找到“业务 SQL”要更新的业务数据，在业务数据被更新前，将其保存成“before image&#x27;</li>
<li>执行“业务 SQL”更新业务数据，在业务数据更新之后，</li>
<li>其保存成“after image”，最后生成行锁。</li>
</ol>
<p>以上操作全部在一个数据库事务内完成，这样保证了一阶段操作的原子性。
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZG9vbXdhdGNoZXI=,size_20,color_FFFFFF,t_70,g_se,x_16-168086591340823.png" alt="在这里插入图片描述" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="二阶段">二阶段<a href="#二阶段" class="hash-link" aria-label="Direct link to 二阶段" title="Direct link to 二阶段">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="提交">提交<a href="#提交" class="hash-link" aria-label="Direct link to 提交" title="Direct link to 提交">​</a></h4>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZG9vbXdhdGNoZXI=,size_20,color_FFFFFF,t_70,g_se,x_16-168086591340824.png" alt="在这里插入图片描述" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="回滚">回滚<a href="#回滚" class="hash-link" aria-label="Direct link to 回滚" title="Direct link to 回滚">​</a></h4>
<p>二阶段如果是回滚的话，Seata 就需要回滚一阶段已经执行的“业务 SQL”，还原业务数据。
回滚方式便是用“before image”还原业务数据;但在还原前要首先要校验脏写，对比“数据库当前业务数据”和“after image&quot;如果两份数据完全一致就说明没有脏写，可以还原业务数据，如果不一致就说明有脏写，出现脏写就需要转人工处理。
<img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZG9vbXdhdGNoZXI=,size_20,color_FFFFFF,t_70,g_se,x_16-168086591340825.png" alt="在这里插入图片描述" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="完整过程流程图">完整过程流程图<a href="#完整过程流程图" class="hash-link" aria-label="Direct link to 完整过程流程图" title="Direct link to 完整过程流程图">​</a></h3>
<p><img decoding="async" loading="lazy" src="http://img.doomwatcher.cn/img/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAZG9vbXdhdGNoZXI=,size_20,color_FFFFFF,t_70,g_se,x_16-168086591340826.png" alt="在这里插入图片描述" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结-1">总结<a href="#总结-1" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>seata 分布式事务解决方案，我们微服务的事务发生了质变，原本只有单机和单数据源，开启事务
而多个数据源多个模块的事务开启，seata 回去寻找在一个事务里的数据源，拦截 sql 去做一系列的处理
解决了单机单数据源一致性的业务痛点。 一个字 猛！</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Java/SpringBoot 解决企业级复杂性简化开发的神奇"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">微服务阶段</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Java/SpringCloud Netflix"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">springcloud2020</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#什么是-nacos" class="table-of-contents__link toc-highlight">什么是 nacos</a><ul><li><a href="#解决了什么痛点" class="table-of-contents__link toc-highlight">解决了什么痛点</a></li><li><a href="#如何获得和社区文档" class="table-of-contents__link toc-highlight">如何获得和社区文档</a></li><li><a href="#主流注册中心对比" class="table-of-contents__link toc-highlight">主流注册中心对比</a></li><li><a href="#安装-nacos" class="table-of-contents__link toc-highlight">安装 nacos</a></li></ul></li><li><a href="#作为服务注册中心" class="table-of-contents__link toc-highlight">作为服务注册中心</a><ul><li><a href="#cloudalibaba-provider-payment9001" class="table-of-contents__link toc-highlight">cloudalibaba-provider-payment9001</a></li></ul></li><li><a href="#作为服务配置中心" class="table-of-contents__link toc-highlight">作为服务配置中心</a><ul><li><a href="#基础配置" class="table-of-contents__link toc-highlight">基础配置</a></li><li><a href="#nacos-中的配置规则" class="table-of-contents__link toc-highlight">nacos 中的配置规则</a></li></ul></li><li><a href="#nacos-配置持久化" class="table-of-contents__link toc-highlight">nacos 配置持久化</a></li><li><a href="#小结" class="table-of-contents__link toc-highlight">小结</a></li><li><a href="#sentinel-是什么" class="table-of-contents__link toc-highlight">Sentinel 是什么</a></li><li><a href="#能做什么-针对于什么场景" class="table-of-contents__link toc-highlight">能做什么 针对于什么场景</a></li><li><a href="#如何获取" class="table-of-contents__link toc-highlight">如何获取</a></li><li><a href="#演示工程-8401" class="table-of-contents__link toc-highlight">演示工程 8401</a></li><li><a href="#流控规则" class="table-of-contents__link toc-highlight">流控规则</a><ul><li><a href="#基础流控" class="table-of-contents__link toc-highlight">基础流控</a></li><li><a href="#直接失败" class="table-of-contents__link toc-highlight">直接失败</a></li><li><a href="#关联" class="table-of-contents__link toc-highlight">关联</a></li></ul></li><li><a href="#高级配置" class="table-of-contents__link toc-highlight">高级配置</a><ul><li><a href="#预热-warm-up" class="table-of-contents__link toc-highlight">预热 Warm Up</a></li><li><a href="#排队等待" class="table-of-contents__link toc-highlight">排队等待</a></li></ul></li><li><a href="#总结" class="table-of-contents__link toc-highlight">总结</a></li><li><a href="#分布式问题的出现" class="table-of-contents__link toc-highlight">分布式问题的出现</a></li><li><a href="#seata-简介" class="table-of-contents__link toc-highlight">Seata 简介</a></li><li><a href="#seata-能给我们带来什么" class="table-of-contents__link toc-highlight">Seata 能给我们带来什么</a></li><li><a href="#seata-安装和配置" class="table-of-contents__link toc-highlight">seata 安装和配置</a></li><li><a href="#演示示例" class="table-of-contents__link toc-highlight">演示示例</a><ul><li><a href="#准备环境" class="table-of-contents__link toc-highlight">准备环境</a></li><li><a href="#新建订单-order-module" class="table-of-contents__link toc-highlight">新建订单 Order-Module</a></li><li><a href="#新建库存-storage-module" class="table-of-contents__link toc-highlight">新建库存 Storage-Module</a></li><li><a href="#新建账户-account-module" class="table-of-contents__link toc-highlight">新建账户 Account-Module</a></li></ul></li><li><a href="#seata-原理" class="table-of-contents__link toc-highlight">seata 原理</a><ul><li><a href="#seata-的几种模式" class="table-of-contents__link toc-highlight">seata 的几种模式</a></li><li><a href="#一阶段" class="table-of-contents__link toc-highlight">一阶段</a></li><li><a href="#二阶段" class="table-of-contents__link toc-highlight">二阶段</a><ul><li><a href="#提交" class="table-of-contents__link toc-highlight">提交</a></li><li><a href="#回滚" class="table-of-contents__link toc-highlight">回滚</a></li></ul></li><li><a href="#完整过程流程图" class="table-of-contents__link toc-highlight">完整过程流程图</a></li></ul></li><li><a href="#总结-1" class="table-of-contents__link toc-highlight">总结</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">  来自冷环渊的技术支持与文档创作 @2025</div></div></div></footer></div>
</body>
</html>