"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1602],{1806:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>d,default:()=>g,frontMatter:()=>t,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"Java/\u9ad8\u5e76\u53d1\u79d2\u6740\u7cfb\u7edf","title":"\u9ad8\u5e76\u53d1\u79d2\u6740\u7cfb\u7edf","description":"\u5206\u6790\u9700\u6c42","source":"@site/docs/Java/\u9ad8\u5e76\u53d1\u79d2\u6740\u7cfb\u7edf.md","sourceDirName":"Java","slug":"/Java/\u9ad8\u5e76\u53d1\u79d2\u6740\u7cfb\u7edf","permalink":"/docs/Java/\u9ad8\u5e76\u53d1\u79d2\u6740\u7cfb\u7edf","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"JavaSidebar","previous":{"title":"\u963f\u91cc\u6dd8\u7cfb\u5355\u70b9\u767b\u5f55\u4e2d\u5fc3","permalink":"/docs/Java/\u963f\u91cc\u6dd8\u7cfb\u5355\u70b9\u767b\u5f55\u4e2d\u5fc3"}}');var o=n(4848),i=n(8453);const t={},d="\u9ad8\u5e76\u53d1\u79d2\u6740\u7cfb\u7edf",l={},c=[{value:"\u5206\u6790\u9700\u6c42",id:"\u5206\u6790\u9700\u6c42",level:2},{value:"\u79d2\u6740\u7cfb\u7edf",id:"\u79d2\u6740\u7cfb\u7edf",level:2},{value:"\u6280\u672f\u9009\u578b",id:"\u6280\u672f\u9009\u578b",level:3},{value:"\u6570\u636e\u5e93\u8868\u8bbe\u8ba1",id:"\u6570\u636e\u5e93\u8868\u8bbe\u8ba1",level:3},{value:"\u9879\u76ee\u914d\u7f6e\u6587\u4ef6",id:"\u9879\u76ee\u914d\u7f6e\u6587\u4ef6",level:3},{value:"\u5546\u54c1\u5217\u8868",id:"\u5546\u54c1\u5217\u8868",level:3},{value:"\u79d2\u6740\u5546\u54c1",id:"\u79d2\u6740\u5546\u54c1",level:3},{value:"\u76f4\u63a5\u5904\u7406",id:"\u76f4\u63a5\u5904\u7406",level:4},{value:"\u4e8b\u52a1\u5904\u7406",id:"\u4e8b\u52a1\u5904\u7406",level:4},{value:"\u4e3e\u4e00\u53cd\u4e09",id:"\u4e3e\u4e00\u53cd\u4e09",level:4},{value:"\u751f\u6210\u8ba2\u5355",id:"\u751f\u6210\u8ba2\u5355",level:3},{value:"\u6d41\u7a0b\u5c55\u793a",id:"\u6d41\u7a0b\u5c55\u793a",level:2},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function a(e){const r={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.header,{children:(0,o.jsx)(r.h1,{id:"\u9ad8\u5e76\u53d1\u79d2\u6740\u7cfb\u7edf",children:"\u9ad8\u5e76\u53d1\u79d2\u6740\u7cfb\u7edf"})}),"\n",(0,o.jsx)(r.h2,{id:"\u5206\u6790\u9700\u6c42",children:"\u5206\u6790\u9700\u6c42"}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"\u573a\u666f\u5206\u6790"}),"\n"]}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"\u79d2\u6740\u65f6\u5927\u91cf\u7528\u6237\u4f1a\u5728\u540c\u4e00\u65f6\u95f4\u540c\u65f6\u8fdb\u884c\u62a2\u8d2d\uff0c\u7f51\u7ad9\u77ac\u65f6\u8bbf\u95ee\u6d41\u91cf\u6fc0\u589e\u3002"}),"\n",(0,o.jsx)(r.li,{children:"\u79d2\u6740\u4e00\u822c\u662f\u8bbf\u95ee\u8bf7\u6c42\u6570\u91cf\u8fdc\u8fdc\u5927\u4e8e\u5e93\u5b58\u6570\u91cf\uff0c\u53ea\u6709\u5c11\u90e8\u5206\u7528\u6237\u80fd\u591f\u79d2\u6740\u6210\u529f\u3002"}),"\n",(0,o.jsx)(r.li,{children:"\u79d2\u6740\u4e1a\u52a1\u6d41\u7a0b\u6bd4\u8f83\u7b80\u5355\uff0c\u4e00\u822c\u5c31\u662f\u4e0b\u8ba2\u5355\u51cf\u5e93\u5b58\u3002"}),"\n"]}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"\u95ee\u9898\u5206\u6790"}),"\n"]}),"\n",(0,o.jsx)(r.p,{children:"\u79d2\u6740\u7cfb\u7edf\u4e00\u822c\u8981\u6ce8\u610f\u7684\u95ee\u9898\u5c31\u662f :"}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsx)(r.li,{children:"\u5e93\u5b58\u5c11\u5356\uff0c\u8d85\u5356\u95ee\u9898\uff08\u539f\u5b50\u6027\uff09"}),"\n",(0,o.jsx)(r.li,{children:"\u6d41\u91cf\u524a\u5cf0\uff0c\u8fd9\u91cc\u6211\u4eec\u8bbe\u5b9a\u7684\u65f6\u5019\u6bcf\u4e2a\u7528\u6237\u53ea\u80fd\u79d2\u6740\u4e00\u6b21\u6240\u4ee5\u6bd4\u8f83\u597d\u5904\u7406"}),"\n"]}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"\u6267\u884c\u6d41\u7a0b"}),"\n"]}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"\u521d\u59cb\u5316\u6570\u636e\uff0c\u63d0\u524d\u9884\u70ed\u8981\u79d2\u6740\u7684\u5546\u54c1\uff08\u9879\u76ee\u91cc\u8bbe\u7f6e\u4e3a\u542f\u52a8\uff0c\u5982\u679c\u79d2\u6740\u5217\u8868\u6709\u5c31\u9884\u70ed\uff09"}),"\n",(0,o.jsx)(r.li,{children:"\u4f7f\u7528 redis \u7f13\u5b58\u79d2\u6740\u7684\u5546\u54c1\u4fe1\u606f\uff0c\u4f7f\u7528 redis \u6765\u627f\u62c5\u79d2\u6740\u7684\u538b\u529b\u6700\u540e\u751f\u4ea7\u79d2\u6740\u5230\u7684\u7528\u6237\uff0c\u518d\u5230 mysql \u751f\u6210\u8ba2\u5355"}),"\n",(0,o.jsx)(r.li,{children:"\u5728\u79d2\u6740\u65f6\u4f7f\u7528\uff08\u4e8b\u52a1\uff0c\u5206\u5e03\u5f0f\u9501\u4e24\u79cd\u65b9\u5f0f\u90fd\u5b9e\u73b0\uff09\u5bf9\u5546\u54c1\u5e93\u5b58\uff0c\u4fdd\u8bc1\u539f\u5b50\u6027"}),"\n"]}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"\u8bbe\u8ba1\u601d\u8def\u56fe"}),"\n"]}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.img,{src:"http://img.doomwatcher.cn/img/d2b648c95b6ddb7e71fad594ce58db0d.png",alt:"image-20220308165057681"})}),"\n",(0,o.jsx)(r.h2,{id:"\u79d2\u6740\u7cfb\u7edf",children:"\u79d2\u6740\u7cfb\u7edf"}),"\n",(0,o.jsx)(r.h3,{id:"\u6280\u672f\u9009\u578b",children:"\u6280\u672f\u9009\u578b"}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.strong,{children:"\u5f00\u53d1\u8bed\u8a00 : Java 8 \u6216 Java 11"})}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.strong,{children:"\u6846\u67b6\u6280\u672f\uff1a SpringBoot2.x \uff0cMybatis-plus \uff0cThymeleaf"})}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.strong,{children:"\u4e2d\u95f4\u4ef6\uff1a Redis"})}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.strong,{children:"\u6570\u636e\u5e93\uff1aMySQL 8.0"})}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.strong,{children:"\u6570\u636e\u6e90\uff1a druid 1.16"})}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.strong,{children:"\u6d4b\u8bd5\u5de5\u5177\uff1a apache jmeter"})}),"\n",(0,o.jsx)(r.h3,{id:"\u6570\u636e\u5e93\u8868\u8bbe\u8ba1",children:"\u6570\u636e\u5e93\u8868\u8bbe\u8ba1"}),"\n",(0,o.jsx)(r.p,{children:"\u4e09\u5f20\u8868\uff0c\u5206\u522b\u662f"}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsx)(r.li,{children:"\u5546\u54c1\u8868\uff1a id \u5546\u54c1 id \u5546\u54c1 name \u5546\u54c1\u56fe\u7247 \u5546\u54c1\u7c7b\u522b \u5546\u54c1\u4ef7\u683c \u5e93\u5b58"}),"\n",(0,o.jsx)(r.li,{children:"\u79d2\u6740\u5546\u54c1\u8868 \uff1a id \u5546\u54c1 id \u79d2\u6740\u5f00\u59cb\u65f6\u95f4 \u79d2\u6740\u7ed3\u675f\u65f6\u95f4 \u79d2\u6740\u4ef7 \u53ef\u79d2\u6740\u7684\u6570\u91cf"}),"\n",(0,o.jsx)(r.li,{children:"\u8ba2\u5355\u8868 id \u8ba2\u5355 id \u5546\u54c1 id \u79d2\u6740\u4ef7\u683c \u7528\u6237 id \u5730\u5740 \u7535\u8bdd"}),"\n"]}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"sql \u8868"}),"\n"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-sql",children:"CREATE DATABASE /*!32312 IF NOT EXISTS*/`seckill` /*!40100 DEFAULT CHARACTER SET utf8 */\r\n\r\nUSE `seckill`;\r\n\r\nDROP TABLE IF EXISTS `goods`;\r\n\r\nCREATE TABLE `goods` (\r\n  `id` int NOT NULL AUTO_INCREMENT,\r\n  `goods_id` varchar(100) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT '\u5546\u54c1id',\r\n  `goods_name` varchar(100) DEFAULT NULL COMMENT '\u5546\u54c1\u540d\u5b57',\r\n  `goodtype` varchar(100) DEFAULT NULL COMMENT '\u5546\u54c1\u7c7b\u522b',\r\n  `price` double DEFAULT NULL COMMENT '\u5546\u54c1\u4ef7\u683c',\r\n  `img_path` varchar(200) DEFAULT NULL COMMENT '\u5546\u54c1\u56fe\u7247\u5730\u5740',\r\n  PRIMARY KEY (`id`)\r\n) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8mb3;\r\n\r\n/*Data for the table `goods` */\r\n\r\ninsert  into `goods`(`id`,`goods_id`,`goods_name`,`goodtype`,`price`,`img_path`) values\r\n\r\n(5,'1001','\u534e\u4e3a\u624b\u673a','\u7535\u5b50\u7528\u54c1',5000,'/img/huaweiphone.jpg');\r\n\r\n/*Table structure for table `goodsorder` */\r\n\r\nDROP TABLE IF EXISTS `goodsorder`;\r\n\r\nCREATE TABLE `goodsorder` (\r\n  `id` int NOT NULL AUTO_INCREMENT,\r\n  `order_id` varchar(100) DEFAULT NULL,\r\n  `user_id` varchar(100) DEFAULT NULL,\r\n  `goods_id` varchar(100) DEFAULT NULL,\r\n  `telephone` varchar(20) DEFAULT NULL,\r\n  `address` varchar(100) DEFAULT NULL,\r\n  PRIMARY KEY (`id`)\r\n) ENGINE=InnoDB AUTO_INCREMENT=10 DEFAULT CHARSET=utf8mb3;\r\n\r\n/*Data for the table `goodsorder` */\r\n\r\n/*Table structure for table `seckillgoods` */\r\n\r\nDROP TABLE IF EXISTS `seckillgoods`;\r\n\r\nCREATE TABLE `seckillgoods` (\r\n  `id` bigint NOT NULL AUTO_INCREMENT,\r\n  `goods_id` varchar(100) DEFAULT NULL,\r\n  `seckill_price` double DEFAULT NULL COMMENT '\u79d2\u6740\u4ef7\u683c',\r\n  `stock_num` int DEFAULT NULL COMMENT '\u79d2\u6740\u5e93\u5b58',\r\n  `start_time` datetime DEFAULT NULL COMMENT '\u5f00\u59cb\u65f6\u95f4',\r\n  `end_time` datetime DEFAULT NULL COMMENT '\u7ed3\u675f\u65f6\u95f4',\r\n  PRIMARY KEY (`id`)\r\n) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb3;\r\n\r\n/*Data for the table `seckillgoods` */\r\n\r\ninsert  into `seckillgoods`(`id`,`goods_id`,`seckill_price`,`stock_num`,`start_time`,`end_time`) values\r\n\r\n(1,'1001',3599,10,'2022-03-07 00:00:00','2022-03-09 00:00:00');\r\n\r\n\n"})}),"\n",(0,o.jsx)(r.h3,{id:"\u9879\u76ee\u914d\u7f6e\u6587\u4ef6",children:"\u9879\u76ee\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.code,{children:"application.yml"})}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-xml",children:"spring:\r\n  datasource:\r\n    username: root\r\n    password: root\r\n    url: jdbc:mysql://localhost:3306/seckill?\t\t userSSL=true&useUnicode=true&characterEncoding=utf-8&serverTimezone=GMT%2B8\r\n    driver-class-name: com.mysql.cj.jdbc.Driver\r\n  redis:\r\n    database: 0\r\n    host: 120.79.14.203\r\n    port: 6379\r\n    password: root\r\n    timeout: 1000\r\n\r\n  thymeleaf:\r\n    cache: false\r\n    prefix: classpath:/templates/\r\n    suffix: .html\r\n\r\nmybatis-plus:\r\n  configuration:\r\n    map-underscore-to-camel-case: false\r\n    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl\r\n  #  configuration:\r\n  #    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl\r\n  mapper-locations: classpath:mapper/*\r\n\r\n\n"})}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"redis \u914d\u7f6e\u7c7b"}),"\n"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-java",children:"@Configuration\r\npublic class RedisConfig {\r\n    /**\r\n     * @author \u51b7\u73af\u6e0a Doomwatcher\r\n     * @context:redis \u5b58\u50a8\u6570\u636e \u5e8f\u5217\u5316\u65b9\u5f0f\r\n     * @date: 2022/3/7 21:19\r\n     * @param redisConnectionFactory\r\n     * @return: org.springframework.data.redis.core.RedisTemplate<java.lang.String, java.lang.Object>\r\n     */\r\n    @Bean\r\n    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory\r\n                                                               redisConnectionFactory) {\r\n        RedisTemplate<String, Object> redisTemplate = new RedisTemplate<>();\r\n        redisTemplate.setConnectionFactory(redisConnectionFactory);\r\n\r\n        //\u58f0\u660e key \u548c value \u7684\u5e8f\u5217\u5316\u65b9\u5f0f\r\n        StringRedisSerializer keySerializer = new StringRedisSerializer();\r\n        GenericFastJsonRedisSerializer valueSerializer = new GenericFastJsonRedisSerializer();\r\n        redisTemplate.setKeySerializer(keySerializer);\r\n        redisTemplate.setValueSerializer(valueSerializer);\r\n        redisTemplate.setHashKeySerializer(keySerializer);\r\n        redisTemplate.setValueSerializer(valueSerializer);\r\n\r\n        //\u591a\u79cd\u7684\u5e8f\u5217\u5316\u65b9\u5f0f \u6700\u597d\u662f\u8c01\u5e8f\u5217\u5316\u7684\u8c01\u5904\u7406\r\n        //GenericFastJsonRedisSerializer\r\n        //Jackson2JsonRedisSerializer\r\n        return redisTemplate;\r\n    }\r\n}\n"})}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"redis \u5de5\u5177\u7c7b"}),"\n"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-java",children:"package com.hyc.seckillsystem.util;\r\n\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.data.redis.core.RedisTemplate;\r\nimport org.springframework.data.redis.core.SessionCallback;\r\nimport org.springframework.data.redis.core.script.RedisScript;\r\nimport org.springframework.stereotype.Component;\r\n\r\nimport java.util.List;\r\nimport java.util.concurrent.TimeUnit;\r\n\r\n/**\r\n * @projectName: seckillsystem\r\n * @package: com.hyc.seckillsystem.util\r\n * @className: RedisUtil\r\n * @author: \u51b7\u73af\u6e0a doomwatcher\r\n * @description: TODO\r\n * @date: 2022/3/7 21:25\r\n * @version: 1.0\r\n */\r\n@Component\r\npublic class RedisUtil {\r\n    @Autowired\r\n    private RedisTemplate<String, Object> redisTemplate;\r\n\r\n    //    \u8bbe\u7f6e\u7f13\u5b58\r\n    public void set(String key, Object value) {\r\n        redisTemplate.opsForValue().set(key, value);\r\n    }\r\n//\u8bbe\u7f6e\u7f13\u5b58\u548c\u8d85\u65f6\u65f6\u95f4\r\n    public void set(String key, Object value, long timeout) {\r\n        redisTemplate.opsForValue().set(key, value, timeout, TimeUnit.SECONDS);\r\n    }\r\n\r\n    //\u83b7\u53d6\u547d\u4e2dkey \u7684\u5185\u5bb9\r\n    public Object get(String key) {\r\n        if (!redisTemplate.hasKey(key)) {\r\n            return null;\r\n        }\r\n        return redisTemplate.opsForValue().get(key);\r\n    }\r\n\r\n    //\u9012\u51cf\u64cd\u4f5c\r\n    public void decr(String key) {\r\n        redisTemplate.opsForValue().decrement(key);\r\n    }\r\n\r\n    //\u89e6\u53d1 \u63d0\u4ea4 \u53c2\u6570\u91cc\u7684sessionCallback \u961f\u5217\u91cc\u7684\u547d\u4ee4\r\n    public Object execute(SessionCallback sessionCallback) {\r\n        return redisTemplate.execute(sessionCallback);\r\n    }\r\n\r\n    // \u4f7f\u7528\u811a\u672c\u8bed\u8a00\r\n    public Object execute(RedisScript script, List keylist) {\r\n        return redisTemplate.execute(script, keylist);\r\n    }\r\n// \u662f\u5426\u5b58\u5728 key\r\n    public boolean hasKey(String key) {\r\n        return redisTemplate.hasKey(key);\r\n    }\r\n}\r\n\n"})}),"\n",(0,o.jsx)(r.h3,{id:"\u5546\u54c1\u5217\u8868",children:"\u5546\u54c1\u5217\u8868"}),"\n",(0,o.jsx)(r.p,{children:"\u5546\u54c1\u5217\u8868\u754c\u9762\uff0c\u662f\u6bd4\u8f83\u7b80\u5355\u7684\uff0c\u8bbe\u8ba1\u601d\u8def\u8fd8\u662f\u57fa\u4e8e\u4f20\u7edf\u7684\u4e09\u5c42\u5f00\u53d1"}),"\n",(0,o.jsxs)(r.p,{children:[(0,o.jsx)(r.code,{children:"Controller -> servier -> dao"}),"\u8fd9\u6837\u7684\u5206\u5c42\u5f00\u53d1\u6a21\u5f0f"]}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.img,{src:"http://img.doomwatcher.cn/img/2a6b4645e71d6b4b26c883b3dceba13e.png",alt:"image-20220308165851328"})}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"\u5b9e\u4f53\u7c7b"}),"\n"]}),"\n",(0,o.jsx)(r.p,{children:"\u8fd9\u91cc\u4e3a\u4e86\u65b9\u9762\u5c55\u793a\uff0c\u5c31\u5c55\u793a\u5b9e\u4f53\u7c7b\u7684\u5c5e\u6027\uff0c\u5c0f\u4f19\u4f34\u4eec\u81ea\u884c\u8865\u5145 getter/setter \u4ee5\u53ca\u6784\u9020\u65b9\u6cd5\u7b49"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-java",children:"public class goods {\r\n    @Id\r\n    @TableId(type = IdType.AUTO)\r\n    private Integer id;\r\n    private String goods_id;\r\n    private String goods_name;\r\n    private String goodtype;\r\n    private double price;\r\n    private String img_path;\r\n    @TableField(exist = false)\r\n    private SeckillGoods seckillgoods;\r\n}\n"})}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"DAO"}),"\n"]}),"\n",(0,o.jsx)(r.p,{children:"\u867d\u7136\u4f7f\u7528\u4e86 mybatis-plus \u4f46\u662f\u6211\u4eec\u8fd8\u662f\u6839\u636e\u81ea\u5df1\u7684\u67e5\u8be2\u9700\u6c42\u65b0\u589e\u4e86\u81ea\u5df1\u7684\u65b9\u6cd5\uff0c"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-java",children:"@Repository\r\npublic interface GoodsMapper extends BaseMapper<goods> {\r\n    goods getGoodsByGoodsId(String goodId);\r\n\r\n    List<goods> selectGoods();\r\n\r\n    List<goods> getGoodList();\r\n}\n"})}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"\u6620\u5c04\u6587\u4ef6"}),"\n"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-xml",children:'<?xml version="1.0" encoding="UTF-8" ?>\r\n<!DOCTYPE mapper\r\n        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"\r\n        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">\r\n<mapper namespace="com.hyc.seckillsystem.dao.GoodsMapper">\r\n\r\n    <select id="getGoodsByGoodsId" resultType="com.hyc.seckillsystem.pojo.goods">\r\n        select seckill.goods.goods_id,\r\n               seckill.goods.goods_name,\r\n               seckill.goods.goodtype,\r\n               seckill.goods.price,\r\n               seckill.goods.img_path\r\n        from seckill.goods\r\n        where goods_id = #{goodId};\r\n    </select>\r\n    <select id="getGoodList" resultType="com.hyc.seckillsystem.pojo.goods">\r\n        select seckill.goods.goods_id,\r\n               seckill.goods.goods_name,\r\n               seckill.goods.goodtype,\r\n               seckill.goods.price,\r\n               seckill.goods.img_path\r\n        from seckill.goods\r\n    </select>\r\n\r\n    <resultMap id="goodsResult" type="com.hyc.seckillsystem.pojo.goods">\r\n        <id property="id" column="id"/>\r\n        <result property="goods_id" column="goods_id"/>\r\n        <result property="goods_name" column="goods_name"/>\r\n        <result property="goodtype" column="goods_type"/>\r\n        <result property="price" column="price"/>\r\n        <result property="img_path" column="img_path"/>\r\n        <association property="seckillgoods" javaType="com.hyc.seckillsystem.pojo.SeckillGoods">\r\n            <result property="seckill_price" column="seckill_price"/>\r\n            <result property="stock_num" column="stock_num"/>\r\n        </association>\r\n    </resultMap>\r\n\r\n\r\n    <select id="selectGoods" resultMap="goodsResult">\r\n        SELECT a.`goods_id`,\r\n               a.`goods_name`,\r\n               a.`goodtype`,\r\n               a.`price`,\r\n               a.`img_path`,\r\n               b.`seckill_price`,\r\n               b.`stock_num`\r\n        FROM seckill.goods AS a\r\n                 LEFT JOIN seckill.seckillgoods AS b\r\n                           ON a.`goods_id` = b.`goods_id`\r\n    </select>\r\n</mapper>\n'})}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"service \u5b9e\u73b0\u7c7b"}),"\n"]}),"\n",(0,o.jsx)(r.p,{children:"\u4e24\u79cd\u67e5\u627e\u5546\u54c1\u6570\u636e\u7684\u65b9\u6cd5"}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.code,{children:"getlist\uff1a"}),"\u9010\u4e2a\u8868 \u5339\u914d\u67e5\u8be2"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.code,{children:"selectGoods"}),"\u94fe\u8868\u67e5\u8be2"]}),"\n"]}),"\n",(0,o.jsxs)(r.p,{children:["\u8fd4\u56de\u5546\u54c1\u8be6\u60c5(\u5305\u62ec\u79d2\u6740\u4ef7\u683c\u7b49)VO ",(0,o.jsx)(r.code,{children:"getGoodsDetail(String goodId)"})]}),"\n",(0,o.jsx)(r.p,{children:"service \u5c42\u7684\u8bbe\u8ba1\u601d\u8def\u5c31\u662f \u8c03\u7528 DAO \u5c42\u63a5\u53e3 \u5b9e\u73b0\u5bf9\u6570\u636e\u5e93\u4e2d\u53d6\u51fa\u6570\u636e\u7684\u5904\u7406,\u5e76\u4e14\u63d0\u4f9b\u7ed9 controller \u5c01\u88c5\u597d\u7684\u63a5\u53e3"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-java",children:'@Service\r\npublic class GoodsServiceImpl implements GoodsService {\r\n    @Autowired\r\n    GoodsMapper goodsMapper;\r\n    @Autowired\r\n    SeckillGoodsMapper seckillGoodsMapper;\r\n\r\n    /**\r\n     * @author \u51b7\u73af\u6e0a Doomwatcher\r\n     * @context:\u9010\u4e2a\u8868 \u5339\u914d\u67e5\u8be2\r\n     * @date: 2022/3/7 16:20\r\n     * @param\r\n     * @return: java.util.List<com.hyc.seckillsystem.vo.GoodVo>\r\n     */\r\n    @Override\r\n    public List<GoodVo> getlist() {\r\n        /* \u4e24\u79cd\u65b9\u5f0f\r\n         * \u6bcf\u4e2a\u8868\u5355\u72ec\u67e5\u8be2\r\n         * \u4ece\u7b2c\u4e00\u4e2a\u8868\u67e5\u591a\u4e2a\u6570\u636e\uff0c\u518d\u6839\u636e\u6570\u636e\u53bb\u7b2c\u4e8c\u4e2a\u8868\u4e2d\u67e5\u8be2\r\n         * */\r\n        List<goods> goods = goodsMapper.getGoodList();\r\n        ArrayList<GoodVo> result = new ArrayList<>();\r\n        for (goods good : goods) {\r\n            Map<String, Object> map = new HashMap();\r\n            map.put("goods_id", good.getGoods_id());\r\n            SeckillGoods seckillGoods = seckillGoodsMapper.getSeckillByGoodsId(good.getGoods_id());\r\n            GoodVo vo = new GoodVo();\r\n            vo.setGoodsId(good.getGoods_id());\r\n            vo.setGoodsName(good.getGoods_name());\r\n            vo.setGoodType(good.getGoodtype());\r\n            vo.setPrice(good.getPrice());\r\n            vo.setImgPath(good.getImg_path());\r\n            vo.setSeckillPrice(seckillGoods.getSeckill_price());\r\n            vo.setStockNum(seckillGoods.getStock_num());\r\n            result.add(vo);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    @Override\r\n    //\u8fd4\u56de\u79d2\u6740\u5546\u54c1\u8be6\u60c5\u9875\u9762\r\n    public GoodsDetailVo getGoodsDetail(String goodId) {\r\n        SeckillGoods seckillGoods = seckillGoodsMapper.getSeckillByGoodsId(goodId);\r\n        goods good = goodsMapper.getGoodsByGoodsId(goodId);\r\n        //\u5546\u54c1\u8868\u4fe1\u606f1\r\n        GoodsDetailVo goodsDetailVo = new GoodsDetailVo();\r\n        goodsDetailVo.setGoodsId(good.getGoods_id());\r\n        goodsDetailVo.setGoodsName(good.getGoods_name());\r\n        goodsDetailVo.setGoodType(good.getGoodtype());\r\n        goodsDetailVo.setPrice(good.getPrice());\r\n        goodsDetailVo.setImgPath(good.getImg_path());\r\n        //\u79d2\u6740\u8868\u4fe1\u606f\r\n        goodsDetailVo.setSeckillPrice(seckillGoods.getSeckill_price());\r\n        goodsDetailVo.setStockNum(seckillGoods.getStock_num());\r\n        goodsDetailVo.setStartTime(seckillGoods.getStart_time());\r\n        goodsDetailVo.setEndTime(seckillGoods.getEnd_time());\r\n        return goodsDetailVo;\r\n    }\r\n\r\n    /**\r\n     * @author \u51b7\u73af\u6e0a Doomwatcher\r\n     * @context: \u8054\u8868\u67e5\u8be2\r\n     * @date: 2022/3/7 16:20\r\n     * @param\r\n     * @return: com.hyc.seckillsystem.vo.GoodVo\r\n     */\r\n    @Override\r\n    public List<GoodVo> selectGoods() {\r\n        List<goods> goods = goodsMapper.selectGoods();\r\n        ArrayList<GoodVo> result = new ArrayList<>();\r\n        for (goods good : goods) {\r\n            GoodVo vo = new GoodVo();\r\n            vo.setGoodsId(good.getGoods_id());\r\n            vo.setGoodsName(good.getGoods_name());\r\n            vo.setGoodType(good.getGoodtype());\r\n            vo.setPrice(good.getPrice());\r\n            vo.setImgPath(good.getImg_path());\r\n            vo.setSeckillPrice(good.getSeckillGoods().getSeckill_price());\r\n            vo.setStockNum(good.getSeckillGoods().getStock_num());\r\n            result.add(vo);\r\n        }\r\n        return result;\r\n    }\r\n}\r\n\n'})}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"Controller"}),"\n"]}),"\n",(0,o.jsx)(r.p,{children:"Controller \u5c42,\u8d1f\u8d23\u63a7\u5236\u63a5\u53e3\u6570\u636e\u548c\u6e32\u67d3\u754c\u9762\u7684\u503c\u4f20\u9012 , \u8df3\u8f6c , \u8fd9\u91cc\u57fa\u672c\u4e0a\u4e0d\u5305\u542b\u4e1a\u52a1\u4ee3\u7801"}),"\n",(0,o.jsx)(r.p,{children:"\u5c3d\u53ef\u80fd\u7684\u518d service \u5c42 \u5c01\u88c5\u597d\u65b9\u6cd5 \u8ba9 Controller \u53ea\u8d1f\u8d23\u8c03\u7528"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-java",children:'@Controller\r\n@Slf4j\r\npublic class GoodsController {\r\n    @Autowired\r\n    GoodsService goodsService;\r\n\r\n    @GetMapping(value = "/index")\r\n    public String list(Model model) {\r\n        //    \u9010\u5c42\u8c03\u7528\r\n        List<GoodVo> getlist = goodsService.getlist();\r\n        model.addAttribute("goodslist", getlist);\r\n        return "list";\r\n    }\r\n\r\n    @GetMapping(value = "/goodDetail/{goodsId}")\r\n    public String getGoodDetail(@PathVariable String goodsId, Model model) {\r\n        GoodsDetailVo goodsDetail = goodsService.getGoodsDetail(goodsId);\r\n        model.addAttribute("GoodsDetail", goodsDetail);\r\n\r\n        //\u83b7\u53d6\u5230\u65f6\u95f4\r\n        Date startTime = goodsDetail.getStartTime();\r\n        Date endTime = goodsDetail.getEndTime();\r\n        Date nowtime = new Date();\r\n\r\n        /*\u8bbe\u7f6e\u72b6\u6001\u503c\r\n         * 0 \u672a\u5f00\u59cb\r\n         * 1 \u6b63\u5728\u79d2\u6740\r\n         * 2 \u79d2\u6740\u7ed3\u675f\r\n         * */\r\n        int status;\r\n        int remainSeconds = -1;\r\n        if (nowtime.before(startTime)) {\r\n            //    \u79d2\u6740\u672a\u5f00\u59cb\r\n            status = 0;\r\n            remainSeconds = (int) ((startTime.getTime() - nowtime.getTime()) / 1000);\r\n        } else if (nowtime.after(endTime)) {\r\n            //\u79d2\u6740\u5df2\u7ecf\u7ed3\u675f\r\n            status = 2;\r\n        } else {\r\n            //\u6b63\u5728\u79d2\u6740\u4e2d\r\n            status = 1;\r\n        }\r\n        model.addAttribute("status", status);\r\n        model.addAttribute("remainSeconds", remainSeconds);\r\n        return "Detail";\r\n    }\r\n}\n'})}),"\n",(0,o.jsx)(r.h3,{id:"\u79d2\u6740\u5546\u54c1",children:"\u79d2\u6740\u5546\u54c1"}),"\n",(0,o.jsx)(r.p,{children:"\u8fd9\u91cc\u624d\u662f\u6211\u4eec\u7684\u91cd\u5934\u620f\u8fd9\u91cc\u6211\u4eec\u4e3b\u8981\u8bb2\u89e3\u4f7f\u7528\u601d\u8def\uff0c\u4e0d\u8fc7\u591a\u7684\u53bb\u5c55\u793a\u65e0\u7528\u4ee3\u7801\u5982\u5b9e\u4f53\u7c7b\u7b49\uff0c\u6211\u4eec\u8fd9\u91cc\u4ece\u6700\u5f00\u59cb\u7684"}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsx)(r.li,{children:"\u76f4\u63a5\u5904\u7406"}),"\n",(0,o.jsx)(r.li,{children:"redis \u4e8b\u52a1\u5904\u7406"}),"\n",(0,o.jsx)(r.li,{children:"\u5206\u5e03\u5f0f\u9501 Lua \u5904\u7406"}),"\n"]}),"\n",(0,o.jsx)(r.p,{children:"\u4e09\u79cd\u65b9\u5f0f \u7531\u6d45\u81f3\u6df1\u7684\u6765\u7406\u89e3\u79d2\u6740\u7684\u601d\u8def\u548c\u8d85\u5356\u95ee\u9898\u7684\u89e3\u51b3"}),"\n",(0,o.jsx)(r.h4,{id:"\u76f4\u63a5\u5904\u7406",children:"\u76f4\u63a5\u5904\u7406"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"\u5224\u65ad\u7528\u6237 id \u7684\u6709\u6548\u6027 \u6211\u4eec\u6ca1\u6709\u7528\u6237"}),"\n",(0,o.jsx)(r.li,{children:"\u5224\u65ad goodsid \u7684\u6709\u6548\u6027"}),"\n",(0,o.jsx)(r.li,{children:"\u5224\u65ad\u5f53\u524d\u662f\u5426\u5904\u4e8e\u53ef\u4ee5\u79d2\u6740\u7684\u72b6\u6001"}),"\n",(0,o.jsx)(r.li,{children:"\u5224\u65ad\u662f\u5426\u6709\u5269\u4f59\u5e93\u5b58"}),"\n",(0,o.jsx)(r.li,{children:"\u5224\u65ad\u7528\u6237\u7684\u79d2\u6740\u6743\u9650\uff08\u662f\u5426\u79d2\u6740\u8fc7\uff09"}),"\n",(0,o.jsx)(r.li,{children:"\u51cf\u5c11\u5e93\u5b58"}),"\n",(0,o.jsx)(r.li,{children:"\u751f\u6210\u65b0\u7684\u8ba2\u5355"}),"\n"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-java",children:'public String handle(String userId, String goodsId) {\r\n    String stockkey = goodsId + "_count";\r\n    String startTimekey = goodsId + "_startTime";\r\n    String userkey = goodsId + "_" + userId;\r\n    String dateStr = (String) redisUtil.get(startTimekey);\r\n    SimpleDateFormat format = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");\r\n    Date startTime = null;\r\n    try {\r\n        startTime = format.parse(dateStr);\r\n    } catch (ParseException e) {\r\n        e.printStackTrace();\r\n    }\r\n    if (startTime == null || new Date().before(startTime)) {\r\n        return "\u79d2\u6740\u8fd8\u6ca1\u5f00\u59cb";\r\n    }\r\n    int stockNum = (int) redisUtil.get(stockkey);\r\n    if (stockNum <= 0) {\r\n        return "\u79d2\u6740\u4e00\u7a7a";\r\n    }\r\n    if (redisUtil.get(userkey) != null) {\r\n        return "\u7528\u6237\u79d2\u6740\u6210\u529f\u8fc7\u4e86";\r\n    }\r\n    //\u51cf\u5c11\u5e93\u5b58\r\n    redisUtil.decr(stockkey);\r\n    //\u9650\u989d 1 \u53ef\u4ee5\u8fd9\u4e48\u5904\u7406\r\n    //\u5982\u679c\u9650\u989d \u591a\u4e2a \u53ef\u4ee5\u83b7\u53d6value \u81ea\u589e\r\n    redisUtil.set(goodsId + "_" + userId, 1);\r\n    return userId + "\u7528\u6237\u79d2\u6740\u6210\u529f";\r\n}\n'})}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"\u6d4b\u8bd5"}),"\n"]}),"\n",(0,o.jsx)(r.p,{children:"\u8fd9\u4e2a\u65f6\u5019\u542f\u52a8 jmeter \u6765\u6d4b\u8bd5\u4e00\u4e0b\u63a5\u53e3\u7684\u7ed3\u679c"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"\u5e93\u5b58 10"}),"\n",(0,o.jsx)(r.li,{children:"\u4e00\u767e\u4e2a\u7ebf\u7a0b \u62a2\u8fd9 10 \u4e2a \u624b\u673a"}),"\n"]}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.img,{src:"http://img.doomwatcher.cn/img/9c8c34c16a0d2654dcf5df45b04b1c2d.png",alt:"image-20220308174255775"})}),"\n",(0,o.jsx)(r.p,{children:"\u67e5\u770b redis \u4e2d \u5e93\u5b58 key \u7684\u6570\u91cf \u4e3a -4"}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.img,{src:"http://img.doomwatcher.cn/img/60ea48e5f6961fef46ea1406c58173c3.png",alt:"image-20220308174432576"})}),"\n",(0,o.jsx)(r.p,{children:"\u518d\u6b21\u6d4b\u8bd5"}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.img,{src:"http://img.doomwatcher.cn/img/e870a0b8eecdf563616dfacf32097552.png",alt:"image-20220308174916436"})}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.img,{src:"http://img.doomwatcher.cn/img/f32c2861b580f5bbd52537a6edc312f0.png",alt:"image-20220308174744088"})}),"\n",(0,o.jsx)(r.p,{children:"\u901a\u8fc7\u6d4b\u8bd5\u548c\u67e5\u770b\u65e5\u5fd7\u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u76f4\u63a5\u5904\u7406\uff0c\u7cfb\u7edf\u4e0d\u884c\u4e0d\u80fd\u5728\u7b2c\u4e00\u65f6\u95f4\u53cd\u5e94\u8fc7\u6765\u662f\u5426\u8d85\u8fc7\u4e86\u5e93\u5b58\uff0c\u5bfc\u81f4\u7279\u4ef7\u5546\u54c1\u88ab\u8d85\u989d\u5356\u51fa\uff0c\u90a3\u8fd9\u4e2a\u95ee\u9898\u600e\u4e48\u89e3\u51b3\u5462\uff1f"}),"\n",(0,o.jsx)(r.h4,{id:"\u4e8b\u52a1\u5904\u7406",children:"\u4e8b\u52a1\u5904\u7406"}),"\n",(0,o.jsx)(r.p,{children:"\u4f18\u79c0\u6210\u719f\u7684\u6570\u636e\u5e93 \u4e00\u5b9a\u4f1a\u6709\u5bf9\u4e8b\u52a1\u7684\u652f\u6301\uff0c redis \u4e5f\u4e0d\u4f8b\u5916"}),"\n",(0,o.jsx)(r.p,{children:"Redis \u7684\u4e8b\u52a1\u5728\u4e0d\u51fa\u73b0\u5f02\u5e38\u7684\u65f6\u5019\u662f\u539f\u5b50\u64cd\u4f5c\uff0cexec \u662f\u89e6\u53d1\u4e8b\u52a1\u6267\u884c\u7684\u547d\u4ee4"}),"\n",(0,o.jsx)(r.p,{children:"\u76f8\u5173\u547d\u4ee4\uff1a"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"watch \u8bbe\u7f6e\u4e00\u4e2a key \u8868\u793a\u5f00\u59cb\u5bf9\u8fd9\u4e2a key \u7684\u547d\u4ee4\u76d1\u542c"}),"\n",(0,o.jsx)(r.li,{children:"multi \u5c06 \u540e\u7eed\u7684\u547d\u4ee4 \u52a0\u5165\u5230\u6267\u884c\u961f\u5217\u91cc"}),"\n",(0,o.jsx)(r.li,{children:"exec \u51fa\u53d1\u6267\u884c\u961f\u5217\u91cc\u7684\u547d\u4ee4"}),"\n",(0,o.jsx)(r.li,{children:"discard \u505c\u6b62\u63d0\u4ea4\uff0credis \u4e0d\u80fd\u56de\u6eda"}),"\n"]}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"\u4f7f\u7528\u4e8b\u52a1"}),"\n"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-java",children:'    public String handleByTrans(String userId, String goodsId) {\r\n        String stockkey = goodsId + "_count";\r\n        String startTimekey = goodsId + "_startTime";\r\n        String userkey = goodsId + "_" + userId;\r\n        String dateStr = (String) redisUtil.get(startTimekey);\r\n        SimpleDateFormat format = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");\r\n        Date startTime = null;\r\n        try {\r\n            startTime = format.parse(dateStr);\r\n        } catch (ParseException e) {\r\n            e.printStackTrace();\r\n        }\r\n        if (startTime == null || new Date().before(startTime)) {\r\n            return "\u79d2\u6740\u8fd8\u6ca1\u5f00\u59cb";\r\n        }\r\n        if (redisUtil.get(userkey) != null) {\r\n            return "\u7528\u6237\u79d2\u6740\u6210\u529f\u8fc7\u4e86";\r\n        }\r\n        SessionCallback sessionCallback = new SessionCallback() {\r\n            @Override\r\n            public Object execute(RedisOperations redisOperations) throws DataAccessException {\r\n                // \u7f16\u5199\u4e8b\u52a1\u903b\u8f91\r\n                // \u8c03\u7528 watch \u5f00\u59cb\u4e8b\u52a1\uff0c mutil \u5f00\u59cb\u5c06\u4e4b\u540e\u7684\u547d\u4ee4\u52a0\u5165\u961f\u5217 exec \u6267\u884c\u961f\u5217\u91cc\u7684\u547d\u4ee4\r\n                redisOperations.watch(stockkey);\r\n                int stockNum = (int) redisUtil.get(stockkey);\r\n                if (stockNum <= 0) {\r\n                    return "\u79d2\u6740\u4e00\u7a7a";\r\n                }\r\n                redisOperations.multi();\r\n                redisUtil.decr(stockkey);\r\n                redisUtil.set(userkey, 1);\r\n                return redisOperations.exec();\r\n            }\r\n        };\r\n        redisUtil.execute(sessionCallback);\r\n        if (redisUtil.hasKey(userkey)) {\r\n            return userId;\r\n        }\r\n        return userId + "\u79d2\u6740\u5931\u8d25";\r\n    }\r\n\r\n\n'})}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"\u6d4b\u8bd5"}),"\n"]}),"\n",(0,o.jsx)(r.p,{children:"\u548c\u4e4b\u524d\u4e00\u6837\u7684\u6848\u4f8b 100 \u62a2 10"}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.img,{src:"http://img.doomwatcher.cn/img/9d4673f91e9804263d7fa6eeb29d9810.png",alt:"image-20220308175622279"})}),"\n",(0,o.jsx)(r.p,{children:"\u53ef\u4ee5\u53d1\u73b0\u4f7f\u7528\u4e86 \u4e8b\u52a1\u4e4b\u540e\u6211\u4eec\u89e3\u51b3\u4e86\u8d85\u5356\u7684\u95ee\u9898"}),"\n",(0,o.jsx)(r.h4,{id:"\u4e3e\u4e00\u53cd\u4e09",children:"\u4e3e\u4e00\u53cd\u4e09"}),"\n",(0,o.jsx)(r.p,{children:"\u90a3\u9664\u4e86\u4e8b\u52a1 \u8fd8\u6709\u4ec0\u4e48\u65b9\u5f0f\u53ef\u4ee5\u89e3\u51b3\u8d85\u5356\u95ee\u9898\u5462\uff1f"}),"\n",(0,o.jsx)(r.p,{children:"\u811a\u672c\u8bed\u8a00 \uff1a lua"}),"\n",(0,o.jsx)(r.p,{children:"redis \u662f\u652f\u6301\u6267\u884c\u811a\u672c\u8bed\u8a00\u7684\u4e14\u4e00\u6bb5\u811a\u672c\u6267\u884c\u7684\u65f6\u5019\u662f\u4e0d\u4f1a\u88ab\u5176\u4ed6\u64cd\u4f5c\u5f71\u54cd\u7684\uff0c\u4fdd\u8bc1\u539f\u5b50\u6027"}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"\u7f16\u5199 lua \u811a\u672c"}),"\n"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-lua",children:'--\u63a5\u53d7\u5230\u53c2\u65701\r\nlocal userId = KEYS[1];\r\n--\u63a5\u6536\u5230\u53c2\u65702\r\nlocal goodsId = KEYS[2];\r\n--redis\u4e2d\u7684 key \u5b58\u50a8\u4e3a \u5c40\u90e8\u53d8\u91cf\r\n--\u79d2\u6740\u5546\u54c1\u6570\u91cf\r\n--.. \u662flua \u91cc\u9762\u5b57\u7b26\u4e32\u7684\u62fc\u63a5\r\nlocal cntkey = goodsId .. "_count";\r\n--\u79d2\u6740\u7528\u6237 id\r\nlocal orderkey = goodsId .. "_" .. userId;\r\n--\u5224\u65ad\u662f\u5426\u79d2\u6740\u8fc7\r\nlocal orderExists = redis.call("get", orderkey);\r\nif (orderExists and tonumber(orderExists) == 1) then\r\n    return 2;\r\nend\r\n--\u5224\u65ad\u5e93\u5b58\u662f\u5426\u4e3a\u7a7a\r\nlocal num = redis.call("get", cntkey);\r\nif (num and tonumber(num) <= 0) then\r\n    return 0;\r\nelse\r\n    --    \u79d2\u6740\u6210\u529f\r\n    redis.call("decr", cntkey);\r\n    redis.call("set", orderkey, 1);\r\nend\r\nreturn 1\n'})}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"\u5b9e\u4f8b\u4ee3\u7801"}),"\n"]}),"\n",(0,o.jsx)(r.p,{children:"\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 DefaultRedisScript \u7c7b \u6765\u6267\u884c\u6211\u4eec\u5199\u5728 resouce \u4e0b\u7684 lua \u811a\u672c"}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.code,{children:' script.setScriptSource(new ResourceScriptSource(                 new ClassPathResource("lua/sekill.lua")));'})}),"\n",(0,o.jsx)(r.p,{children:"\u8bbe\u7f6e\u811a\u672c\u7684\u4f4d\u7f6e\uff0c\u4e4b\u540e\u7528\u4e4b\u524d\u5de5\u5177\u7c7b\u5c01\u88c5\u7684 redis \u65b9\u6cd5\u5c06\u811a\u672c\u548c\u9700\u8981\u7684\u53c2\u6570 list \u4f20\u5165\u6267\u884c\u5373\u53ef"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-java",children:'    //\u4f7f\u7528lua \u811a\u672c \u4fdd\u8bc1\u539f\u5b50\u6027 \uff08\u5206\u5e03\u5f0f\u9501\uff09\r\n    @Override\r\n    public String handleByLua(String userId, String goodsId) {\r\n        String startTimekey = goodsId + "_startTime";\r\n        String dateStr = (String) redisUtil.get(startTimekey);\r\n        SimpleDateFormat format = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");\r\n        Date startTime = null;\r\n        try {\r\n            startTime = format.parse(dateStr);\r\n        } catch (ParseException e) {\r\n            e.printStackTrace();\r\n        }\r\n        if (startTime == null || new Date().before(startTime)) {\r\n            return "\u79d2\u6740\u8fd8\u6ca1\u5f00\u59cb";\r\n        }\r\n        DefaultRedisScript<Long> script = new DefaultRedisScript<>();\r\n        //\u8bbe\u7f6e\u8fd4\u56de\u811a\u672c\u7c7b\u578b\r\n        script.setResultType(Long.class);\r\n        script.setScriptSource(new ResourceScriptSource(\r\n                new ClassPathResource("lua/sekill.lua")));\r\n        List<String> keylist = new ArrayList<>();\r\n        keylist.add(userId);\r\n        keylist.add(goodsId);\r\n        Object execute = redisUtil.execute(script, keylist);\r\n        String resultStr = String.valueOf(execute);\r\n        if ("0".equals(resultStr)) {\r\n            return "\u79d2\u6740\u5e93\u5b58\u5df2\u7ecf\u7a7a\u4e86";\r\n        } else if ("1".equals(resultStr)) {\r\n            return userId;\r\n        } else if ("2".equals(resultStr)) {\r\n            return "\u8be5\u7528\u6237\u79d2\u6740\u8fc7\u4e86 =>" + userId;\r\n        } else {\r\n            return "\u79d2\u6740\u548c\u62a2\u8d2d\u53ef\u80fd\u51fa\u4e86\u70b9\u95ee\u9898\uff0c\u6b63\u5728\u7d27\u6025\u7ef4\u62a4";\r\n        }\r\n    }\r\n\n'})}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"\u6d4b\u8bd5"}),"\n"]}),"\n",(0,o.jsx)(r.p,{children:"\u540c\u6837\u7684 100 -\u300b 10 ,\u4ece\u7ed3\u679c\u6765\u770b\uff0c\u4e5f\u662f\u4fdd\u8bc1\u4e86\u4e0d\u8d85\u5356\uff0c\u4e0d\u5c11\u5356\u7684"}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.img,{src:"http://img.doomwatcher.cn/img/ad1a7b43eb53f827903532b09895b520.png",alt:"image-20220308175958242"})}),"\n",(0,o.jsx)(r.p,{children:"\u89e3\u51b3\u4e86\u79d2\u6740\u7684\u95ee\u9898,\u5269\u4e0b\u5c31\u662f\u5c06\u79d2\u6740\u4e4b\u540e\u7684\u6210\u529f\u7528\u6237\u4fe1\u606f\u548c\u5546\u54c1\u4fe1\u606f\u4f20\u7ed9\u8ba2\u5355\u6a21\u5757\u5373\u53ef"}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"Controller"}),"\n"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-java",children:'@Controller\r\n@Slf4j\r\npublic class redisController {\r\n    @Autowired\r\n    redisService redisService;\r\n    @Autowired\r\n    RedisUtil redisUtil;\r\n\r\n    // \u4e3a\u4e86 \u65b9\u9762\u6d4b\u8bd5 \u6bcf\u6b21\u91cd\u542f\u9879\u76ee\u90fd\u4f1a\u91cd\u7f6e\u79d2\u6740\u6b21\u6570\r\n    @PostConstruct\r\n    public void initdata() {\r\n\r\n        redisService.initdata();\r\n    }\r\n\r\n    @PostMapping(value = "/seckillAPI")\r\n    public String seckill(String userId, String goodsId, Model model) {\r\n        String key = goodsId + "_" + userId;\r\n        if (userId == null || goodsId == null) {\r\n            return "\u53c2\u6570\u5f02\u5e38";\r\n        }\r\n        String result = redisService.seckill(userId, goodsId);\r\n        if (redisUtil.hasKey(key)) {\r\n            log.info(result);\r\n            model.addAttribute("userId", result);\r\n            model.addAttribute("goodsId", goodsId);\r\n        }\r\n        return "order";\r\n    }\r\n}\r\n\n'})}),"\n",(0,o.jsx)(r.h3,{id:"\u751f\u6210\u8ba2\u5355",children:"\u751f\u6210\u8ba2\u5355"}),"\n",(0,o.jsx)(r.p,{children:"\u89e3\u51b3\u4e86\u79d2\u6740\u7684\u95ee\u9898\uff0c\u751f\u6210\u8ba2\u5355\u5176\u5b9e\u5c31\u7b80\u5355\u548c\u5e38\u89c4\u7684\u4e0d\u5c11"}),"\n",(0,o.jsx)(r.p,{children:"\u5c31\u662f\u67e5\u8be2 \u5fc5\u8981\u7684\u4fe1\u606f\u751f\u6210\u4e00\u4e2a\u8ba2\u5355\u4fe1\u606f"}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"service \u5b9e\u73b0\u7c7b"}),"\n"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-java",children:"@Service\r\npublic class orderServiceImpl implements orderService {\r\n    @Autowired\r\n    GoodsMapper goodsMapper;\r\n    @Autowired\r\n    SeckillGoodsMapper seckillGoodsMapper;\r\n    @Autowired\r\n    orderMapper ordermapper;\r\n\r\n    @Override\r\n    public orderVo createOrder(order order) {\r\n        int insert = ordermapper.insert(order);\r\n        if (insert != 0) {\r\n            List<order> orders = ordermapper.selectList(null);\r\n            for (order o : orders) {\r\n                goods goods = goodsMapper.getGoodsByGoodsId(o.getGoods_id());\r\n                SeckillGoods seckillGoods = seckillGoodsMapper.getSeckillByGoodsId(o.getGoods_id());\r\n                orderVo orderVo = new orderVo();\r\n                orderVo.setOrderId(String.valueOf(o.getId()));\r\n                orderVo.setUserId(o.getUser_id());\r\n                orderVo.setGoodsId(o.getGoods_id());\r\n                orderVo.setTelephone(o.getTelephone());\r\n                orderVo.setAddress(o.getAddress());\r\n                orderVo.setImgPath(goods.getImg_path());\r\n                orderVo.setSeckillPrice(seckillGoods.getSeckill_price());\r\n                return orderVo;\r\n            }\r\n        }\r\n        return null;\r\n\r\n    }\r\n}\r\n\n"})}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"Controller"}),"\n"]}),"\n",(0,o.jsx)(r.p,{children:"\u7b49\u5f85\u7528\u6237 \u786e\u8ba4\u4fe1\u606f\u4e4b\u540e \u5c31\u53ef\u4ee5\u751f\u6210\u8ba2\u5355 \u540c\u6b65\u5230\u6570\u636e\u5e93\u4e86"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-java",children:'@Controller\r\npublic class orderController {\r\n    @Autowired\r\n    orderService orderService;\r\n\r\n    @PostMapping(value = "/create")\r\n    public String createOrder(order order, Model model) {\r\n        orderVo order1 = orderService.createOrder(order);\r\n        model.addAttribute("orderinfo", order1);\r\n        return "success";\r\n    }\r\n}\r\n\n'})}),"\n",(0,o.jsx)(r.h2,{id:"\u6d41\u7a0b\u5c55\u793a",children:"\u6d41\u7a0b\u5c55\u793a"}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.img,{src:"http://img.doomwatcher.cn/img/a096c3bdb821102230eeec4c161dd6ff.png",alt:"image-20220308182706212"})}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.img,{src:"http://img.doomwatcher.cn/img/5a538ec3f46c7352367570ac623c1a29.png",alt:"image-20220308182722476"})}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.img,{src:"http://img.doomwatcher.cn/img/46c0322ff764b5c6fb34be4ff48bed0d.png",alt:"image-20220308182733907"})}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.img,{src:"http://img.doomwatcher.cn/img/5697205d51b3adc38ed0faf3fe0b34fd.png",alt:"image-20220308182751989"})}),"\n",(0,o.jsx)(r.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,o.jsx)(r.p,{children:"\u8bbe\u8ba1\u4e00\u4e2a\u79d2\u6740\u9879\u76ee \u5176\u5b9e\u8981\u8003\u8651\u7684\u4e1c\u897f\u5341\u5206\u7684\u591a\uff0c\u6211\u4eec\u8fd9\u6b21\u7684\u7cfb\u7edf\u4e5f\u4e0d\u662f\u6700\u7ec8\u7684\u7248\u672c\uff0c\u5148\u505a\u51fa\u6765\u7684\u6838\u5fc3\u7684\uff0c"}),"\n",(0,o.jsx)(r.p,{children:"\u5957\u7528\u9c7c\u76ae\u7684\u8bdd \u5148\u6709 \u518d\u8c03\u4f18 \u8ffd\u6c42\u66f4\u597d"}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"\u62d3\u5c55"}),"\n"]}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"\u9875\u9762\u52a8\u9759\u5206\u79bb"}),"\n",(0,o.jsx)(r.li,{children:"nginx ip \u5206\u6d41"}),"\n",(0,o.jsx)(r.li,{children:"MQ \u6d41\u91cf\u524a\u5cf0\uff0c\u5f02\u6b65\u4efb\u52a1"}),"\n",(0,o.jsx)(r.li,{children:"\u524d\u7aef\u9a8c\u8bc1\u7801"}),"\n",(0,o.jsx)(r.li,{children:"\u6570\u636e\u5e93\u4e0e\u7f13\u5b58\u540c\u6b65\u7b56\u7565\uff08MQ redis \u90fd\u53ef\u4ee5\u5b9e\u73b0\uff09"}),"\n"]}),"\n",(0,o.jsx)(r.p,{children:"\u4e0a\u8ff0\u90fd\u662f\u6211\u5b66\u8fc7\u7684\u77e5\u8bc6\u70b9\u6682\u65f6\u5e76\u4e14\u5b9e\u6218\u8fc7\uff0c\u4f1a\u5728\u4eca\u540e\u4e0d\u65ad\u7684\u5c06\u4f18\u5316\u529f\u80fd\u5b9e\u73b0\u51fa\u6765"}),"\n",(0,o.jsx)(r.p,{children:"\u8fd9\u4e9b\u90fd\u662f\u6211\u5728\u8003\u8651\u7684\u8303\u56f4\u5185\uff0c\u4eca\u540e\u4f1a\u4e0d\u65ad\u7684\u5b66\u4e60 \u665a\u4e0a\u5176\u4e2d\u7684\u5185\u5bb9\uff0c"})]})}function g(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,o.jsx)(r,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>t,x:()=>d});var s=n(6540);const o={},i=s.createContext(o);function t(e){const r=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function d(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),s.createElement(i.Provider,{value:r},e.children)}}}]);