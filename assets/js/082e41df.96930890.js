"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2295],{8453:(r,e,n)=>{n.d(e,{R:()=>s,x:()=>o});var t=n(6540);const a={},i=t.createContext(a);function s(r){const e=t.useContext(i);return t.useMemo((function(){return"function"==typeof r?r(e):{...e,...r}}),[e,r])}function o(r){let e;return e=r.disableParentContext?"function"==typeof r.components?r.components(a):r.components||a:s(r.components),t.createElement(i.Provider,{value:e},r.children)}},8540:(r,e,n)=>{n.r(e),n.d(e,{assets:()=>c,contentTitle:()=>o,default:()=>g,frontMatter:()=>s,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"Java/\u5206\u5e03\u5f0f\u9879\u76ee\u4e2d\u9501\u7684\u5e94\u7528\uff08\u672c\u5730\u9501-redis\u3010setnx\u3011-redisson-springcache\uff09","title":"\u5206\u5e03\u5f0f\u9879\u76ee\u4e2d\u9501\u7684\u5e94\u7528\uff08\u672c\u5730\u9501-redis\u3010setnx\u3011-redisson-springcache\uff09","description":"[toc]","source":"@site/docs/Java/\u5206\u5e03\u5f0f\u9879\u76ee\u4e2d\u9501\u7684\u5e94\u7528\uff08\u672c\u5730\u9501-redis\u3010setnx\u3011-redisson-springcache\uff09.md","sourceDirName":"Java","slug":"/Java/\u5206\u5e03\u5f0f\u9879\u76ee\u4e2d\u9501\u7684\u5e94\u7528\uff08\u672c\u5730\u9501-redis\u3010setnx\u3011-redisson-springcache\uff09","permalink":"/docs/Java/\u5206\u5e03\u5f0f\u9879\u76ee\u4e2d\u9501\u7684\u5e94\u7528\uff08\u672c\u5730\u9501-redis\u3010setnx\u3011-redisson-springcache\uff09","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Java/\u5206\u5e03\u5f0f\u9879\u76ee\u4e2d\u9501\u7684\u5e94\u7528\uff08\u672c\u5730\u9501-redis\u3010setnx\u3011-redisson-springcache\uff09.md","tags":[],"version":"current","frontMatter":{},"sidebar":"JavaSidebar","previous":{"title":"\u516d\u9053\u5165\u95e8\u6811\u9898\u76ee\u5e26\u4f60\u8d70\u5165\u6811\u7ed3\u6784\u7684\u4e16\u754c","permalink":"/docs/Java/\u516d\u9053\u5165\u95e8\u6811\u9898\u76ee\u5e26\u4f60\u8d70\u5165\u6811\u7ed3\u6784\u7684\u4e16\u754c"},"next":{"title":"\u591a\u7ebf\u7a0b\u8fdb\u9636 JUC \u5e76\u53d1\u7f16\u7a0b","permalink":"/docs/Java/\u591a\u7ebf\u7a0b\u8fdb\u9636 JUC\u5e76\u53d1\u7f16\u7a0b"}}');var a=n(4848),i=n(8453);const s={},o="\u6982\u8ff0",c={},l=[{value:"1.\u9002\u5408\u653e\u5165\u7f13\u5b58\u7684\u6570\u636e",id:"1\u9002\u5408\u653e\u5165\u7f13\u5b58\u7684\u6570\u636e",level:2},{value:"2.\u8bfb\u6a21\u5f0f\u7f13\u5b58\u4f7f\u7528\u6d41\u7a0b",id:"2\u8bfb\u6a21\u5f0f\u7f13\u5b58\u4f7f\u7528\u6d41\u7a0b",level:2},{value:"3.\u672c\u5730\u7f13\u5b58\u4e0e\u5c40\u9650\u6027",id:"3\u672c\u5730\u7f13\u5b58\u4e0e\u5c40\u9650\u6027",level:2},{value:"4.\u5206\u5e03\u5f0f\u7f13\u5b58",id:"4\u5206\u5e03\u5f0f\u7f13\u5b58",level:2},{value:"1.\u4f7f\u7528 springboot \u6574\u5408 redis",id:"1\u4f7f\u7528-springboot-\u6574\u5408-redis",level:2},{value:"2.\u6d4b\u8bd5\u7528\u4f8b",id:"2\u6d4b\u8bd5\u7528\u4f8b",level:2},{value:"3.lettuce \u5806\u5916\u5185\u5b58\u6ea2\u51fa\uff08springboot2.3.2 \u5df2\u89e3\u51b3\uff09",id:"3lettuce-\u5806\u5916\u5185\u5b58\u6ea2\u51faspringboot232-\u5df2\u89e3\u51b3",level:2},{value:"3.1.lettuce\u3001jedis\u3001redistemplate",id:"31lettucejedisredistemplate",level:3},{value:"3.2.\u539f\u56e0",id:"32\u539f\u56e0",level:3},{value:"3.3.\u89e3\u51b3\u65b9\u6cd5\uff1a\u5207\u6362 jedis",id:"33\u89e3\u51b3\u65b9\u6cd5\u5207\u6362-jedis",level:3},{value:"4.\u7f13\u5b58\u5931\u6548\u95ee\u9898",id:"4\u7f13\u5b58\u5931\u6548\u95ee\u9898",level:2},{value:"4.1.\u7f13\u5b58\u7a7f\u900f\uff08\u4e0d\u5b58\u5728\u7684\u6570\u636e\uff09",id:"41\u7f13\u5b58\u7a7f\u900f\u4e0d\u5b58\u5728\u7684\u6570\u636e",level:3},{value:"4.2.\u7f13\u5b58\u96ea\u5d29\uff08\u5927\u9762\u79ef\u5931\u6548\uff09",id:"42\u7f13\u5b58\u96ea\u5d29\u5927\u9762\u79ef\u5931\u6548",level:3},{value:"4.3.\u7f13\u5b58\u51fb\u7a7f\uff08\u4e00\u6761\u5931\u6548\uff09",id:"43\u7f13\u5b58\u51fb\u7a7f\u4e00\u6761\u5931\u6548",level:3},{value:"4.4.\u9501\u65f6\u6548\u95ee\u9898",id:"44\u9501\u65f6\u6548\u95ee\u9898",level:3},{value:"4.5.\u6a21\u62df\u5206\u5e03\u5f0f\u672c\u5730\u9501\u5931\u6548",id:"45\u6a21\u62df\u5206\u5e03\u5f0f\u672c\u5730\u9501\u5931\u6548",level:3},{value:"5.\u5206\u5e03\u5f0f\u9501",id:"5\u5206\u5e03\u5f0f\u9501",level:2},{value:"5.1.\u6f14\u793a\u5206\u5e03\u5f0f\u9501 SETNX",id:"51\u6f14\u793a\u5206\u5e03\u5f0f\u9501-setnx",level:3},{value:"5.2.\u95ee\u9898\u5408\u96c6",id:"52\u95ee\u9898\u5408\u96c6",level:3},{value:"5.3.redis \u5206\u5e03\u5f0f\u9501\u7248\u672c",id:"53redis-\u5206\u5e03\u5f0f\u9501\u7248\u672c",level:3},{value:"1.\u6982\u8ff0",id:"1\u6982\u8ff0",level:2},{value:"2.\u4f7f\u7528\u539f\u751f redisson(\u770b\u95e8\u72d7)",id:"2\u4f7f\u7528\u539f\u751f-redisson\u770b\u95e8\u72d7",level:2},{value:"2.1.\u53ef\u91cd\u5165\u9501",id:"21\u53ef\u91cd\u5165\u9501",level:3},{value:"2.2.\u8fc7\u671f\u65f6\u95f4\u3001\u81ea\u52a8\u7eed\u671f\u3001\u624b\u52a8\u91ca\u653e\uff08lua \u539f\u5b50\u64cd\u4f5c\uff09",id:"22\u8fc7\u671f\u65f6\u95f4\u81ea\u52a8\u7eed\u671f\u624b\u52a8\u91ca\u653elua-\u539f\u5b50\u64cd\u4f5c",level:3},{value:"2.3.\u6307\u5b9a\u8d85\u65f6\u4e0d\u81ea\u52a8\u7eed\u671f",id:"23\u6307\u5b9a\u8d85\u65f6\u4e0d\u81ea\u52a8\u7eed\u671f",level:3},{value:"2.4.tryLock",id:"24trylock",level:3},{value:"2.5.\u516c\u5e73\u9501",id:"25\u516c\u5e73\u9501",level:3},{value:"2.6.\u8bfb\u5199\u9501",id:"26\u8bfb\u5199\u9501",level:3},{value:"2.7.\u4fe1\u53f7\u91cf Semphore",id:"27\u4fe1\u53f7\u91cf-semphore",level:3},{value:"2.8.\u95ed\u9501 CountDownLatch",id:"28\u95ed\u9501-countdownlatch",level:3},{value:"2.9.\u9501\u7684\u7c92\u5ea6",id:"29\u9501\u7684\u7c92\u5ea6",level:3},{value:"2.10.redisson \u5206\u5e03\u5f0f\u9501\u7248\u672c",id:"210redisson-\u5206\u5e03\u5f0f\u9501\u7248\u672c",level:3},{value:"1.\u53cc\u5199\u6a21\u5f0f\u548c\u5931\u6548\u6a21\u5f0f\u4e0e\u6700\u7ec8\u4e00\u81f4\u6027\uff08\u6307\u4fee\u6539\u6570\u636e\u65b9\u6848\uff09",id:"1\u53cc\u5199\u6a21\u5f0f\u548c\u5931\u6548\u6a21\u5f0f\u4e0e\u6700\u7ec8\u4e00\u81f4\u6027\u6307\u4fee\u6539\u6570\u636e\u65b9\u6848",level:2},{value:"2.\u89e3\u51b3\u65b9\u6848\uff08\u9009\u7528\u5931\u6548\u6a21\u5f0f\uff09",id:"2\u89e3\u51b3\u65b9\u6848\u9009\u7528\u5931\u6548\u6a21\u5f0f",level:2},{value:"2.1.canal",id:"21canal",level:3},{value:"1.\u6574\u5408",id:"1\u6574\u5408",level:2},{value:"2.\u8bfb\u6a21\u5f0f\u4e0e\u5199\u6a21\u5f0f",id:"2\u8bfb\u6a21\u5f0f\u4e0e\u5199\u6a21\u5f0f",level:2},{value:"2.1.\u8bfb\u6a21\u5f0f",id:"21\u8bfb\u6a21\u5f0f",level:3},{value:"2.2.\u5199\u6a21\u5f0f",id:"22\u5199\u6a21\u5f0f",level:3},{value:"\u5931\u6548\u6a21\u5f0f",id:"\u5931\u6548\u6a21\u5f0f",level:4},{value:"\u53cc\u5199\u6a21\u5f0f",id:"\u53cc\u5199\u6a21\u5f0f",level:4},{value:"2.3.@Caching+\u5931\u6548\u6a21\u5f0f+\u89e3\u51b3\u51fb\u7a7f\u3001\u96ea\u5d29\u3001\u7a7f\u900f\uff08\u5206\u5e03\u5f0f\u9501\uff09",id:"23caching\u5931\u6548\u6a21\u5f0f\u89e3\u51b3\u51fb\u7a7f\u96ea\u5d29\u7a7f\u900f\u5206\u5e03\u5f0f\u9501",level:3},{value:"4.\u7ec6\u8282",id:"4\u7ec6\u8282",level:2},{value:"2.1.@ConfigurationProperties \u6807\u6ce8\u65b9\u6cd5\u4e0a\u4f7f\u7528",id:"21configurationproperties-\u6807\u6ce8\u65b9\u6cd5\u4e0a\u4f7f\u7528",level:3},{value:"2.2.@ConfigurationProperties \u6807\u6ce8\u7c7b\u4e0a\u4f7f\u7528",id:"22configurationproperties-\u6807\u6ce8\u7c7b\u4e0a\u4f7f\u7528",level:3},{value:"2.3. @EnableConfigurationProperties \u6807\u6ce8\u5728\u7c7b\u4e0a\u4f7f\u7528",id:"23-enableconfigurationproperties-\u6807\u6ce8\u5728\u7c7b\u4e0a\u4f7f\u7528",level:3},{value:"5.spring-cache \u4e0d\u8db3",id:"5spring-cache-\u4e0d\u8db3",level:2},{value:"\u6700\u7ec8\u7248\uff1a\u5931\u6548\u6a21\u5f0f+\u89e3\u51b3\u51fb\u7a7f\u3001\u96ea\u5d29\u3001\u7a7f\u900f\uff08\u672c\u5730\u9501\uff09",id:"\u6700\u7ec8\u7248\u5931\u6548\u6a21\u5f0f\u89e3\u51b3\u51fb\u7a7f\u96ea\u5d29\u7a7f\u900f\u672c\u5730\u9501",level:3},{value:"1.\u4e00\u4e9b\u4f7f\u7528\u6848\u4f8b",id:"1\u4e00\u4e9b\u4f7f\u7528\u6848\u4f8b",level:2},{value:"1.1.BoundHashOperations",id:"11boundhashoperations",level:3}];function d(r){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...r.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.p,{children:"[toc]"}),"\n",(0,a.jsx)(e.header,{children:(0,a.jsx)(e.h1,{id:"\u6982\u8ff0",children:"\u6982\u8ff0"})}),"\n",(0,a.jsx)(e.h2,{id:"1\u9002\u5408\u653e\u5165\u7f13\u5b58\u7684\u6570\u636e",children:"1.\u9002\u5408\u653e\u5165\u7f13\u5b58\u7684\u6570\u636e"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-json",children:"1.\u5373\u65f6\u6027\u3001\u6570\u636e\u4e00\u81f4\u6027\u8981\u6c42\u4e0d\u9ad8\u7684\r\n2.\u8bbf\u95ee\u91cf\u5927\u4e14\u66f4\u65b0\u9891\u7387\u4e0d\u9ad8\u7684\u6570\u636e\uff08\u8bfb\u591a\uff0c\u5199\u5c11\uff09\r\n\u4e3e\u4f8b\uff1a\r\n\t1.\u7535\u5546\u7c7b\u5e94\u7528\uff0c\u5546\u54c1\u5206\u7c7b\uff0c\u5546\u54c1\u5217\u8868\u7b49\u9002\u5408\u7f13\u5b58\u5e76\u52a0\u4e00\u4e2a\u5931\u6548\u65f6\u95f4\uff08\u6839\u636e\u6570\u636e\u66f4\u65b0\u9891\u7387\u6765\u5b9a\uff09\r\n\t2.\u540e\u53f0\u5982\u679c\u53d1\u5e03\u4e00\u4e2a\u5546\u54c1\uff0c\u4e70\u5bb6\u9700\u89815\u5206\u949f\u624d\u80fd\u770b\u5230\u65b0\u7684\u5546\u54c1\u4e00\u822c\u8fd8\u662f\u53ef\u4ee5\u63a5\u53d7\u7684\r\n\t3.\u7269\u6d41\u4fe1\u606f\n"})}),"\n",(0,a.jsx)(e.h2,{id:"2\u8bfb\u6a21\u5f0f\u7f13\u5b58\u4f7f\u7528\u6d41\u7a0b",children:"2.\u8bfb\u6a21\u5f0f\u7f13\u5b58\u4f7f\u7528\u6d41\u7a0b"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"http://img.doomwatcher.cn/img/2de2f4a095d7c644d46d9444d83b0a23.png",alt:"1635512623631"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"http://img.doomwatcher.cn/img/0f5a29c819eaa6aebc0bd68377ecb2d9.png",alt:"1635512538828"})}),"\n",(0,a.jsx)(e.h2,{id:"3\u672c\u5730\u7f13\u5b58\u4e0e\u5c40\u9650\u6027",children:"3.\u672c\u5730\u7f13\u5b58\u4e0e\u5c40\u9650\u6027"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-json",children:"1.\u96c6\u7fa4\u60c5\u51b5\u4e0b\uff0c\u6bcf\u4e2a\u8282\u70b9\u7684\u672c\u5730\u7f13\u5b58\u53ef\u80fd\u4f1a\u4e0d\u4e00\u81f4\uff08\u6570\u636e\u4e00\u81f4\u6027\uff09\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"http://img.doomwatcher.cn/img/41ed81f2ad154fcc65470c13a49f0663.png",alt:"1635513182709"})}),"\n",(0,a.jsx)(e.h2,{id:"4\u5206\u5e03\u5f0f\u7f13\u5b58",children:"4.\u5206\u5e03\u5f0f\u7f13\u5b58"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"\u4f7f\u7528\u7f13\u5b58\u4e2d\u95f4\u4ef6\uff1a\r\n\tredis\uff08\u96c6\u7fa4\u3001\u5206\u7247\uff09\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"http://img.doomwatcher.cn/img/44721c36c7d789fd677a5888b78e82e4.png",alt:"1635513259851"})}),"\n",(0,a.jsx)(e.h1,{id:"\u6574\u5408-redis",children:"\u6574\u5408 redis"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u628a redis \u770b\u505a Map"})}),"\n",(0,a.jsx)(e.h2,{id:"1\u4f7f\u7528-springboot-\u6574\u5408-redis",children:"1.\u4f7f\u7528 springboot \u6574\u5408 redis"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yml",children:"1.\u5728\u9700\u8981\u4f7f\u7528redis\u7684\u6a21\u5757\u5bfc\u5165\u4f9d\u8d56\uff0c\u542f\u52a8\u5668\r\n        \x3c!--redis\u542f\u52a8\u5668--\x3e\r\n        <dependency>\r\n            <groupId>org.springframework.boot</groupId>\r\n            <artifactId>spring-boot-starter-data-redis</artifactId>\r\n        </dependency>\r\n\r\n2.RedisAutoConfiguration\u67e5\u770b\u81ea\u52a8\u914d\u7f6e\r\n\u5728.yml\u589e\u52a0\u4ee5\u4e0b\u914d\u7f6e\r\nspring:\r\n  redis:\r\n    host: 192.168.56.10\r\n    port: 6379\r\n\r\n3.\u4f7f\u7528SpringBoot\u81ea\u52a8\u914d\u7f6e\u597d\u7684RedisTemplate\u6216\u8005StringRedisTemplate\u5373\u53ef\u64cd\u4f5credis\r\n\u3010\u4e00\u822c\u4f7f\u7528StringRedisTemplate\u3011\r\n\n"})}),"\n",(0,a.jsx)(e.h2,{id:"2\u6d4b\u8bd5\u7528\u4f8b",children:"2.\u6d4b\u8bd5\u7528\u4f8b"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'    @Autowired\r\n    StringRedisTemplate stringRedisTemplate;\r\n\r\n    /**\r\n     * \u6d4b\u8bd5redis\r\n     */\r\n    @Test\r\n    void testRedis() {\r\n        // \u83b7\u53d6\u64cd\u4f5c\u5bf9\u8c61\r\n        ValueOperations<String, String> ops = stringRedisTemplate.opsForValue();\r\n\r\n        // \u5b58\u50a8\r\n        ops.set("hello", "world" + UUID.randomUUID());\r\n\r\n        // \u83b7\u53d6\r\n        System.out.println(ops.get("hello"));\r\n    }\n'})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"http://img.doomwatcher.cn/img/e6ec18b8b7caf07fd7ff360d4d636159.png",alt:"1635514358072"})}),"\n",(0,a.jsx)(e.h2,{id:"3lettuce-\u5806\u5916\u5185\u5b58\u6ea2\u51faspringboot232-\u5df2\u89e3\u51b3",children:"3.lettuce \u5806\u5916\u5185\u5b58\u6ea2\u51fa\uff08springboot2.3.2 \u5df2\u89e3\u51b3\uff09"}),"\n",(0,a.jsx)(e.h3,{id:"31lettucejedisredistemplate",children:"3.1.lettuce\u3001jedis\u3001redistemplate"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"\u4e09\u8005\u5206\u522b\u662f\u4ec0\u4e48\uff1f\r\n\tlettuce\uff1aredis\u7684\u5ba2\u6237\u7aef\uff0c\u5bf9redis\u64cd\u4f5c\u8fdb\u884c\u5c01\u88c5\uff0c\u5185\u90e8\u4f7f\u7528netty\u8fdb\u884c\u7f51\u7edc\u901a\u4fe1\uff0c\u6027\u80fd\u5f88\u5f3a\r\n\tjedis\uff1aredis\u7684\u5ba2\u6237\u7aef\uff0c\u5bf9redis\u64cd\u4f5c\u8fdb\u884c\u5c01\u88c5\uff0c\u505c\u6b62\u66f4\u65b0\u4e86\r\n\tredistemplate\uff1a\u662fspringboot\u5bf9redis\u5ba2\u6237\u7aef\u7684\u518d\u5c01\u88c5\n"})}),"\n",(0,a.jsx)(e.h3,{id:"32\u539f\u56e0",children:"3.2.\u539f\u56e0"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-json",children:"\u5f02\u5e38\u63cf\u8ff0\uff1a\r\n\t\u5f53\u8fdb\u884c\u538b\u529b\u6d4b\u8bd5\u65f6\u540e\u671f\u51fa\u73b0\u5806\u5916\u5185\u5b58\u6ea2\u51faOutOfDirectMemoryError\uff08\u538b\u529b\u6d4b\u8bd5\u6307\u67e5\u8be2\u7f13\u5b58\u6570\u636e\uff09\r\n\r\n\u539f\u56e0\uff1a\r\n\t1\uff09springboot2.0\u4ee5\u540e\u9ed8\u8ba4\u4f7f\u7528lettuce\u4f5c\u4e3a\u64cd\u4f5credis\u7684\u5ba2\u6237\u7aef\uff0c\u5b83\u4f7f\u7528netty\u8fdb\u884c\u7f51\u7edc\u901a\u4fe1\uff0c\u4f7f\u7528netty\u521b\u5efa\u8fde\u63a5\u65f6\u672a\u53ca\u65f6\u91ca\u653e\u8fde\u63a5\r\n\t2\uff09\u5982\u679c\u6ca1\u6709\u4e3anetty\u6307\u5b9a\u5bf9\u5916\u5185\u5b58\uff0c\u9ed8\u8ba4\u4f7f\u7528Xms\u7684\u503c\uff08\u4f7f\u7528-Dio.netty.maxDirectMemory\u8bbe\u7f6e\u503c\uff09\r\n\r\n\u89e3\u51b3\uff1a\uff08\u53ea\u662f\u8c03\u5927\u5806\u5916\u5185\u5b58\u6cbb\u6807\u4e0d\u6cbb\u672c\uff09\r\n\t\u65b9\u6cd51\uff1a\u5347\u7ea7lettuce\u5ba2\u6237\u7aef\uff082.3.2\u5df2\u89e3\u51b3\uff09\r\n\t\u65b9\u6cd52\uff1a\u5207\u6362\u4f7f\u7528jedis\n"})}),"\n",(0,a.jsx)(e.h3,{id:"33\u89e3\u51b3\u65b9\u6cd5\u5207\u6362-jedis",children:"3.3.\u89e3\u51b3\u65b9\u6cd5\uff1a\u5207\u6362 jedis"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-xml",children:"\u6b65\u9aa4\uff1a\r\n\u6392\u9664lettuce\u4f9d\u8d56\uff0c\u5bfc\u5165jedis\r\n\x3c!--redis\u542f\u52a8\u5668--\x3e\r\n<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-data-redis</artifactId>\r\n    <exclusions>\r\n        \x3c!--\u6392\u9664springboot\u9ed8\u8ba4\u7684redis\u5ba2\u6237\u7aeflettus--\x3e\r\n        <exclusion>\r\n            <groupId>io.lettuce</groupId>\r\n            <artifactId>lettuce-core</artifactId>\r\n        </exclusion>\r\n    </exclusions>\r\n</dependency>\r\n\x3c!--jedis\uff0c\u64cd\u4f5credis\u7684\u5ba2\u6237\u7aef--\x3e\r\n<dependency>\r\n    <groupId>redis.clients</groupId>\r\n    <artifactId>jedis</artifactId>\r\n</dependency>\n"})}),"\n",(0,a.jsx)(e.h2,{id:"4\u7f13\u5b58\u5931\u6548\u95ee\u9898",children:"4.\u7f13\u5b58\u5931\u6548\u95ee\u9898"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-json",children:"\u8bfb\u6a21\u5f0f\uff0c\u4f1a\u5b58\u5728\u7f13\u5b58\u5931\u6548\u95ee\u9898\uff1a\r\n\t\u7f13\u5b58\u7a7f\u900f\u3001\u96ea\u5d29\u3001\u51fb\u7a7f\n"})}),"\n",(0,a.jsx)(e.h3,{id:"41\u7f13\u5b58\u7a7f\u900f\u4e0d\u5b58\u5728\u7684\u6570\u636e",children:"4.1.\u7f13\u5b58\u7a7f\u900f\uff08\u4e0d\u5b58\u5728\u7684\u6570\u636e\uff09"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-json",children:"\u7f13\u5b58\u7a7f\u900f:\r\n\t\u67e5\u8be2\u4e00\u4e2a\u4e00\u5b9a\u4e0d\u5b58\u5728\u7684\u6570\u636e\uff0c\u5bfc\u81f4\u4e00\u5b9a\u4f1a\u67e5\u8be2\u7f13\u5b58+\u67e5\u8be2DB\uff0c\u7f13\u5b58\u5931\u53bb\u610f\u4e49\uff08\u5927\u5e76\u53d1\u8fc7\u6765\u65f6\u4efb\u7136\u4f1a\u67e5\u8be2db\uff09\r\n\r\n\u98ce\u9669\uff1a\r\n\t\u5229\u7528\u4e0d\u5b58\u5728\u7684\u6570\u636e\u8fdb\u884c\u653b\u51fb\uff0c\u6570\u636e\u5e93\u987a\u65f6\u538b\u529b\u589e\u5927\uff0c\u6700\u7ec8\u5bfc\u81f4\u5d29\u6e83\r\n\r\n\u89e3\u51b3\uff1a\r\n\t\u65b9\u6cd51\uff1a\u5c06null\u7ed3\u679c\u7f13\u5b58\uff0c\u5e76\u52a0\u5165\u77ed\u6682\u8fc7\u671f\u65f6\u95f4\r\n\t\u5f0a\u7aef\uff1a\u67e5\u8be2\u6761\u4ef6\u4f7f\u7528UUID\u751f\u6210\uff0c\u4ecd\u7136\u51fa\u73b0\u7f13\u5b58\u7a7f\u900f\u95ee\u9898\uff0c\u5e76\u4e14redis\u5b58\u6ee1\u4e86null\r\n\r\n\t\u65b9\u6cd52\uff1a\u5e03\u9686\u8fc7\u6ee4\u5668\uff0c\u4e0d\u653e\u884c\u4e0d\u5b58\u5728\u7684\u67e5\u8be2\r\n    \u5728redis\u7ef4\u62a4id\u7684hash\u8868\u8fc7\u6ee4\u6389id\u4e0d\u5b58\u5728\u7684\u67e5\u8be2\uff08\u4e0d\u5230\u8fbeDB\u5c42\u67e5\u8be2\uff09\n"})}),"\n",(0,a.jsx)(e.h3,{id:"42\u7f13\u5b58\u96ea\u5d29\u5927\u9762\u79ef\u5931\u6548",children:"4.2.\u7f13\u5b58\u96ea\u5d29\uff08\u5927\u9762\u79ef\u5931\u6548\uff09"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-json",children:"\u7f13\u5b58\u96ea\u5d29\uff1a\r\n\t\u9ad8\u5e76\u53d1\u72b6\u6001\u4e0b\uff0c\u5927\u9762\u79efredis\u6570\u636e\u5931\u6548\uff0c\u5bfc\u81f4\u6240\u6709\u67e5\u8be2\u5230\u8fbeDB\uff0cDB\u77ac\u65f6\u538b\u529b\u8fc7\u91cd\u96ea\u5d29\r\n\r\n\u89e3\u51b3\uff1a\r\n\t\u65b9\u6cd51\uff1a\u89c4\u907f\u96ea\u5d29\uff0c\u8bbe\u7f6e\u968f\u673a\u7684\u6709\u6548\u65f6\u95f4\uff08\u5b9e\u9645\u4e0a\u65e0\u9700\u8bbe\u7f6e\u968f\u673a\u65f6\u95f4\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u7f13\u5b58\u653e\u5165\u5e93\u4e2d\u7684\u65f6\u95f4\u672c\u8eab\u5c31\u4e0d\u56fa\u5b9a\uff09\r\n\t\t\u8ba9\u6bcf\u4e00\u4e2a\u7f13\u5b58\u8fc7\u671f\u65f6\u95f4\u91cd\u590d\u7387\u964d\u4f4e\uff0c\r\n\r\n\t\u65b9\u6cd52\uff1a\u6c38\u4e0d\u5931\u6548\r\n\r\n\t\u65b9\u6cd53\uff1a\r\n\t\t\u4e8b\u524d\uff1a\u5c3d\u91cf\u4fdd\u8bc1\u6574\u4e2a redis \u96c6\u7fa4\u7684\u9ad8\u53ef\u7528\u6027\uff0c\u53d1\u73b0\u673a\u5668\u5b95\u673a\u5c3d\u5feb\u8865\u4e0a\u3002\u9009\u62e9\u5408\u9002\u7684\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\u3002\r\n\t\t\u4e8b\u4e2d\uff1a\u672c\u5730ehcache\u7f13\u5b58 + hystrix\u9650\u6d41&\u964d\u7ea7\uff0c\u907f\u514dMySQL\u5d29\u6389\r\n\t\t\u4e8b\u540e\uff1a\u5229\u7528 redis \u6301\u4e45\u5316\u673a\u5236\u4fdd\u5b58\u7684\u6570\u636e\u5c3d\u5feb\u6062\u590d\u7f13\u5b58\r\n\r\n\u95ee\u9898\uff1a\u5982\u679c\u5df2\u7ecf\u51fa\u73b0\u4e86\u7f13\u5b58\u96ea\u5d29\uff0c\u5982\u4f55\u89e3\u51b3\uff1f\r\n\t\u65b9\u6cd51\uff1a\u7194\u65ad\u3001\u964d\u7ea7\n"})}),"\n",(0,a.jsx)(e.h3,{id:"43\u7f13\u5b58\u51fb\u7a7f\u4e00\u6761\u5931\u6548",children:"4.3.\u7f13\u5b58\u51fb\u7a7f\uff08\u4e00\u6761\u5931\u6548\uff09"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-json",children:"\u7f13\u5b58\u51fb\u7a7f\uff1a\r\n\t\u9ad8\u5e76\u53d1\u72b6\u6001\u4e0b\uff0c\u4e00\u6761\u6570\u636e\u8fc7\u671f\uff0c\u6240\u6709\u8bf7\u6c42\u5230\u8fbeDB\r\n\r\n\u89e3\u51b3\uff1a\r\n\t\u65b9\u6cd51\uff1a\u52a0\u5206\u5e03\u5f0f\u9501\r\n\t\u4f8b\u539f\u5b50\u64cd\u4f5c\uff08Redis\u7684SETNX\u6216\u8005Memcache\u7684ADD\uff09\r\n\t\u6d41\u7a0b\uff1a\u67e5\u8be2cache\u5931\u8d25\uff0c\u7ade\u4e89\u9501\uff0c\u7ade\u4e89\u6210\u529f\u67e5\u8be2cache\uff0c\u67e5\u8be2\u6210\u529f\u8fd4\u56de\u91ca\u653e\u9501\r\n\t\t\u67e5\u8be2\u5931\u8d25\u5219\u67e5\u8be2DB\uff0c\u5e76set\u7f13\u5b58\uff0c\u5e76\u91ca\u653e\u9501\r\n\r\n\t\u65b9\u6cd52\uff1a\u6c38\u4e0d\u5931\u6548\n"})}),"\n",(0,a.jsx)(e.h3,{id:"44\u9501\u65f6\u6548\u95ee\u9898",children:"4.4.\u9501\u65f6\u6548\u95ee\u9898"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-json",children:"\u7ed3\u679c\u653e\u5165\u7f13\u5b58\u7684\u64cd\u4f5c\uff0c\u5e94\u8be5\u653e\u5728\u540c\u6b65\u4ee3\u7801\u5757\u5185\uff0c\u5426\u5219\u4f1a\u9020\u6210\u91cd\u590d\u67e5\u8be2DB\u7684\u60c5\u51b5\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"http://img.doomwatcher.cn/img/be95534b068f7f8be7e8d5c4377b2aa4.png",alt:"1635663356474"})}),"\n",(0,a.jsx)(e.h3,{id:"45\u6a21\u62df\u5206\u5e03\u5f0f\u672c\u5730\u9501\u5931\u6548",children:"4.5.\u6a21\u62df\u5206\u5e03\u5f0f\u672c\u5730\u9501\u5931\u6548"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-json",children:"1.\u542f\u52a8\u591a\u4efd\u914d\u7f6e\r\n\r\n2.\u4fee\u6539\u538b\u6d4b\u914d\u7f6e\r\n\tgulimall.com\t80\r\n    /index/catalog.json\r\n\r\n3.\u5f00\u59cb\u538b\u6d4b\r\n\t100\u4e2a\u7ebf\u7a0b  \u5faa\u73af5\u6b21\r\n\r\n4.\u672c\u5730\u9501\u5931\u6548\uff0c\u591a\u6b21\u67e5\u8be2\u6570\u636e\u5e93\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"http://img.doomwatcher.cn/img/3d46f1e3482acf3f6f0875f4bab56c39.png",alt:"1635663592317"})}),"\n",(0,a.jsx)(e.h2,{id:"5\u5206\u5e03\u5f0f\u9501",children:"5.\u5206\u5e03\u5f0f\u9501"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-json",children:"\u6587\u68631\uff1ahttp://redisdoc.com/string/set.html\r\n\u6587\u68632\uff1ahttp://www.redis.cn/commands/set.html\r\n\r\n\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"http://img.doomwatcher.cn/img/ea0581f01b74a64a5778f334088d374d.png",alt:"1635664198425"})}),"\n",(0,a.jsx)(e.h3,{id:"51\u6f14\u793a\u5206\u5e03\u5f0f\u9501-setnx",children:"5.1.\u6f14\u793a\u5206\u5e03\u5f0f\u9501 SETNX"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-sh",children:"1.\u6253\u5f00\u591a\u4e2ash\u6846\r\n\r\n2.\u6253\u5f00xshell\u64b0\u5199\u680f\uff08\u67e5\u770b->\u64b0\u5199->\u64b0\u5199\u680f\uff09\r\n\r\n3.\u7f16\u8f91\u547d\u4ee4\uff0c\u53d1\u9001\u7ed9\u591a\u4e2a\u7a97\u53e3\uff0c\u540c\u65f6\u8fde\u63a5redis\u5ba2\u6237\u7aef\r\ndocker exec -it redis redis-cli\r\n\r\n4.\u7f16\u8f91\u547d\u4ee4\uff0c\u53d1\u9001\u7ed9\u591a\u4e2a\u7a97\u53e3\uff0c\u540c\u65f6\u5360\u9501\r\nset key value NX\r\n\u8fd4\u56deOK\u8868\u793a\u5360\u9501\u6210\u529f\uff0c\u8fd4\u56denill\u5360\u9501\u5931\u8d25\r\n\r\n5.\u8bbe\u7f6e\u9501\u8fc7\u671f\u65f6\u95f4\r\nset key value EX 300 NX\r\n\r\n6.\u67e5\u770b\u9501\u8fc7\u671f\u65f6\u95f4\r\nttl lock\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u53d1\u9001\u547d\u4ee4\u81f3\u5168\u90e8\u4f1a\u8bdd\uff1a"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"http://img.doomwatcher.cn/img/248e4e439b6d2ae713eeb21837acc0c2.png",alt:"1635669533421"})}),"\n",(0,a.jsx)(e.p,{children:"\u9501\u503c\uff1a"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"http://img.doomwatcher.cn/img/b864eb8a242754d33025528974ed69b1.png",alt:"1635670061333"})}),"\n",(0,a.jsx)(e.h3,{id:"52\u95ee\u9898\u5408\u96c6",children:"5.2.\u95ee\u9898\u5408\u96c6"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"\u95ee\u98981\uff1a\uff08\u5220\u9664\u9501\uff09\r\n\t\u672a\u6267\u884c\u5220\u9664\u9501\u903b\u8f91\uff0c\u4f1a\u5bfc\u81f4\u5176\u4ed6\u7ebf\u7a0b\u65e0\u6cd5\u83b7\u5f97\u9501\uff0c\u51fa\u73b0\u6b7b\u9501\r\n\u95ee\u98982\uff1a\uff08\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff09\r\n    \u9501\u91ca\u653e\u64cd\u4f5c\u53ef\u80fd\u5931\u8d25\uff08\u670d\u52a1\u5b95\u673a\uff09\uff0c\u6240\u4ee5\u9700\u8981\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\r\n\u95ee\u98983\uff1a\uff08\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u539f\u5b50\u6027\uff09\r\n    \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u4ee3\u7801\u5fc5\u987b\u5728setnx\u62a2\u5360\u9501\u7684\u540c\u65f6\u8bbe\u7f6e\uff0c\u4fdd\u8bc1\u539f\u5b50\u6027\r\n\u95ee\u98984\uff1a\uff08\u4ec5\u53ef\u4ee5\u5220\u9664\u5f53\u524d\u7ebf\u7a0b\u5360\u7528\u7684\u9501\uff09\r\n    \u5220\u9664\u9501\u65f6\uff0c\u53ef\u80fd\u9501\u5df2\u8fc7\u671f\u5220\u9664\u4e86\u5176\u4ed6\u7ebf\u7a0b\u7684\u9501\uff0c\u5360\u9501\u65f6\u8bbe\u7f6e\u503c\u4e3auuid\uff0c\u5220\u9664\u65f6\u5224\u65ad\u5f53\u524duuid\u662f\u5426\u76f8\u7b49\r\n    \u5e76\u4e14\u9700\u8981\u4f7f\u7528lua\u811a\u672c\u6267\u884c\u539f\u5b50\u5220\u9664\u64cd\u4f5c\r\n\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"http://img.doomwatcher.cn/img/a28c0b0a90e35fc592f9991a1461c9e5.png",alt:"1635670158689"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"http://img.doomwatcher.cn/img/af2562bcefc63a2489cb7d4bbf323a74.png",alt:"1635673350495"})}),"\n",(0,a.jsx)(e.h3,{id:"53redis-\u5206\u5e03\u5f0f\u9501\u7248\u672c",children:"5.3.redis \u5206\u5e03\u5f0f\u9501\u7248\u672c"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u67e5\u8be2\u4e09\u7ea7\u5206\u7c7b\uff08\u539f\u751f\u7248redis\u5206\u5e03\u5f0f\u9501\u7248\u672c\uff09\r\n */\r\npublic Map<String, List<Catalog2VO>> getCatalogJsonFromDBWithRedisLock() {\r\n    // 1.\u62a2\u5360\u5206\u5e03\u5f0f\u9501\uff0c\u540c\u65f6\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\r\n    String uuid = UUID.randomUUID().toString();\r\n    // \u4f7f\u7528setnx\u5360\u9501\uff08setIfAbsent\uff09\r\n    Boolean isLock = redisTemplate.opsForValue().setIfAbsent(CategoryConstant.LOCK_KEY_CATALOG_JSON, uuid, 300, TimeUnit.SECONDS);\r\n    if (isLock) {\r\n        // 2.\u62a2\u5360\u6210\u529f\r\n        Map<String, List<Catalog2VO>> result = null;\r\n        try {\r\n            // \u67e5\u8be2DB\r\n            return getCatalogJsonFromDB();\r\n        } finally {\r\n            // 3.\u67e5\u8be2UUID\u662f\u5426\u662f\u81ea\u5df1\uff0c\u662f\u81ea\u5df1\u7684lock\u5c31\u5220\u9664\r\n            // \u5c01\u88c5lua\u811a\u672c\uff08\u539f\u5b50\u64cd\u4f5c\u89e3\u9501\uff09\r\n            // \u67e5\u8be2+\u5220\u9664\uff08\u5f53\u524d\u503c\u4e0e\u76ee\u6807\u503c\u662f\u5426\u76f8\u7b49\uff0c\u76f8\u7b49\u6267\u884c\u5220\u9664\uff0c\u4e0d\u7b49\u8fd4\u56de0\uff09\r\n            String luaScript = "if redis.call(\'get\',KEYS[1]) == ARGV[1]\\n" +\r\n                    "then\\n" +\r\n                    "    return redis.call(\'del\',KEYS[1])\\n" +\r\n                    "else\\n" +\r\n                    "    return 0\\n" +\r\n                    "end";\r\n            // \u5220\u9664\u9501\r\n            redisTemplate.execute(new DefaultRedisScript<Long>(luaScript, Long.class), Arrays.asList(CategoryConstant.LOCK_KEY_CATALOG_JSON), uuid);\r\n        }\r\n    } else {\r\n        // 4.\u52a0\u9501\u5931\u8d25\uff0c\u81ea\u65cb\u91cd\u8bd5\r\n        try {\r\n            Thread.sleep(200);\r\n        } catch (InterruptedException e) {\r\n            e.printStackTrace();\r\n        }\r\n        return getCatalogJsonFromDBWithRedisLock();\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.h1,{id:"redisson",children:"Redisson"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-json",children:"\u6587\u6863\uff1a\r\nhttps://github.com/redisson/redisson/wiki/Table-of-Content\n"})}),"\n",(0,a.jsx)(e.h2,{id:"1\u6982\u8ff0",children:"1.\u6982\u8ff0"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-json",children:"1.\u4e0d\u63a8\u8350\u76f4\u63a5\u4f7f\u7528SETNX\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\uff0c\u5e94\u8be5\u4f7f\u7528Redisson\r\n\u56e0\u4e3a\u6839\u636e\u9501\u7684\u5b9e\u73b0\u4f1a\u5206\u4e3a\r\n\t\u8bfb\u5199\u9501\u3001\u53ef\u91cd\u5165\u9501\u3001\u95ed\u9501\u3001\u4fe1\u53f7\u91cf\u3001\r\n\r\n2.\u5c01\u88c5\u4e86\u5206\u5e03\u5f0fMap\u3001List\u7b49\u7c7b\u578b\r\n\r\n3.Redisson\u4e0elettuce\u3001jedis\u4e00\u6837\u90fd\u662fredis\u7684\u5ba2\u6237\u7aef\uff0c\u4ee3\u66ff\u4e86redisTemplate\n"})}),"\n",(0,a.jsx)(e.h2,{id:"2\u4f7f\u7528\u539f\u751f-redisson\u770b\u95e8\u72d7",children:"2.\u4f7f\u7528\u539f\u751f redisson(\u770b\u95e8\u72d7)"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'\u6b65\u9aa4\uff1a\r\n1.\u5f15\u5165\u4f9d\u8d56\r\n\x3c!--redisson\uff0credis\u5ba2\u6237\u7aef\uff0c\u5c01\u88c5\u4e86\u5206\u5e03\u5f0f\u9501\u5b9e\u73b0\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528springboot\u7684\u65b9\u5f0f\uff0c\u4e0d\u9700\u8981\u81ea\u5df1\u914d\u7f6e--\x3e\r\n<dependency>\r\n    <groupId>org.redisson</groupId>\r\n    <artifactId>redisson</artifactId>\r\n    <version>3.13.3</version>\r\n</dependency>\r\n\r\n2.\u914d\u7f6e\u7c7b\r\nimport org.redisson.Redisson;\r\nimport org.redisson.api.RedissonClient;\r\nimport org.redisson.config.Config;\r\nimport org.springframework.beans.factory.annotation.Value;\r\nimport org.springframework.context.annotation.Bean;\r\nimport org.springframework.context.annotation.Configuration;\r\n\r\nimport java.io.IOException;\r\n@Configuration\r\npublic class MyRedissonConfig {\r\n\r\n    /**\r\n     * \u6ce8\u5165\u5ba2\u6237\u7aef\u5b9e\u4f8b\u5bf9\u8c61\r\n     */\r\n    @Bean(destroyMethod="shutdown")\r\n    public RedissonClient redisson(@Value("${spring.redis.host}") String host, @Value("${spring.redis.port}")String port) throws IOException {\r\n        // 1.\u521b\u5efa\u914d\u7f6e\r\n        Config config = new Config();\r\n        config.useSingleServer().setAddress("redis://" + host + ":" + port);// \u5355\u8282\u70b9\u6a21\u5f0f\r\n//        config.useSingleServer().setAddress("rediss://" + host + ":" + port);// \u4f7f\u7528\u5b89\u5168\u8fde\u63a5\r\n//        config.useClusterServers().addNodeAddress("127.0.0.1:7004", "127.0.0.1:7001");// \u96c6\u7fa4\u6a21\u5f0f\r\n        // 2.\u521b\u5efaredisson\u5ba2\u6237\u7aef\u5b9e\u4f8b\r\n        RedissonClient redissonClient = Redisson.create(config);\r\n        return redissonClient;\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.h3,{id:"21\u53ef\u91cd\u5165\u9501",children:"2.1.\u53ef\u91cd\u5165\u9501"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'redisson\u5b9e\u73b0\u4e86JUC\u5305\u4e0b\u7684\u53ef\u91cd\u5165\u9501\r\n\r\nRLock lock = redissonClient.getLock("redisson_lock");\n'})}),"\n",(0,a.jsx)(e.h3,{id:"22\u8fc7\u671f\u65f6\u95f4\u81ea\u52a8\u7eed\u671f\u624b\u52a8\u91ca\u653elua-\u539f\u5b50\u64cd\u4f5c",children:"2.2.\u8fc7\u671f\u65f6\u95f4\u3001\u81ea\u52a8\u7eed\u671f\u3001\u624b\u52a8\u91ca\u653e\uff08lua \u539f\u5b50\u64cd\u4f5c\uff09"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-properties",children:"\u539f\u7406\uff1a\r\n\t// 1\uff09\u9ed8\u8ba4\u8fc7\u671f\u65f6\u95f430S\r\n    // 2\uff09\u9501\u81ea\u52a8\u7eed\u671f+30S\uff0c\u4e1a\u52a1\u8d85\u957f\u60c5\u51b5\u4e0b\uff08\u770b\u95e8\u72d7\uff09\r\n    // 3\uff09\u5982\u679c\u7ebf\u7a0b\u5b95\u673a\uff0c\u770b\u95e8\u72d7\u4e0d\u4f1a\u81ea\u52a8\u7eed\u671f\uff0c\u9501\u4f1a\u81ea\u52a8\u8fc7\u671f\r\n    // 4\uff09unlock\u4f7f\u7528lua\u811a\u672c\u91ca\u653e\u9501\uff0c\u4e0d\u4f1a\u51fa\u73b0\u8bef\u5220\u9501\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'\u4ee3\u7801\u6848\u4f8b\uff1a\r\n/**\r\n * \u6d4b\u8bd5redisson\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\r\n */\r\n@ResponseBody\r\n@GetMapping("/testRedisson")\r\npublic String test() {\r\n    // 1.\u83b7\u53d6\u9501\r\n    RLock lock = redissonClient.getLock("redisson_lock");\r\n\r\n    // 2.\u52a0\u9501\r\n    // 1\uff09\u9501\u81ea\u52a8\u7eed\u671f+30S\uff0c\u4e1a\u52a1\u8d85\u957f\u60c5\u51b5\u4e0b\uff08\u770b\u95e8\u72d7\uff09\r\n    // 2\uff09\u5982\u679c\u7ebf\u7a0b\u5b95\u673a\uff0c\u770b\u95e8\u72d7\u4e0d\u4f1a\u81ea\u52a8\u7eed\u671f\uff0c\u9501\u4f1a\u81ea\u52a8\u8fc7\u671f\r\n    // 3\uff09unlock\u4f7f\u7528lua\u811a\u672c\u91ca\u653e\u9501\uff0c\u4e0d\u4f1a\u51fa\u73b0\u8bef\u5220\u9501\r\n    lock.lock();\r\n\r\n    try {\r\n        // \u52a0\u9501\u6210\u529f\uff0c\u6267\u884c\u4e1a\u52a1\r\n        System.out.println("\u52a0\u9501\u6210\u529f\uff0c\u6267\u884c\u4e1a\u52a1..." + Thread.currentThread().getId());\r\n        Thread.sleep(30000);\r\n    } catch (Exception e) {\r\n\r\n    } finally {\r\n        // 3.\u89e3\u9501\r\n        System.out.println("\u89e3\u9501..." + Thread.currentThread().getId());\r\n        lock.unlock();\r\n    }\r\n\r\n    return "testRedisson";\r\n}\n'})}),"\n",(0,a.jsx)(e.h3,{id:"23\u6307\u5b9a\u8d85\u65f6\u4e0d\u81ea\u52a8\u7eed\u671f",children:"2.3.\u6307\u5b9a\u8d85\u65f6\u4e0d\u81ea\u52a8\u7eed\u671f"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-json",children:"1.\u67e5\u770b\u6e90\u7801\r\n\t1\uff09\u5f53\u4e0d\u6307\u5b9a\u8d85\u65f6\u65f6\u95f4\u65f6\uff0c\u9ed8\u8ba430S\u8fc7\u671f\uff0c\u4e14\u542f\u52a8\u4e00\u4e2a\u5b9a\u65f6\u4efb\u52a1\u3010\u81ea\u52a8\u7eed\u671f\u4efb\u52a1\u3011\r\n\t\t\u7eed\u671f\u65f6\u95f4\u70b9=\u9ed8\u8ba4\u8fc7\u671f\u65f6\u95f4/3\uff0c\u6ca1\u969410S\u6267\u884c\u4e00\u6b21\u7eed\u671f\r\n\t2\uff09\u5f53\u6307\u5b9a\u8d85\u65f6\u65f6\u95f4\u65f6\uff0c\u4e0d\u4f1a\u81ea\u52a8\u7eed\u671f\r\n\r\n2.\u63a8\u8350\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\r\n\t1\uff09\u53ef\u4ee5\u7701\u7565\u81ea\u52a8\u7eed\u671f\u64cd\u4f5c\r\n\t2\uff09\u82e5\u771f\u7684\u8d85\u65f6\u672a\u5b8c\u6210\uff0c\u5219\u5f88\u6709\u53ef\u80fd\u662f\u6570\u636e\u5e93\u5b95\u673a\uff0c\u5373\u4f7f\u7eed\u671f\u4e5f\u65e0\u6cd5\u5b8c\u6210\uff0c\u4e0d\u5e94\u8be5\u65e0\u9650\u7eed\u671f\u4e0b\u53bb\n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-json",children:'/**\r\n * \u6d4b\u8bd5redisson\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\r\n */\r\n@ResponseBody\r\n@GetMapping("/testRedisson")\r\npublic String test() {\r\n    // 1.\u83b7\u53d6\u9501\r\n    RLock lock = redissonClient.getLock("redisson_lock");\r\n\r\n    // 2.\u52a0\u9501\r\n    // 1\uff09\u9501\u81ea\u52a8\u7eed\u671f+30S\uff0c\u4e1a\u52a1\u8d85\u957f\u60c5\u51b5\u4e0b\uff08\u770b\u95e8\u72d7\uff09\r\n    // 2\uff09\u5982\u679c\u7ebf\u7a0b\u5b95\u673a\uff0c\u770b\u95e8\u72d7\u4e0d\u4f1a\u81ea\u52a8\u7eed\u671f\uff0c\u9501\u4f1a\u81ea\u52a8\u8fc7\u671f\r\n    // 3\uff09unlock\u4f7f\u7528lua\u811a\u672c\u91ca\u653e\u9501\uff0c\u4e0d\u4f1a\u51fa\u73b0\u8bef\u5220\u9501\r\n    lock.lock();\r\n\r\n    try {\r\n        // \u52a0\u9501\u6210\u529f\uff0c\u6267\u884c\u4e1a\u52a1\r\n        System.out.println("\u52a0\u9501\u6210\u529f\uff0c\u6267\u884c\u4e1a\u52a1..." + Thread.currentThread().getId());\r\n        Thread.sleep(30000);\r\n    } catch (Exception e) {\r\n\r\n    } finally {\r\n        // 3.\u89e3\u9501\r\n        System.out.println("\u89e3\u9501..." + Thread.currentThread().getId());\r\n        lock.unlock();\r\n    }\r\n\r\n    return "testRedisson";\r\n}\n'})}),"\n",(0,a.jsx)(e.h3,{id:"24trylock",children:"2.4.tryLock"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"// \u5c1d\u8bd5\u52a0\u9501\uff0c\u6700\u591a\u7b49\u5f85100\u79d2\r\n// \u8d85\u65f6\u65f6\u95f430\u79d2\r\nlock.tryLock(100, 30, TimeUnit.SECONDS);\n"})}),"\n",(0,a.jsx)(e.h3,{id:"25\u516c\u5e73\u9501",children:"2.5.\u516c\u5e73\u9501"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'// \u6709\u987a\u5e8f\u8fdb\u884c\u52a0\u9501\u64cd\u4f5c\uff0c\u6309\u7167\u8bf7\u6c42\u7684\u987a\u5e8f\r\nRLock lock = redisson.getFairLock("fair-lock");\n'})}),"\n",(0,a.jsx)(e.h3,{id:"26\u8bfb\u5199\u9501",children:"2.6.\u8bfb\u5199\u9501"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'\u5199+\u8bfb\uff1a\u8bfb\u963b\u585e\r\n\u5199+\u5199\uff1a\u963b\u585e\r\n\u8bfb+\u5199\uff1a\u5199\u963b\u585e\r\n\r\nRReadWriteLock rwlock = redisson.getReadWriteLock("lock");\r\n// \u8bfb\u9501\r\nrwlock.readLock().lock(10, TimeUnit.SECONDS);\r\n// \u5199\u9501\r\nrwlock.writeLock().lock(10, TimeUnit.SECONDS);\n'})}),"\n",(0,a.jsx)(e.p,{children:"\u5199\u9501\uff1a"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"http://img.doomwatcher.cn/img/1f9d99b814f28b20ee7a1ca08c3085d9.png",alt:"1597734236213"})}),"\n",(0,a.jsx)(e.p,{children:"\u8bfb\u9501\uff1a"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"http://img.doomwatcher.cn/img/fdbd1ec9ca37c46557970301e56735b0.png",alt:"1597734296729"})}),"\n",(0,a.jsx)(e.p,{children:"\u8bfb\u9501\u540c\u65f6\u5b58\u5165\u591a\u4e2a\uff1a"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"http://img.doomwatcher.cn/img/4a47fd299603171ca6126e91410698c6.png",alt:"1597735057026"})}),"\n",(0,a.jsx)(e.h3,{id:"27\u4fe1\u53f7\u91cf-semphore",children:"2.7.\u4fe1\u53f7\u91cf Semphore"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-json",children:'\u5148\u8bbe\u7f6e\u4e00\u4e2a\u503c\r\n\t"park" 3\r\n\r\nacquire\uff1a\u83b7\u53d6\u4e00\u4e2a\u4fe1\u53f7\u91cf\uff0c\u4e3a0\u963b\u585e\r\nrelease\uff1a\u91ca\u653e\u4e00\u4e2a\u4fe1\u53f7\u91cf\uff0c+1\r\ntryacquire\uff1a\u5c1d\u8bd5\u83b7\u53d6\u4e00\u4e2a\u4fe1\u53f7\u91cf\uff0c\u4e0d\u963b\u585e\r\n\r\n\u4f5c\u7528\uff1a\u3010\u9650\u6d41\u3011\r\n\t\u6240\u6709\u670d\u52a1\u4e0a\u6765\u4e86\u53bb\u83b7\u53d6\u4e00\u4e2a\u4fe1\u53f7\u91cf\uff0c\u4e00\u4e2a\u4e00\u4e2a\u653e\u884c\uff08\u6700\u591a\u53ea\u80fdn\u4e2a\u7ebf\u7a0b\u540c\u65f6\u6267\u884c\uff09\r\n\n'})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"http://img.doomwatcher.cn/img/9eda4760d793430502cc2a7e61f78be2.png",alt:"1635689277138"})}),"\n",(0,a.jsx)(e.h3,{id:"28\u95ed\u9501-countdownlatch",children:"2.8.\u95ed\u9501 CountDownLatch"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"// \u7b49\u5f85\u4e00\u7ec4\u64cd\u4f5c\u6267\u884c\u5b8c\u6bd5\uff0c\u7edf\u4e00\u6267\u884c\r\n\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"http://img.doomwatcher.cn/img/1b58fc947f819eab3b7d1faed1f2e0aa.png",alt:"1635689625640"})}),"\n",(0,a.jsx)(e.h3,{id:"29\u9501\u7684\u7c92\u5ea6",children:"2.9.\u9501\u7684\u7c92\u5ea6"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-properties",children:"\u9501\u7684\u7c92\u5ea6\u4e00\u5b9a\u8981\u5c0f\uff0c\u4f8b\u5982\u4e0d\u5e94\u8be5\u9501\u6574\u4e2a\u5546\u54c1\u64cd\u4f5c\uff0c\u5e94\u8be5\u5e26\u4e0a\u5546\u54c1ID\n"})}),"\n",(0,a.jsx)(e.h3,{id:"210redisson-\u5206\u5e03\u5f0f\u9501\u7248\u672c",children:"2.10.redisson \u5206\u5e03\u5f0f\u9501\u7248\u672c"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"/**\r\n * \u67e5\u8be2\u4e09\u7ea7\u5206\u7c7b\uff08redisson\u5206\u5e03\u5f0f\u9501\u7248\u672c\uff09\r\n */\r\npublic Map<String, List<Catalog2VO>> getCatalogJsonFromDBWithRedissonLock() {\r\n    // 1.\u62a2\u5360\u5206\u5e03\u5f0f\u9501\uff0c\u540c\u65f6\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\r\n    RLock lock = redisson.getLock(CategoryConstant.LOCK_KEY_CATALOG_JSON);\r\n    lock.lock(30, TimeUnit.SECONDS);\r\n    try {\r\n        // 2.\u67e5\u8be2DB\r\n        Map<String, List<Catalog2VO>> result = getCatalogJsonFromDB();\r\n        return result;\r\n    } finally {\r\n        // 3.\u91ca\u653e\u9501\r\n        lock.unlock();\r\n    }\r\n}\n"})}),"\n",(0,a.jsx)(e.h1,{id:"\u6570\u636e\u4e00\u81f4\u6027",children:"\u6570\u636e\u4e00\u81f4\u6027"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-json",children:"\u5199\u6a21\u5f0f\uff0c\u4f1a\u5b58\u5728\u6570\u636e\u4e00\u81f4\u6027\u95ee\u9898\uff1a\r\n\t1.\u52a0\u8bfb\u5199\u9501\u5b9e\u73b0\uff08\u6240\u4ee5\u5bf9\u4e00\u81f4\u6027\u9ad8\u7684\u6570\u636e\u4e0d\u8981\u653e\u5728\u7f13\u5b58\u91cc\uff09\r\n\t2.\u5f15\u5165canal\uff0c\u611f\u77e5mysql\u66f4\u65b0\u53bb\u66f4\u65b0\u7f13\u5b58\r\n\t3.\u8bfb\u591a\u5199\u591a\uff0c\u76f4\u63a5\u67e5\u6570\u636e\u5e93\n"})}),"\n",(0,a.jsx)(e.h2,{id:"1\u53cc\u5199\u6a21\u5f0f\u548c\u5931\u6548\u6a21\u5f0f\u4e0e\u6700\u7ec8\u4e00\u81f4\u6027\u6307\u4fee\u6539\u6570\u636e\u65b9\u6848",children:"1.\u53cc\u5199\u6a21\u5f0f\u548c\u5931\u6548\u6a21\u5f0f\u4e0e\u6700\u7ec8\u4e00\u81f4\u6027\uff08\u6307\u4fee\u6539\u6570\u636e\u65b9\u6848\uff09"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"\u6ce8\uff1a\u53cc\u5199\u6a21\u5f0f\u548c\u5931\u6548\u6a21\u5f0f\u90fd\u4f1a\u5bfc\u81f4\u6570\u636e\u4e00\u81f4\u6027\u95ee\u9898\uff08\u5199\u548c\u8bfb\u64cd\u4f5c\u5e76\u53d1\u65f6\u5bfc\u81f4\uff0c\u89e3\u51b3\uff0c\u8bfb\u4e0e\u5199\u64cd\u4f5c\u52a0\u8bfb\u5199\u9501\uff09\r\n\r\n\u53cc\u5199\u6a21\u5f0f\uff1a\r\n\t\u63cf\u8ff0\uff1a\u540c\u65f6\u5199\r\n\t\u6f0f\u6d1e\uff1a\u7f13\u5b58\u6709\u810f\u6570\u636e\u3002\u64cd\u4f5c1\u5199\u7f13\u5b58\u6162\u4e8e\u64cd\u4f5c2\u5199\u7f13\u5b58\uff0c\u5bfc\u81f4\u7f13\u5b58\u4e0eDB\u6570\u636e\u4e0d\u4e00\u81f4\r\n\t\u89e3\u51b3\uff1a\r\n\t\t\u65b9\u68481\uff1a\u5199\u6570\u636e\u5e93+\u5199\u7f13\u5b58\u6574\u4e2a\u52a0\u9501\r\n\t\t\u65b9\u68482\uff1a\u4e1a\u52a1\u662f\u5426\u5141\u8bb8\u6682\u65f6\u6027\u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898\uff0c\u82e5\u5141\u8bb8\u5219\u7ed9\u6570\u636e\u8bbe\u7f6e\u4e00\u4e2a\u8fc7\u671f\u65f6\u95f4\u5373\u53ef\r\n\r\n\u5931\u6548\u6a21\u5f0f\uff1a\r\n\t\u63cf\u8ff0\uff1aDB\u5199\u5b8c\uff0c\u5220\u9664\u7f13\u5b58\r\n\t\u6ce8\uff1a\u4e0b\u56fe\u6709\u9519\u8bef\uff0c\u7528\u62373\u5148\u8bfbdb-1\uff0c\u7136\u540e\u7528\u62372\u518d\u5199db-2\uff0c\u7528\u62372\u5220\u7f13\u5b58\uff0c\u7528\u62373\u5199\u7f13\u5b58\u3010\u5199\u5165\u810f\u6570\u636e1\u3011\r\n\t\u6f0f\u6d1e\uff1a\u7f13\u5b58\u6709\u810f\u6570\u636e\u3002\u7528\u62373\u5c06db-1\u5199\u5165\u4e86\u7f13\u5b58\r\n\t\u89e3\u51b3\uff1a\r\n\t\t\u65b9\u68481\uff1a\u5199\u6570\u636e\u5e93+\u5199\u7f13\u5b58\u6574\u4e2a\u52a0\u9501\r\n\t\t\u65b9\u68482\uff1a\u4e1a\u52a1\u662f\u5426\u5141\u8bb8\u6682\u65f6\u6027\u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898\uff0c\u82e5\u5141\u8bb8\u5219\u7ed9\u6570\u636e\u8bbe\u7f6e\u4e00\u4e2a\u8fc7\u671f\u65f6\u95f4\u5373\u53ef\r\n\r\n\u4e8c\u8005\u90fd\u6709\u810f\u6570\u636e\u7684\u53ef\u80fd\u6027\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"http://img.doomwatcher.cn/img/3bc73ac0016d1ed91c347245baea2116.png",alt:"1635691115207"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"http://img.doomwatcher.cn/img/44b77e5f585e1a0e1008fb76469a1a37.png",alt:"1635692249946"})}),"\n",(0,a.jsx)(e.h2,{id:"2\u89e3\u51b3\u65b9\u6848\u9009\u7528\u5931\u6548\u6a21\u5f0f",children:"2.\u89e3\u51b3\u65b9\u6848\uff08\u9009\u7528\u5931\u6548\u6a21\u5f0f\uff09"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"\u4e09\u79cd\u65b9\u6848\uff1a\r\n\t1.\u4ec5\u52a0\u8fc7\u671f\u65f6\u95f4\u5373\u53ef\uff08\u9996\u5148\u8003\u8651\u4e1a\u52a1\u9020\u6210\u810f\u6570\u636e\u7684\u6982\u7387\uff0c\u4f8b\u5982\u7528\u6237\u7ef4\u5ea6\u6570\u636e\uff08\u8ba2\u5355\u6570\u636e\u3001\u7528\u6237\u6570\u636e\uff09\u5e76\u53d1\u51e0\u7387\u5f88\u5c0f\uff0c\u6bcf\u8fc7\u4e00\u6bb5\u65f6\u95f4\u89e6\u53d1\u8bfb\u7684\u4e3b\u52a8\u66f4\u65b0\uff09\r\n\t2.canal\u8ba2\u9605binlog\u7684\u65b9\u5f0f\uff08\u83dc\u5355\u3001\u5546\u54c1\u4ecb\u7ecd\u7b49\u57fa\u7840\u6570\u636e\uff09\u3010\u5b8c\u7f8e\u89e3\u51b3\u3011\r\n\t3.\u52a0\u8bfb\u5199\u9501\r\n\t4.\u5b9e\u65f6\u6027\u3001\u4e00\u81f4\u6027\u8981\u6c42\u9ad8\u7684\u6570\u636e\uff0c\u5e94\u8be5\u76f4\u63a5\u67e5\u6570\u636e\u5e93\r\n\r\n\u6700\u7ec8\u65b9\u6848\uff1a\r\n    1.\u6240\u6709\u6570\u636e\u52a0\u4e0a\u8fc7\u671f\u65f6\u95f4\r\n    2.\u8bfb\u5199\u6570\u636e\u52a0\u5206\u5e03\u5f0f\u8bfb\u5199\u9501\uff08\u7ecf\u5e38\u5199\u7684\u6570\u636e\u4e0d\u8981\u653e\u5728\u7f13\u5b58\u91cc\uff09\n"})}),"\n",(0,a.jsx)(e.h3,{id:"21canal",children:"2.1.canal"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"canal\uff1a\r\n    \u963f\u91cc\u5f00\u6e90\u7684\u4e2d\u95f4\u4ef6\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u6570\u636e\u5e93\u7684\u4ece\u670d\u52a1\u5668\uff0c\u8ba2\u9605\u6570\u636e\u5e93\u7684binlog\u65e5\u5fd7\uff0c\u6570\u636e\u66f4\u65b0canal\u4e5f\u540c\u6b65\u66f4\u65b0redis\r\n\r\n\u53e6\u4e00\u4f5c\u7528\uff1a\r\n    \u89e3\u6790\u4e0d\u540c\u7684\u8868\u65e5\u5fd7\u5206\u6790\u8ba1\u7b97\u751f\u6210\u4e00\u5f20\u65b0\u7684\u8868\u8bb0\u5f55\r\n    \u6848\u4f8b\uff1a\r\n    \t\u6839\u636e\u7528\u6237\u8bbf\u95ee\u7684\u5546\u54c1\u8bb0\u5f55\u3001\u8ba2\u5355\u8bb0\u5f55 + \u5546\u54c1\u8bb0\u5f55\u8868\u5171\u540c\u751f\u6210\u4e00\u5f20\u7528\u6237\u63a8\u8350\u8868\uff0c\u5c55\u793a\u9996\u9875\u7684\u6570\u636e\uff08\u6bcf\u4e2a\u7528\u6237\u7684\u9996\u9875\u63a8\u8350\u6570\u636e\u662f\u4e0d\u4e00\u6837\u7684\uff09\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"http://img.doomwatcher.cn/img/27cfae800161100cbfa0cde09b7f5dd4.png",alt:"1635863295094"})}),"\n",(0,a.jsx)(e.h1,{id:"springcache",children:"SpringCache"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"\u7b80\u4ecb\uff1a\r\n    \u901a\u8fc7\u6ce8\u89e3\u5b9e\u73b0\u7f13\u5b58\uff1b\u5c5e\u4e8espring\u5185\u5bb9\u4e0d\u662fspringboot\r\n\u6587\u6863\uff1a\r\n    https://docs.spring.io/spring/docs/current/spring-framework-reference/integration.html#spring-integration\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"http://img.doomwatcher.cn/img/d703a0d4ffa78a0ca6487f6b70e350b8.png",alt:"1597740655126"})}),"\n",(0,a.jsx)(e.h2,{id:"1\u6574\u5408",children:"1.\u6574\u5408"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'\u6ce8\uff1aname::key\uff0c\u7f13\u5b58\u533a\u57df\u5316\u6307name\uff0ckey\u662f\u952e\r\n\r\n1.\u5f15\u5165SpringCache\u4f9d\u8d56\r\n\x3c!--Spring Cache\uff0c\u4f7f\u7528\u6ce8\u89e3\u7b80\u5316\u5f00\u53d1--\x3e\r\n<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-cache</artifactId>\r\n</dependency>\r\n\r\n2.\u5f15\u5165redis\u4f9d\u8d56\r\n\x3c!--redis\u542f\u52a8\u5668--\x3e\r\n<dependency>\r\n    <groupId>org.springframework.boot</groupId>\r\n    <artifactId>spring-boot-starter-data-redis</artifactId>\r\n</dependency>\r\n\r\n3.\u8fd9\u4e00\u6b65\u53ea\u662f\u67e5\u770b\u4e00\u4e0b\u81ea\u52a8\u914d\u7f6e\u7c7b+\u5c5e\u6027\u7c7b\uff0c\u6ca1\u6709\u5b9e\u9645\u7f16\u7801\u52a8\u4f5c\r\n    1\uff09\u81ea\u52a8\u914d\u7f6e\u4ee5\u4e0b\u5185\u5bb9\uff1a\r\n    \u5c5e\u6027\u7c7b\uff1aCacheProperties.java\u3010\u5c5e\u6027\u4ee5spring.cache\u5f00\u5934\u3011\r\n    \u81ea\u52a8\u914d\u7f6e\u7c7b\uff1aCacheAutoConfiguration.java\u3010\u4f1a\u5bfc\u5165RedisCacheConfiguration\u914d\u7f6e\u3011\r\n    redis\u81ea\u52a8\u914d\u7f6e\u7c7b\uff1aRedisCacheConfiguration.java\u3010\u5f80IOC\u6ce8\u5165\u4e86redis\u7f13\u5b58\u7ba1\u7406\u5668\u3011\r\n    redis\u7f13\u5b58\u7ba1\u7406\u5668\uff1aRedisCacheManager\u3010\u4f1a\u521d\u59cb\u5316\u6240\u6709\u7f13\u5b58\uff08\u51b3\u5b9a\u6bcf\u4e2a\u7f13\u5b58\u4f7f\u7528\u4ec0\u4e48\u914d\u7f6e\uff09\u3011\r\n    \t\u3010\u5982\u679cRedisCacheConfiguration\u6709\u5c31\u4f7f\u7528\uff0c\u6ca1\u6709\u5c31\u4f7f\u7528\u9ed8\u8ba4\u7684\uff08\u5bfc\u81f4\u7f13\u5b58\u4f7f\u7528\u9ed8\u8ba4\u914d\u7f6e\uff0c\u9ed8\u8ba4\u914d\u7f6e\u503c\u6765\u81ea\u4e8ethis.cacheProperties.getRedis()\uff09\u3011\r\n    \u6ce8\uff1a\u7f13\u5b58\u533a\u57df\u5316\u53ea\u662fspringcache\u7684\u5185\u5bb9\uff0c\u5728redis\u91cc\u6570\u636e\u5b58\u653e\u6ca1\u6709\u533a\u57df\u5316\u7684\u6982\u5ff5\uff0c\u4f53\u73b0\u4e3a name::key\r\n\r\n4.\u6ce8\u89e3\u89e3\u91ca\uff1a\r\n\t\t@Cacheable\uff1a\u66f4\u65b0\u7f13\u5b58\u3010\u8bfb\u64cd\u4f5c\uff1a\u5982\u679c\u5f53\u524d\u7f13\u5b58\u5b58\u5728\u65b9\u6cd5\u4e0d\u88ab\u6267\u884c\uff0c\u4e0d\u5b58\u5728\u5219\u6267\u884cget\u65b9\u6cd5\u5e76\u66f4\u65b0\u7f13\u5b58\u3011\r\n\t\t@CacheEvict\uff1a\u5220\u9664\u7f13\u5b58\u3010\u5199\u64cd\u4f5c\uff1a\u5931\u6548\u6a21\u5f0f\uff0c\u65b9\u6cd5\u6267\u884c\u5b8c\u5220\u9664\u7f13\u5b58\u3011\r\n\t\t@CachePut\uff1a\u66f4\u65b0\u7f13\u5b58\u3010\u5199\u64cd\u4f5c\uff1a\u53cc\u5199\u6a21\u5f0f\uff0c\u65b9\u6cd5\u6267\u884c\u5b8c\u66f4\u65b0\u7f13\u5b58\u3011\r\n\t\t@Caching\uff1a\u7ec4\u5408\u4ee5\u4e0a\u591a\u4e2a\u7f13\u5b58\u64cd\u4f5c\r\n\t\t@CacheConfig\uff1a\u5728\u7c7b\u7ea7\u522b\u5171\u4eab\u7f13\u5b58\u7684\u76f8\u540c\u914d\u7f6e\r\n\r\n5.\u5c5e\u6027\r\nspring:\r\n  redis:\r\n    host: 192.168.56.10\r\n    port: 6379\r\n  cache:\r\n    type: redis # \u4f7f\u7528redis\u4f5c\u4e3a\u7f13\u5b58\r\n    redis:\r\n      time-to-live: 3600s # \u8fc7\u671f\u65f6\u95f4\r\n      # key-prefix: CACHE_ # \u4f1a\u5bfc\u81f4\u81ea\u5df1\u5728@Cacheable\u91cc\u8bbe\u7f6e\u7684\u540d\u5b57\u5931\u6548\uff0c\u6240\u4ee5\u8fd9\u91cc\u4e0d\u6307\u5b9a\r\n      use-key-prefix: true # key\u503c\u52a0\u524d\u7f00\r\n      cache-null-values: true # \u7f13\u5b58\u63a7\u5236\r\n\r\n6.\u9ed8\u8ba4\u884c\u4e3a\uff1a\r\n\tkey\u81ea\u52a8\u751f\u6210\uff1a\u7f13\u5b58\u540d\u5b57::key\u503c\r\n    \u9ed8\u8ba4\u8fc7\u671f\u65f6\u95f4\uff1a-1\r\n    value\u503c\u9ed8\u8ba4\u5e8f\u5217\u5316\u65b9\u5f0f\uff1ajdk\u5e8f\u5217\u5316\u3010\u503c\u4f7f\u7528jdk\u5e8f\u5217\u5316\u540e\u5b58\u653e\u5230redis\u3011\r\n\r\n7.\u81ea\u5b9a\u4e49\u884c\u4e3a\r\n    \u7f13\u5b58\u540d\u5b57\uff1avalue = {"category"}\u3010\u533a\u57df\u5212\u5206\u3011\r\n\tkey\u503c\uff1akey = "\'levelCategorys\'"\r\n        \u3010\u63a5\u6536\u4e00\u4e2aSpEl\u8868\u8fbe\u5f0f\uff0c\u53ef\u4ee5\u83b7\u53d6\u5f53\u524d\u65b9\u6cd5\u540d\uff0c\u53c2\u6570\u5217\u8868\uff0c\u5355\u5f15\u53f7\u8868\u5b57\u7b26\u4e32\u3011\r\n        \u3010\u4f7f\u7528\u65b9\u6cd5\u540d\u4f5c\u4e3akey\uff1a"#root.method.name"\u3011\r\n    \u8fc7\u671f\u65f6\u95f4\uff1a\u5728application.yml\u4e2d\u6307\u5b9a\r\n    \u4fee\u6539\u5e8f\u5217\u5316\u65b9\u5f0f\u8981\u5728\u914d\u7f6e\u7c7b\u4e2d\u4fee\u6539\r\n\r\n8.\u914d\u7f6e\u7c7b\u3010\u6dfb\u52a0@EnableCache\u4f7f\u7528springcache\u3011\r\n@EnableConfigurationProperties(CacheProperties.class)\r\n@EnableCaching\r\n@Configuration\r\npublic class MyCacheConfig {\r\n\r\n//    @Autowired\r\n//    CacheProperties cacheProperties;\r\n\r\n    /**\r\n     * \u9700\u8981\u5c06\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u914d\u7f6e\u8bbe\u7f6e\u4e0a\r\n     * 1\u3001\u4f7f\u914d\u7f6e\u7c7b\u751f\u6548\r\n     * 1\uff09\u5f00\u542f\u914d\u7f6e\u7c7b\u4e0e\u5c5e\u6027\u7ed1\u5b9a\u529f\u80fdEnableConfigurationProperties\r\n     *\r\n     * @ConfigurationProperties(prefix = "spring.cache")  public class CacheProperties\r\n     * 2\uff09\u6ce8\u5165\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e86\r\n     * @Autowired CacheProperties cacheProperties;\r\n     * 3\uff09\u76f4\u63a5\u5728\u65b9\u6cd5\u53c2\u6570\u4e0a\u52a0\u5165\u5c5e\u6027\u53c2\u6570redisCacheConfiguration(CacheProperties redisProperties)\r\n     * \u81ea\u52a8\u4eceIOC\u5bb9\u5668\u4e2d\u627e\r\n     * <p>\r\n     * 2\u3001\u7ed9config\u8bbe\u7f6e\u4e0a\r\n     */\r\n    @Bean\r\n    RedisCacheConfiguration redisCacheConfiguration(CacheProperties cacheProperties) {\r\n        RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig();\r\n        config = config.serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(new StringRedisSerializer()));\r\n        config = config.serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(new GenericJackson2JsonRedisSerializer()));\r\n\r\n        // \u5f53\u81ea\u5df1\u5f80IOC\u6ce8\u5165\u4e86RedisCacheConfiguration\u914d\u7f6e\u7c7b\u65f6\uff0c\u4ee5\u4e0b\u53c2\u6570\u5168\u90fd\u5931\u6548\uff0c\u9700\u8981\u624b\u52a8\u8bbe\u7f6e\r\n        CacheProperties.Redis redisProperties = cacheProperties.getRedis();\r\n        if (redisProperties.getTimeToLive() != null) {\r\n            config = config.entryTtl(redisProperties.getTimeToLive());\r\n        }\r\n        if (redisProperties.getKeyPrefix() != null) {\r\n            config = config.prefixCacheNameWith(redisProperties.getKeyPrefix());\r\n        }\r\n        if (!redisProperties.isCacheNullValues()) {\r\n            config = config.disableCachingNullValues();\r\n        }\r\n        if (!redisProperties.isUseKeyPrefix()) {\r\n            config = config.disableKeyPrefix();\r\n        }\r\n        return config;\r\n    }\r\n}\r\n\r\n9.\u4f7f\u7528\u6848\u4f8b\uff1a\u5728service\u5c42\u4ee3\u7801\u4e0a\u6dfb\u52a0\u6ce8\u89e3\r\n/**\r\n * \u67e5\u51fa\u6240\u67091\u7ea7\u5206\u7c7b\r\n */\r\n@Cacheable(value = {"category"}, key = "\'level1Categorys\'")\r\n@Override\r\npublic List<CategoryEntity> getLevel1Categorys() {\r\n    System.out.println("\u8c03\u7528\u4e86getLevel1Categorys...");\r\n    // \u67e5\u8be2\u7236id=0\r\n    return baseMapper.selectList(new QueryWrapper<CategoryEntity>().eq("parent_cid", 0));\r\n}\n'})}),"\n",(0,a.jsxs)(e.p,{children:["redis \u7f13\u5b58\u7ba1\u7406\u5668\u6e90\u7801\uff0c\u4f1a\u521d\u59cb\u5316\u8fc7\u671f\u65f6\u95f4\u3001key \u524d\u7f00\u3001\u7a7a\u6570\u636e\u662f\u5426\u7f13\u5b58\u3001\u662f\u5426\u4f7f\u7528\u7f13\u5b58\u524d\u7f00",(0,a.jsx)(e.img,{src:"http://img.doomwatcher.cn/img/205896a194286a529fa05b2ab6edcec1.png",alt:"1636030148580"})]}),"\n",(0,a.jsx)(e.h2,{id:"2\u8bfb\u6a21\u5f0f\u4e0e\u5199\u6a21\u5f0f",children:"2.\u8bfb\u6a21\u5f0f\u4e0e\u5199\u6a21\u5f0f"}),"\n",(0,a.jsx)(e.h3,{id:"21\u8bfb\u6a21\u5f0f",children:"2.1.\u8bfb\u6a21\u5f0f"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'\u76f4\u63a5\u5728get\u65b9\u6cd5\u4e0a\u6dfb\u52a0@Cacheable\u5373\u53ef\r\n/**\r\n * \u67e5\u51fa\u6240\u67091\u7ea7\u5206\u7c7b\r\n */\r\n@Cacheable(value = {"category"}, key = "\'level1Categorys\'")\r\n@Override\r\npublic List<CategoryEntity> getLevel1Categorys() {\r\n    System.out.println("\u8c03\u7528\u4e86getLevel1Categorys...");\r\n    // \u67e5\u8be2\u7236id=0\r\n    return baseMapper.selectList(new QueryWrapper<CategoryEntity>().eq("parent_cid", 0));\r\n}\n'})}),"\n",(0,a.jsx)(e.h3,{id:"22\u5199\u6a21\u5f0f",children:"2.2.\u5199\u6a21\u5f0f"}),"\n",(0,a.jsx)(e.h4,{id:"\u5931\u6548\u6a21\u5f0f",children:"\u5931\u6548\u6a21\u5f0f"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u7ea7\u8054\u66f4\u65b0\r\n * \u7f13\u5b58\u7b56\u7565\uff1a\u5931\u6548\u6a21\u5f0f\uff0c\u65b9\u6cd5\u6267\u884c\u5b8c\u5220\u9664\u7f13\u5b58\r\n */\r\n@CacheEvict(value = "category", key = "\'level1Categorys\'")\r\n@Transactional\r\n@Override\r\npublic void updateCascade(CategoryEntity category) {\r\n    this.updateById(category);\r\n    if (!StringUtils.isEmpty(category.getName())) {\r\n        // \u66f4\u65b0\u5197\u4f59\u8868\r\n        categoryBrandRelationService.updateCategory(category.getCatId(), category.getName());\r\n        // TODO \u66f4\u65b0\u5176\u4ed6\u5197\u4f59\u8868\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.h4,{id:"\u53cc\u5199\u6a21\u5f0f",children:"\u53cc\u5199\u6a21\u5f0f"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u7ea7\u8054\u66f4\u65b0\r\n * \u7f13\u5b58\u7b56\u7565\uff1a\u53cc\u5199\u6a21\u5f0f\uff0c\u65b9\u6cd5\u6267\u884c\u5b8c\u66f4\u65b0\u7f13\u5b58\r\n */\r\n@CachePut(value = "category", key = "\'level1Categorys\'")\r\n@Transactional\r\n@Override\r\npublic void updateCascade(CategoryEntity category) {\r\n    this.updateById(category);\r\n    if (!StringUtils.isEmpty(category.getName())) {\r\n        // \u66f4\u65b0\u5197\u4f59\u8868\r\n        categoryBrandRelationService.updateCategory(category.getCatId(), category.getName());\r\n        // TODO \u66f4\u65b0\u5176\u4ed6\u5197\u4f59\u8868\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.h3,{id:"23caching\u5931\u6548\u6a21\u5f0f\u89e3\u51b3\u51fb\u7a7f\u96ea\u5d29\u7a7f\u900f\u5206\u5e03\u5f0f\u9501",children:"2.3.@Caching+\u5931\u6548\u6a21\u5f0f+\u89e3\u51b3\u51fb\u7a7f\u3001\u96ea\u5d29\u3001\u7a7f\u900f\uff08\u5206\u5e03\u5f0f\u9501\uff09"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'\u5931\u6548\u6a21\u5f0f\uff0c\u7ea7\u8054\u66f4\u65b0\u7c7b\u578b\u65f6\uff0c\u5220\u9664\u4e0e\u7c7b\u578b\u76f8\u5173\u7684\u6240\u6709\u7f13\u5b58\r\n\r\n\u4e24\u79cd\u65b9\u5f0f\uff1a\r\n    \u65b9\u5f0f1\uff1a\u6307\u5b9a\u6bcf\u4e2akey\r\n    @Caching(evict = {\r\n        @CacheEvict(value = "category", key = "\'getLevel1Categorys\'"),\r\n        @CacheEvict(value = "category", key = "\'getCatalogJson\'")\r\n    })\r\n\r\n    \u65b9\u5f0f2\uff1a\u76f4\u63a5\u5220\u9664\u533a\u57df\u5316\u5185\u6240\u6709\u7f13\u5b58\r\n    @CacheEvict(value = {"category"}, allEntries = true)\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u7ea7\u8054\u66f4\u65b0\u6240\u6709\u5173\u8054\u8868\u7684\u5197\u4f59\u6570\u636e\r\n * \u7f13\u5b58\u7b56\u7565\uff1a\u5931\u6548\u6a21\u5f0f\uff0c\u65b9\u6cd5\u6267\u884c\u5b8c\u5220\u9664\u7f13\u5b58\r\n */\r\n@CacheEvict(value = {"category"}, allEntries = true)\r\n@Transactional\r\n@Override\r\npublic void updateCascade(CategoryEntity category) {\r\n    this.updateById(category);\r\n    if (!StringUtils.isEmpty(category.getName())) {\r\n        // \u66f4\u65b0\u5197\u4f59\u8868\r\n        categoryBrandRelationService.updateCategory(category.getCatId(), category.getName());\r\n        // TODO \u66f4\u65b0\u5176\u4ed6\u5197\u4f59\u8868\r\n    }\r\n}\r\n\r\n/**\r\n * \u67e5\u51fa\u6240\u67091\u7ea7\u5206\u7c7b\r\n */\r\n@Cacheable(value = {"category"}, key = "\'getLevel1Categorys\'")\r\n@Override\r\npublic List<CategoryEntity> getLevel1Categorys() {\r\n    System.out.println("\u8c03\u7528\u4e86getLevel1Categorys...");\r\n    // \u67e5\u8be2\u7236id=0\r\n    return baseMapper.selectList(new QueryWrapper<CategoryEntity>().eq("parent_cid", 0));\r\n}\r\n\r\n/**\r\n * \u67e5\u8be2\u4e09\u7ea7\u5206\u7c7b\u5e76\u5c01\u88c5\u6210Map\u8fd4\u56de\r\n * \u4f7f\u7528SpringCache\u6ce8\u89e3\u65b9\u5f0f\u7b80\u5316\u7f13\u5b58\u8bbe\u7f6e\r\n */\r\n@Cacheable(value = {"category"}, key = "\'getCatalogJson\'")\r\n@Override\r\npublic Map<String, List<Catalog2VO>> getCatalogJsonWithSpringCache() {\r\n    // \u672a\u547d\u4e2d\u7f13\u5b58\r\n    // 1.\u62a2\u5360\u5206\u5e03\u5f0f\u9501\uff0c\u540c\u65f6\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u3010\u4e0d\u4f7f\u7528\u8bfb\u5199\u9501\uff0c\u56e0\u4e3a\u5c31\u662f\u4e3a\u4e86\u9632\u6b62\u7f13\u5b58\u51fb\u7a7f\u3011\r\n    RLock lock = redisson.getLock(CategoryConstant.LOCK_KEY_CATALOG_JSON);\r\n    lock.lock(30, TimeUnit.SECONDS);\r\n    try {\r\n        // 2.double check\uff0c\u5360\u9501\u6210\u529f\u9700\u8981\u518d\u6b21\u68c0\u67e5\u7f13\u5b58\r\n        // \u67e5\u8be2\u975e\u7a7a\u5373\u8fd4\u56de\r\n        String catlogJSON = redisTemplate.opsForValue().get("getCatalogJson");\r\n        if (!StringUtils.isEmpty(catlogJSON)) {\r\n            // \u67e5\u8be2\u6210\u529f\u76f4\u63a5\u8fd4\u56de\u4e0d\u9700\u8981\u67e5\u8be2DB\r\n            Map<String, List<Catalog2VO>> result = JSON.parseObject(catlogJSON, new TypeReference<Map<String, List<Catalog2VO>>>() {\r\n            });\r\n            return result;\r\n        }\r\n\r\n        // 3.\u67e5\u8be2\u6240\u6709\u5206\u7c7b\uff0c\u6309\u7167parentCid\u5206\u7ec4\r\n        Map<Long, List<CategoryEntity>> categoryMap = baseMapper.selectList(null).stream()\r\n                .collect(Collectors.groupingBy(key -> key.getParentCid()));\r\n\r\n        // 4.\u83b7\u53d61\u7ea7\u5206\u7c7b\r\n        List<CategoryEntity> level1Categorys = categoryMap.get(0L);\r\n\r\n        // 5.\u5c01\u88c5\u6570\u636e\r\n        Map<String, List<Catalog2VO>> result = level1Categorys.stream().collect(Collectors.toMap(key -> key.getCatId().toString(), l1Category -> {\r\n            // 6.\u67e5\u8be22\u7ea7\u5206\u7c7b\uff0c\u5e76\u5c01\u88c5\u6210List<Catalog2VO>\r\n            List<Catalog2VO> catalog2VOS = categoryMap.get(l1Category.getCatId())\r\n                    .stream().map(l2Category -> {\r\n                        // 7.\u67e5\u8be23\u7ea7\u5206\u7c7b\uff0c\u5e76\u5c01\u88c5\u6210List<Catalog3VO>\r\n                        List<Catalog2VO.Catalog3Vo> catalog3Vos = categoryMap.get(l2Category.getCatId())\r\n                                .stream().map(l3Category -> {\r\n                                    // \u5c01\u88c53\u7ea7\u5206\u7c7bVO\r\n                                    Catalog2VO.Catalog3Vo catalog3Vo = new Catalog2VO.Catalog3Vo(l2Category.getCatId().toString(), l3Category.getCatId().toString(), l3Category.getName());\r\n                                    return catalog3Vo;\r\n                                }).collect(Collectors.toList());\r\n                        // \u5c01\u88c52\u7ea7\u5206\u7c7bVO\u8fd4\u56de\r\n                        Catalog2VO catalog2VO = new Catalog2VO(l1Category.getCatId().toString(), catalog3Vos, l2Category.getCatId().toString(), l2Category.getName());\r\n                        return catalog2VO;\r\n                    }).collect(Collectors.toList());\r\n            return catalog2VOS;\r\n        }));\r\n        return result;\r\n    } finally {\r\n        // 8.\u91ca\u653e\u9501\r\n        lock.unlock();\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.h2,{id:"4\u7ec6\u8282",children:"4.\u7ec6\u8282"}),"\n",(0,a.jsx)(e.h3,{id:"21configurationproperties-\u6807\u6ce8\u65b9\u6cd5\u4e0a\u4f7f\u7528",children:"2.1.@ConfigurationProperties \u6807\u6ce8\u65b9\u6cd5\u4e0a\u4f7f\u7528"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'\u4f7f\u7528@ConfigurationProperties\u6807\u6ce8\u5728\u65b9\u6cd5\u4e0a\u4f7f\u7528\u65f6\u5fc5\u987b\u914d\u5408@Bean + @Configuration\u4f7f\u7528\r\n\r\n@Configuration\r\npublic class DruidDataSourceConfig {\r\n    /**\r\n     * DataSource \u914d\u7f6e\r\n     * @return\r\n     */\r\n    @ConfigurationProperties(prefix = "spring.datasource.druid.read")\r\n    @Bean(name = "readDruidDataSource")\r\n    public DataSource readDruidDataSource() {\r\n        return new DruidDataSource();\r\n    }\r\n\r\n\r\n    /**\r\n     * DataSource \u914d\u7f6e\r\n     * @return\r\n     */\r\n    @ConfigurationProperties(prefix = "spring.datasource.druid.write")\r\n    @Bean(name = "writeDruidDataSource")\r\n    @Primary\r\n    public DataSource writeDruidDataSource() {\r\n        return new DruidDataSource();\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-properties",children:"spring.datasource.druid.write.username=root\r\nspring.datasource.druid.write.password=1\r\nspring.datasource.druid.write.driver-class-name=com.mysql.jdbc.Driver\r\n\r\nspring.datasource.druid.read.url=jdbc:mysql://localhost:3306/jpa\r\nspring.datasource.druid.read.username=root\r\nspring.datasource.druid.read.password=1\r\nspring.datasource.druid.read.driver-class-name=com.mysql.jdbc.Driver\n"})}),"\n",(0,a.jsx)(e.h3,{id:"22configurationproperties-\u6807\u6ce8\u7c7b\u4e0a\u4f7f\u7528",children:"2.2.@ConfigurationProperties \u6807\u6ce8\u7c7b\u4e0a\u4f7f\u7528"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'@ConfigurationProperties(prefix = "spring.datasource")\r\n@Component\r\n@Setter\r\n@Getter\r\npublic class DatasourcePro {\r\n\r\n    private String url;\r\n    private String username;\r\n    private String password;\r\n    // \u914d\u7f6e\u6587\u4ef6\u4e2d\u662fdriver-class-name, \u8f6c\u9a7c\u5cf0\u547d\u540d\u4fbf\u53ef\u4ee5\u7ed1\u5b9a\u6210\r\n    private String driverClassName;\r\n    private String type;\r\n}\r\n\r\n\r\n\r\n@Controller\r\n@RequestMapping(value = "/config")\r\npublic class ConfigurationPropertiesController {\r\n\r\n    @Autowired\r\n    private DatasourcePro datasourcePro;\r\n\r\n    @RequestMapping("/test")\r\n    @ResponseBody\r\n    public Map<String, Object> test(){\r\n\r\n        Map<String, Object> map = new HashMap<>();\r\n        map.put("url", datasourcePro.getUrl());\r\n        map.put("userName", datasourcePro.getUsername());\r\n        map.put("password", datasourcePro.getPassword());\r\n        map.put("className", datasourcePro.getDriverClassName());\r\n        map.put("type", datasourcePro.getType());\r\n\r\n        return map;\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-properties",children:"spring.datasource.url=jdbc:mysql://127.0.0.1:8888/test?useUnicode=false&autoReconnect=true&characterEncoding=utf-8\r\nspring.datasource.username=root\r\nspring.datasource.password=root\r\nspring.datasource.driver-class-name=com.mysql.jdbc.Driver\r\nspring.datasource.type=com.alibaba.druid.pool.DruidDataSource\n"})}),"\n",(0,a.jsx)(e.h3,{id:"23-enableconfigurationproperties-\u6807\u6ce8\u5728\u7c7b\u4e0a\u4f7f\u7528",children:"2.3. @EnableConfigurationProperties \u6807\u6ce8\u5728\u7c7b\u4e0a\u4f7f\u7528"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'@EnableConfigurationProperties(prefix = "spring.datasource.druid.read")\r\n@Configuration\r\npublic class DruidDataSourceConfig {\r\n    /**\r\n     * DataSource \u914d\u7f6e\r\n     * @return\r\n     */\r\n    @ConfigurationProperties(prefix = "spring.datasource.druid.read")\r\n    @Bean(name = "readDruidDataSource")\r\n    public DataSource readDruidDataSource(JDBCProperties properties) {\r\n        DruidDataSource dataSource = new DruidDataSource();\r\n        // dataSource.setUrl(properties.getXX)\r\n        return dataSource;\r\n    }\r\n\r\n\r\n    /**\r\n     * DataSource \u914d\u7f6e\r\n     * @return\r\n     */\r\n    @ConfigurationProperties(prefix = "spring.datasource.druid.write")\r\n    @Bean(name = "writeDruidDataSource")\r\n    @Primary\r\n    public DataSource writeDruidDataSource() {\r\n        return new DruidDataSource();\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(e.h2,{id:"5spring-cache-\u4e0d\u8db3",children:"5.spring-cache \u4e0d\u8db3"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"1\u3001\u8bfb\u6a21\u5f0f:\r\n\t\u7f13\u5b58\u7a7f\u900f:\u67e5\u8be2\u4e00\u4e2aDB\u4e0d\u5b58\u5728\u7684\u6570\u636e\u3002\u89e3\u51b3:\u7f13\u5b58\u7a7a\u6570\u636e;ache-null-values=true\u3010\u5e03\u9686\u8fc7\u6ee4\u5668\u3011\r\n\t\u7f13\u5b58\u51fb\u7a7f:\u5927\u91cf\u5e76\u53d1\u8fdb\u6765\u540c\u65f6\u67e5\u8be2\u4e00\u4e2a\u6b63\u597d\u8fc7\u671f\u7684\u6570\u636e\u3002\u89e3\u51b3:\u52a0\u9501; \u9ed8\u8ba4\u672a\u52a0\u9501\u3010sync = true\u3011\u53ea\u662f\u672c\u5730\u9501\r\n\t\u7f13\u5b58\u96ea\u5d29:\u5927\u91cf\u7684key\u540c\u65f6\u8fc7\u671f\u3002\u89e3\u51b3:\u52a0\u4e0a\u8fc7\u671f\u65f6\u95f4\u3002: spring.cache.redis.time-to-live= 360000s\r\n2\u3001\u5199\u6a21\u5f0f:\uff08\u7f13\u5b58\u4e0e\u6570\u636e\u5e93\u4e00\u81f4)\uff08\u6ca1\u6709\u89e3\u51b3\uff09\r\n\t1)\u3001\u624b\u52a8\u8bfb\u5199\u52a0\u9501\u3002\r\n\t2)\u3001\u5f15\u5165canal\uff0c\u611f\u77e5mysql\u7684\u66f4\u65b0\u53bb\u66f4\u65b0\u7f13\u5b58\r\n\t3)\u3001\u8bfb\u591a\u5199\u591a\uff0c\u76f4\u63a5\u53bb\u67e5\u8be2\u6570\u636e\u5e93\u5c31\u884c\r\n\r\n\u603b\u7ed3:\r\n\t\u5e38\u89c4\u6570\u636e\uff08\u8bfb\u591a\u5199\u5c11\uff0c\u5373\u65f6\u6027\uff0c\u4e00\u81f4\u6027\u8981\u6c42\u4e0d\u9ad8\u7684\u6570\u636e\uff09\ufe54\u5b8c\u5168\u53ef\u4ee5\u4f7f\u7528Spring-Cache\uff0c\u5199\u6a21\u5f0f(\u53ea\u8981\u7f13\u5b58\u7684\u6570\u636e\u6709\u8fc7\u671f\u65f6\u95f4\u5c31\u53ef\u4ee5\uff09\r\n\t\u7279\u6b8a\u6570\u636e:\u7279\u6b8a\u8bbe\u8ba1\uff08canal\u3001\u8bfb\u5199\u9501\uff09\r\n\r\n\r\n\u5728RedisCache\u91cc\u9762\u6253\u65ad\u70b9\u67e5\u770bget\u540c\u6b65\u65b9\u6cd5\n"})}),"\n",(0,a.jsx)(e.h3,{id:"\u6700\u7ec8\u7248\u5931\u6548\u6a21\u5f0f\u89e3\u51b3\u51fb\u7a7f\u96ea\u5d29\u7a7f\u900f\u672c\u5730\u9501",children:"\u6700\u7ec8\u7248\uff1a\u5931\u6548\u6a21\u5f0f+\u89e3\u51b3\u51fb\u7a7f\u3001\u96ea\u5d29\u3001\u7a7f\u900f\uff08\u672c\u5730\u9501\uff09"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u7ea7\u8054\u66f4\u65b0\u6240\u6709\u5173\u8054\u8868\u7684\u5197\u4f59\u6570\u636e\r\n * \u7f13\u5b58\u7b56\u7565\uff1a\u5931\u6548\u6a21\u5f0f\uff0c\u65b9\u6cd5\u6267\u884c\u5b8c\u5220\u9664\u7f13\u5b58\r\n */\r\n@CacheEvict(value = {"category"}, allEntries = true)\r\n@Transactional\r\n@Override\r\npublic void updateCascade(CategoryEntity category) {\r\n    this.updateById(category);\r\n    if (!StringUtils.isEmpty(category.getName())) {\r\n        // \u66f4\u65b0\u5197\u4f59\u8868\r\n        categoryBrandRelationService.updateCategory(category.getCatId(), category.getName());\r\n        // TODO \u66f4\u65b0\u5176\u4ed6\u5197\u4f59\u8868\r\n    }\r\n}\r\n\r\n/**\r\n * \u67e5\u51fa\u6240\u67091\u7ea7\u5206\u7c7b\r\n */\r\n@Cacheable(value = {"category"}, key = "\'getLevel1Categorys\'", sync = true)\r\n@Override\r\npublic List<CategoryEntity> getLevel1Categorys() {\r\n    System.out.println("\u8c03\u7528\u4e86getLevel1Categorys...");\r\n    // \u67e5\u8be2\u7236id=0\r\n    return baseMapper.selectList(new QueryWrapper<CategoryEntity>().eq("parent_cid", 0));\r\n}\r\n\r\n/**\r\n * \u67e5\u8be2\u4e09\u7ea7\u5206\u7c7b\u5e76\u5c01\u88c5\u6210Map\u8fd4\u56de\r\n * \u4f7f\u7528SpringCache\u6ce8\u89e3\u65b9\u5f0f\u7b80\u5316\u7f13\u5b58\u8bbe\u7f6e\r\n */\r\n@Cacheable(value = {"category"}, key = "\'getCatalogJson\'", sync = true)\r\n@Override\r\npublic Map<String, List<Catalog2VO>> getCatalogJsonWithSpringCache() {\r\n    // \u672a\u547d\u4e2d\u7f13\u5b58\r\n    // 1.double check\uff0c\u5360\u9501\u6210\u529f\u9700\u8981\u518d\u6b21\u68c0\u67e5\u7f13\u5b58\uff08springcache\u4f7f\u7528\u672c\u5730\u9501\uff09\r\n    // \u67e5\u8be2\u975e\u7a7a\u5373\u8fd4\u56de\r\n    String catlogJSON = redisTemplate.opsForValue().get("getCatalogJson");\r\n    if (!StringUtils.isEmpty(catlogJSON)) {\r\n        // \u67e5\u8be2\u6210\u529f\u76f4\u63a5\u8fd4\u56de\u4e0d\u9700\u8981\u67e5\u8be2DB\r\n        Map<String, List<Catalog2VO>> result = JSON.parseObject(catlogJSON, new TypeReference<Map<String, List<Catalog2VO>>>() {\r\n        });\r\n        return result;\r\n    }\r\n\r\n    // 2.\u67e5\u8be2\u6240\u6709\u5206\u7c7b\uff0c\u6309\u7167parentCid\u5206\u7ec4\r\n    Map<Long, List<CategoryEntity>> categoryMap = baseMapper.selectList(null).stream()\r\n            .collect(Collectors.groupingBy(key -> key.getParentCid()));\r\n\r\n    // 3.\u83b7\u53d61\u7ea7\u5206\u7c7b\r\n    List<CategoryEntity> level1Categorys = categoryMap.get(0L);\r\n\r\n    // 4.\u5c01\u88c5\u6570\u636e\r\n    Map<String, List<Catalog2VO>> result = level1Categorys.stream().collect(Collectors.toMap(key -> key.getCatId().toString(), l1Category -> {\r\n        // 5.\u67e5\u8be22\u7ea7\u5206\u7c7b\uff0c\u5e76\u5c01\u88c5\u6210List<Catalog2VO>\r\n        List<Catalog2VO> catalog2VOS = categoryMap.get(l1Category.getCatId())\r\n                .stream().map(l2Category -> {\r\n                    // 7.\u67e5\u8be23\u7ea7\u5206\u7c7b\uff0c\u5e76\u5c01\u88c5\u6210List<Catalog3VO>\r\n                    List<Catalog2VO.Catalog3Vo> catalog3Vos = categoryMap.get(l2Category.getCatId())\r\n                            .stream().map(l3Category -> {\r\n                                // \u5c01\u88c53\u7ea7\u5206\u7c7bVO\r\n                                Catalog2VO.Catalog3Vo catalog3Vo = new Catalog2VO.Catalog3Vo(l2Category.getCatId().toString(), l3Category.getCatId().toString(), l3Category.getName());\r\n                                return catalog3Vo;\r\n                            }).collect(Collectors.toList());\r\n                    // \u5c01\u88c52\u7ea7\u5206\u7c7bVO\u8fd4\u56de\r\n                    Catalog2VO catalog2VO = new Catalog2VO(l1Category.getCatId().toString(), catalog3Vos, l2Category.getCatId().toString(), l2Category.getName());\r\n                    return catalog2VO;\r\n                }).collect(Collectors.toList());\r\n        return catalog2VOS;\r\n    }));\r\n    return result;\r\n}\n'})}),"\n",(0,a.jsx)(e.h1,{id:"stringredistemplate",children:"StringRedisTemplate"}),"\n",(0,a.jsx)(e.h2,{id:"1\u4e00\u4e9b\u4f7f\u7528\u6848\u4f8b",children:"1.\u4e00\u4e9b\u4f7f\u7528\u6848\u4f8b"}),"\n",(0,a.jsx)(e.h3,{id:"11boundhashoperations",children:"1.1.BoundHashOperations"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u6839\u636e\u7528\u6237\u4fe1\u606f\u83b7\u53d6\u8d2d\u7269\u8f66redis\u64cd\u4f5c\u5bf9\u8c61\r\n */\r\nprivate BoundHashOperations<String, Object, Object> getCartOps() {\r\n    // \u83b7\u53d6\u7528\u6237\u767b\u5f55\u4fe1\u606f\r\n    UserInfoTO userInfo = CartInterceptor.threadLocal.get();\r\n    String cartKey = "";\r\n    if (userInfo.getUserId() != null) {\r\n        // \u767b\u5f55\u6001\uff0c\u4f7f\u7528\u7528\u6237\u8d2d\u7269\u8f66\r\n        cartKey = CartConstant.CART_PREFIX + userInfo.getUserId();\r\n    } else {\r\n        // \u975e\u767b\u5f55\u6001\uff0c\u4f7f\u7528\u6e38\u5ba2\u8d2d\u7269\u8f66\r\n        cartKey = CartConstant.CART_PREFIX + userInfo.getUserKey();\r\n    }\r\n    // \u7ed1\u5b9a\u8d2d\u7269\u8f66\u7684key\u64cd\u4f5cRedis\r\n    BoundHashOperations<String, Object, Object> operations = redisTemplate.boundHashOps(cartKey);\r\n    return operations;\r\n}\n'})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"get \u65b9\u6cd5\uff1a"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"/**\r\n * \u6839\u636eskuId\u83b7\u53d6\u8d2d\u7269\u8f66\u5546\u54c1\u4fe1\u606f\r\n */\r\n@Override\r\npublic CartItemVO getCartItem(Long skuId) {\r\n    // \u83b7\u53d6\u8d2d\u7269\u8f66redis\u64cd\u4f5c\u5bf9\u8c61\r\n    BoundHashOperations<String, Object, Object> cartOps = getCartOps();\r\n    String cartItemJSONString = (String) cartOps.get(skuId.toString());\r\n    CartItemVO cartItemVo = JSON.parseObject(cartItemJSONString, CartItemVO.class);\r\n    return cartItemVo;\r\n}\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"put \u65b9\u6cd5\uff1a"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'/**\r\n * \u6dfb\u52a0sku\u5546\u54c1\u5230\u8d2d\u7269\u8f66\r\n */\r\n@Override\r\npublic CartItemVO addToCart(Long skuId, Integer num) throws ExecutionException, InterruptedException {\r\n    // \u83b7\u53d6\u8d2d\u7269\u8f66redis\u64cd\u4f5c\u5bf9\u8c61\r\n    BoundHashOperations<String, Object, Object> operations = getCartOps();\r\n    // \u83b7\u53d6\u5546\u54c1\r\n    String cartItemJSONString = (String) operations.get(skuId.toString());\r\n    if (StringUtils.isEmpty(cartItemJSONString)) {\r\n        // \u8d2d\u7269\u8f66\u4e0d\u5b58\u5728\u6b64\u5546\u54c1\uff0c\u9700\u8981\u5c06\u5f53\u524d\u5546\u54c1\u6dfb\u52a0\u5230\u8d2d\u7269\u8f66\u4e2d\r\n        CartItemVO cartItem = new CartItemVO();\r\n        CompletableFuture<Void> getSkuInfoFuture = CompletableFuture.runAsync(() -> {\r\n            // \u8fdc\u7a0b\u67e5\u8be2\u5f53\u524d\u5546\u54c1\u4fe1\u606f\r\n            R r = productFeignService.getInfo(skuId);\r\n            SkuInfoVO skuInfo = r.getData("skuInfo", new TypeReference<SkuInfoVO>() {\r\n            });\r\n            cartItem.setSkuId(skuInfo.getSkuId());// \u5546\u54c1ID\r\n            cartItem.setTitle(skuInfo.getSkuTitle());// \u5546\u54c1\u6807\u9898\r\n            cartItem.setImage(skuInfo.getSkuDefaultImg());// \u5546\u54c1\u9ed8\u8ba4\u56fe\u7247\r\n            cartItem.setPrice(skuInfo.getPrice());// \u5546\u54c1\u5355\u4ef7\r\n            cartItem.setCount(num);// \u5546\u54c1\u4ef6\u6570\r\n            cartItem.setCheck(true);// \u662f\u5426\u9009\u4e2d\r\n        }, executor);\r\n\r\n        CompletableFuture<Void> getSkuAttrValuesFuture = CompletableFuture.runAsync(() -> {\r\n            // \u8fdc\u7a0b\u67e5\u8be2attrName:attrValue\u4fe1\u606f\r\n            List<String> skuSaleAttrValues = productFeignService.getSkuSaleAttrValues(skuId);\r\n            cartItem.setSkuAttrValues(skuSaleAttrValues);\r\n        }, executor);\r\n\r\n        CompletableFuture.allOf(getSkuInfoFuture, getSkuAttrValuesFuture).get();\r\n        operations.put(skuId.toString(), JSON.toJSONString(cartItem));\r\n        return cartItem;\r\n    } else {\r\n        // \u5f53\u524d\u8d2d\u7269\u8f66\u5df2\u5b58\u5728\u6b64\u5546\u54c1\uff0c\u4fee\u6539\u5f53\u524d\u5546\u54c1\u6570\u91cf\r\n        CartItemVO cartItem = JSON.parseObject(cartItemJSONString, CartItemVO.class);\r\n        cartItem.setCount(cartItem.getCount() + num);\r\n        operations.put(skuId.toString(), JSON.toJSONString(cartItem));\r\n        return cartItem;\r\n    }\r\n}\n'})})]})}function g(r={}){const{wrapper:e}={...(0,i.R)(),...r.components};return e?(0,a.jsx)(e,{...r,children:(0,a.jsx)(d,{...r})}):d(r)}}}]);